function polyfillForEach(){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){"undefined"==typeof t&&(t=window);for(var i=0;i<this.length;i++)e.call(t,this[i],i,this)})}function polyFillClone(){"function"!=typeof Array.prototype.clone&&(Array.prototype.clone=function(){return this.slice(0)})}function shallowEquals(){"function"!=typeof Array.prototype.shallowEquals&&(Array.prototype.shallowEquals=function(e){if(this===e)return!0;if(null===this||null===e)return!1;if(this.length!==e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!==e[t])return!1;return!0})}Array.prototype.insert=function(e,t){this.splice(e,0,t)},function(){polyfillForEach(),polyFillClone(),shallowEquals()}(),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return e.length>0&&this.substring(0,e.length)===e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return e.length>0&&this.substring(this.length-e.length,this.length)===e}),String.prototype.replaceAll=function(e,t){var i=this.split(e).join(t);return i},String.prototype.toCamelCase=function(){var e=this.charAt(0).toLowerCase()+this.substring(1);return e=e.replaceAll("-","")},String.prototype.toPascalCase=function(){var e=this.charAt(0).toUpperCase()+this.substring(1);return e=e.replaceAll("-","")},String.prototype.hashCode=function(){var e,t=0;if(0===this.length)return t;for(var i=0;i<this.length;i++)e=this.charCodeAt(i),t=(t<<5)-t+e,t&=t;return t},NodeList.prototype.forEach=Array.prototype.forEach,NodeList.prototype.length=Array.prototype.length,HTMLElement.prototype.knownElementTypes=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","col","colgroup","content","code","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marque","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],HTMLElement.prototype.isKnownType=function(){if(!Bifrost.isNullOrUndefined("HTMLUnknownElement"))return this.constructor.toString().indexOf("HTMLUnknownElement")<0;var e=this.constructor!==HTMLElement;if(e===!1){var t=this.tagName.toLowerCase();e=this.knownElementTypes.some(function(e){if(t===e)return!0})}return e},HTMLElement.prototype.getChildElements=function(){var e=[];return this.childNodes.forEach(function(t){1===t.nodeType&&e.push(t)}),e},HTMLCollection.prototype.forEach=Array.prototype.forEach,HTMLCollection.prototype.length=Array.prototype.length,Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&!function(e){"use strict";if("Element"in e){var t="classList",i="prototype",n=e.Element[i],r=Object,o=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[i].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},f=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},u=function(e){for(var t=o.call(e.getAttribute("class")||""),i=t?t.split(/\s+/):[],n=0,r=i.length;n<r;n++)this.push(i[n]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=u[i]=[],l=function(){return new u(this)};if(a[i]=Error[i],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",f(this,e)!==-1},c.add=function(){var e,t=arguments,i=0,n=t.length,r=!1;do e=t[i]+"",f(this,e)===-1&&(this.push(e),r=!0);while(++i<n);r&&this._updateClassName()},c.remove=function(){var e,t=arguments,i=0,n=t.length,r=!1;do{e=t[i]+"";var o=f(this,e);o!==-1&&(this.splice(o,1),r=!0)}while(++i<n);r&&this._updateClassName()},c.toggle=function(e,t){e+="";var i=this.contains(e),n=i?t!==!0&&"remove":t!==!1&&"add";return n&&this[n](e),!i},c.toString=function(){return this.join(" ")},r.defineProperty){var d={get:l,enumerable:!0,configurable:!0};try{r.defineProperty(n,t,d)}catch(e){e.number===-2146823252&&(d.enumerable=!1,r.defineProperty(n,t,d))}}else r[i].__defineGetter__&&n.__defineGetter__(t,l)}}(self),this.Element&&function(e,t){function i(){}i.prototype.length=Array.prototype.length,e.matchesSelector=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this.parentNode.querySelectorAll(e),i=-1;t[++i]&&t[i]!=this;);return!!t[i]},e.ancestorQuerySelectorAll=e.ancestorQuerySelectorAll||e.mozAncestorQuerySelectorAll||e.msAncestorQuerySelectorAll||e.oAncestorQuerySelectorAll||e.webkitAncestorQuerySelectorAll||function(e){for(var t=this,n=new i;t=t.parentElement;)t.matchesSelector(e)&&Array.prototype.push.call(n,t);return n},e.ancestorQuerySelector=e.ancestorQuerySelector||e.mozAncestorQuerySelector||e.msAncestorQuerySelector||e.oAncestorQuerySelector||e.webkitAncestorQuerySelector||function(e){return this.ancestorQuerySelectorAll(e)[0]||null}}(Element.prototype);var Bifrost=Bifrost||{};!function(e,t){Bifrost.extend=function(e,t){return $.extend(e,t)}}(window);var Bifrost=Bifrost||{};Bifrost.namespace=function(e,t){e=e.replaceAll("..","."),e.endsWith(".")&&(e=e.substr(0,e.length-1)),e.startsWith(".")&&(e=e.substr(1));var i=window,n="",r=e.split(".");if(r.forEach(function(e){n.length>0&&(n+="."),n+=e,Object.prototype.hasOwnProperty.call(i,e)||(i[e]={},i[e].parent=i,i[e].name=n),i=i[e]}),"object"==typeof t){Bifrost.namespace.current=i;var o;for(o in t)i[o]=t[o];for(o in i)i.hasOwnProperty(o)&&(i[o]._namespace=i,i[o]._name=o);Bifrost.namespace.current=null}return i},Bifrost.namespace("Bifrost.execution",{Promise:function(){function e(){null!=t.callback&&"undefined"!=typeof t.callback&&("undefined"!=typeof t.signalParameter?t.callback(t.signalParameter,Bifrost.execution.Promise.create()):t.callback(Bifrost.execution.Promise.create()))}var t=this;this.id=Bifrost.Guid.create(),this.signalled=!1,this.callback=null,this.error=null,this.hasFailed=!1,this.failedCallback=null,this.fail=function(e){null!=t.failedCallback&&t.failedCallback(e),t.hasFailed=!0,t.error=e},this.onFail=function(e){return t.hasFailed?e(t.error):t.failedCallback=e,t},this.signal=function(i){t.signalled=!0,t.signalParameter=i,e()},this.continueWith=function(i){return this.callback=i,t.signalled===!0&&e(),t}}}),Bifrost.execution.Promise.create=function(){var e=new Bifrost.execution.Promise;return e},Bifrost.namespace("Bifrost",{isObject:function(e){return null!==e&&"undefined"!=typeof e&&"[object Object]"===Object.prototype.toString.call(e)}}),Bifrost.namespace("Bifrost",{isNumber:function(e){return!(Bifrost.isString(e)&&e.length>1&&"0"===e[0])&&(!isNaN(parseFloat(e))&&isFinite(e))}}),Bifrost.namespace("Bifrost",{isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)}}),Bifrost.namespace("Bifrost",{isString:function(e){return"string"==typeof e}}),Bifrost.namespace("Bifrost",{isNull:function(e){return null===e}}),Bifrost.namespace("Bifrost",{isUndefined:function(e){return"undefined"==typeof e}}),Bifrost.namespace("Bifrost",{isNullOrUndefined:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}}),Bifrost.namespace("Bifrost",{isFunction:function(e){return"function"==typeof e}}),Bifrost.namespace("Bifrost",{isType:function(e){return!Bifrost.isNullOrUndefined(e)&&"undefined"!=typeof e._typeId}}),Bifrost.namespace("Bifrost",{functionParser:{parse:function(e){var t=[],i=e.toString().match(/function\w*\s*\((.*?)\)/);if(null!==i){var n=i[1].split(/\s*,\s*/);n.forEach(function(e){e.trim().length>0&&t.push({name:e})})}return t}}}),Bifrost.namespace("Bifrost",{assetsManager:{scripts:[],isInitialized:function(){return Bifrost.assetsManager.scripts.length>0},initialize:function(){var e=Bifrost.execution.Promise.create();return Bifrost.assetsManager.isInitialized()?e.signal():$.get("/Bifrost/AssetsManager",{extension:"js"},function(t){Bifrost.assetsManager.initializeFromAssets(t),e.signal()},"json"),e},initializeFromAssets:function(e){Bifrost.assetsManager.isInitialized()||(Bifrost.assetsManager.scripts=e,Bifrost.namespaces.create().initialize())},getScripts:function(){return Bifrost.assetsManager.scripts},hasScript:function(e){return Bifrost.assetsManager.scripts.some(function(t){return t===e})},getScriptPaths:function(){var e=[];return Bifrost.assetsManager.scripts.forEach(function(t){var i=Bifrost.Path.getPathWithoutFilename(t);e.indexOf(i)===-1&&e.push(i)}),e}}}),Bifrost.namespace("Bifrost",{WellKnownTypesDependencyResolver:function(){var e=this;this.types=Bifrost.WellKnownTypesDependencyResolver.types,this.canResolve=function(t,i){return e.types.hasOwnProperty(i)},this.resolve=function(t,i){return e.types[i]}}}),Bifrost.WellKnownTypesDependencyResolver.types={options:{}},Bifrost.namespace("Bifrost",{dependencyResolver:function(){function e(e,t){var i=Bifrost.dependencyResolvers.getAll(),n=null;return i.forEach(function(i){if(null==n){var r=i.canResolve(e,t);return r?void(n=i.resolve(e,t)):void 0}}),n}function t(e){if(null!=e&&null!==e._super){if("undefined"!=typeof e._super&&e._super===Bifrost.Type)return!0;if(t(e._super)===!0)return!0}return!1}function i(e){return t(e)?e.create():e}function n(e){var t=Bifrost.execution.Promise.create();return null!=e&&null!==e._super&&"undefined"!=typeof e._super&&e._super===Bifrost.Type?e.beginCreate().continueWith(function(e,i){t.signal(e)}):t.signal(e),t}return{getDependenciesFor:function(e){for(var t=[],i=Bifrost.functionParser.parse(e),n=0;n<i.length;n++)t.push(i[n].name);return t},canResolve:function(e,t){var i=Bifrost.dependencyResolvers.getAll(),n=!1;return i.forEach(function(i){n!==!0&&(n=i.canResolve(e,t))}),n},resolve:function(t,n){var r=e(t,n);if("undefined"==typeof r||null===r)throw console.log("Unable to resolve '"+n+"' in '"+t+"'"),new Bifrost.UnresolvedDependencies;if(r instanceof Bifrost.execution.Promise)throw console.log("'"+n+"' was resolved as an asynchronous dependency, consider using beginCreate() or make the dependency available prior to calling create"),new Bifrost.AsynchronousDependenciesDetected;return i(r)},beginResolve:function(t,r){var o=Bifrost.execution.Promise.create();return Bifrost.configure.ready(function(){var s=e(t,r);"undefined"!=typeof s&&null!==s||(console.log("Unable to resolve '"+r+"' in '"+t+"'"),o.fail(new Bifrost.UnresolvedDependencies)),s instanceof Bifrost.execution.Promise?s.continueWith(function(e,t){n(e).continueWith(function(e,t){o.signal(i(e))}).onFail(function(e){o.fail(e)})}):o.signal(i(s))}),o}}}()}),Bifrost.WellKnownTypesDependencyResolver.types.dependencyResolver=Bifrost.dependencyResolver,Bifrost.namespace("Bifrost",{dependencyResolvers:function(){return{getAll:function(){var e=[new Bifrost.WellKnownTypesDependencyResolver,new Bifrost.DefaultDependencyResolver,new Bifrost.KnownArtifactTypesDependencyResolver,new Bifrost.KnownArtifactInstancesDependencyResolver];for(var t in this)0!==t.indexOf("_")&&this.hasOwnProperty(t)&&"function"!=typeof this[t]&&e.push(this[t]);return e}}}()}),Bifrost.namespace("Bifrost",{DefaultDependencyResolver:function(){var e=this;this.doesNamespaceHave=function(e,t){return e.hasOwnProperty(t)},this.doesNamespaceHaveScriptReference=function(e,t){if(e.hasOwnProperty("_scripts")&&Bifrost.isArray(e._scripts))for(var i=0;i<e._scripts.length;i++){var n=e._scripts[i];if(n===t)return!0}return!1},this.getFileName=function(e,t){var i="";return"undefined"!=typeof e._path&&(i+=e._path,i.endsWith("/")||(i+="/")),i+=t,i.endsWith(".js")||(i+=".js"),i=i.replaceAll("//","/")},this.loadScriptReference=function(t,i,n){var r=e.getFileName(t,i),o=Bifrost.io.fileFactory.create().create(r,Bifrost.io.fileType.javaScript);Bifrost.io.fileManager.create().load([o]).continueWith(function(r){var o=r[0];e.doesNamespaceHave(t,i)&&(o=t[i]),n.signal(o)})},this.canResolve=function(t,i){for(var n=t;null!=n&&n!==window;){if(e.doesNamespaceHave(n,i))return!0;if(e.doesNamespaceHaveScriptReference(n,i))return!0;if(n===n.parent)break;n=n.parent}return!1},this.resolve=function(t,i){for(var n=t;null!=n&&n!==window;){if(e.doesNamespaceHave(n,i))return n[i];if(e.doesNamespaceHaveScriptReference(n,i)){var r=Bifrost.execution.Promise.create();return e.loadScriptReference(n,i,r),r}if(n===n.parent)break;n=n.parent}return null}}}),Bifrost.dependencyResolvers.DOMRootDependencyResolver={canResolve:function(e,t){return"DOMRoot"===t},resolve:function(e,t){if(null!=document.body&&"undefined"!=typeof document.body)return document.body;var i=Bifrost.execution.Promise.create();return Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.push(i),i}},Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises=[],Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady=function(){Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.forEach(function(e){e.signal(document.body)})},Bifrost.namespace("Bifrost",{KnownArtifactTypesDependencyResolver:function(){function e(e,t){var i=e.name.split("."),n=t.name.split(".");if(i.length>n.length)return!1;for(var r=0;r<i.length;r++)if(i[r]!==n[r])return!1;return!0}var t={readModelTypes:Bifrost.read.ReadModelOf,commandTypes:Bifrost.commands.Command,queryTypes:Bifrost.read.Query};this.canResolve=function(e,i){return i in t},this.resolve=function(i,n){var r=t[n],o=r.getExtendersIn(i),s={};return o.forEach(function(t){var i=t._name;s[i]&&!e(s[i]._namespace,t._namespace)||(s[i]=t)}),s}}}),Bifrost.namespace("Bifrost",{KnownArtifactInstancesDependencyResolver:function(){function e(e,t){var i=e.name.split("."),n=t.name.split(".");if(i.length>n.length)return!1;for(var r=0;r<i.length;r++)if(i[r]!==n[r])return!1;return!0}var t={readModels:Bifrost.read.ReadModelOf,commands:Bifrost.commands.Command,queries:Bifrost.read.Query};this.canResolve=function(e,i){return i in t},this.resolve=function(i,n){var r=t[n],o=r.getExtendersIn(i),s={};o.forEach(function(t){var i=t._name;s[i]&&!e(s[i]._namespace,t._namespace)||(s[i]=t)});var a={};for(var f in s)a[f]=s[f].create();return a}}}),Bifrost.namespace("Bifrost",{Guid:{create:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},empty:"00000000-0000-0000-0000-000000000000"}}),Bifrost.namespace("Bifrost",{Type:function(){}}),function(){function throwIfMissingTypeDefinition(e){if(null==e||"undefined"==typeof e)throw new Bifrost.MissingTypeDefinition}function throwIfTypeDefinitionIsObjectLiteral(e){if("object"==typeof e)throw new Bifrost.ObjectLiteralNotAllowed}function addStaticProperties(e){for(var t in Bifrost.Type)Bifrost.Type.hasOwnProperty(t)&&"_extenders"!==t&&(e[t]=Bifrost.Type[t])}function setupDependencies(typeDefinition){typeDefinition._dependencies=Bifrost.dependencyResolver.getDependenciesFor(typeDefinition);var firstParameter=!0,createFunctionString="Function('definition', 'dependencies','return new definition(";"undefined"!=typeof typeDefinition._dependencies&&typeDefinition._dependencies.forEach(function(e,t){firstParameter||(createFunctionString+=","),firstParameter=!1,createFunctionString+="dependencies["+t+"]"}),createFunctionString+=");')",typeDefinition.createFunction=eval(createFunctionString)}function getDependencyInstances(e,t){var i=[];return"undefined"!=typeof t._dependencies&&t._dependencies.forEach(function(t){var n=Bifrost.dependencyResolver.resolve(e,t);i.push(n)}),i}function resolve(e,t,i,n,r,o){var s=Bifrost.dependencyResolver.beginResolve(e,t).continueWith(function(e,t){n[i]=e,o(e,t)});return s}function beginGetDependencyInstances(e,t,i){function n(e,t){s++,s===a&&r.signal(o)}var r=Bifrost.execution.Promise.create(),o=[],s=0;if("undefined"!=typeof t._dependencies)for(var a=t._dependencies.length,f="",u=0;u<a;u++)f=t._dependencies[u],i&&i.hasOwnProperty(f)?(o[u]=i[f],s++,s===a&&r.signal(o)):resolve(e,f,u,o,t,n).onFail(r.fail);return r}function expandInstancesHashToDependencies(e,t,i){if("undefined"!=typeof e._dependencies&&null!=e._dependencies)for(var n in t)for(var r=0;r<e._dependencies.length;r++)e._dependencies[r]===n&&(i[r]=t[n])}function expandDependenciesToInstanceHash(e,t,i){for(var n=0;n<t.length;n++)i[e._dependencies[n]]=t[n]}function resolveDependencyInstancesThatHasNotBeenResolved(e,t){e.forEach(function(i,n){if(null==i||"undefined"==typeof i){var r=t._dependencies[n];e[n]=Bifrost.dependencyResolver.resolve(t._namespace,r)}})}function resolveDependencyInstances(e,t){var i=[];return"object"==typeof e&&expandInstancesHashToDependencies(t,e,i),"undefined"!=typeof t._dependencies&&t._dependencies.length>0&&(i.length>0?resolveDependencyInstancesThatHasNotBeenResolved(i,t):i=getDependencyInstances(t._namespace,t)),i}function addMissingDependenciesAsNullFromTypeDefinition(e,t){if("undefined"!=typeof t._dependencies&&"undefined"!=typeof e&&null!=e)for(var i=0;i<t._dependencies.length;i++){var n=t._dependencies[i];n in e||(e[n]=null)}}function handleOnCreate(e,t,i){null!=i&&"undefined"!=typeof i&&("undefined"!=typeof e&&"undefined"!=typeof e.prototype&&handleOnCreate(e._super,t,e.prototype),i.hasOwnProperty("onCreated")&&"function"==typeof i.onCreated&&i.onCreated(t))}Bifrost.Type._extenders=[],Bifrost.Type.scope={getFor:function(e,t){return null}},Bifrost.Type.typeOf=function(e){if("undefined"==typeof this._super||"undefined"==typeof this._super._typeId)return!1;if(this._super._typeId===e._typeId)return!0;if("undefined"!=typeof e._super){var t=this._super.typeOf(e);if(t===!0)return!0}return!1},Bifrost.Type.getExtenders=function(){return this._extenders},Bifrost.Type.getExtendersIn=function(e){var t=[];return this._extenders.forEach(function(i){for(var n=e;n!==window;){if(i._namespace===n){t.push(i);break}if(Bifrost.isUndefined(n.parent))break;n=n.parent}}),t},Bifrost.Type.extend=function(e){return throwIfMissingTypeDefinition(e),throwIfTypeDefinitionIsObjectLiteral(e),addStaticProperties(e),setupDependencies(e),e._super=this,e._typeId=Bifrost.Guid.create(),e._extenders=[],Bifrost.Type.registerExtender(this,e),e},Bifrost.Type.registerExtender=function(e,t){for(var i=e;null!=i;)i._extenders.indexOf(t)===-1&&i._extenders.push(t),i=i._super},Bifrost.Type.scopeTo=function(e){return"function"==typeof e?this.scope={getFor:e}:"function"==typeof e.getFor?this.scope=e:this.scope={getFor:function(){return e}},this},Bifrost.Type.defaultScope=function(){return this.scope={getFor:function(){return null}},this},Bifrost.Type.requires=function(){for(var e=0;e<arguments.length;e++)this._dependencies.push(arguments[e]);return this},Bifrost.Type.create=function(e,t){var i=this;null!=this._super&&(i.prototype=this._super.create(e,!0)),addMissingDependenciesAsNullFromTypeDefinition(e,this);var n=null;if(this!==Bifrost.Type&&(this.instancesPerScope=this.instancesPerScope||{},n=this.scope.getFor(this._namespace,this._name,this._typeId),null!=n&&this.instancesPerScope.hasOwnProperty(n)))return this.instancesPerScope[n];var r=null;if("undefined"!=typeof this.createFunction){var o=resolveDependencyInstances(e,this);r=this.createFunction(this,o)}else r=new i;return r._type=i,t!==!0&&handleOnCreate(i,r,r),null!=n&&(this.instancesPerScope[n]=r),r},Bifrost.Type.createWithoutScope=function(e,t){var i=this.scope;this.defaultScope();var n=this.create(e,t);return this.scope=i,n},Bifrost.Type.ensure=function(){var e=Bifrost.execution.Promise.create(),t=0,i=this._dependencies.length,n=this._namespace,r=Bifrost.dependencyResolver;return i>0?this._dependencies.forEach(function(o){r.canResolve(n,o)?r.beginResolve(n,o).continueWith(function(n){t++,t===i&&e.signal()}):(i--,t===i&&e.signal())}):e.signal(),e},Bifrost.Type.beginCreate=function(e){var t=this,i=Bifrost.execution.Promise.create(),n=Bifrost.execution.Promise.create();return n.onFail(function(e){i.fail(e)}),null!=this._super?this._super.beginCreate(e).continueWith(function(e,t){n.signal(e)}).onFail(function(e){i.fail(e)}):n.signal(null),n.continueWith(function(n,r){if(t.prototype=n,null==t._dependencies||"undefined"==typeof t._dependencies||0===t._dependencies.length){var o=t.create(e);i.signal(o)}else beginGetDependencyInstances(t._namespace,t,e).continueWith(function(n,r){var o={};if(expandDependenciesToInstanceHash(t,n,o),"object"==typeof e)for(var s in e)o[s]=e[s];try{var a=t.create(o);i.signal(a)}catch(e){i.fail(e)}})}),i}}(),Bifrost.namespace("Bifrost",{Singleton:function(e){return Bifrost.Type.extend(e).scopeTo(window)}}),Bifrost.namespace("Bifrost.types",{TypeInfo:Bifrost.Type.extend(function(){this.properties=[]})}),Bifrost.types.TypeInfo.createFrom=function(e){var t,i=Bifrost.types.TypeInfo.create();for(var n in e){var r=e[n];if(!Bifrost.isNullOrUndefined(r)){var o=r.constructor;Bifrost.isNullOrUndefined(e[n]._type)||(o=e[n]._type),t=Bifrost.types.PropertyInfo.create({name:n,type:o})}i.properties.push(t)}return i},Bifrost.namespace("Bifrost.types",{PropertyInfo:Bifrost.Type.extend(function(e,t){this.name=e,this.type=t})}),Bifrost.namespace("Bifrost",{Path:Bifrost.Type.extend(function(e){function t(e){var t=e.indexOf("?");return t>0&&(e=e.substr(0,t)),e}function i(e){var t=r.exec(e),i=(t[1]||"")+(t[2]||""),n=t[3]||"",s=o.exec(n),a=s[1]||"",f=s[2]||"",u=s[3]||"";return[i,a,f,u]}var n=this,r=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?([\\\/])?([\s\S]*?)$/,o=/^([\s\S]+[\\\/](?!$)|[\\\/])?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/\\]*)?)$/;e=t(e);var s=i(e);this.device=s[0]||"",this.directory=s[1]||"",this.filename=s[2]||"",this.extension=s[3]||"",this.filenameWithoutExtension=this.filename.replaceAll(this.extension,""),this.fullPath=e,this.hasExtension=function(){return!Bifrost.isNullOrUndefined(n.extension)&&""!==n.extension}})}),Bifrost.Path.makeRelative=function(e){return 0===e.indexOf("/")?e.substr(1):e},Bifrost.Path.getPathWithoutFilename=function(e){var t=e.lastIndexOf("/");return e.substr(0,t)},Bifrost.Path.getFilename=function(e){var t=e.lastIndexOf("/");return e.substr(t+1)},Bifrost.Path.getFilenameWithoutExtension=function(e){var t=this.getFilename(e),i=t.lastIndexOf(".");return t.substr(0,i)},Bifrost.Path.hasExtension=function(e){e.indexOf("?")>0&&(e=e.substr(0,e.indexOf("?")));var t=e.lastIndexOf(".");return t>0},Bifrost.Path.changeExtension=function(e,t){var i=Bifrost.Path.create({fullPath:e}),n=i.directory+i.filenameWithoutExtension+"."+t;return n},Bifrost.namespace("Bifrost"),Bifrost.DefinitionMustBeFunction=function(e){this.prototype=Error.prototype,this.name="DefinitionMustBeFunction",this.message=e||"Definition must be function"},Bifrost.MissingName=function(e){this.prototype=Error.prototype,this.name="MissingName",this.message=e||"Missing name"},Bifrost.Exception=function(e,t){function i(e){if(!e||"undefined"==typeof e)throw new Bifrost.MissingName}function n(e){if("function"!=typeof e)throw new Bifrost.DefinitionMustBeFunction}function r(e){var t=e.lastIndexOf(".");return t===-1&&t!==e.length?e:e.substr(t+1)}function o(t){var i=t.lastIndexOf(".");if(i===-1)return e;var n=t.substr(0,i);Bifrost.namespace(n);var r=e,o=n.split(".");return o.forEach(function(e){r=r[e]}),r}return{define:function(e,t,s){i(e);var a=o(e),f=r(e),u=function(e){this.name=f,this.message=e||t};u.prototype=Error.prototype,s&&"undefined"!=typeof s&&(n(s),s.prototype=Error.prototype,u.prototype=new s),a[f]=u}}}(window),Bifrost.namespace("Bifrost"),Bifrost.Exception.define("Bifrost.LocationNotSpecified","Location was not specified"),Bifrost.Exception.define("Bifrost.InvalidUriFormat","Uri format specified is not valid"),Bifrost.Exception.define("Bifrost.ObjectLiteralNotAllowed","Object literal is not allowed"),Bifrost.Exception.define("Bifrost.MissingTypeDefinition","Type definition was not specified"),Bifrost.Exception.define("Bifrost.AsynchronousDependenciesDetected","You should consider using Type.beginCreate() or dependencyResolver.beginResolve() for systems that has asynchronous dependencies"),Bifrost.Exception.define("Bifrost.UnresolvedDependencies","Some dependencies was not possible to resolve"),Bifrost.namespace("Bifrost"),Bifrost.hashString=function(){return{decode:function(e){if(""===e)return{};e=e.replace("/?","").split("&");for(var t={},i=0;i<e.length;++i){var n=e[i].split("=",2);if(2===n.length){var r=decodeURIComponent(n[1].replace(/\+/g," "));""===r||isNaN(r)||(r=parseFloat(r)),t[n[0]]=r}}return t}}}(),Bifrost.namespace("Bifrost"),Bifrost.Uri=function(e,t){function i(e){for(var t=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],i=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),n={},r=0;r<10;r++)n[t[r]]=i[r]?i[r]:"";return n.directoryPath.length>0&&(n.directoryPath=n.directoryPath.replace(/\/?$/,"/")),n}function n(t){var n=this;this.setLocation=function(t){n.fullPath=t,t=t.replace("#!","/");var r=i(t);if(!r.protocol||"undefined"==typeof r.protocol)throw new Bifrost.InvalidUriFormat("Uri ('"+t+"') was in the wrong format");n.scheme=r.protocol,n.host=r.domain,n.path=r.path,n.anchor=r.anchor,n.queryString=r.query,n.port=parseInt(r.port),n.parameters=Bifrost.hashString.decode(r.query),n.parameters=Bifrost.extend(Bifrost.hashString.decode(r.anchor),n.parameters),n.isSameAsOrigin=e.location.protocol===r.protocol+":"&&e.location.hostname===n.host},this.setLocation(t)}function r(e){if(!e||"undefined"==typeof e)throw new Bifrost.LocationNotSpecified}return{create:function(e){r(e);var t=new n(e);return t},isAbsolute:function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return t.test(e)}}}(window),Bifrost.namespace("Bifrost",{namespaces:Bifrost.Singleton(function(){var e=this;this.stripPath=function(e){return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e},this.initialize=function(){var t=Bifrost.assetsManager.getScripts();"undefined"!=typeof t&&t.forEach(function(t){var i=Bifrost.Path.getPathWithoutFilename(t);i=e.stripPath(i);for(var n in Bifrost.namespaceMappers){var r=Bifrost.namespaceMappers[n];if("function"==typeof r.hasMappingFor&&r.hasMappingFor(i)){var o=r.resolve(i),s=Bifrost.namespace(o),a="/"+i+"/";s._path=a,"undefined"==typeof s._scripts&&(s._scripts=[]);var f=t.lastIndexOf("/"),u=t.substr(f+1),c=u.lastIndexOf("."),l=u.substr(0,c);s._scripts.push(l)}}})}})}),Bifrost.namespace("Bifrost",{namespaceMappers:{mapPathToNamespace:function(e){for(var t in Bifrost.namespaceMappers){var i=Bifrost.namespaceMappers[t];if("function"==typeof i.hasMappingFor&&i.hasMappingFor(e)){var n=i.resolve(e);return n}}return null}}}),Bifrost.namespace("Bifrost",{StringMapping:Bifrost.Type.extend(function(e,t){this.format=e,this.mappedFormat=t;var i="{[a-zA-Z]+}",n=(new RegExp(i,"g"),"\\*{2}[//||.]"),r=new RegExp(n,"g"),o="("+i+")*("+n+")*",s=new RegExp(o,"g"),a=[],f=e.replace(s,function(e){return"undefined"==typeof e||""===e?"":(a.push(e),0===e.indexOf("**")?"([\\w.//]*)":"([\\w.]*)")}),u=t.match(r),c=new RegExp(f);this.matches=function(e){var t=e.match(c);return!!t},this.getValues=function(e){var t={},i=e.match(c);return a.forEach(function(e,n){var r=e.substr(1,e.length-2),o=i[n+2];0!==e.indexOf("**")&&(t[r]=o)}),t},this.resolve=function(e){var i=e.match(c),n=t,r=0;return a.forEach(function(e,t){var o=i[t+1];if(0===e.indexOf("**")){var s=u[r];o=o.replaceAll(e[2],s[2]),n=n.replace(s,o),r++}else n=n.replace(e,o)}),n}})}),Bifrost.namespace("Bifrost",{stringMappingFactory:Bifrost.Singleton(function(){this.create=function(e,t){var i=Bifrost.StringMapping.create({format:e,mappedFormat:t});return i}})}),Bifrost.namespace("Bifrost",{StringMapper:Bifrost.Type.extend(function(e){function t(e,t){var i=!1;return e.some(function(e){return e.matches(t)&&(i=!0),i}),i}function i(e,t){var i;if(e.some(function(e){if(e.matches(t))return i=e,!0}),"undefined"!=typeof i)return i;throw{name:"ArgumentError",message:"String mapping for ("+t+") could not be found"}}function n(e,t){try{if(null===t||"undefined"==typeof t)return"";var i=r.getMappingFor(t);return Bifrost.isNullOrUndefined(i)?"":i.resolve(t)}catch(e){return""}}var r=this;this.stringMappingFactory=e,this.mappings=[],this.reverseMappings=[],this.hasMappingFor=function(e){return t(r.mappings,e)},this.getMappingFor=function(e){return i(r.mappings,e)},this.resolve=function(e){return n(r.mappings,e)},this.reverse={hasMappingFor:function(e){return r.hasMappingFor(r.reverseMappings,e)},getMappingFor:function(e){return r.getMappingFor(r.reverseMappings,e)},resolve:function(e){return r.resolve(r.reverseMappings,e)}},this.addMapping=function(e,t){var i=r.stringMappingFactory.create(e,t);r.mappings.push(i);var n=r.stringMappingFactory.create(t,e);r.reverseMappings.push(n)}})}),Bifrost.namespace("Bifrost",{uriMappers:{}}),Bifrost.namespace("Bifrost",{server:Bifrost.Singleton(function(){function e(t){if(Bifrost.isArray(t)){var i=[];return t.forEach(function(t){i.push(e(t))}),i}for(var n in t)if(Bifrost.isArray(t[n]))t[n]=e(t[n]);else{var r=t[n];Bifrost.isNumber(r)?t[n]=parseFloat(r):t[n]=t[n]}return t}var t=this;this.target="",this.defaultParameters={},this.post=function(i,n){var r=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(i)||(i=t.target+i);var o={};Bifrost.extend(o,t.defaultParameters);for(var s in n)o[s]=JSON.stringify(n[s]);return $.ajax({url:i,type:"POST",dataType:"json",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",complete:function(t){var i=$.parseJSON(t.responseText);e(i),r.signal(i)},error:function(e,t,i){r.fail(e)}}),r},this.get=function(i,n){var r=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(i)||(i=t.target+i);var o={};if(Bifrost.extend(o,t.defaultParameters),Bifrost.isObject(n))for(var s in n)Bifrost.isArray(n[s])?o[s]=JSON.stringify(n[s]):o[s]=n[s];return $.ajax({url:i,type:"GET",dataType:"json",data:o,contentType:"application/json; charset=utf-8",complete:function(t,i){var n=$.parseJSON(t.responseText);e(n),r.signal(n)},error:function(e,t,i){r.fail(e)}}),r}})}),Bifrost.WellKnownTypesDependencyResolver.types.server=Bifrost.server,Bifrost.namespace("Bifrost",{areEqual:function(e,t){function i(e){return e.indexOf("_")>=0||"model"===e||"commons"===e||"targetViewModel"===e||"region"===e}if(ko.isObservable(e)&&(e=e()),ko.isObservable(t)&&(t=t()),Bifrost.isNullOrUndefined(e)&&Bifrost.isNullOrUndefined(t))return!0;if(Bifrost.isNullOrUndefined(e))return!1;if(Bifrost.isNullOrUndefined(t))return!1;if(Bifrost.isArray(e)&&Bifrost.isArray(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(Bifrost.areEqual(e[n],t[n])===!1)return!1}else for(var r in e)if(!i(r)){if(!t.hasOwnProperty(r))return!1;var o=e[r],s=t[r];if(Bifrost.isObject(o)||Bifrost.isArray(o)||ko.isObservable(o)){if(!Bifrost.areEqual(o,s))return!1}else if(o!==s)return!1}return!0}}),Bifrost.namespace("Bifrost",{deepClone:function(e,t){function i(e){return e.indexOf("_")>=0||"model"===e||"commons"===e||"targetViewModel"===e||"region"===e;
}ko.isObservable(e)&&(e=e()),null==t&&(t=Bifrost.isArray(e)?[]:{});var n;if(Bifrost.isArray(e))for(var r=0;r<e.length;r++){n=e[r];var o=Bifrost.deepClone(n);t.push(o)}else for(var s in e)if(!i(s)&&(n=e[s],ko.isObservable(n)&&(n=n()),!Bifrost.isFunction(n))){var a=null;Bifrost.isObject(n)?a={}:Bifrost.isArray(n)?a=[]:t[s]=n,null!=a&&(t[s]=a,Bifrost.deepClone(n,a))}return t}}),Bifrost.namespace("Bifrost",{systemClock:Bifrost.Singleton(function(){this.nowInMilliseconds=function(){return window.performance.now()}})}),Bifrost.namespace("Bifrost",{TimeSpan:function(e,t,i,n,r){var o="1.2",s=1e3,a=6e4,f=36e5,u=864e5,c=0,l=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};l(r)&&(c+=r*u),l(n)&&(c+=n*f),l(i)&&(c+=i*a),l(t)&&(c+=t*s),l(e)&&(c+=e),this.addMilliseconds=function(e){l(e)&&(c+=e)},this.addSeconds=function(e){l(e)&&(c+=e*s)},this.addMinutes=function(e){l(e)&&(c+=e*a)},this.addHours=function(e){l(e)&&(c+=e*f)},this.addDays=function(e){l(e)&&(c+=e*u)},this.subtractMilliseconds=function(e){l(e)&&(c-=e)},this.subtractSeconds=function(e){l(e)&&(c-=e*s)},this.subtractMinutes=function(e){l(e)&&(c-=e*a)},this.subtractHours=function(e){l(e)&&(c-=e*f)},this.subtractDays=function(e){l(e)&&(c-=e*u)},this.isTimeSpan=!0,this.add=function(e){e.isTimeSpan&&(c+=e.totalMilliseconds())},this.subtract=function(e){e.isTimeSpan&&(c-=e.totalMilliseconds())},this.equals=function(e){if(e.isTimeSpan)return c===e.totalMilliseconds()},this.totalMilliseconds=function(e){var t=c;return e===!0&&(t=Math.floor(t)),t},this.totalSeconds=function(e){var t=c/s;return e===!0&&(t=Math.floor(t)),t},this.totalMinutes=function(e){var t=c/a;return e===!0&&(t=Math.floor(t)),t},this.totalHours=function(e){var t=c/f;return e===!0&&(t=Math.floor(t)),t},this.totalDays=function(e){var t=c/u;return e===!0&&(t=Math.floor(t)),t},this.milliseconds=function(){return c%1e3},this.seconds=function(){return Math.floor(c/s)%60},this.minutes=function(){return Math.floor(c/a)%60},this.hours=function(){return Math.floor(c/f)%24},this.days=function(){return Math.floor(c/u)},this.getVersion=function(){return o}}}),Bifrost.TimeSpan.zero=function(){return new Bifrost.TimeSpan(0,0,0,0,0)},Bifrost.TimeSpan.fromMilliseconds=function(e){return new Bifrost.TimeSpan(e,0,0,0,0)},Bifrost.TimeSpan.fromSeconds=function(e){return new Bifrost.TimeSpan(0,e,0,0,0)},Bifrost.TimeSpan.fromMinutes=function(e){return new Bifrost.TimeSpan(0,0,e,0,0)},Bifrost.TimeSpan.fromHours=function(e){return new Bifrost.TimeSpan(0,0,0,e,0)},Bifrost.TimeSpan.fromDays=function(e){return new Bifrost.TimeSpan(0,0,0,0,e)},Bifrost.TimeSpan.fromDates=function(e,t,i){var n=t.valueOf()-e.valueOf();return i===!0&&(n=Math.abs(n)),new Bifrost.TimeSpan(n,0,0,0,0)},Bifrost.namespace("Bifrost",{Event:Bifrost.Type.extend(function(){var e=[];this.subscribe=function(t){e.push(t)},this.trigger=function(t){e.forEach(function(e){e(t)})}})}),Bifrost.namespace("Bifrost",{systemEvents:Bifrost.Singleton(function(){this.readModels=Bifrost.read.readModelSystemEvents.create(),this.commands=Bifrost.commands.commandEvents.create()})}),Bifrost.WellKnownTypesDependencyResolver.types.systemEvents=Bifrost.systemEvents,Bifrost.namespace("Bifrost",{dispatcher:Bifrost.Singleton(function(){this.schedule=function(e,t){setTimeout(t,e)}})}),ko.extenders.linked=function(e,t){function i(t){if(ko.isObservable(t)){var i=t.subscribe(function(){e.valueHasMutated()});e._previousLinkedSubscription=i}}e.subscribe(function(t){e._previousLinkedSubscription&&e._previousLinkedSubscription.dispose(),i(t)});var n=e();i(n)},Bifrost.namespace("Bifrost.hubs",{hubConnection:Bifrost.Singleton(function(){var e=this,t=$.hubConnection("/signalr",{useDefaultPath:!1});$.signalR.hub=t,this.isConnected=!1,this.connected=Bifrost.Event.create(),this.createProxy=function(e){var i=t.createHubProxy(e);return i},$.connection.hub.start().done(function(){console.log("Hub connection up and running"),e.isConnected=!0,e.connected.trigger()})})}),Bifrost.WellKnownTypesDependencyResolver.types.hubConnection=Bifrost.hubs.hubConnection,Bifrost.namespace("Bifrost.hubs",{Hub:Bifrost.Type.extend(function(e){function t(e){return function(){e.apply(n,arguments)}}function i(e,t,i){return function(){for(var n=[],o=0;o<i.length;o++)n.push(i[o]);var s=[t].concat(n);r.invoke.apply(r,s).done(function(t){e.signal(t)})}}var n=this,r=null;this._name="",this.client=function(e){var i={};e(i);for(var n in i){var o=i[n];Bifrost.isFunction(o)&&r.on(n,t(o))}},this.server={};var o=[];e.connected.subscribe(function(){o.forEach(function(e){e()})}),this.invokeServerMethod=function(t,n){var r=Bifrost.execution.Promise.create(),s=i(r,t,n);return e.isConnected===!1?o.push(s):s(),r},this.onCreated=function(t){r=e.createProxy(t._name)}})}),Bifrost.dependencyResolvers.hub={canResolve:function(e,t){return"undefined"!=typeof hubs&&t in hubs},resolve:function(e,t){return hubs[t].create()}},Bifrost.namespace("Bifrost.io",{fileType:{unknown:0,text:1,javaScript:2,html:3}}),Bifrost.namespace("Bifrost.io",{File:Bifrost.Type.extend(function(e){this.type=Bifrost.io.fileType.unknown,this.path=Bifrost.Path.create({fullPath:e})})}),Bifrost.namespace("Bifrost.io",{fileFactory:Bifrost.Singleton(function(){this.create=function(e,t){var i=Bifrost.io.File.create({path:e});return Bifrost.isNullOrUndefined(t)||(i.fileType=t),i}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileFactory=Bifrost.io.fileFactory,Bifrost.namespace("Bifrost.io",{fileManager:Bifrost.Singleton(function(){function e(e){var i=t.origin;return 0!==e.indexOf("/")&&(i+="/"),i+=e}var t=this,i=Bifrost.Uri.create(window.location.href);if("file:"===window.location.protocol)this.origin=window.location.href,this.origin=this.origin.substr(0,this.origin.lastIndexOf("/")),this.origin.lastIndexOf("/")===this.origin.length-1&&(this.origin=this.origin.substr(0,this.origin.length-1));else{var n=i.port||"";Bifrost.isUndefined(n)||""===n||80===n||(n=":"+n),this.origin=i.scheme+"://"+i.host+n}this.load=function(t){var i=[],n=Bifrost.execution.Promise.create();return t.forEach(function(t){var n=e(t.path.fullPath);t.fileType===Bifrost.io.fileType.html&&(n="text!"+n+"!strip"),i.push(n)}),require(i,function(){n.signal(arguments)}),n}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileManager=Bifrost.io.fileManager,Bifrost.namespace("Bifrost.specifications",{Specification:Bifrost.Type.extend(function(){var e=this,t=ko.observable();this.evaluator=null,this.isSatisfied=ko.computed(function(){if(ko.isObservable(e.evaluator))return e.evaluator();var i=t();return!Bifrost.isNullOrUndefined(i)&&e.evaluator(i)}),this.evaluate=function(i){return t(i),e.isSatisfied()},this.and=function(e){if(Bifrost.isFunction(e)){var t=e;e=Bifrost.specifications.Specification.create(),e.evaluator=t}var i=Bifrost.specifications.And.create(this,e);return i},this.or=function(e){if(Bifrost.isFunction(e)){var t=e;e=Bifrost.specifications.Specification.create(),e.evaluator=t}var i=Bifrost.specifications.Or.create(this,e);return i}})}),Bifrost.specifications.Specification.when=function(e){var t=Bifrost.specifications.Specification.create();return t.evaluator=e,t},Bifrost.namespace("Bifrost.specifications",{And:Bifrost.specifications.Specification.extend(function(e,t){this.isSatisfied=ko.computed(function(){return e.isSatisfied()&&t.isSatisfied()}),this.evaluate=function(i){e.evaluate(i),t.evaluate(i)}})}),Bifrost.namespace("Bifrost.specifications",{Or:Bifrost.specifications.Specification.extend(function(e,t){this.isSatisfied=ko.computed(function(){return e.isSatisfied()||t.isSatisfied()}),this.evaluate=function(i){e.evaluate(i),t.evaluate(i)}})}),Bifrost.namespace("Bifrost.tasks",{Task:Bifrost.Type.extend(function(){var e=this;this.errors=ko.observableArray(),this.isExecuting=ko.observable(!1),this.execute=function(){var e=Bifrost.execution.Promise.create();return e.signal(),e},this.reportError=function(t){e.errors.push(t)}})}),Bifrost.namespace("Bifrost.tasks",{TaskHistoryEntry:Bifrost.Type.extend(function(){var e=this;this.type="",this.content="",this.begin=ko.observable(),this.end=ko.observable(),this.total=ko.computed(function(){return Bifrost.isNullOrUndefined(e.end())||Bifrost.isNullOrUndefined(e.begin())?0:e.end()-e.begin()}),this.result=ko.observable(),this.error=ko.observable(),this.isFinished=ko.computed(function(){return!Bifrost.isNullOrUndefined(e.end())}),this.hasFailed=ko.computed(function(){return!Bifrost.isNullOrUndefined(e.error())}),this.isSuccess=ko.computed(function(){return e.isFinished()&&!e.hasFailed()})})}),Bifrost.namespace("Bifrost.tasks",{taskHistory:Bifrost.Singleton(function(e){var t=this,i={};this.entries=ko.observableArray(),this.begin=function(n){var r=Bifrost.Guid.create();try{var o=Bifrost.tasks.TaskHistoryEntry.create();o.type=n._type._name;var s={};for(var a in n)0!==a.indexOf("_")&&n.hasOwnProperty(a)&&"function"!=typeof n[a]&&(s[a]=n[a]);o.content=JSON.stringify(s),o.begin(e.nowInMilliseconds()),i[r]=o,t.entries.push(o)}catch(e){}return r},this.end=function(t,n){if(i.hasOwnProperty(t)){var r=i[t];r.end(e.nowInMilliseconds()),r.result(n)}},this.failed=function(t,n){if(i.hasOwnProperty(t)){var r=i[t];r.end(e.nowInMilliseconds()),r.error(n)}}})}),Bifrost.WellKnownTypesDependencyResolver.types.taskHistory=Bifrost.tasks.taskHistory,Bifrost.namespace("Bifrost.tasks",{Tasks:Bifrost.Type.extend(function(e){function t(t){if(t.isExecuting()!==!0){t.isExecuting(!0);var n=e.begin(t);t.execute().continueWith(function(r){i.unfiltered.remove(t),e.end(n,r),t.promise.signal(r)}).onFail(function(r){i.unfiltered.remove(t),i.errors.push(t),e.failed(n,r),t.promise.fail(r)})}}var i=this;this.unfiltered=ko.observableArray(),this.canExecuteWhen=ko.observable(),this.all=ko.computed(function(){var e=i.unfiltered(),t=i.canExecuteWhen();if(!Bifrost.isNullOrUndefined(t)){var n=[];return e.forEach(function(e){t.evaluate(e),t.isSatisfied()===!0&&n.push(e)}),n}return e}),this.errors=ko.observableArray(),this.isBusy=ko.computed(function(){return i.all().length>0}),this.all.subscribe(function(e){e.forEach(function(e){t(e)})}),this.execute=function(e){e.promise=Bifrost.execution.Promise.create(),i.unfiltered.push(e);var n=i.canExecuteWhen(),r=!0;return Bifrost.isNullOrUndefined(n)||(r=n.evaluate(e)),r===!0&&t(e),e.promise}})}),Bifrost.namespace("Bifrost.tasks",{tasksFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.tasks.Tasks.create();return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.tasksFactory=Bifrost.tasks.tasksFactory,Bifrost.namespace("Bifrost.tasks",{HttpGetTask:Bifrost.tasks.Task.extend(function(e,t,i){this.execute=function(){var n=Bifrost.execution.Promise.create();return e.get(t,i).continueWith(function(e){n.signal(e)}).onFail(function(e){n.fail(e)}),n}})}),Bifrost.namespace("Bifrost.tasks",{HttpPostTask:Bifrost.tasks.Task.extend(function(e,t,i){this.execute=function(){var n=Bifrost.execution.Promise.create();return e.post(t,i).continueWith(function(e){n.signal(e)}).onFail(function(e){n.fail(e)}),n}})}),Bifrost.namespace("Bifrost.tasks",{LoadTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){var e=Bifrost.execution.Promise.create();return e.signal(),e}})}),Bifrost.namespace("Bifrost.tasks",{FileLoadTask:Bifrost.tasks.LoadTask.extend(function(e,t){this.files=e;var i=this;this.files=[],e.forEach(function(e){i.files.push(e.path.fullPath)}),this.execute=function(){var i=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){i.signal(e)}),i}})}),Bifrost.namespace("Bifrost.tasks",{ExecutionTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost",{taskFactory:Bifrost.Singleton(function(){this.createHttpPost=function(e,t){var i=Bifrost.tasks.HttpPostTask.create({url:e,payload:t});return i},this.createHttpGet=function(e,t){var i=Bifrost.tasks.HttpGetTask.create({url:e,payload:t});return i},this.createQuery=function(e,t){var i=Bifrost.read.QueryTask.create({query:e,paging:t});return i},this.createReadModel=function(e,t){var i=Bifrost.read.ReadModelTask.create({readModelOf:e,propertyFilters:t});return i},this.createHandleCommand=function(e){var t=Bifrost.commands.HandleCommandTask.create({command:e});return t},this.createHandleCommands=function(e){var t=Bifrost.commands.HandleCommandsTask.create({commands:e});return t},this.createViewLoad=function(e){var t=Bifrost.views.ViewLoadTask.create({files:e});return t},this.createViewModelLoad=function(e){var t=Bifrost.views.ViewModelLoadTask.create({files:e});return t},this.createFileLoad=function(e){var t=Bifrost.tasks.FileLoadTask.create({files:e});return t}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.Exception.define("Bifrost.validation.OptionsNotDefined","Option was undefined"),Bifrost.Exception.define("Bifrost.validation.OptionsValueNotSpecified","Required value in Options is not specified. "),Bifrost.Exception.define("Bifrost.validation.NotANumber","Value is not a number"),Bifrost.Exception.define("Bifrost.validation.NotAString","Value is not a string"),Bifrost.Exception.define("Bifrost.validation.ValueNotSpecified","Value is not specified"),Bifrost.Exception.define("Bifrost.validation.MinNotSpecified","Min is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxNotSpecified","Max is not specified"),Bifrost.Exception.define("Bifrost.validation.MinLengthNotSpecified","Min length is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxLengthNotSpecified","Max length is not specified"),Bifrost.Exception.define("Bifrost.validation.MissingExpression","Expression is not specified"),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.ruleHandlers=function(){return Bifrost.validation.ruleHandlers||{}}(),Bifrost.namespace("Bifrost.validation",{Rule:Bifrost.Type.extend(function(e){e=e||{},this.message=e.message||"",this.options={},Bifrost.extend(this.options,e),this.validate=function(e){return!0}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.Validator=function(){function e(e){var t=this;this.isValid=ko.observable(!0),this.message=ko.observable(""),this.rules=[],this.isRequired=!1,e=e||{},this.setOptions=function(e){function i(i){if(i._name===n){var r=i.create({options:e[n]||{}});t.rules.push(r)}"required"===i._name&&(t.isRequired=!0)}for(var n in e){var r=Bifrost.validation.Rule.getExtenders();r.some(i)}},this.validate=function(e){t.isValid(!0),t.message(""),e=ko.utils.unwrapObservable(e),t.rules.some(function(i){return i.validate(e)?(t.isValid(!0),void t.message("")):(t.isValid(!1),t.message(i.message),!0)})},this.validateSilently=function(e){t.rules.some(function(i){return i.validate(e)?void t.isValid(!0):(t.isValid(!1),!0)})},this.setOptions(e)}return{create:function(t){var i=new e(t);return i},applyTo:function(e,t){function i(e){var i=n.create(t);e.validator=i}var n=this;e instanceof Array?e.forEach(function(e){i(e)}):i(e)},applyToProperties:function(e,t){var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(e[n]);this.applyTo(i,t)}}}(),"undefined"!=typeof ko&&(Bifrost.namespace("Bifrost.validation",{ValidationSummary:function(e,t){function i(){var e=[];n.commands().forEach(function(t){var i=ko.utils.unwrapObservable(t);i.validators().forEach(function(t){!t.isValid()&&t.message().length&&e.push(t.message())})}),n.messages(e)}var n=this;this.commands=ko.observable(e),this.messages=ko.observableArray([]),this.hasMessages=ko.computed(function(){return this.messages().length>0},n),e.forEach(function(e){var t=ko.utils.unwrapObservable(e);t.validators().forEach(function(e){e.message.subscribe(i)})})}}),ko.bindingHandlers.validationSummaryFor={init:function(e,t,i,n){var r=ko.bindingHandlers.validationSummaryFor.getValueAsArray(t),o=new Bifrost.validation.ValidationSummary(r),s=document.createElement("ul");e.appendChild(s),s.innerHTML="<li><span data-bind='text: $data'></span></li>",ko.utils.domData.set(e,"validationsummary",o),ko.applyBindingsToNode(e,{visible:o.hasMessages},o),ko.applyBindingsToNode(s,{foreach:o.messages},o)},update:function(e,t){var i=ko.utils.domData.get(e,"validationsummary");i.commands(ko.bindingHandlers.validationSummaryFor.getValueAsArray(t))},getValueAsArray:function(e){var t=ko.utils.unwrapObservable(e());return Bifrost.isArray(t)||(t=[t]),t}}),"undefined"!=typeof ko&&(ko.bindingHandlers.validationMessageFor={init:function(e,t,i,n){var r=t(),o=r.validator;Bifrost.isNullOrUndefined(o)||(o.isValid.subscribe(function(t){t===!0?$(e).hide():$(e).show()}),ko.applyBindingsToNode(e,{text:o.message},o))}}),"undefined"!=typeof ko&&(ko.extenders.validation=function(e,t){return Bifrost.validation.Validator.applyTo(e,t),e.subscribe(function(t){e.validator.validate(t)}),e}),Bifrost.namespace("Bifrost.validation",{required:Bifrost.validation.Rule.extend(function(){this.validate=function(e){return!(Bifrost.isUndefined(e)||Bifrost.isNull(e)||""===e||0===e)}})}),Bifrost.namespace("Bifrost.validation",{length:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function i(i){if(e(i))throw new Bifrost.validation.OptionsNotDefined;if(e(i.max))throw new Bifrost.validation.MaxLengthNotSpecified;if(e(i.min))throw new Bifrost.validation.MinLengthNotSpecified;t(i.min),t(i.max)}var n=this;this.validate=function(t){return i(n.options),e(t)&&(t=""),Bifrost.isString(t)||(t=t.toString()),n.options.min<=t.length&&t.length<=n.options.max}})}),Bifrost.namespace("Bifrost.validation",{minLength:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function i(i){if(e(i))throw new Bifrost.validation.OptionsNotDefined;if(e(i.length))throw new Bifrost.validation.MaxNotSpecified;t(i.length)}function n(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string")}var r=this;this.validate=function(t){return i(r.options),e(t)&&(t=""),n(t),t.length>=r.options.length}})}),Bifrost.namespace("Bifrost.validation",{maxLength:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function i(i){if(e(i))throw new Bifrost.validation.OptionsNotDefined;if(e(i.length))throw new Bifrost.validation.MaxNotSpecified;t(i.length)}function n(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string")}var r=this;this.validate=function(t){return i(r.options),e(t)&&(t=""),n(t),t.length<=r.options.length}})}),Bifrost.namespace("Bifrost.validation",{range:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e,t){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber(t+" value "+e+" is not a number")}function i(i){if(e(i))throw new Bifrost.validation.OptionsNotDefined;if(e(i.max))throw new Bifrost.validation.MaxNotSpecified;if(e(i.min))throw new Bifrost.validation.MinNotSpecified;t(i.min,"min"),t(i.max,"max")}var n=this;this.validate=function(r){return i(n.options),!e(r)&&(t(r,"value"),n.options.min<=r&&r<=n.options.max)}})}),Bifrost.namespace("Bifrost.validation",{lessThan:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.value)){var i=new Bifrost.validation.OptionsValueNotSpecified;throw i.message=i.message+" 'value' is not set.",i}}function i(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}var n=this;this.validate=function(r){return t(n.options),!e(r)&&(i(r),parseFloat(r)<parseFloat(n.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.lessThanOrEqual={throwIfOptionsInvalid:function(e){if(this.notSet(e))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(e.value)){var t=new Bifrost.validation.OptionsValueNotSpecified;throw t.message=t.message+" 'value' is not set.",t}},throwIsValueToCheckIsNotANumber:function(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")},notSet:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)},validate:function(e,t){return this.throwIfOptionsInvalid(t),!this.notSet(e)&&(this.throwIsValueToCheckIsNotANumber(e),parseFloat(e)<=parseFloat(t.value))}},Bifrost.namespace("Bifrost.validation",{greaterThan:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.value)){var n=new Bifrost.validation.OptionsValueNotSpecified;throw n.message=n.message+" 'value' is not set.",n}i(t.value)}function i(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}var n=this;this.validate=function(r){return t(n.options),!e(r)&&(i(r),parseFloat(r)>parseFloat(n.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.greaterThanOrEqual={throwIfOptionsInvalid:function(e){if(this.notSet(e))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(e.value)){var t=new Bifrost.validation.OptionsValueNotSpecified;throw t.message=t.message+" 'value' is not set.",t}this.throwIfValueToCheckIsNotANumber(e.value)},throwIfValueToCheckIsNotANumber:function(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")},notSet:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)},validate:function(e,t){return this.throwIfOptionsInvalid(t),!this.notSet(e)&&(this.throwIfValueToCheckIsNotANumber(e),parseFloat(e)>=parseFloat(t.value))}},Bifrost.namespace("Bifrost.validation",{email:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isNull(e)||Bifrost.isUndefined(e)}var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/;this.validate=function(i){if(e(i))return!1;if(!Bifrost.isString(i))throw new Bifrost.validation.NotAString("Value "+i+" is not a string");return null!=i.match(t)}})}),Bifrost.namespace("Bifrost.validation",{regex:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.expression))throw new Bifrost.validation.MissingExpression;if(!Bifrost.isString(t.expression))throw new Bifrost.validation.NotAString("Expression "+t.expression+" is not a string.")}function i(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string.")}var n=this;this.validate=function(r){return t(n.options),!e(r)&&(i(r),null!=r.match(n.options.expression))}})}),"undefined"!=typeof ko&&(ko.bindingHandlers.command={init:function(e,t,i,n){var r,o=t(),s=!1;if("undefined"==typeof o.canExecute){r=o.target,r.parameters=r.parameters||{};var a=o.parameters||{};for(var f in a){var u=a[f];r.parameters.hasOwnProperty(f)&&ko.isObservable(r.parameters[f])?r.parameters[f](u):r.parameters[f]=ko.observable(u)}s=!0}else r=o;ko.applyBindingsToNode(e,{click:function(){r.execute()}},n)}}),Bifrost.namespace("Bifrost.commands",{HandleCommandTask:Bifrost.tasks.ExecutionTask.extend(function(e,t,i){this.name=e.name,this.execute=function(){var n=Bifrost.execution.Promise.create(),r=Bifrost.commands.CommandDescriptor.createFrom(e),o={commandDescriptor:r},s="/Bifrost/CommandCoordinator/Handle?_cmd="+e._generatedFrom;return t.post(s,o).continueWith(function(e){var t=Bifrost.commands.CommandResult.createFrom(e);t.success===!0?i.commands.succeeded.trigger(e):i.commands.failed.trigger(e),n.signal(t)}).onFail(function(e){var t=Bifrost.commands.CommandResult.create();t.exception="HTTP 500",t.exceptionMessage=e.statusText,t.details=e.responseText,i.commands.failed.trigger(t),n.signal(t)}),n}})}),Bifrost.namespace("Bifrost.commands",{HandleCommandsTask:Bifrost.tasks.ExecutionTask.extend(function(e,t){var i=this;this.names=[],e.forEach(function(e){i.names.push(e.name)}),this.execute=function(){var i=Bifrost.execution.Promise.create(),n=[];e.forEach(function(e){e.isBusy(!0);var t=Bifrost.commands.CommandDescriptor.createFrom(e);n.push(t)});var r={commandDescriptors:n},o="/Bifrost/CommandCoordinator/HandleMany";return t.post(o,r).continueWith(function(e){var t=[];e.forEach(function(e){var i=Bifrost.commands.CommandResult.createFrom(e);t.push(i)}),i.signal(t)}),i}})}),Bifrost.namespace("Bifrost.commands",{commandCoordinator:Bifrost.Singleton(function(e){this.handle=function(t){var i=Bifrost.execution.Promise.create(),n=e.createHandleCommand(t);return t.region.tasks.execute(n).continueWith(function(e){i.signal(e)}),i},this.handleMany=function(t,i){var n=Bifrost.execution.Promise.create();try{var r=e.createHandleCommands(t);i.tasks.execute(r).continueWith(function(e){t.forEach(function(t,i){var n=e[i];null==n||Bifrost.isUndefined(n)||t.handleCommandResult(n),t.isBusy(!1)}),n.signal(e)})}catch(e){t.forEach(function(e){e.isBusy(!1)})}return n}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandCoordinator=Bifrost.commands.commandCoordinator,Bifrost.namespace("Bifrost.commands",{commandValidationService:Bifrost.Singleton(function(){function e(e,t){return"region"===t||(e instanceof HTMLElement||(!e.hasOwnProperty(t)||!ko.isObservable(e[t])&&("function"==typeof e[t]||("_type"===t||("_dependencies"===t||("_namespace"===t||(null==e[t]||"undefined"!=typeof e[t].prototype&&null!==e[t].prototype&&e[t]instanceof Bifrost.Type)))))))}function t(i,n){for(var r in i)e(i,r)||"undefined"==typeof i[r].validator&&(ko.isObservable(i[r])?(i[r].extend({validation:{}}),i[r].validator.propertyName=r):"object"==typeof i[r]&&t(i[r],n))}function i(t,n,r){for(var o in t)if(!e(t,o))if("undefined"!=typeof t[o].validator){var s=ko.utils.unwrapObservable(t[o]());r===!0?t[o].validator.validateSilently(s):t[o].validator.validate(s),t[o].validator.isValid()===!1&&(n.valid=!1)}else"object"==typeof t[o]&&i(t[o],n,r)}function n(e,t,i){function n(e){s=e.toCamelCase(),s in a&&"object"==typeof a[s]&&(a=a[s])}for(var r=0;r<t.length;r++){var o=t[r].split("."),s=null,a=e;if(o.forEach(n),null!=s&&s.length){var f=a[s];"undefined"!=typeof f.validator&&(f.validator.isValid(!1),f.validator.message(i))}}}function r(t,i){for(var n in t){var o=t[n];e(t,n)||(ko.isObservable(o)&&"undefined"!=typeof o.validator?i.push(o.validator):Bifrost.isObject(o)&&r(o,i))}}this.applyValidationResultToProperties=function(e,t){for(var i=0;i<t.length;i++){var r=t[i],o=r.errorMessage,s=r.memberNames;s.length>0&&n(e,s,o)}},this.validate=function(e){var t={valid:!0};return i(e,t),t},this.validateSilently=function(e){var t={valid:!0};return i(e,t,!0),t},this.clearValidationMessagesFor=function(t){for(var i in t)e(t,i)||Bifrost.isNullOrUndefined(t[i].validator)||t[i].validator.message("")},this.extendPropertiesWithoutValidation=function(e){t(e)},this.getValidatorsFor=function(e){var t=[];return r(e,t),t}})}),Bifrost.namespace("Bifrost.commands",{Command:Bifrost.Type.extend(function(e,t,i,n,r,o){var s=this,a=ko.observableArray();this.region=o,this._name="",this._generatedFrom="",this.targetCommand=this,this.validators=ko.observableArray(),this.validationMessages=ko.observableArray(),this.securityContext=ko.observable(null),this.populatedFromExternalSource=ko.observable(!1),this.isBusy=ko.observable(!1),this.isValid=ko.computed(function(){var e=!0;return s.validators().some(function(t){if(ko.isObservable(t.isValid)&&t.isValid()===!1)return e=!1,!0}),!(s.validationMessages().length>0)&&e}),this.isAuthorized=ko.observable(!1),this.canExecute=ko.computed(function(){return s.isValid()&&s.isAuthorized()}),this.isPopulatedExternally=ko.observable(!1),this.isReady=ko.computed(function(){return s.isPopulatedExternally()===!1||s.populatedFromExternalSource()}),this.isReadyToExecute=ko.computed(function(){return s.isPopulatedExternally()===!1||s.hasChanges()}),this.hasChanges=ko.computed(function(){var e=!1;return a().some(function(t){if(t()===!0)return e=!0,!0}),e}),this.failedCallbacks=[],this.succeededCallbacks=[],this.completedCallbacks=[],this.commandCoordinator=e,this.commandValidationService=t,this.commandSecurityService=i,this.options={beforeExecute:function(){},failed:function(){},succeeded:function(){},completed:function(){},properties:{}},this.failed=function(e){return s.failedCallbacks.push(e),s},this.succeeded=function(e){return s.succeededCallbacks.push(e),s},this.completed=function(e){return s.completedCallbacks.push(e),s},this.setOptions=function(e){Bifrost.extend(s.options,e),"undefined"!=typeof e.name&&"string"==typeof e.name&&(s._name=e.name)},this.copyPropertiesFromOptions=function(){for(var e in s.targetCommand.options.properties){var t=s.targetCommand.options.properties[e];ko.isObservable(t)||(t=ko.observable(t)),s.targetCommand[e]=t}},this.getProperties=function(){var e=[];for(var t in s.targetCommand)s.targetCommand.hasOwnProperty(t)&&!s.hasOwnProperty(t)&&e.push(t);return e},this.makePropertiesObservable=function(){var e=s.getProperties();e.forEach(function(e){var t=null,i=s.targetCommand[e];ko.isObservable(i)||"object"==typeof i&&!Bifrost.isArray(i)||"function"!=typeof i&&(t=Bifrost.isArray(i)?ko.observableArray(i):ko.observable(i),s.targetCommand[e]=t)})},this.extendPropertiesWithHasChanges=function(){var e=s.getProperties();e.forEach(function(e){var t=s.targetCommand[e];ko.isObservable(t)&&(t.extend({hasChanges:{}}),Bifrost.isNullOrUndefined(t.hasChanges)||a.push(t.hasChanges))})},this.onBeforeExecute=function(){s.options.beforeExecute()},this.onFailed=function(e){s.options.failed(e),s.failedCallbacks.forEach(function(t){t(e)})},this.setInitialValuesForProperties=function(e){e.forEach(function(e){var t=s.targetCommand[e];if(ko.isObservable(t)&&ko.isWriteableObservable(t)&&Bifrost.isFunction(t.setInitialValue)){var i=t();t.setInitialValue(i)}})},this.setInitialValuesFromCurrentValues=function(){var e=s.getProperties();s.setInitialValuesForProperties(e)},this.onSucceeded=function(e){s.options.succeeded(e),s.setInitialValuesFromCurrentValues(),s.succeededCallbacks.forEach(function(t){t(e)})},this.onCompleted=function(e){s.options.completed(e),s.completedCallbacks.forEach(function(t){t(e)})},this.handleCommandResult=function(e){s.isBusy(!1),"undefined"!=typeof e.commandValidationMessages&&s.validationMessages(e.commandValidationMessages),e.success===!1||e.invalid===!0?(e.invalid&&"undefined"!=typeof e.validationResults&&s.commandValidationService.applyValidationResultToProperties(s.targetCommand,e.validationResults),s.onFailed(e)):s.onSucceeded(e),s.onCompleted(e)},this.getCommandResultFromValidationResult=function(e){var t=Bifrost.commands.CommandResult.create();return t.invalid=!0,t},this.execute=function(){s.isBusy(!0);try{s.onBeforeExecute();var e=s.commandValidationService.validate(this);if(e.valid===!0)s.commandCoordinator.handle(s.targetCommand).continueWith(function(e){s.handleCommandResult(e)});else{var t=s.getCommandResultFromValidationResult(e);s.handleCommandResult(t);
}}catch(e){s.isBusy(!1)}},this.populatedExternally=function(){s.isPopulatedExternally(!0)},this.populateFromExternalSource=function(e){s.isPopulatedExternally(!0),s.setPropertyValuesFrom(e),s.populatedFromExternalSource(!0),t.clearValidationMessagesFor(s.targetCommand)},this.setPropertyValuesFrom=function(e){var t=n.mapToInstance(s.targetCommand._type,e,s.targetCommand);s.setInitialValuesForProperties(t)},this.onCreated=function(e){if(s.targetCommand=e,"undefined"!=typeof r&&(this.setOptions(r),this.copyPropertiesFromOptions()),this.makePropertiesObservable(),this.extendPropertiesWithHasChanges(),"undefined"!=typeof e._name&&""!==e._name){t.extendPropertiesWithoutValidation(e);var n=t.getValidatorsFor(e);Bifrost.isArray(n)&&n.length>0&&s.validators(n),t.validateSilently(this)}i.getContextFor(e).continueWith(function(t){e.securityContext(t),ko.isObservable(t.isAuthorized)&&(e.isAuthorized(t.isAuthorized()),t.isAuthorized.subscribe(function(t){e.isAuthorized(t)}))})}})}),Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandDescriptor=function(e){function t(e,t){return!e.hasOwnProperty(t)||(!!n.hasOwnProperty(t)||!ko.isObservable(e[t])&&("function"==typeof e[t]||("_type"===t||"_namespace"===t)))}function i(e){var i={};for(var n in e)t(e,n)||(i[n]=e[n]);return i}var n={};"undefined"!=typeof Bifrost.commands.Command&&(n=Bifrost.commands.Command.create({region:{commands:[]},commandCoordinator:{},commandValidationService:{},commandSecurityService:{getContextFor:function(){return{continueWith:function(){}}}},mapper:{},options:{}})),this.name=e._name,this.generatedFrom=e._generatedFrom,this.id=Bifrost.Guid.create();var r=i(e),o=ko.toJS(r);o.Id=Bifrost.Guid.create(),this.command=ko.toJSON(o)},Bifrost.commands.CommandDescriptor.createFrom=function(e){var t=new Bifrost.commands.CommandDescriptor(e);return t},Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandResult=function(){function e(e){var t=this;this.isEmpty=function(){return t.commandId===Bifrost.Guid.empty},this.commandName="",this.commandId=Bifrost.Guid.empty,this.validationResults=[],this.success=!0,this.invalid=!1,this.passedSecurity=!0,this.exception=void 0,this.exceptionMessage="",this.commandValidationMessages=[],this.securityMessages=[],this.allValidationMessages=[],this.details="","undefined"!=typeof e&&Bifrost.extend(this,e)}return{create:function(){var t=new e;return t},createFrom:function(t){var i="string"==typeof t?JSON.parse(t):t,n=new e(i);return n}}}(),Bifrost.dependencyResolvers.command={canResolve:function(e,t){return"undefined"!=typeof commands&&t in commands},resolve:function(e,t){return commands[t].create()}},Bifrost.namespace("Bifrost.commands",{CommandSecurityContext:Bifrost.Type.extend(function(){this.isAuthorized=ko.observable(!1)})}),Bifrost.namespace("Bifrost.commands",{commandSecurityContextFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.commands.CommandSecurityContext.create();return e}})}),Bifrost.namespace("Bifrost.commands",{commandSecurityService:Bifrost.Singleton(function(e){function t(e){return e._type._name}function i(e){var t=e+"SecurityContext";return t}function n(e,t){var n=i(e);return!Bifrost.isNullOrUndefined(n)&&!Bifrost.isNullOrUndefined(t)&&t.hasOwnProperty(n)}function r(e,t){var n=i(e,t);return t[n]}var o=this;this.commandSecurityContextFactory=e,this.getContextFor=function(e){var i,s=Bifrost.execution.Promise.create(),a=t(e);if(n(a,e._type._namespace)){var f=r(a,e._type._namespace);i=f.create(),s.signal(i)}else if(i=o.commandSecurityContextFactory.create(),Bifrost.isNullOrUndefined(e._generatedFrom)||""===e._generatedFrom)s.signal(i);else{var u="/Bifrost/CommandSecurity/GetForCommand?commandName="+e._generatedFrom;$.getJSON(u,function(e){i.isAuthorized(e.isAuthorized),s.signal(i)})}return s},this.getContextForType=function(e){var t,i=Bifrost.execution.Promise.create();if(n(e._name,e._namespace)){var o=r(e._name,e._namespace);t=o.create(),i.signal(t)}else t=Bifrost.commands.CommandSecurityContext.create(),t.isAuthorized(!0),i.signal(t);return i}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandSecurityService=Bifrost.commands.commandSecurityService,ko.extenders.hasChanges=function(e){function t(){if(e._initialValueSet===!1)e.hasChanges(!1);else{if(Bifrost.isArray(e._initialValue))return void e.hasChanges(!e._initialValue.shallowEquals(e()));e.hasChanges(e._initialValue!==e())}}e._initialValueSet=!1,e.hasChanges=ko.observable(!1),e.subscribe(function(){t()}),e.setInitialValue=function(i){var n;n=Bifrost.isArray(i)?i.clone():i,e._initialValue=n,e._initialValueSet=!0,t()}},Bifrost.namespace("Bifrost.commands",{commandEvents:Bifrost.Singleton(function(){this.succeeded=Bifrost.Event.create(),this.failed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.interaction",{Operation:Bifrost.Type.extend(function(e,t){var i=this,n=ko.observableArray(),r=ko.observable(!0);this.context=t,this.identifier=Bifrost.Guid.empty,this.region=e,this.canPerform=ko.computed({read:function(){if(0===n().length)return!0;var e=!0;return n().forEach(function(t){if(t()===!1)return void(e=!1)}),e},write:function(e){r(e)}}),this.canPerform.when=function(e){return n.push(e),i.canPerform},this.canPerform.when(r),this.perform=function(){return{}},this.undo=function(e){}})}),Bifrost.namespace("Bifrost.interaction",{OperationContext:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.interaction",{OperationEntry:Bifrost.Type.extend(function(e,t){this.operation=e,this.state=t})}),Bifrost.namespace("Bifrost.interaction",{operationEntryFactory:Bifrost.Singleton(function(){this.create=function(e,t){var i=Bifrost.interaction.OperationEntry.create({operation:e,state:t});return i}})}),Bifrost.namespace("Bifrost.interaction",{Operations:Bifrost.Type.extend(function(e){var t=this;this.all=ko.observableArray(),this.stateful=ko.computed(function(){var e=[];return t.all().forEach(function(t){Bifrost.areEqual(t.state,{})||e.push(t)}),e}),this.getByIdentifier=function(e){var i=null;return t.all().forEach(function(t){if(t.identifier===e)return void(i=t)}),i},this.perform=function(i){if(i.canPerform()===!0){var n=i.perform(),r=e.create(i,n);t.all.push(r)}},this.undo=function(){throw"Not implemented"}})}),Bifrost.namespace("Bifrost.interaction",{operationsFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.interaction.Operations.create();return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.operationsFactory=Bifrost.interaction.operationsFactory,Bifrost.namespace("Bifrost.interaction",{CommandOperation:Bifrost.interaction.Operation.extend(function(e){var t=this;this.commandType=ko.observable(),this.isAuthorized=ko.observable(!1),this.commandCreated=Bifrost.Event.create(),this.canPerform.when(this.isAuthorized),this.commandType.subscribe(function(i){e.getContextForType(i).continueWith(function(e){Bifrost.isNullOrUndefined(e)||t.isAuthorized(e.isAuthorized())})}),this.createCommandOfType=function(e){var i=e.create({region:t.region});return t.commandCreated.trigger(i),i}})}),Bifrost.namespace("Bifrost.interaction",{Action:Bifrost.Type.extend(function(){this.perform=function(){}})}),Bifrost.namespace("Bifrost.interaction",{Trigger:Bifrost.Type.extend(function(){var e=this;this.actions=[],this.addAction=function(t){e.actions.push(t)},this.initialize=function(e){},this.signal=function(){e.actions.forEach(function(e){e.perform()})}})}),Bifrost.namespace("Bifrost.interaction",{EventTrigger:Bifrost.interaction.Trigger.extend(function(){function e(e){if(!e.eventName)throw"EventName is not set for trigger"}var t=this;this.eventName=null,this.initialize=function(i){e(this);var n="on"+t.eventName;if(null==i[n]||"function"==typeof i[n]){var r=i[n];i[n]=function(e){r&&r(e),t.signal()}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualState:Bifrost.Type.extend(function(){var e=this;this.name="",this.actions=ko.observableArray(),this.addAction=function(t){e.actions.push(t)},this.enter=function(t,i){e.actions().forEach(function(e){e.onEnter(t,i)})},this.exit=function(t,i){e.actions().forEach(function(e){e.onExit(t,i)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateAction:Bifrost.Type.extend(function(){this.initialize=function(e){},this.onEnter=function(e,t){},this.onExit=function(e,t){}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateGroup:Bifrost.Type.extend(function(e){var t=this;this.defaultDuration=Bifrost.TimeSpan.zero(),this.currentState=ko.observable({name:"null state",enter:function(){},exit:function(){}}),this.states=ko.observableArray(),this.transitions=ko.observableArray(),this.addState=function(e){if(t.hasState(e.name))throw"VisualState with name of '"+e.name+"' already exists";t.states.push(e)},this.addTransition=function(e){t.transitions.push(e)},this.hasState=function(e){var i=!1;return t.states().forEach(function(t){if(t.name===e)return void(i=!0)}),i},this.getStateByName=function(e){var i=null;return t.states().forEach(function(t){if(t.name===e)return void(i=t)}),i},this.goTo=function(i,n){var r=t.currentState();if(Bifrost.isNullOrUndefined(r)||r.name!==n){var o=t.getStateByName(n);if(!Bifrost.isNullOrUndefined(o)){var s=t.defaultDuration;Bifrost.isNullOrUndefined(r)||r.exit(i,s),o.enter(i,s),e.schedule(s.totalMilliseconds(),function(){t.currentState(o)})}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManager:Bifrost.Type.extend(function(){var e=this;this.namingRoot=null,this.groups=ko.observableArray(),this.addGroup=function(t){e.groups.push(t)},this.goTo=function(t){e.groups().forEach(function(i){i.hasState(t)===!0&&i.goTo(e.namingRoot,t)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateTransition:Bifrost.Type.extend(function(){this.from="",this.to="",this.duration=Bifrost.TimeStamp.zero()})});var globalId=0;Bifrost.namespace("Bifrost.interaction.visualStateActions",{Opacity:Bifrost.interaction.VisualStateAction.extend(function(e){var t=this,i=null,n=e.getUniqueStyleName("opacity");this.target="",this.value="",this.initialize=function(e){i=e.find(t.target)},this.onEnter=function(r,o){var s=parseFloat(t.value);isNaN(s)&&(s=0);var a=o.totalMilliseconds()/1e3;e.addStyle("."+n,{"-webkit-transition":"opacity "+a+"s ease-in-out","-moz-transition":"opacity "+a+"s ease-in-out","-ms-transition":"opacity "+a+"s ease-in-out","-o-transition":"opacity "+a+"s ease-in-out",transition:"opacity "+a+"s ease-in-out",opacity:s}),i.classList.add(n)},this.onExit=function(e,t){i.classList.remove(n)}})}),Bifrost.namespace("Bifrost.mapping",{MissingPropertyStrategy:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.mapping",{PropertyMap:Bifrost.Type.extend(function(e,t){function i(){if(Bifrost.isNullOrUndefined(n.strategy))throw Bifrost.mapping.MissingPropertyStrategy.create()}var n=this;this.strategy=null,this.to=function(i){n.strategy=function(n,r){var o=ko.unwrap(n[e]),s=ko.unwrap(r[i]),a=null;Bifrost.isNullOrUndefined(o)||(Bifrost.isNullOrUndefined(s)||(o.constructor!==s.constructor&&(a=s.constructor.name.toString()),Bifrost.isNullOrUndefined(r[i]._typeAsString)||(a=r[i]._typeAsString)),Bifrost.isNullOrUndefined(a)||(o=t.convertFrom(o.toString(),a))),ko.isObservable(r[i])?r[i](o):r[i]=o}},this.map=function(e,t){i(),n.strategy(e,t)}})}),Bifrost.namespace("Bifrost.mapping",{Map:Bifrost.Type.extend(function(){var e=this,t={};this.sourceType=null,this.targetType=null,this.source=function(t){e.sourceType=t},this.target=function(t){e.targetType=t},this.property=function(e){var i=Bifrost.mapping.PropertyMap.create({sourceProperty:e});return t[e]=i,i},this.canMapProperty=function(e){return t.hasOwnProperty(e)},this.mapProperty=function(i,n,r){e.canMapProperty(i)&&t[i].map(n,r)}})}),Bifrost.namespace("Bifrost.mapping",{maps:Bifrost.Singleton(function(){function e(e,t){return e._typeId+" - "+t._typeId}var t=this,i={},n=Bifrost.mapping.Map.getExtenders();n.forEach(function(t){var n=t.create(),r=e(n.sourceType,n.targetType);i[r]=n}),this.hasMapFor=function(t,n){if(Bifrost.isNullOrUndefined(t)||Bifrost.isNullOrUndefined(n))return!1;var r=e(t,n);return i.hasOwnProperty(r)},this.getMapFor=function(n,r){if(t.hasMapFor(n,r)){var o=e(n,r);return i[o]}}})}),Bifrost.namespace("Bifrost.mapping",{mapper:Bifrost.Type.extend(function(typeConverters,maps){"use strict";function getTypeAsString(e,t,i,n){var r=null;return Bifrost.isNullOrUndefined(i)||Bifrost.isNullOrUndefined(n)||i.constructor!==n.constructor&&(r=n.constructor.toString().match(/function\040+(\w*)/)[1]),Bifrost.isNullOrUndefined(e[t])||Bifrost.isNullOrUndefined(e[t]._typeAsString)||(r=e[t]._typeAsString),r}function copyProperties(e,t,i,n){for(var r in t)if(0!==r.indexOf("_")&&!Bifrost.isUndefined(t[r]))if(Bifrost.isObject(t[r])&&Bifrost.isObject(i[r]))copyProperties(e,t[r],i[r]);else{if(!Bifrost.isNullOrUndefined(n)&&n.canMapProperty(r)){n.mapProperty(r,t,i),e.indexOf(r)<0&&e.push(r);continue}if(!Bifrost.isUndefined(i[r])){var o=ko.unwrap(t[r]),s=ko.unwrap(i[r]),a=getTypeAsString(i,r,o,s);if(Bifrost.isNullOrUndefined(a)||Bifrost.isNullOrUndefined(o)||(o=typeConverters.convertFrom(o.toString(),a)),e.indexOf(r)<0&&e.push(r),ko.isObservable(i[r])){if(!ko.isWriteableObservable(i[r]))continue;i[r](o)}else i[r]=o}}}function mapSingleInstance(type,data,mappedProperties){data&&(Bifrost.isNullOrUndefined(data._sourceType)||(type=eval(data._sourceType)));var instance=type.create();if(data){var map=null;maps.hasMapFor(data._type,type)&&(map=maps.getMapFor(data._type,type)),copyProperties(mappedProperties,data,instance,map)}return instance}function mapMultipleInstances(e,t,i){for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(mapSingleInstance(e,o,i))}return n}var self=this;this.map=function(e,t){var i=[];return Bifrost.isArray(t)?mapMultipleInstances(e,t,i):mapSingleInstance(e,t,i)},this.mapToInstance=function(e,t,i){var n=[],r=null;return maps.hasMapFor(t._type,e)&&(r=maps.getMapFor(t._type,e)),copyProperties(n,t,i,r),n}})}),Bifrost.WellKnownTypesDependencyResolver.types.mapper=Bifrost.mapping.mapper,Bifrost.namespace("Bifrost.read",{readModelSystemEvents:Bifrost.Singleton(function(){this.noInstance=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.read",{PagingInfo:Bifrost.Type.extend(function(e,t){this.size=e,this.number=t})}),Bifrost.namespace("Bifrost.read",{Queryable:Bifrost.Type.extend(function(e,t,i,n){function r(e){for(var t in e){var i=e[t];ko.isObservable(i)===!0&&e.hasOwnProperty(t)&&"areAllParametersSet"!==t&&i.subscribe(o.execute)}}var o=this;this.canExecute=!0,this.target=n,this.query=e,this.queryService=t,this.pageSize=ko.observable(0),this.pageNumber=ko.observable(0),this.totalItems=ko.observable(0),this.completedCallbacks=[],this.pageSize.subscribe(function(){o.canExecute&&o.execute()}),this.pageNumber.subscribe(function(){o.canExecute&&o.execute()}),this.completed=function(e){return o.completedCallbacks.push(e),o},this.onCompleted=function(e){o.completedCallbacks.forEach(function(t){t(e)})},this.execute=function(){if(o.query.areAllParametersSet()!==!0)return o.target;o.query._previousAreAllParametersSet=!0;var t=Bifrost.read.PagingInfo.create({size:o.pageSize(),number:o.pageNumber()});return o.queryService.execute(e,t).continueWith(function(e){Bifrost.isNullOrUndefined(e)||(o.totalItems(e.totalItems),o.target(e.items),o.onCompleted(e.items))}),o.target},this.setPageInfo=function(e,t){e===o.pageSize()&&t===o.pageNumber()||(o.canExecute=!1,o.pageSize(e),o.pageNumber(t),o.canExecute=!0,o.execute())},r(o.query),o.query.areAllParametersSet()&&o.execute()})}),Bifrost.read.Queryable.new=function(e,t){var i=ko.observableArray();e.targetObservable=i,e.region=t;var n=Bifrost.read.Queryable.create(e);return Bifrost.extend(i,n),i.isQueryable=!0,i},Bifrost.namespace("Bifrost.read",{queryableFactory:Bifrost.Singleton(function(){this.create=function(e,t){var i=Bifrost.read.Queryable.new({query:e},t);return i}})}),Bifrost.WellKnownTypesDependencyResolver.types.queryableFactory=Bifrost.interaction.queryableFactory,Bifrost.namespace("Bifrost.read",{Query:Bifrost.Type.extend(function(e,t){var i=this;this.target=this,this._name="",this._generatedFrom="",this._readModel=null,this.region=t,this.areAllParametersSet=null,this.hasReadModel=function(){return"undefined"!=typeof i.target._readModel&&null!=i.target._readModel},this.setParameters=function(e){try{for(var t in e)i.target.hasOwnProperty(t)&&ko.isObservable(i.target[t])===!0&&i.target[t](e[t])}catch(e){}},this.getParameters=function(){var e={};for(var t in i.target)ko.isObservable(i.target[t])&&"areAllParametersSet"!==t&&(e[t]=i.target[t]);return e},this.getParameterValues=function(){var e,t={},n=i.getParameters();for(var r in n)e=n[r](),ko.isObservable(e)&&(e=e()),t[r]=e;return t},this.all=function(){var n=e.create(i.target,t);return n},this.paged=function(n,r){var o=e.create(i.target,t);return o.setPageInfo(n,r),o},this.onCreated=function(e){i.target=e;for(var t in i.target)ko.isObservable(i.target[t])===!0&&i.target[t].extend({linked:{}});i.areAllParametersSet=ko.computed(function(){var e=!0,t=!1;for(var n in i.target)if(ko.isObservable(i.target[n])===!0){t=!0;var r=ko.unwrap(i.target[n]());if("undefined"==typeof r||null===r){e=!1;break}}return t===!1||e})}})}),Bifrost.namespace("Bifrost.read",{ReadModel:Bifrost.Type.extend(function(){var e=this;this.copyTo=function(t){for(var i in e)if(e.hasOwnProperty(i)&&0!==i.indexOf("_")){var n=ko.utils.unwrapObservable(e[i]);t.hasOwnProperty(i)?ko.isObservable(t[i])?t[i](n):t[i]=n:t[i]=ko.observable(n)}},this.onCreated=function(t){e=t}})}),Bifrost.namespace("Bifrost.read",{ReadModelOf:Bifrost.Type.extend(function(e,t,i,n){function r(e){var t={};for(var i in e)t[i]=ko.utils.unwrapObservable(e[i]);return t}function o(e,r){var o=i.createReadModel(e,r);e.region.tasks.execute(o).continueWith(function(i){if(Bifrost.isNullOrUndefined(i))n.noInstance.trigger(e);else{var r=t.map(e._readModelType,i);s.instance(r)}})}var s=this;this.target=null,this._name="",this._generatedFrom="",this._readModelType=Bifrost.Type.extend(function(){}),this.instance=ko.observable(),this.commandToPopulate=null,this.region=e,this.instanceMatching=function(e){function t(){var t=r(e);o(s.target,t)}t();for(var i in e){var n=e[i];ko.isObservable(n)&&n.subscribe(t)}},this.populateCommandOnChanges=function(e){e.populatedExternally(),"undefined"!=typeof s.instance()&&null!=s.instance()&&e.populateFromExternalSource(s.instance()),s.instance.subscribe(function(t){e.populateFromExternalSource(t)})},this.onCreated=function(e){s.target=e;var t=e._readModelType.create();s.instance(t)}})}),Bifrost.namespace("Bifrost.read",{ReadModelTask:Bifrost.tasks.LoadTask.extend(function(e,t,i){var n="/Bifrost/ReadModel/InstanceMatching?_rm="+e._generatedFrom,r={descriptor:{readModel:e._name,generatedFrom:e._generatedFrom,propertyFilters:t}};this.readModel=e._generatedFrom;var o=i.createHttpPost(n,r);this.execute=function(){var e=o.execute();return e}})}),Bifrost.dependencyResolvers.readModelOf={canResolve:function(e,t){return"undefined"!=typeof read&&t in read},resolve:function(e,t){return read[t].create()}},Bifrost.dependencyResolvers.query={canResolve:function(e,t){return"undefined"!=typeof read&&t in read},resolve:function(e,t){return read[t].create()}},Bifrost.namespace("Bifrost.read",{QueryTask:Bifrost.tasks.LoadTask.extend(function(e,t,i){var n="/Bifrost/Query/Execute?_q="+e._generatedFrom,r={descriptor:{nameOfQuery:e._name,generatedFrom:e._generatedFrom,parameters:e.getParameterValues()},paging:{size:t.size,number:t.number}};this.query=e._name,this.paging=r.paging;var o=i.createHttpPost(n,r);this.execute=function(){var e=o.execute();return e}})}),Bifrost.namespace("Bifrost.read",{queryService:Bifrost.Singleton(function(e,t){this.execute=function(i,n){var r=Bifrost.execution.Promise.create(),o=i.region,s=t.createQuery(i,n);return o.tasks.execute(s).continueWith(function(t){"undefined"!=typeof t&&null!=t||(t={}),"undefined"!=typeof t.items&&null!=t.items||(t.items=[]),"undefined"!=typeof t.totalItems&&null!=t.totalItems||(t.totalItems=0),i.hasReadModel()&&(t.items=e.map(i._readModel,t.items)),r.signal(t)}),r}})}),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.Saga=function(){function e(){var e=this;this.executeCommands=function(t,i){var n=!0;t.forEach(function(e){if(e.onBeforeExecute()===!1)return n=!1,!1}),n!==!1&&Bifrost.commands.commandCoordinator.handleForSaga(e,t,i)}}return{create:function(t){var i=new e;return Bifrost.extend(i,t),i}}}(),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.sagaNarrator=function(){function e(e,t,i){$.ajax({url:e,type:"POST",dataType:"json",data:t,contentType:"application/json; charset=utf-8",complete:i})}function t(e,t){return 200===e.status&&t.success===!0}var i="/Bifrost/SagaNarrator";return{conclude:function(n,r,o){var s={sagaId:n.Id};e(i+"/Conclude",JSON.stringify(s),function(e){var i=Bifrost.commands.CommandResult.createFrom(e.responseText),s=t(e,i);s===!0&&"function"==typeof r&&r(n),s===!1&&"function"==typeof o&&o(n)})}}}(),Bifrost.namespace("Bifrost.messaging",{Messenger:Bifrost.Type.extend(function(){var e=[];return this.publish=function(t,i){e.hasOwnProperty(t)&&e[t].subscribers.forEach(function(e){e(i)})},this.subscribeTo=function(t,i){var n;e.hasOwnProperty(t)?n=e[t]:(n={subscribers:[]},e[t]=n),n.subscribers.push(i)},{publish:this.publish,subscribeTo:this.subscribeTo}})}),Bifrost.messaging.Messenger.global=Bifrost.messaging.Messenger.create(),Bifrost.WellKnownTypesDependencyResolver.types.globalMessenger=Bifrost.messaging.Messenger.global,Bifrost.namespace("Bifrost.messaging",{messengerFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.messaging.Messenger.create();return e},this.global=function(){return Bifrost.messaging.Messenger.global}})}),Bifrost.WellKnownTypesDependencyResolver.types.messengerFactory=Bifrost.messaging.messengerFactory,"undefined"!=typeof ko&&(ko.observableMessage=function(e,t){var i=ko.observable(t),n=!1;return i.subscribe(function(t){n!==!0&&Bifrost.messaging.Messenger.global.publish(e,t)}),Bifrost.messaging.Messenger.global.subscribeTo(e,function(e){n=!0,i(e),n=!1}),i}),Bifrost.namespace("Bifrost.services",{Service:Bifrost.Type.extend(function(){function e(e){var t={};for(var i in e)t[i]=JSON.stringify(e[i]);var n=JSON.stringify(t);return n}function t(t,n,r){$.ajax({url:i.url+"/"+t,type:"POST",dataType:"json",data:e(n),contentType:"application/json; charset=utf-8",complete:function(e){var t=$.parseJSON(e.responseText);r(t)}})}var i=this;this.url="",this.name="",this.callWithoutReturnValue=function(e,i){var n=Bifrost.execution.Promise.create();return t(e,i,function(e){n.signal()}),n},this.callWithObjectAsReturn=function(e,i){var n=ko.observable();return t(e,i,function(e){n(e)}),n},this.callWithArrayAsReturn=function(e,i){var n=ko.observableArray();return t(e,i,function(e){n(e)}),n},this.onCreated=function(e){i.url=e.url,0!==i.url.indexOf("/")&&(i.url="/"+i.url),i.name=e.name}})}),Bifrost.dependencyResolvers.service={canResolve:function(e,t){return"undefined"!=typeof services&&t in services},resolve:function(e,t){return services[t].create()}},Bifrost.namespace("Bifrost",{documentService:Bifrost.Singleton(function(e){var t=this;this.DOMRoot=e,this.pageHasViewModel=function(e){var t=ko.contextFor($("body")[0]);return!Bifrost.isUndefined(t)&&t.$data===e},this.getViewModelNameFor=function(e){var t=e.attributes.getNamedItem("data-viewmodel-name");return Bifrost.isNullOrUndefined(t)&&(t=document.createAttribute("data-viewmodel-name"),t.value=Bifrost.Guid.create()),e.attributes.setNamedItem(t),t.value},this.setViewModelParametersOn=function(e,t){e.viewModelParameters=t},this.getViewModelParametersFrom=function(e){return e.viewModelParameters},this.hasViewModelParameters=function(e){return!Bifrost.isNullOrUndefined(e.viewModelParameters)},this.cleanChildrenOf=function(e){t.traverseObjects(function(t){t!==e&&($(t).unbind(),ko.cleanNode(t))},e)},this.hasViewFile=function(e){var t=e.attributes["data-view-file"];return!Bifrost.isNullOrUndefined(t)},this.getViewFileFrom=function(e){if(t.hasViewFile(e)){var i=e.attributes["data-view-file"];return i.value}return null},this.hasOwnRegion=function(e){return!!e.region},this.getParentRegionFor=function(e){for(var t=null;e.parentNode;)if(e=e.parentNode,e.region)return e.region;return t},this.getRegionFor=function(e){var i=null;return e.region?e.region:i=t.getParentRegionFor(e)},this.setRegionOn=function(e,t){e.region=t},this.clearRegionOn=function(e){e.region=null},this.traverseObjects=function(e,i){if(i=i||t.DOMRoot,!Bifrost.isNullOrUndefined(i)&&(e(i),i.hasChildNodes()))for(var n=i.firstChild;n;){var r=n.nextSibling;1===n.nodeType&&t.traverseObjects(e,n),n=r}},this.getUniqueStyleName=function(e){var t=Bifrost.Guid.create(),i=e+"_"+t;return i},this.addStyle=function(e,t){if(document.styleSheets){var i,n="";for(var r in t)n=n+r+":"+t[r]+";";if(t=n,0!==document.getElementsByTagName("head").length){var o,s,a;if(document.styleSheets.length>0)for(i=0;i<document.styleSheets.length&&(document.styleSheets[i].disabled||(s=document.styleSheets[i].media,a=typeof s,"string"===a?""!==s&&s.indexOf("screen")===-1||(o=document.styleSheets[i]):"object"===a&&(""!==s.mediaText&&s.mediaText.indexOf("screen")===-1||(o=document.styleSheets[i])),"undefined"==typeof o));i++);if("undefined"==typeof o){var f=document.createElement("style");for(f.type="text/css",document.getElementsByTagName("head")[0].appendChild(f),i=0;i<document.styleSheets.length;i++)document.styleSheets[i].disabled||(o=document.styleSheets[i]);s=o.media,a=typeof s}if("string"===a){for(i=0;i<o.rules.length;i++)if(o.rules[i].selectorText&&o.rules[i].selectorText.toLowerCase()===e.toLowerCase())return void(o.rules[i].style.cssText=t);o.addRule(e,t)}else if("object"===a){for(i=0;i<o.cssRules.length;i++)if(o.cssRules[i].selectorText&&o.cssRules[i].selectorText.toLowerCase()===e.toLowerCase())return void(o.cssRules[i].style.cssText=t);o.insertRule(e+"{"+t+"}",0)}}}}})}),Bifrost.namespace("Bifrost.markup",{BindingContext:Bifrost.Type.extend(function(){this.parent=null,this.current=null,this.changed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.markup",{bindingContextManager:Bifrost.Singleton(function(){this.ensure=function(e){},this.hasFor=function(e){},this.getFor=function(e){}})}),Bifrost.WellKnownTypesDependencyResolver.types.bindingContextManager=Bifrost.markup.bindingContextManager,Bifrost.namespace("Bifrost.markup",{attributeValues:Bifrost.Singleton(function(e){this.expandFor=function(e){}})}),Bifrost.namespace("Bifrost.markup",{valueProviderParser:Bifrost.Singleton(function(e,t,i){function n(e,i,n){var o=t.getFor(e,i);if(r.hasValueProvider(n)){var s=r.parseFor(e,i,n);s.forEach(function(e){e.provide(o)})}else o.consume(n)}var r=this,o=new RegExp("{{([a-z ,:{{}}}]*)}}","g");this.hasValueProvider=function(e){var t=e.match(o);return!!t},this.parseFor=function(t,i,r){var s=[],a=r.match(o),f=a[0].substr(2,a[0].length-4),u=new RegExp("([a-z]*) +","g");if(a=f.match(u),1===a.length){var c=a[0].trim();if(e.isKnown(c)){var l=e.getInstanceOf(c);if(s.push(l),f.length>a[0].length){var d=f.substr(a[0].length),p=d.split(",");p.forEach(function(e){e=e.trim();var t=e.split(":");if(0===t.length,1===t.length){var i=t[0];n(l,l.defaultProperty,i)}else 2===t.length&&n(l,t[0],t[1])})}}}return s}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitor:Bifrost.Type.extend(function(){this.visit=function(e,t){}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitorResultActions:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.markup",{objectModelFactory:Bifrost.Singleton(function(e,t){function i(t,n,r,o){function s(s){if(s.length){var a=Bifrost.namespace(n.shift()),f=!1;a._scripts.forEach(function(s){s.toLowerCase()===t.toLowerCase()&&(e.beginResolve(a,s).continueWith(function(e){r(e)}).onFail(function(){i(t,n,r,o)}),f=!0)}),f||i(t,n,r,o)}else o()}s(n)}this.createFrom=function(e,t,n,r,o){i(t,n.targets,r,o)}})}),Bifrost.namespace("Bifrost.markup",{MultipleNamespacesInNameNotAllowed:Bifrost.Type.extend(function(e){})}),Bifrost.namespace("Bifrost.markup",{MultiplePropertyReferencesNotAllowed:Bifrost.Type.extend(function(e){})}),Bifrost.namespace("Bifrost.markup",{ParentTagNameMismatched:Bifrost.Type.extend(function(e,t){})}),Bifrost.namespace("Bifrost.markup",{NamespaceDefinition:Bifrost.Type.extend(function(e){var t=this;this.prefix=e,this.targets=[],this.addTarget=function(e){t.targets.push(e)}})}),Bifrost.namespace("Bifrost.markup",{namespaceDefinitions:Bifrost.Singleton(function(){this.create=function(e){var t=Bifrost.markup.NamespaceDefinition.create({prefix:e});return t}})}),Bifrost.namespace("Bifrost.markup",{namespaces:Bifrost.Singleton(function(e,t){function i(e,t){if(!Bifrost.isNullOrUndefined(t.__namespaces)){var n=null;if(t.__namespaces.forEach(function(t){if(t.prefix===e)return n=t,!1}),null!=n)return n}if(Bifrost.isNullOrUndefined(t.parentElement)||t.parentElement.constructor===HTMLHtmlElement)return null;var r=i(e,t.parentElement);return null!=r?r:null}var n=this,r="ns:";this.global=e.create("__global"),this.expandNamespaceDefinitions=function(t){for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];if(0===o.name.indexOf(r)){var s=o.name.substr(r.length),a=o.value,f=i(s,t);Bifrost.isNullOrUndefined(f)&&(Bifrost.isNullOrUndefined(t.__namespaces)&&(t.__namespaces=[]),f=e.create(s),t.__namespaces.push(f)),f.addTarget(a)}}},this.resolveFor=function(e){var r=t.getNamespacePrefixFor(e);if(Bifrost.isNullOrUndefined(r)||""===r)return n.global;var o=i(r,e);return o}})}),Bifrost.namespace("Bifrost.markup",{elementNaming:Bifrost.Singleton(function(){function e(e){var t,i=e.localName.toLowerCase(),n=i.split(":");if(n.length>2)throw Bifrost.markup.MultipleNamespacesInNameNotAllowed.create({tagName:i});return 2===n.length&&(i=n[1],t=n[0]),{name:i,namespace:t}}this.getNamespacePrefixFor=function(t){var i=e(t);return Bifrost.isNullOrUndefined(i.namespace)?"":i.namespace},this.getLocalNameFor=function(t){var i=e(t);return i.name}})}),Bifrost.namespace("Bifrost.markup",{propertyExpander:Bifrost.Singleton(function(e){this.expand=function(t,i){for(var n=0;n<t.attributes.length;n++){var r=t.attributes[n].localName,o=t.attributes[n].value;r in i&&e.hasValueProvider(o)&&e.parseFor(i,r,o)}}})}),Bifrost.namespace("Bifrost.markup",{ObjectModelElementVisitor:Bifrost.markup.ElementVisitor.extend(function(e,t,i,n,r,o,s){this.visit=function(a,f){if(t.expandNamespaceDefinitions(a),s.ensure(a),a.isKnownType())return void o.expandFor(a);var u=e.getLocalNameFor(a),c=t.resolveFor(a);i.createFrom(a,u,c,function(e){n.expand(a,e),r.prepare(a,e)},function(){})}})}),Bifrost.namespace("Bifrost.markup",{NamingRoot:Bifrost.Type.extend(function(){var e=this;this.target=null,this.find=function(t,i){if(Bifrost.isNullOrUndefined(i)){if(Bifrost.isNullOrUndefined(e.target))return null;i=e.target}if(i.getAttribute("name")===t)return i;if(i.hasChildNodes())for(var n=i.firstChild;n;){if(1===n.nodeType){var r=e.find(t,n);if(null!=r)return r}n=n.nextSibling}return null}})}),Bifrost.namespace("Bifrost.markup",{UIElement:Bifrost.markup.NamingRoot.extend(function(){this.prepare=function(e,t){}})}),Bifrost.namespace("Bifrost.markup",{UIElementPreparer:Bifrost.Singleton(function(){this.prepare=function(e,t){var i=t.prepare(t._type,e);i instanceof Bifrost.execution.Promise&&i.continueWith(function(){if(!Bifrost.isNullOrUndefined(t.template)){var i=Bifrost.views.UIManager.create();i.handle(t.template),ko.applyBindingsToNode(t.template,{with:t}),e.parentElement.replaceChild(t.template,e)}})}})}),Bifrost.namespace("Bifrost.markup",{Control:Bifrost.markup.UIElement.extend(function(){var e=this;this.template=null,this.prepare=function(t,i){var n=Bifrost.execution.Promise.create(),r=t._namespace._path+t._name+".html";return require(["text!"+r+"!strip"],function(t){var i=document.createElement("div");i.innerHTML=t,e.template=i,n.signal()}),n}})}),Bifrost.namespace("Bifrost.views",{PostBindingVisitor:Bifrost.Type.extend(function(){this.visit=function(e){}})}),Bifrost.namespace("Bifrost.views",{UIManager:Bifrost.Singleton(function(e){
var t=Bifrost.markup.ElementVisitor.getExtenders(),i=[],n=Bifrost.views.PostBindingVisitor.getExtenders(),r=[];t.forEach(function(e){i.push(e.create())}),n.forEach(function(e){r.push(e.create())}),this.handle=function(t){e.traverseObjects(function(e){i.forEach(function(t){var i=Bifrost.markup.ElementVisitorResultActions.create();t.visit(e,i)})},t)},this.handlePostBinding=function(t){e.traverseObjects(function(e){r.forEach(function(t){t.visit(e)})},t)}})}),Bifrost.WellKnownTypesDependencyResolver.types.UIManager=Bifrost.views.UIManager,Bifrost.namespace("Bifrost.views",{Content:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{Items:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{ComposeTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost.views",{viewManager:Bifrost.Singleton(function(e,t,i,n,r,o,s,a){function f(e,t){r.masterViewModel.setFor(e,t);var i=a.getViewModelNameFor(e),n="",o=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(o)?o=document.createAttribute("data-bind"):n=o.value+", ",o.value=n+"viewModel: $root['"+i+"']",e.attributes.setNamedItem(o)}this.initializeLandingPage=function(){var a=Bifrost.execution.Promise.create(),u=document.body;if(null!==u){var c=Bifrost.Path.getFilenameWithoutExtension(document.location.toString());if(""===c&&(c="index"),t.canResolve(u,c)){var l=t.resolve(u,c),d=e.createFrom(l);d.element=u,d.content=u.innerHTML,u.view=d;var p=i.getFor(d);i.describe(d,p).continueWith(function(){if(r.hasForView(l)){var e=r.getViewModelPathForView(l);r.isLoaded(e)?s.beginCreateInstanceOfViewModel(e,p).continueWith(function(e){Bifrost.isNullOrUndefined(e)||f(u,e)}):o.load(e,p).continueWith(function(e){Bifrost.isNullOrUndefined(e)||f(u,e)})}n.handle(u),a.signal()})}}return a},this.attach=function(e){n.handle(e),r.masterViewModel.applyTo(e)}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewManager=Bifrost.views.viewManager,Bifrost.namespace("Bifrost.views",{PathResolver:Bifrost.Type.extend(function(){this.canResolve=function(e,t){return!1},this.resolve=function(e,t){}})}),Bifrost.namespace("Bifrost.views",{pathResolvers:Bifrost.Singleton(function(){function e(){var e=[];for(var t in Bifrost.views.pathResolvers)if(Bifrost.views.pathResolvers.hasOwnProperty(t)){var i=Bifrost.views.pathResolvers[t];if("function"==typeof i&&"function"==typeof i.create){var n=i.create();"function"==typeof n.canResolve&&e.push(n)}}return e}this.canResolve=function(t,i){for(var n=e(),r=0;r<n.length;r++){var o=n[r],s=o.canResolve(t,i);if(s===!0)return!0}return!1},this.resolve=function(t,i){for(var n=e(),r=0;r<n.length;r++){var o=n[r];if(o.canResolve(t,i))return o.resolve(t,i)}return null}})}),Bifrost.namespace("Bifrost.views",{UriMapperPathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(e,t){var i=$(e).closest("[data-urimapper]");if(1===i.length){var n=$(i[0]).data("urimapper");if(Bifrost.uriMappers[n].hasMappingFor(t)===!0)return!0}return Bifrost.uriMappers.default.hasMappingFor(t)},this.resolve=function(e,t){var i=$(e).closest("[data-urimapper]");if(1===i.length){var n=$(i[0]).data("urimapper");if(Bifrost.uriMappers[n].hasMappingFor(t)===!0)return Bifrost.uriMappers[n].resolve(t)}return Bifrost.uriMappers.default.resolve(t)}})}),"undefined"!=typeof Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.UriMapperPathResolver=Bifrost.views.UriMapperPathResolver),Bifrost.namespace("Bifrost.views",{RelativePathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(e,t){var i=$(e).closest("[data-view]");if(1===i.length){$(i[0]).view}return!1},this.resolve=function(e,t){var i=$(e).closest("[data-urimapper]");if(1===i.length){var n=$(i[0]).data("urimapper");if(Bifrost.uriMappers[n].hasMappingFor(t)===!0)return Bifrost.uriMappers[n].resolve(t)}return Bifrost.uriMappers.default.resolve(t)}})}),"undefined"!=typeof Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.RelativePathResolver=Bifrost.views.RelativePathResolver),Bifrost.namespace("Bifrost.views",{View:Bifrost.Type.extend(function(e,t,i,n){var r=this;this.path=n,this.content="[CONTENT NOT LOADED]",this.element=null,this.viewModelType=null,this.viewModelPath=null,this.region=null,this.load=function(o){r.region=o;var s=Bifrost.execution.Promise.create();return r.viewModelPath=i.getViewModelPathForView(n),e.load(r.path,o).continueWith(function(e){r.content=e,r.viewModelType=t.getViewModelTypeForPath(r.viewModelPath),s.signal(r)}),s}})}),Bifrost.namespace("Bifrost.views",{viewFactory:Bifrost.Singleton(function(){this.createFrom=function(e){var t=Bifrost.views.View.create({path:e});return t}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewFactory=Bifrost.views.viewFactory,Bifrost.namespace("Bifrost.views",{ViewLoadTask:Bifrost.views.ComposeTask.extend(function(e,t){var i=this;this.files=[],e.forEach(function(e){i.files.push(e.path.fullPath)}),this.execute=function(){var i=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){var t=e[0];i.signal(t)}),i}})}),Bifrost.namespace("Bifrost.views",{viewLoader:Bifrost.Singleton(function(e,t,i,n){this.load=function(n,r){var o=Bifrost.execution.Promise.create(),s=[],a=i.create(n,Bifrost.io.fileType.html);n.indexOf("?")>0&&(a.path.fullPath=a.path.fullPath+n.substr(n.indexOf("?"))),s.push(a);var f=null;if(e.hasForView(n)&&(f=e.getViewModelPathForView(n),!e.isLoaded(f))){var u=i.create(f,Bifrost.io.fileType.javaScript);s.push(u)}var c=t.createViewLoad(s);return r.tasks.execute(c).continueWith(function(e){o.signal(e)}),o}})}),Bifrost.namespace("Bifrost.views",{viewBindingHandler:Bifrost.Type.extend(function(e,t,i,n,r,o,s,a){function f(t,n,r,o){return function(){var o=ko.utils.unwrapObservable(n());t.viewUri!==o&&(t.children.forEach(ko.removeNode),t.viewModel=null,t.view=null,t.templateSource=null,t.innerHTML=""),t.viewUri=o;var f=ko.observable(t.viewModel),u=r().viewModelParameters||{},c=null,l=null,d=null;if(Bifrost.isNullOrUndefined(o)||""===o)c=new ko.nativeTemplateEngine;else{c=e;var p=a.resolve(t,o);l=i.createFrom(p),l.element=t,d=s.getFor(l)}return{if:!0,data:f,element:t,templateEngine:c,viewUri:o,viewModelParameters:u,view:l,region:d}}}this.init=function(e,t,i,n,r){return ko.bindingHandlers.template.init(e,f(e,t,i,r),i,n,r)},this.update=function(e,t,i,n,r){return ko.bindingHandlers.template.update(e,f(e,t,i,r),i,n,r)}})}),Bifrost.views.viewBindingHandler.initialize=function(){ko.bindingHandlers.view=Bifrost.views.viewBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.view=!1,ko.virtualElements.allowedBindings.view=!0},Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateSource:Bifrost.Type.extend(function(e){var t="";this.loadFor=function(e,i,n){var r=Bifrost.execution.Promise.create();return i.load(n).continueWith(function(e){var o=document.createElement("div");o.innerHTML=e.content,t=o.innerHTML,Bifrost.isNullOrUndefined(e.viewModelType)?r.signal(e):(Bifrost.views.Region.current=n,i.viewModelType.ensure().continueWith(function(){r.signal(e)}))}),r},this.data=function(e,t){},this.text=function(e){return t}})}),Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateEngine:Bifrost.Type.extend(function(e,t,i){var n=this;this.renderTemplate=function(e,r,o){var s;Bifrost.isNullOrUndefined(o.element.templateSource)?(s=Bifrost.views.ViewBindingHandlerTemplateSource.create({viewUri:o.viewUri,region:o.region}),o.element.templateSource=s):s=o.element.templateSource,Bifrost.isNullOrUndefined(o.element.view)&&s.loadFor(o.element,o.view,o.region).continueWith(function(e){o.element.view=e,t.describe(o.view,o.region).continueWith(function(){try{ko.dependencyDetection.begin();var t;if(Bifrost.isNullOrUndefined(e.viewModelType))t={},o.data(t),r.$data=t;else{var i=o.viewModelParameters;i.region=o.region,t=e.viewModelType.create(i),o.element.viewModel=t,o.data(t),r.$data=t}}finally{ko.dependencyDetection.end()}})}),r.$root=r.$data;var a=n.renderTemplateSource(s,r,o);return a.forEach(function(e){e.constructor!==Text&&e.constructor!==Comment&&i.handle(e)}),a}})}),function(){var e=new ko.nativeTemplateEngine,t=Bifrost.views.ViewBindingHandlerTemplateEngine.create;Bifrost.views.ViewBindingHandlerTemplateEngine.create=function(){var i=t.call(Bifrost.views.ViewBindingHandlerTemplateEngine,arguments);for(var n in e)i.hasOwnProperty(n)||(i[n]=e[n]);return i}}(),Bifrost.namespace("Bifrost.views",{MasterViewModel:Bifrost.Type.extend(function(e){function t(e){Bifrost.isNullOrUndefined(e)||Bifrost.isFunction(e.deactivated)&&e.deactivated()}function i(e){!Bifrost.isNullOrUndefined(e)&&Bifrost.isFunction(e.activated)&&e.activated()}var n=this;this.setFor=function(r,o){var s=n.getFor(r);s!==o&&t(s);var a=e.getViewModelNameFor(r);n[a]=o,i(o)},this.getFor=function(t){var i=e.getViewModelNameFor(t);return n.hasOwnProperty(i)?n[i]:null},this.clearFor=function(i){var r=e.getViewModelNameFor(i);n.hasOwnProperty(r)||(t(n[r]),delete n[r],n[r]=null)},this.apply=function(){ko.applyBindings(n)},this.applyTo=function(e){ko.applyBindings(n,e)}})}),Bifrost.namespace("Bifrost.views",{ViewModel:Bifrost.Type.extend(function(e){var t=this;this.targetViewModel=this,this.region=e,this.activated=function(){"function"==typeof t.targetViewModel.onActivated&&t.targetViewModel.onActivated()},this.deactivated=function(){"function"==typeof t.targetViewModel.onDeactivated&&t.targetViewModel.onDeactivated()},this.onCreated=function(e){t.targetViewModel=e}})}),Bifrost.namespace("Bifrost.views",{viewModelTypes:Bifrost.Singleton(function(){function e(e){var t=Bifrost.Path.getPathWithoutFilename(e),i=Bifrost.namespaceMappers.mapPathToNamespace(t);if(null!=i){var n=Bifrost.namespace(i);return n}return null}function t(e){var t=(Bifrost.Path.getPathWithoutFilename(e),Bifrost.Path.getFilenameWithoutExtension(e));return t}function i(i){var n=e(i);if(null!=n){var r=t(i);if(Bifrost.isType(n[r]))return n[r]}return null}var n=this;this.isLoaded=function(i){var n=e(i);if(null!=n){var r=t(i);return r in n}return!1},this.getViewModelTypeForPath=function(e){var t=i(e);if(Bifrost.isNullOrUndefined(t)){var n=e.replace(".js","/index.js");t=i(n),Bifrost.isNullOrUndefined(t)&&(n=e.replace(".js","/Index.js"),i(n))}return t},this.beginCreateInstanceOfViewModel=function(e,t,i){var r=Bifrost.execution.Promise.create(),o=n.getViewModelTypeForPath(e);if(null!=o){Bifrost.views.Region.current;Bifrost.views.Region.current=t,i=i||{},i.region=t,o.beginCreate(i).continueWith(function(e){r.signal(e)}).onFail(function(t){throw console.log("ViewModel '"+e+"' failed instantiation"),t})}else console.log("ViewModel '"+e+"' does not exist"),r.signal(null);return r}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewModelTypes=Bifrost.views.viewModelTypes,Bifrost.namespace("Bifrost.views",{viewModelLoader:Bifrost.Singleton(function(e,t,i){this.load=function(n,r,o){var s=Bifrost.execution.Promise.create(),a=t.create(n,Bifrost.io.fileType.javaScript),f=e.createViewModelLoad([a]);return r.tasks.execute(f).continueWith(function(){i.beginCreateInstanceOfViewModel(n,r,o).continueWith(function(e){s.signal(e)})}),s}})}),Bifrost.namespace("Bifrost.views",{ViewModelLoadTask:Bifrost.views.ComposeTask.extend(function(e,t){var i=this;this.files=[],e.forEach(function(e){i.files.push(e.path.fullPath)}),this.execute=function(){var i=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){i.signal(e)}),i}})}),Bifrost.namespace("Bifrost.views",{viewModelManager:Bifrost.Singleton(function(e,t,i,n,r,o,s){var a=this;this.assetsManager=e,this.viewModelLoader=i,this.documentService=t,this.masterViewModel=s,this.hasForView=function(e){var t=Bifrost.Path.changeExtension(e,"js");t=Bifrost.Path.makeRelative(t);var i=a.assetsManager.hasScript(t);return i},this.getViewModelPathForView=function(e){var t=Bifrost.Path.changeExtension(e,"js");return t},this.isLoaded=function(e){var t=Bifrost.Path.getPathWithoutFilename(e),i=Bifrost.Path.getFilenameWithoutExtension(e),n=Bifrost.namespaceMappers.mapPathToNamespace(t);if(null!=n){var r=Bifrost.namespace(n);if(i in r)return!0}return!1}})}),Bifrost.namespace("Bifrost.views",{viewModelBindingHandler:Bifrost.Type.extend(function(e,t,i,n,r,o){this.init=function(n,s,a,f,u){var c=ko.utils.unwrapObservable(s());if(n._isLoading!==!0&&(n._viewModelPath!==c||Bifrost.isNullOrUndefined(n._viewModel))){n._isLoading=!0,n._viewModelPath=c;var l="/";e.hasViewFile(n)&&(l=e.getViewFileFrom(n));var d=t.createFrom(l);d.content=n.innerHTML,d.element=n;var p=ko.observable(),h=o.getFor(d);return o.describe(d,h).continueWith(function(){var e=a().viewModelParameters||{};if(e.region=h,r.isLoaded(c)){var t=r.getViewModelTypeForPath(c),o=Bifrost.views.Region.current;Bifrost.views.Region.current=h,t.beginCreate(e).continueWith(function(e){var t=u.createChildContext(e);t.$root=e,n._viewModel=e,p(e),Bifrost.views.Region.current=o,n._isLoading=!1}).onFail(function(e){console.log("Could not create an instance of '"+t._namespace.name+"."+t._name+" - Reason : "+e)})}else i.load(c,h,e).continueWith(function(e){var t=u.createChildContext(e);t.$root=e,n._viewModel=e,p(e),n._isLoading=!1})}),ko.bindingHandlers.with.init(n,p,a,f,u)}}})}),Bifrost.views.viewModelBindingHandler.initialize=function(){ko.bindingHandlers.viewModel=Bifrost.views.viewModelBindingHandler.create()},Bifrost.namespace("Bifrost.views",{Region:function(e,t,i){function n(e,t){return ko.computed(function(){var i=!1;return s.children().forEach(function(e){if(e[t]()===!0)return void(i=!0)}),s.tasks.all().forEach(function(t){t._type.typeOf(e)===!0&&(i=!0)}),i})}function r(e,t){return ko.computed(function(){var i=!0,n=s.aggregatedCommands();return(t!==!0||0!==n.length)&&(n.forEach(function(t){if(t[e]()===!1)return void(i=!1)}),i)})}function o(e){return ko.computed(function(){var t=!1,i=s.aggregatedCommands();return i.forEach(function(i){if(i[e]()===!0)return void(t=!0)}),t})}var s=this;this.view=ko.observable(),this.viewModel=null,this.messenger=e.create(),this.globalMessenger=e.global(),this.operations=t.create(),this.tasks=i.create(),this.parent=null,this.children=ko.observableArray(),this.commands=ko.observableArray(),this.isCommandRoot=ko.observable(!1),this.aggregatedCommands=ko.computed(function(){var e=[];return s.commands().forEach(function(t){e.push(t)}),s.children().forEach(function(t){t.isCommandRoot()||t.aggregatedCommands().forEach(function(t){e.push(t)})}),e}),this.isValid=r("isValid"),this.canCommandsExecute=r("canExecute",!0),this.areCommandsAuthorized=r("isAuthorized"),this.commandsHaveChanges=o("hasChanges"),this.areCommandsReadyToExecute=r("isReadyToExecute",!0),this.hasChanges=ko.computed(function(){var e=s.commandsHaveChanges(),t=!1;return s.children().forEach(function(e){if(!e.isCommandRoot()&&e.hasChanges()===!0)return void(t=!0)}),e||s.operations.stateful().length>0||t}),this.validationMessages=ko.computed(function(){var e=[],t=s.aggregatedCommands();return t.forEach(function(t){t.isValid()===!1&&t.validators().forEach(function(t){t.isValid()===!1&&e.push(t.message())})}),e}),this.isExecuting=n(Bifrost.tasks.ExecutionTask,"isExecuting"),this.isComposing=n(Bifrost.views.ComposeTask,"isComposing"),this.isLoading=n(Bifrost.tasks.LoadTask,"isLoading"),this.isBusy=ko.computed(function(){var e=!1;return s.children().forEach(function(t){if(t.isBusy()===!0)return void(e=!0)}),s.tasks.all().length>0&&(e=!0),e})}}),Bifrost.views.Region.current=null,Bifrost.dependencyResolvers.Region={canResolve:function(e,t){return"region"===t},resolve:function(e,t){return Bifrost.views.Region.current}},Bifrost.namespace("Bifrost.views",{regionManager:Bifrost.Singleton(function(e,t,i,n,r){function o(){var e=new Bifrost.views.Region(i,n,r);return e}function s(i){var n=e.getParentRegionFor(i);if(n)Bifrost.views.Region.prototype=n;else{var r=o();t.describeTopLevel(r),Bifrost.views.Region.prototype=r}return n}function a(e){var t=o();return t.parent=e,e&&e.children.push(t),t}this.getFor=function(t){var i,n=t.element;if(e.hasOwnRegion(n))return i=e.getRegionFor(n),i.view(t),i;var r=s(n);return i=a(r),i.view(t),e.setRegionOn(n,i),i},this.describe=function(e,i){var n=Bifrost.execution.Promise.create();e.element;return t.describe(e,i).continueWith(function(){n.signal()}),n},this.getCurrent=function(){return Bifrost.views.Region.current},this.evict=function(e){e.parentRegion&&e.parentRegion.children.remove(e),e.parentRegion=null}})}),Bifrost.WellKnownTypesDependencyResolver.types.regionManager=Bifrost.views.regionManage,Bifrost.namespace("Bifrost.views",{RegionDescriptor:Bifrost.Type.extend(function(){this.describe=function(e){}})}),Bifrost.namespace("Bifrost.views",{regionDescriptorManager:Bifrost.Singleton(function(){this.describe=function(e,t){var i=Bifrost.execution.Promise.create(),n=Bifrost.Path.getPathWithoutFilename(e.path),r=Bifrost.namespaceMappers.mapPathToNamespace(n);if(null!=r){var o=Bifrost.namespace(r);Bifrost.views.Region.current=t,Bifrost.dependencyResolver.beginResolve(o,"RegionDescriptor").continueWith(function(e){e.describe(t),i.signal()}).onFail(function(){i.signal()})}else i.signal();return i},this.describeTopLevel=function(e){}})}),Bifrost.dependencyResolvers.RegionDescriptor={canResolve:function(e,t){return"RegionDescriptor"===t},resolve:function(e,t){return{describe:function(){}}}},Bifrost.namespace("Bifrost.views",{DataViewAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(e,t){var i=e.attributes.getNamedItem("data-view");if(!Bifrost.isNullOrUndefined(i)){var n="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):n=r.value+", ",r.value=n+"view: '"+i.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-view")}}})}),Bifrost.namespace("Bifrost.views",{DataViewModelFileAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(e,t){var i=e.attributes.getNamedItem("data-viewmodel-file");if(!Bifrost.isNullOrUndefined(i)){var n="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):n=r.value+", ",r.value=n+"viewModel: '"+i.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-viewmodel-file")}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManagerElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){function e(e,t,n){function r(t){if(t._name.toLowerCase()===o.localName){for(var i=t.create(),r=0;r<o.attributes.length;r++){var s=o.attributes[r].localName,a=o.attributes[r].value;i.hasOwnProperty(s)&&(i[s]=a)}i.initialize(e),n.addAction(i)}}if(t.hasChildNodes())for(var o=t.firstChild;o;)i.forEach(r),o=o.nextSibling}function t(t,i,n){if(i.hasChildNodes())for(var r=i.firstChild;r;){if("visualstate"===r.localName){var o=Bifrost.interaction.VisualState.create();o.name=r.getAttribute("name"),n.addState(o),e(t,r,o)}r=r.nextSibling}}var i=Bifrost.interaction.VisualStateAction.getExtenders();this.visit=function(e,i){if("visualstatemanager"===e.localName){var n=Bifrost.interaction.VisualStateManager.create(),r=e.parentElement.namingRoot;if(e.parentElement.visualStateManager=n,e.hasChildNodes())for(var o=e.firstChild;o;){if("visualstategroup"===o.localName){var s=Bifrost.interaction.VisualStateGroup.create();n.addGroup(s);var a=o.getAttribute("duration");if(!Bifrost.isNullOrUndefined(a)&&(a=parseFloat(a),!isNaN(a))){a=1e3*a;var f=Bifrost.TimeSpan.fromMilliseconds(a);s.defaultDuration=f}t(r,o,s)}o=o.nextSibling}}}})}),Bifrost.namespace("Bifrost.navigation",{NavigationFrame:Bifrost.Type.extend(function(e,t,i){var n=this;this.home=e,this.history=i,this.container=null,this.currentUri=ko.observable(e),this.uriMapper=t||null,this.setCurrentUri=function(e){0===e.indexOf("/")&&(e=e.substr(1)),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1)),null!=e&&0!==e.length||(e=n.home),null==n.uriMapper||n.uriMapper.hasMappingFor(e)||(e=n.home),n.currentUri(e)},this.setCurrentUriFromCurrentLocation=function(){var e=n.history.getState(),t=Bifrost.Uri.create(e.url);n.setCurrentUri(t.path)},i.Adapter.bind(window,"statechange",function(){n.setCurrentUriFromCurrentLocation()}),this.configureFor=function(e){n.setCurrentUriFromCurrentLocation(),n.container=e;var t=$(e).closest("[data-urimapper]");if(1===t.length){var i=$(t[0]).data("urimapper");i in Bifrost.uriMappers&&(n.uriMapper=Bifrost.uriMappers[i])}null==n.uriMapper&&(n.uriMapper=Bifrost.uriMappers.default)},this.navigate=function(e){n.setCurrentUri(e)}})}),"undefined"!=typeof ko&&"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&(ko.bindingHandlers.navigateTo={init:function(e,t,i,n){ko.applyBindingsToNode(e,{click:function(){var i=t()();History.pushState({feature:i},$(e).attr("title"),"/"+i)}},n)}}),Bifrost.namespace("Bifrost.navigation",{navigateTo:function(e,t){var i=e;"/"!==e.charAt(0)&&(i="/"+i),t&&(i+=t),"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&History.pushState({},"",i)},navigationManager:{getCurrentLocation:function(){var e=Bifrost.Uri.create(window.location.toString());return e},hookup:function(){"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&$("body").click(function(e){var t=e.target.href;if("undefined"==typeof t){var i=$(e.target).closest("a")[0];if(!i)return;t=i.href}t.indexOf("#!")>0&&(t=t.substr(0,t.indexOf("#!"))),0===t.length&&(t="/");var n=Bifrost.Uri.create(t);if(n.isSameAsOrigin&&n.queryString.indexOf("postback")<0){for(var r=n.path;0===r.indexOf("/");)r=r.substr(1);e.preventDefault();var o=$(e.target).closest("[data-navigation-target]");if(1===o.length){var s=$(o[0]).data("navigation-target"),a=$("#"+s);1===a.length&&"undefined"!=typeof a[0].navigationFrame&&a[0].navigationFrame.navigate(n.path)}else{var f=n.queryString.length>0?"?"+n.queryString:"";History.pushState({},"","/"+r+f)}}})}}}),Bifrost.namespace("Bifrost.navigation",{observableQueryParameterFactory:Bifrost.Singleton(function(){var e="undefined"!=typeof History&&"undefined"!=typeof History.Adapter;this.create=function(t,i,n){function r(){var e=n.getCurrentLocation();return e.parameters.hasOwnProperty(t)?e.parameters[t]:null}function o(e,i){var n=Bifrost.hashString.decode(e);n[t]=i;var r="",o=0;for(var s in n){var a=n[s];Bifrost.isNullOrUndefined(a)||(o>0&&(r+="&"),r+=s+"="+a),o++}return r}function s(e){return 0!==e.indexOf("#")&&0!==e.indexOf("?")||(e=e.substr(1)),e}var a=null;e?History.Adapter.bind(window,"statechange",function(){null!=a&&a(r())}):window.addEventListener("hashchange",function(){if(null!=a){var e=r();a()!==e&&a(e)}},!1);var f=r();return a=ko.observable(f||i),a.subscribe(function(i){var n;if(e){var r=History.getState();r[t]=i,n="?"+o(s(r.url),i),History.pushState(r,r.title,n)}else n="#"+o(s(document.location.hash),i),document.location.hash=n}),a}})}),ko.observableQueryParameter=function(e,t){var i=Bifrost.navigation.navigationManager,n=Bifrost.navigation.observableQueryParameterFactory.create().create(e,t,i);return n},Bifrost.namespace("Bifrost.navigation",{DataNavigationFrameAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(e){this.visit=function(e,t){var i=e.attributes.getNamedItem("data-navigation-frame");if(!Bifrost.isNullOrUndefined(i)){var n="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):n=r.value+", ",r.value=n+"navigation: '"+i.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-navigation-frame")}}})}),Bifrost.namespace("Bifrost.navigation",{navigationBindingHandler:Bifrost.Type.extend(function(){function e(e){for(var t=ko.utils.unwrapObservable(e()),i=ko.expressionRewriting.parseObjectLiteral(t),n={},r=0;r<i.length;r++){var o=i[r];n[o.key.trim()]=o.value.trim()}var s=n.uriMapper;Bifrost.isNullOrUndefined(s)&&(s="default");var a=Bifrost.uriMappers[s],f=Bifrost.navigation.NavigationFrame.create({locationAware:!1,uriMapper:a,home:n.home||""});return f}function t(e){return function(){return e.currentUri()}}this.init=function(i,n,r,o,s){var a=e(n);return a.configureFor(i),ko.bindingHandlers.view.init(i,t(a),r,o,s)},this.update=function(i,n,r,o,s){var a=e(n);return a.configureFor(i),ko.bindingHandlers.view.update(i,t(a),r,o,s)}})}),Bifrost.navigation.navigationBindingHandler.initialize=function(){ko.bindingHandlers.navigation=Bifrost.navigation.navigationBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.navigation=!1,ko.virtualElements.allowedBindings.navigation=!0},Bifrost.namespace("Bifrost.values",{TypeConverter:Bifrost.Type.extend(function(){this.supportedType=null,this.convertFrom=function(e){return e},this.convertTo=function(e){return e}})}),Bifrost.namespace("Bifrost.values",{NumberTypeConverter:Bifrost.values.TypeConverter.extend(function(){function e(e){e=e.toString();for(var i="",n=0;n<e.length;n++)for(var r=!1,o=0;o<t.length;o++)if(e[n]===t[o]){r=!0,i+=e[n];break}return i}var t="0123456789.,-";this.supportedType=Number,this.convertFrom=function(t){if(t.constructor===Number)return t;if(""===t)return 0;t=e(t);var i=0;return i=t.indexOf(".")>=0?parseFloat(t):parseInt(t)}})}),Bifrost.namespace("Bifrost.values",{DateTypeConverter:Bifrost.values.TypeConverter.extend(function(){function e(e){return Bifrost.isNullOrUndefined(e)||"0001-01-01T00:00:00"===e||"0001-01-01T00:00:00Z"===e||e instanceof Date&&e.getTime()===-621355968e5||e instanceof Date&&isNaN(e.getTime())}this.supportedType=Date,this.convertFrom=function(t){if(e(t))return null;var i=new Date(t);return i},this.convertTo=function(e){return e.format("yyyy-MM-dd")}})}),Bifrost.namespace("Bifrost.values",{StringTypeConverter:Bifrost.values.TypeConverter.extend(function(){this.supportedType=String,this.convertFrom=function(e){return e.toString()}})}),Bifrost.namespace("Bifrost.values",{typeConverters:Bifrost.Singleton(function(){var convertersByType={},typeConverterTypes=Bifrost.values.TypeConverter.getExtenders();typeConverterTypes.forEach(function(e){var t=e.create();convertersByType[t.supportedType]=t}),this.convertFrom=function(value,type){var actualType=null;return actualType=Bifrost.isString(type)?eval(type):type,convertersByType.hasOwnProperty(actualType)?convertersByType[actualType].convertFrom(value):value},this.convertTo=function(e){if(Bifrost.isNullOrUndefined(e))return e;for(var t in convertersByType)if(e.constructor==t)return convertersByType[t].convertTo(e);return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.typeConverters=Bifrost.values.typeConverters,Bifrost.namespace("Bifrost.values",{typeExtender:Bifrost.Singleton(function(){this.extend=function(e,t){e._typeAsString=t}})}),ko.extenders.type=Bifrost.values.typeExtender.create().extend,Bifrost.namespace("Bifrost.values",{Formatter:Bifrost.Type.extend(function(){this.supportedType=null,this.format=function(e,t){return e}})}),Bifrost.namespace("Bifrost.values",{DateFormatter:Bifrost.values.Formatter.extend(function(){this.supportedType=Date,this.format=function(e,t){return e.format(t)}})}),Bifrost.namespace("Bifrost.values",{stringFormatter:Bifrost.Singleton(function(){function e(e){if(1!==e.nodeType||Bifrost.isNullOrUndefined(e.attributes))return null;var t=e.attributes.getNamedItem("data-stringformat");return Bifrost.isNullOrUndefined(t)?null:t.value}var t=Bifrost.values.Formatter.getExtenders(),i={};t.forEach(function(e){var t=e.create();i[t.supportedType]=t}),this.hasFormat=function(t){var i=e(t);return null!==i},this.format=function(t,n){var r=e(t);if(i.hasOwnProperty(n.constructor)){var o=i[n.constructor],s=new RegExp("{(.[^{}])*}","g"),a=r.replace(s,function(e){var t=e.substr(1,e.length-2);return o.format(n,t)});return a}return r}})}),Bifrost.namespace("Bifrost.values",{valuePipeline:Bifrost.Singleton(function(e,t){this.getValueForView=function(i,n){if(Bifrost.isNullOrUndefined(n))return n;var r=ko.utils.unwrapObservable(n);if(Bifrost.isNullOrUndefined(r))return n;var o=r;return t.hasFormat(i)?o=t.format(i,r):Bifrost.isNullOrUndefined(n._typeAsString)||(o=e.convertTo(r)),o},this.getValueForProperty=function(t,i){return Bifrost.isNullOrUndefined(t)?i:Bifrost.isNullOrUndefined(i)?i:(Bifrost.isNullOrUndefined(t._typeAsString)||(i=e.convertFrom(i,t._typeAsString)),i)}})}),function(){var e=Bifrost.values.valuePipeline.create(),t=ko.selectExtensions.readValue;ko.selectExtensions.readValue=function(i){var n=t(i),r=ko.bindingProvider.instance.getBindings(i,ko.contextFor(i));if(Bifrost.isNullOrUndefined(r))return n;var o=e.getValueForProperty(r.value,n);return o};var i=ko.selectExtensions.writeValue;ko.selectExtensions.writeValue=function(t,n,r){var o=n,s=ko.bindingProvider.instance.getBindings(t,ko.contextFor(t));Bifrost.isNullOrUndefined(s)||(o=ko.utils.unwrapObservable(e.getValueForView(t,s.value))),i(t,o,r)};var n=ko.utils.setTextContent;ko.utils.setTextContent=function(t,i){var r=e.getValueForView(t,i);n(t,r)};var r=ko.utils.setHtml;ko.utils.setHtml=function(t,i){var n=e.getValueForView(t,i);r(t,n)}}(),Bifrost.namespace("Bifrost.values",{ValueProvider:Bifrost.Type.extend(function(){this.defaultProperty=null,this.provide=function(e){}})}),Bifrost.namespace("Bifrost.values",{valueProviders:Bifrost.Singleton(function(){this.isKnown=function(e){var t=!1,i=Bifrost.values.ValueProvider.getExtenders();return i.forEach(function(i){if(i._name.toLowerCase()===e)return void(t=!0)}),t},this.getInstanceOf=function(e){var t=null,i=Bifrost.values.ValueProvider.getExtenders();return i.forEach(function(i){if(i._name.toLowerCase()===e)return void(t=i.create())}),t}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueProviders=Bifrost.values.valueProviders,Bifrost.namespace("Bifrost.values",{ValueConsumer:Bifrost.Type.extend(function(){this.canNotifyChanges=function(){return!1},this.notifyChanges=function(e){},this.consume=function(e){}})}),Bifrost.namespace("Bifrost.values",{valueConsumers:Bifrost.Singleton(function(){this.getFor=function(e,t){var i=Bifrost.values.DefaultValueConsumer.create({target:e,property:t});return i}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueConsumers=Bifrost.values.valueConsumers,Bifrost.namespace("Bifrost.values",{Binding:Bifrost.values.ValueProvider.extend(function(e){this.defaultProperty="path",this.path="",this.mode=null,this.converter=null,this.format=null,this.provide=function(e){}})}),Bifrost.namespace("Bifrost.values",{DefaultValueConsumer:Bifrost.values.ValueConsumer.extend(function(e,t){this.consume=function(i){e[t]=i}})}),Bifrost.namespace("Bifrost",{configurator:Bifrost.Type.extend(function(){this.configure=function(e){}})}),Bifrost.namespace("Bifrost",{configureType:Bifrost.Singleton(function(e){function t(){Bifrost.views.Region.current=document.body.region,r.isReady=!0;for(var e=0;e<r.readyCallbacks.length;e++)r.readyCallbacks[e]()}function i(){Bifrost.navigation.navigationManager.hookup(),r.applyMasterViewModel===!0&&Bifrost.views.viewModelManager.create().masterViewModel.apply()}function n(){var n=Bifrost.configurator.getExtenders();n.forEach(function(e){var t=e.create();t.config(r)}),Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady(),Bifrost.views.viewModelBindingHandler.initialize(),Bifrost.views.viewBindingHandler.initialize(),Bifrost.navigation.navigationBindingHandler.initialize(),"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&(Bifrost.WellKnownTypesDependencyResolver.types.history=History),e.initialize().continueWith(function(){r.initializeLandingPage===!0?Bifrost.views.viewManager.create().initializeLandingPage().continueWith(i):i(),t()})}var r=this,o=Bifrost.StringMapper.create();o.addMapping("{boundedContext}/{module}/{feature}/{view}","{boundedContext}/{module}/{feature}/{view}.html"),o.addMapping("{boundedContext}/{feature}/{view}","{boundedContext}/{feature}/{view}.html"),o.addMapping("{feature}/{view}","{feature}/{view}.html"),o.addMapping("{view}","{view}.html"),Bifrost.uriMappers.default=o,this.isReady=!1,this.readyCallbacks=[],this.initializeLandingPage=!0,this.applyMasterViewModel=!0,this.ready=function(e){
r.isReady===!0?e():r.readyCallbacks.push(e)},$(function(){n()})})}),Bifrost.configure=Bifrost.configureType.create();