"use strict";

var gulp = require('gulp'),
    jshint = require('gulp-jshint'),
    concat = require('gulp-concat'),
    uglify = require('gulp-uglify'),
    sourcemaps = require('gulp-sourcemaps');

var src = ['extensions/ArrayExtensions.js',
			'extensions/stringExtensions.js',
			'extensions/NodeListExtensions.js',
			'extensions/HTMLElementExtensions.js',
			'extensions/HTMLCollectionExtensions.js',
			'extensions/HTMLElementExtensions.js',
			'extensions/DateExtensions.js',
			'polyfills/classList.js',
			'polyfills/ElementPolyfills.js',
			'utils/extend.js',
			'utils/namespace.js',
			'execution/Promise.js',
			'utils/isObject.js',
			'utils/isNumber.js',
			'utils/isArray.js',
			'utils/isString.js',
			'utils/isNull.js',
			'utils/isUndefined.js',
			'utils/isNullOrUndefined.js',
			'utils/isFunction.js',
			'utils/isType.js',
			'utils/functionParser.js',
			'utils/assetsManager.js',
			'utils/WellKnownTypesDependencyResolver.js',
			'utils/dependencyResolver.js',
			'utils/dependencyResolvers.js',
			'utils/defaultDependencyResolver.js',
			'utils/DOMRootDependencyResolver.js',
			'utils/KnownArtifactTypesDependencyResolver.js',
			'utils/KnownArtifactInstancesDependencyResolver.js',
			'utils/guid.js',
			'utils/Type.js',
			'utils/Singleton.js',
			'types/TypeInfo.js',
			'types/PropertyInfo.js',
			'utils/path.js',
			'utils/Exception.js',
			'utils/exceptions.js',
			'utils/hashString.js',
			'utils/Uri.js',
			'utils/namespaces.js',
			'utils/namespaceMappers.js',
			'utils/StringMapping.js',
			'utils/stringMappingFactory.js',
			'utils/StringMapper.js',
			'utils/uriMappers.js',
			'utils/server.js',
			'utils/areEqual.js',
			'utils/deepClone.js',
			'utils/systemClock.js',
			'TimeSpan.js',
			'Event.js',
			'systemEvents.js',
			'dispatcher.js',
			'linked.js',
			'hubs/hubConnection.js',
			'hubs/Hub.js',
			'hubs/hubDependencyResolver.js',
			'io/fileType.js',
			'io/File.js',
			'io/fileFactory.js',
			'io/fileManager.js',
			'specifications/Specification.js',
			'specifications/And.js',
			'specifications/Or.js',
			'tasks/Task.js',
			'tasks/TaskHistoryEntry.js',
			'tasks/taskHistory.js',
			'tasks/Tasks.js',
			'tasks/tasksFactory.js',
			'tasks/HttpGetTask.js',
			'tasks/HttpPostTask.js',
			'tasks/LoadTask.js',
			'tasks/FileLoadTask.js',
			'tasks/ExecutionTask.js',
			'taskFactory.js',
			'validation/exceptions.js',
			'validation/ruleHandlers.js',
			'validation/Rule.js',
			'validation/Validator.js',
			'validation/validationSummaryFor.js',
			'validation/validationMessageFor.js',
			'validation/validation.js',
			//'validation/notNull.js',
			'validation/required.js',
			'validation/length.js',
			'validation/minLength.js',
			'validation/maxLength.js',
			'validation/range.js',
			'validation/lessThan.js',
			'validation/lessThanOrEqual.js',
			'validation/greaterThan.js',
			'validation/greaterThanOrEqual.js',
			'validation/email.js',
			'validation/regex.js',
			'commands/bindingHandlers.js',
			'commands/HandleCommandTask.js',
			'commands/HandleCommandsTask.js',
			'commands/CommandCoordinator.js',
			'commands/commandValidationService.js',
			'commands/Command.js',
			'commands/CommandDescriptor.js',
			'commands/CommandResult.js',
			'commands/commandDependencyResolver.js',
			'commands/CommandSecurityContext.js',
			'commands/commandSecurityContextFactory.js',
			'commands/commandSecurityService.js',
			'commands/hasChanges.js',
			'commands/commandEvents.js',
			'interaction/Operation.js',
			'interaction/OperationContext.js',
			'interaction/OperationEntry.js',
			'interaction/operationEntryFactory.js',
			'interaction/Operations.js',
			'interaction/operationsFactory.js',
			'interaction/CommandOperation.js',
			'interaction/Action.js',
			'interaction/Trigger.js',
			'interaction/EventTrigger.js',
			'interaction/VisualState.js',
			'interaction/VisualStateAction.js',
			'interaction/VisualStateGroup.js',
			'interaction/VisualStateManager.js',
			'interaction/VisualStateTransition.js',
			'interaction/visualStateActions/Opacity.js',
			'mapping/MissingPropertyStrategy.js',
			'mapping/propertyMap.js',
			'mapping/Map.js',
			'mapping/maps.js',
			'mapping/mapper.js',
			'read/readModelSystemEvents.js',
			'read/PagingInfo.js',
			'read/Queryable.js',
			'read/queryableFactory.js',
			'read/Query.js',
			'read/ReadModel.js',
			'read/ReadModelOf.js',
			'read/ReadModelTask.js',
			'read/readModelOfDependencyResolver.js',
			'read/queryDependencyResolver.js',
			'read/QueryTask.js',
			'read/queryService.js',
			'sagas/Saga.js',
			'sagas/sagaNarrator.js',
			'messaging/Messenger.js',
			'messaging/messengerFactory.js',
			'messaging/observableMessage.js',
			'services/Service.js',
			'services/serviceDependencyResolver.js',
			'documentService.js',
			'markup/BindingContext.js',
			'markup/bindingContextManager.js',
			'markup/attributeValues.js',
			'markup/valueProviderParser.js',
			'markup/ElementVisitor.js',
			'markup/ElementVisitorResultActions.js',
			'markup/objectModelFactory.js',
			'markup/MultipleNamespacesInNameNotAllowed.js',
			'markup/MultiplePropertyReferencesNotAllowed.js',
			'markup/ParentTagNameMismatched.js',
			'markup/NamespaceDefinition.js',
			'markup/namespaceDefinitions.js',
			'markup/namespaces.js',
			'markup/elementNaming.js',
			'markup/propertyExpander.js',
			'markup/ObjectModelElementVisitor.js',
			'markup/NamingRoot.js',
			'markup/UIElement.js',
			'markup/UIElementPreparer.js',
			'markup/Control.js',
			'views/PostBindingVisitor.js',
			'views/UIManager.js',
			'views/Content.js',
			'views/Items.js',
			'views/ComposeTask.js',
			'views/viewManager.js',
			'views/PathResolver.js',
			'views/pathResolvers.js',
			'views/UriMapperPathResolver.js',
			'views/RelativePathResolver.js',
			'views/View.js',
			'views/viewFactory.js',
			'views/ViewLoadTask.js',
			'views/viewLoader.js',
			'views/viewBindingHandler.js',
			'views/viewBindingHandlerTemplateSource.js',
			'views/viewBindingHandlerTemplateEngine.js',
			'views/MasterViewModel.js',
			'views/ViewModel.js',
			'views/viewModelTypes.js',
			'views/viewModelLoader.js',
			'views/ViewModelLoadTask.js',
			'views/viewModelManager.js',
			'views/viewModelBindingHandler.js',
			'views/Region.js',
			'views/RegionDependencyResolver.js',
			'views/regionManager.js',
			'views/RegionDescriptor.js',
			'views/regionDescriptorManager.js',
			'views/RegionDescriptorDependencyResolver.js',
			'views/DataViewAttributeElementVisitor.js',
			'views/DataViewModelFileAttributeElementVisitor.js',
			'interaction/VisualStateManagerElementVisitor.js',
			'navigation/NavigationFrame.js',
			'navigation/navigateTo.js',
			'navigation/navigationManager.js',
			'navigation/observableQueryParameter.js',
			'navigation/DataNavigationFrameAttributeElementVisitor.js',
			'navigation/navigationBindingHandler.js',
			'values/TypeConverter.js',
			'values/NumberTypeConverter.js',
			'values/DateTypeConverter.js',
			'values/StringTypeConverter.js',
			'values/typeConverters.js',
			'values/typeExtender.js',
			'values/Formatter.js',
			'values/DateFormatter.js',
			'values/stringFormatter.js',
			'values/valuePipeline.js',
			'values/ValueProvider.js',
			'values/valueProviders.js',
			'values/ValueConsumer.js',
			'values/valueConsumers.js',
			'values/Binding.js',
			'values/DefaultValueConsumer.js',
			'utils/configurator.js',
			'utils/configure.js'];

gulp.task('lint', function () {
    return gulp.src(src)
        .pipe(jshint())
        .pipe(jshint.reporter('default'));
});

gulp.task('concat', function () {
    return gulp.src(src)
        .pipe(concat('Bifrost.min.js'))
        .pipe(uglify())
        .pipe(gulp.dest(''));
});

gulp.task('concat-with-sourcemaps', function () {
    return gulp.src(src, {base: '../'})
        .pipe(sourcemaps.init())
        .pipe(concat('Bifrost.dev.js'))
        .pipe(sourcemaps.write())
        .pipe(gulp.dest(''));
});

gulp.task('default', ['lint', 'concat', 'concat-with-sourcemaps']);
gulp.task('build', ['concat', 'concat-with-sourcemaps']);