function polyfillForEach(){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){"undefined"==typeof t&&(t=window);for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)})}function polyFillClone(){"function"!=typeof Array.prototype.clone&&(Array.prototype.clone=function(){return this.slice(0)})}function shallowEquals(){"function"!=typeof Array.prototype.shallowEquals&&(Array.prototype.shallowEquals=function(e){if(this===e)return!0;if(null===this||null===e)return!1;if(this.length!==e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!==e[t])return!1;return!0})}Bifrost.namespace("Bifrost",{dispatcher:Bifrost.Singleton(function(){this.schedule=function(e,t){setTimeout(t,e)}})}),Bifrost.namespace("Bifrost",{documentService:Bifrost.Singleton(function(e){var t=this;this.DOMRoot=e,this.pageHasViewModel=function(e){var t=ko.contextFor($("body")[0]);return!Bifrost.isUndefined(t)&&t.$data===e},this.getViewModelNameFor=function(e){var t=e.attributes.getNamedItem("data-viewmodel-name");return Bifrost.isNullOrUndefined(t)&&(t=document.createAttribute("data-viewmodel-name"),t.value=Bifrost.Guid.create()),e.attributes.setNamedItem(t),t.value},this.setViewModelParametersOn=function(e,t){e.viewModelParameters=t},this.getViewModelParametersFrom=function(e){return e.viewModelParameters},this.hasViewModelParameters=function(e){return!Bifrost.isNullOrUndefined(e.viewModelParameters)},this.cleanChildrenOf=function(e){t.traverseObjects(function(t){t!==e&&($(t).unbind(),ko.cleanNode(t))},e)},this.hasViewFile=function(e){var t=e.attributes["data-view-file"];return!Bifrost.isNullOrUndefined(t)},this.getViewFileFrom=function(e){if(t.hasViewFile(e)){var n=e.attributes["data-view-file"];return n.value}return null},this.hasOwnRegion=function(e){return!!e.region},this.getParentRegionFor=function(e){for(var t=null;e.parentNode;)if(e=e.parentNode,e.region)return e.region;return t},this.getRegionFor=function(e){var n=null;return e.region?e.region:n=t.getParentRegionFor(e)},this.setRegionOn=function(e,t){e.region=t},this.clearRegionOn=function(e){e.region=null},this.traverseObjects=function(e,n){if(n=n||t.DOMRoot,!Bifrost.isNullOrUndefined(n)&&(e(n),n.hasChildNodes()))for(var i=n.firstChild;i;){var r=i.nextSibling;1===i.nodeType&&t.traverseObjects(e,i),i=r}},this.getUniqueStyleName=function(e){var t=Bifrost.Guid.create(),n=e+"_"+t;return n},this.addStyle=function(e,t){if(document.styleSheets){var n,i="";for(var r in t)i=i+r+":"+t[r]+";";if(t=i,0!==document.getElementsByTagName("head").length){var o,s,a;if(document.styleSheets.length>0)for(n=0;n<document.styleSheets.length&&(document.styleSheets[n].disabled||(s=document.styleSheets[n].media,a=typeof s,"string"===a?""!==s&&s.indexOf("screen")===-1||(o=document.styleSheets[n]):"object"===a&&(""!==s.mediaText&&s.mediaText.indexOf("screen")===-1||(o=document.styleSheets[n])),"undefined"==typeof o));n++);if("undefined"==typeof o){var f=document.createElement("style");for(f.type="text/css",document.getElementsByTagName("head")[0].appendChild(f),n=0;n<document.styleSheets.length;n++)document.styleSheets[n].disabled||(o=document.styleSheets[n]);s=o.media,a=typeof s}if("string"===a){for(n=0;n<o.rules.length;n++)if(o.rules[n].selectorText&&o.rules[n].selectorText.toLowerCase()===e.toLowerCase())return void(o.rules[n].style.cssText=t);o.addRule(e,t)}else if("object"===a){for(n=0;n<o.cssRules.length;n++)if(o.cssRules[n].selectorText&&o.cssRules[n].selectorText.toLowerCase()===e.toLowerCase())return void(o.cssRules[n].style.cssText=t);o.insertRule(e+"{"+t+"}",0)}}}}})}),Bifrost.namespace("Bifrost",{Event:Bifrost.Type.extend(function(){var e=[];this.subscribe=function(t){e.push(t)},this.trigger=function(t){e.forEach(function(e){e(t)})}})}),ko.extenders.linked=function(e,t){function n(t){if(ko.isObservable(t)){var n=t.subscribe(function(){e.valueHasMutated()});e._previousLinkedSubscription=n}}e.subscribe(function(t){e._previousLinkedSubscription&&e._previousLinkedSubscription.dispose(),n(t)});var i=e();n(i)},Bifrost.namespace("Bifrost",{systemEvents:Bifrost.Singleton(function(){this.readModels=Bifrost.read.readModelSystemEvents.create(),this.commands=Bifrost.commands.commandEvents.create()})}),Bifrost.WellKnownTypesDependencyResolver.types.systemEvents=Bifrost.systemEvents,Bifrost.namespace("Bifrost",{taskFactory:Bifrost.Singleton(function(){this.createHttpPost=function(e,t){var n=Bifrost.tasks.HttpPostTask.create({url:e,payload:t});return n},this.createHttpGet=function(e,t){var n=Bifrost.tasks.HttpGetTask.create({url:e,payload:t});return n},this.createQuery=function(e,t){var n=Bifrost.read.QueryTask.create({query:e,paging:t});return n},this.createReadModel=function(e,t){var n=Bifrost.read.ReadModelTask.create({readModelOf:e,propertyFilters:t});return n},this.createHandleCommand=function(e){var t=Bifrost.commands.HandleCommandTask.create({command:e});return t},this.createHandleCommands=function(e){var t=Bifrost.commands.HandleCommandsTask.create({commands:e});return t},this.createViewLoad=function(e){var t=Bifrost.views.ViewLoadTask.create({files:e});return t},this.createViewModelLoad=function(e){var t=Bifrost.views.ViewModelLoadTask.create({files:e});return t},this.createFileLoad=function(e){var t=Bifrost.tasks.FileLoadTask.create({files:e});return t}})}),Bifrost.namespace("Bifrost",{TimeSpan:function(e,t,n,i,r){var o="1.2",s=1e3,a=6e4,f=36e5,u=864e5,c=0,l=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};l(r)&&(c+=r*u),l(i)&&(c+=i*f),l(n)&&(c+=n*a),l(t)&&(c+=t*s),l(e)&&(c+=e),this.addMilliseconds=function(e){l(e)&&(c+=e)},this.addSeconds=function(e){l(e)&&(c+=e*s)},this.addMinutes=function(e){l(e)&&(c+=e*a)},this.addHours=function(e){l(e)&&(c+=e*f)},this.addDays=function(e){l(e)&&(c+=e*u)},this.subtractMilliseconds=function(e){l(e)&&(c-=e)},this.subtractSeconds=function(e){l(e)&&(c-=e*s)},this.subtractMinutes=function(e){l(e)&&(c-=e*a)},this.subtractHours=function(e){l(e)&&(c-=e*f)},this.subtractDays=function(e){l(e)&&(c-=e*u)},this.isTimeSpan=!0,this.add=function(e){e.isTimeSpan&&(c+=e.totalMilliseconds())},this.subtract=function(e){e.isTimeSpan&&(c-=e.totalMilliseconds())},this.equals=function(e){if(e.isTimeSpan)return c===e.totalMilliseconds()},this.totalMilliseconds=function(e){var t=c;return e===!0&&(t=Math.floor(t)),t},this.totalSeconds=function(e){var t=c/s;return e===!0&&(t=Math.floor(t)),t},this.totalMinutes=function(e){var t=c/a;return e===!0&&(t=Math.floor(t)),t},this.totalHours=function(e){var t=c/f;return e===!0&&(t=Math.floor(t)),t},this.totalDays=function(e){var t=c/u;return e===!0&&(t=Math.floor(t)),t},this.milliseconds=function(){return c%1e3},this.seconds=function(){return Math.floor(c/s)%60},this.minutes=function(){return Math.floor(c/a)%60},this.hours=function(){return Math.floor(c/f)%24},this.days=function(){return Math.floor(c/u)},this.getVersion=function(){return o}}}),Bifrost.TimeSpan.zero=function(){return new Bifrost.TimeSpan(0,0,0,0,0)},Bifrost.TimeSpan.fromMilliseconds=function(e){return new Bifrost.TimeSpan(e,0,0,0,0)},Bifrost.TimeSpan.fromSeconds=function(e){return new Bifrost.TimeSpan(0,e,0,0,0)},Bifrost.TimeSpan.fromMinutes=function(e){return new Bifrost.TimeSpan(0,0,e,0,0)},Bifrost.TimeSpan.fromHours=function(e){return new Bifrost.TimeSpan(0,0,0,e,0)},Bifrost.TimeSpan.fromDays=function(e){return new Bifrost.TimeSpan(0,0,0,0,e)},Bifrost.TimeSpan.fromDates=function(e,t,n){var i=t.valueOf()-e.valueOf();return n===!0&&(i=Math.abs(i)),new Bifrost.TimeSpan(i,0,0,0,0)},"undefined"!=typeof ko&&(ko.bindingHandlers.command={init:function(e,t,n,i){var r,o=t(),s=!1;if("undefined"==typeof o.canExecute){r=o.target,r.parameters=r.parameters||{};var a=o.parameters||{};for(var f in a){var u=a[f];r.parameters.hasOwnProperty(f)&&ko.isObservable(r.parameters[f])?r.parameters[f](u):r.parameters[f]=ko.observable(u)}s=!0}else r=o;ko.applyBindingsToNode(e,{click:function(){r.execute()}},i)}}),Bifrost.namespace("Bifrost.commands",{Command:Bifrost.Type.extend(function(e,t,n,i,r,o){var s=this,a=ko.observableArray();this.region=o,this._name="",this._generatedFrom="",this.targetCommand=this,this.validators=ko.observableArray(),this.validationMessages=ko.observableArray(),this.securityContext=ko.observable(null),this.populatedFromExternalSource=ko.observable(!1),this.isBusy=ko.observable(!1),this.isValid=ko.computed(function(){var e=!0;return s.validators().some(function(t){if(ko.isObservable(t.isValid)&&t.isValid()===!1)return e=!1,!0}),!(s.validationMessages().length>0)&&e}),this.isAuthorized=ko.observable(!1),this.canExecute=ko.computed(function(){return s.isValid()&&s.isAuthorized()}),this.isPopulatedExternally=ko.observable(!1),this.isReady=ko.computed(function(){return s.isPopulatedExternally()===!1||s.populatedFromExternalSource()}),this.isReadyToExecute=ko.computed(function(){return s.isPopulatedExternally()===!1||s.hasChanges()}),this.hasChanges=ko.computed(function(){var e=!1;return a().some(function(t){if(t()===!0)return e=!0,!0}),e}),this.failedCallbacks=[],this.succeededCallbacks=[],this.completedCallbacks=[],this.commandCoordinator=e,this.commandValidationService=t,this.commandSecurityService=n,this.options={beforeExecute:function(){},failed:function(){},succeeded:function(){},completed:function(){},properties:{}},this.failed=function(e){return s.failedCallbacks.push(e),s},this.succeeded=function(e){return s.succeededCallbacks.push(e),s},this.completed=function(e){return s.completedCallbacks.push(e),s},this.setOptions=function(e){Bifrost.extend(s.options,e),"undefined"!=typeof e.name&&"string"==typeof e.name&&(s._name=e.name)},this.copyPropertiesFromOptions=function(){for(var e in s.targetCommand.options.properties){var t=s.targetCommand.options.properties[e];ko.isObservable(t)||(t=ko.observable(t)),s.targetCommand[e]=t}},this.getProperties=function(){var e=[];for(var t in s.targetCommand)s.targetCommand.hasOwnProperty(t)&&!s.hasOwnProperty(t)&&e.push(t);return e},this.makePropertiesObservable=function(){var e=s.getProperties();e.forEach(function(e){var t=null,n=s.targetCommand[e];ko.isObservable(n)||"object"==typeof n&&!Bifrost.isArray(n)||"function"!=typeof n&&(t=Bifrost.isArray(n)?ko.observableArray(n):ko.observable(n),s.targetCommand[e]=t)})},this.extendPropertiesWithHasChanges=function(){var e=s.getProperties();e.forEach(function(e){var t=s.targetCommand[e];ko.isObservable(t)&&(t.extend({hasChanges:{}}),Bifrost.isNullOrUndefined(t.hasChanges)||a.push(t.hasChanges))})},this.onBeforeExecute=function(){s.options.beforeExecute()},this.onFailed=function(e){s.options.failed(e),s.failedCallbacks.forEach(function(t){t(e)})},this.setInitialValuesForProperties=function(e){e.forEach(function(e){var t=s.targetCommand[e];if(ko.isObservable(t)&&ko.isWriteableObservable(t)&&Bifrost.isFunction(t.setInitialValue)){var n=t();t.setInitialValue(n)}})},this.setInitialValuesFromCurrentValues=function(){var e=s.getProperties();s.setInitialValuesForProperties(e)},this.onSucceeded=function(e){s.options.succeeded(e),s.setInitialValuesFromCurrentValues(),s.succeededCallbacks.forEach(function(t){t(e)})},this.onCompleted=function(e){s.options.completed(e),s.completedCallbacks.forEach(function(t){t(e)})},this.handleCommandResult=function(e){s.isBusy(!1),"undefined"!=typeof e.commandValidationMessages&&s.validationMessages(e.commandValidationMessages),e.success===!1||e.invalid===!0?(e.invalid&&"undefined"!=typeof e.validationResults&&s.commandValidationService.applyValidationResultToProperties(s.targetCommand,e.validationResults),s.onFailed(e)):s.onSucceeded(e),s.onCompleted(e)},this.getCommandResultFromValidationResult=function(e){var t=Bifrost.commands.CommandResult.create();return t.invalid=!0,t},this.execute=function(){s.isBusy(!0);try{s.onBeforeExecute();var e=s.commandValidationService.validate(this);if(e.valid===!0)s.commandCoordinator.handle(s.targetCommand).continueWith(function(e){s.handleCommandResult(e)});else{var t=s.getCommandResultFromValidationResult(e);s.handleCommandResult(t)}}catch(e){s.isBusy(!1)}},this.populatedExternally=function(){s.isPopulatedExternally(!0)},this.populateFromExternalSource=function(e){s.isPopulatedExternally(!0),s.setPropertyValuesFrom(e),s.populatedFromExternalSource(!0),t.clearValidationMessagesFor(s.targetCommand)},this.setPropertyValuesFrom=function(e){var t=i.mapToInstance(s.targetCommand._type,e,s.targetCommand);s.setInitialValuesForProperties(t)},this.onCreated=function(e){if(s.targetCommand=e,"undefined"!=typeof r&&(this.setOptions(r),this.copyPropertiesFromOptions()),this.makePropertiesObservable(),this.extendPropertiesWithHasChanges(),"undefined"!=typeof e._name&&""!==e._name){t.extendPropertiesWithoutValidation(e);var i=t.getValidatorsFor(e);Bifrost.isArray(i)&&i.length>0&&s.validators(i),t.validateSilently(this)}n.getContextFor(e).continueWith(function(t){e.securityContext(t),ko.isObservable(t.isAuthorized)&&(e.isAuthorized(t.isAuthorized()),t.isAuthorized.subscribe(function(t){e.isAuthorized(t)}))})}})}),Bifrost.namespace("Bifrost.commands",{commandCoordinator:Bifrost.Singleton(function(e){this.handle=function(t){var n=Bifrost.execution.Promise.create(),i=e.createHandleCommand(t);return t.region.tasks.execute(i).continueWith(function(e){n.signal(e)}),n},this.handleMany=function(t,n){var i=Bifrost.execution.Promise.create();try{var r=e.createHandleCommands(t);n.tasks.execute(r).continueWith(function(e){t.forEach(function(t,n){var i=e[n];null==i||Bifrost.isUndefined(i)||t.handleCommandResult(i),t.isBusy(!1)}),i.signal(e)})}catch(e){t.forEach(function(e){e.isBusy(!1)})}return i}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandCoordinator=Bifrost.commands.commandCoordinator,Bifrost.dependencyResolvers.command={canResolve:function(e,t){return"undefined"!=typeof commands&&t in commands},resolve:function(e,t){return commands[t].create()}},Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandDescriptor=function(e){function t(e,t){return!e.hasOwnProperty(t)||(!!i.hasOwnProperty(t)||!ko.isObservable(e[t])&&("function"==typeof e[t]||("_type"===t||"_namespace"===t)))}function n(e){var n={};for(var i in e)t(e,i)||(n[i]=e[i]);return n}var i={};"undefined"!=typeof Bifrost.commands.Command&&(i=Bifrost.commands.Command.create({region:{commands:[]},commandCoordinator:{},commandValidationService:{},commandSecurityService:{getContextFor:function(){return{continueWith:function(){}}}},mapper:{},options:{}})),this.name=e._name,this.generatedFrom=e._generatedFrom,this.id=Bifrost.Guid.create();var r=n(e),o=ko.toJS(r);o.Id=Bifrost.Guid.create(),this.command=ko.toJSON(o)},Bifrost.commands.CommandDescriptor.createFrom=function(e){var t=new Bifrost.commands.CommandDescriptor(e);return t},Bifrost.namespace("Bifrost.commands",{commandEvents:Bifrost.Singleton(function(){this.succeeded=Bifrost.Event.create(),this.failed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandResult=function(){function e(e){var t=this;this.isEmpty=function(){return t.commandId===Bifrost.Guid.empty},this.commandName="",this.commandId=Bifrost.Guid.empty,this.validationResults=[],this.success=!0,this.invalid=!1,this.passedSecurity=!0,this.exception=void 0,this.exceptionMessage="",this.commandValidationMessages=[],this.securityMessages=[],this.allValidationMessages=[],this.details="","undefined"!=typeof e&&Bifrost.extend(this,e)}return{create:function(){var t=new e;return t},createFrom:function(t){var n="string"==typeof t?JSON.parse(t):t,i=new e(n);return i}}}(),Bifrost.namespace("Bifrost.commands",{CommandSecurityContext:Bifrost.Type.extend(function(){this.isAuthorized=ko.observable(!1)})}),Bifrost.namespace("Bifrost.commands",{commandSecurityContextFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.commands.CommandSecurityContext.create();return e}})}),Bifrost.namespace("Bifrost.commands",{commandSecurityService:Bifrost.Singleton(function(e){function t(e){return e._type._name}function n(e){var t=e+"SecurityContext";return t}function i(e,t){var i=n(e);return!Bifrost.isNullOrUndefined(i)&&!Bifrost.isNullOrUndefined(t)&&t.hasOwnProperty(i)}function r(e,t){var i=n(e,t);return t[i]}var o=this;this.commandSecurityContextFactory=e,this.getContextFor=function(e){var n,s=Bifrost.execution.Promise.create(),a=t(e);if(i(a,e._type._namespace)){var f=r(a,e._type._namespace);n=f.create(),s.signal(n)}else if(n=o.commandSecurityContextFactory.create(),Bifrost.isNullOrUndefined(e._generatedFrom)||""===e._generatedFrom)s.signal(n);else{var u="/Bifrost/CommandSecurity/GetForCommand?commandName="+e._generatedFrom;$.getJSON(u,function(e){n.isAuthorized(e.isAuthorized),s.signal(n)})}return s},this.getContextForType=function(e){var t,n=Bifrost.execution.Promise.create();if(i(e._name,e._namespace)){var o=r(e._name,e._namespace);t=o.create(),n.signal(t)}else t=Bifrost.commands.CommandSecurityContext.create(),t.isAuthorized(!0),n.signal(t);return n}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandSecurityService=Bifrost.commands.commandSecurityService,Bifrost.namespace("Bifrost.commands",{commandValidationService:Bifrost.Singleton(function(){function e(e,t){return"region"===t||(e instanceof HTMLElement||(!e.hasOwnProperty(t)||!ko.isObservable(e[t])&&("function"==typeof e[t]||("_type"===t||("_dependencies"===t||("_namespace"===t||(null==e[t]||"undefined"!=typeof e[t].prototype&&null!==e[t].prototype&&e[t]instanceof Bifrost.Type)))))))}function t(n,i){for(var r in n)e(n,r)||"undefined"==typeof n[r].validator&&(ko.isObservable(n[r])?(n[r].extend({validation:{}}),n[r].validator.propertyName=r):"object"==typeof n[r]&&t(n[r],i))}function n(t,i,r){for(var o in t)if(!e(t,o))if("undefined"!=typeof t[o].validator){var s=ko.utils.unwrapObservable(t[o]());r===!0?t[o].validator.validateSilently(s):t[o].validator.validate(s),t[o].validator.isValid()===!1&&(i.valid=!1)}else"object"==typeof t[o]&&n(t[o],i,r)}function i(e,t,n){function i(e){s=e.toCamelCase(),s in a&&"object"==typeof a[s]&&(a=a[s])}for(var r=0;r<t.length;r++){var o=t[r].split("."),s=null,a=e;if(o.forEach(i),null!=s&&s.length){var f=a[s];"undefined"!=typeof f.validator&&(f.validator.isValid(!1),f.validator.message(n))}}}function r(t,n){for(var i in t){var o=t[i];e(t,i)||(ko.isObservable(o)&&"undefined"!=typeof o.validator?n.push(o.validator):Bifrost.isObject(o)&&r(o,n))}}this.applyValidationResultToProperties=function(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.errorMessage,s=r.memberNames;s.length>0&&i(e,s,o)}},this.validate=function(e){var t={valid:!0};return n(e,t),t},this.validateSilently=function(e){var t={valid:!0};return n(e,t,!0),t},this.clearValidationMessagesFor=function(t){for(var n in t)e(t,n)||Bifrost.isNullOrUndefined(t[n].validator)||t[n].validator.message("")},this.extendPropertiesWithoutValidation=function(e){t(e)},this.getValidatorsFor=function(e){var t=[];return r(e,t),t}})}),Bifrost.namespace("Bifrost.commands",{HandleCommandsTask:Bifrost.tasks.ExecutionTask.extend(function(e,t){var n=this;this.names=[],e.forEach(function(e){n.names.push(e.name)}),this.execute=function(){var n=Bifrost.execution.Promise.create(),i=[];e.forEach(function(e){e.isBusy(!0);var t=Bifrost.commands.CommandDescriptor.createFrom(e);i.push(t)});var r={commandDescriptors:i},o="/Bifrost/CommandCoordinator/HandleMany";return t.post(o,r).continueWith(function(e){var t=[];e.forEach(function(e){var n=Bifrost.commands.CommandResult.createFrom(e);t.push(n)}),n.signal(t)}),n}})}),Bifrost.namespace("Bifrost.commands",{HandleCommandTask:Bifrost.tasks.ExecutionTask.extend(function(e,t,n){this.name=e.name,this.execute=function(){var i=Bifrost.execution.Promise.create(),r=Bifrost.commands.CommandDescriptor.createFrom(e),o={commandDescriptor:r},s="/Bifrost/CommandCoordinator/Handle?_cmd="+e._generatedFrom;return t.post(s,o).continueWith(function(e){var t=Bifrost.commands.CommandResult.createFrom(e);t.success===!0?n.commands.succeeded.trigger(e):n.commands.failed.trigger(e),i.signal(t)}).onFail(function(e){var t=Bifrost.commands.CommandResult.create();t.exception="HTTP 500",t.exceptionMessage=e.statusText,t.details=e.responseText,n.commands.failed.trigger(t),i.signal(t)}),i}})}),ko.extenders.hasChanges=function(e){function t(){if(e._initialValueSet===!1)e.hasChanges(!1);else{if(Bifrost.isArray(e._initialValue))return void e.hasChanges(!e._initialValue.shallowEquals(e()));e.hasChanges(e._initialValue!==e())}}e._initialValueSet=!1,e.hasChanges=ko.observable(!1),e.subscribe(function(){t()}),e.setInitialValue=function(n){var i;i=Bifrost.isArray(n)?n.clone():n,e._initialValue=i,e._initialValueSet=!0,t()}},Bifrost.namespace("Bifrost.execution",{Promise:function(){function e(){null!=t.callback&&"undefined"!=typeof t.callback&&("undefined"!=typeof t.signalParameter?t.callback(t.signalParameter,Bifrost.execution.Promise.create()):t.callback(Bifrost.execution.Promise.create()))}var t=this;this.id=Bifrost.Guid.create(),this.signalled=!1,this.callback=null,this.error=null,this.hasFailed=!1,this.failedCallback=null,this.fail=function(e){null!=t.failedCallback&&t.failedCallback(e),t.hasFailed=!0,t.error=e},this.onFail=function(e){return t.hasFailed?e(t.error):t.failedCallback=e,t},this.signal=function(n){t.signalled=!0,t.signalParameter=n,e()},this.continueWith=function(n){return this.callback=n,t.signalled===!0&&e(),t}}}),Bifrost.execution.Promise.create=function(){var e=new Bifrost.execution.Promise;return e},Array.prototype.insert=function(e,t){this.splice(e,0,t)},function(){polyfillForEach(),polyFillClone(),shallowEquals()}(),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},HTMLCollection.prototype.forEach=Array.prototype.forEach,HTMLCollection.prototype.length=Array.prototype.length,HTMLElement.prototype.knownElementTypes=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","col","colgroup","content","code","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marque","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],HTMLElement.prototype.isKnownType=function(){if(!Bifrost.isNullOrUndefined("HTMLUnknownElement"))return this.constructor.toString().indexOf("HTMLUnknownElement")<0;var e=this.constructor!==HTMLElement;if(e===!1){var t=this.tagName.toLowerCase();e=this.knownElementTypes.some(function(e){if(t===e)return!0})}return e},HTMLElement.prototype.getChildElements=function(){var e=[];return this.childNodes.forEach(function(t){1===t.nodeType&&e.push(t)}),e},NodeList.prototype.forEach=Array.prototype.forEach,NodeList.prototype.length=Array.prototype.length,"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return e.length>0&&this.substring(0,e.length)===e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return e.length>0&&this.substring(this.length-e.length,this.length)===e}),String.prototype.replaceAll=function(e,t){var n=this.split(e).join(t);return n},String.prototype.toCamelCase=function(){var e=this.charAt(0).toLowerCase()+this.substring(1);return e=e.replaceAll("-","")},String.prototype.toPascalCase=function(){var e=this.charAt(0).toUpperCase()+this.substring(1);return e=e.replaceAll("-","")},String.prototype.hashCode=function(){var e,t=0;if(0===this.length)return t;for(var n=0;n<this.length;n++)e=this.charCodeAt(n),t=(t<<5)-t+e,t&=t;return t},Bifrost.namespace("Bifrost.hubs",{Hub:Bifrost.Type.extend(function(e){function t(e){return function(){e.apply(i,arguments)}}function n(e,t,n){return function(){for(var i=[],o=0;o<n.length;o++)i.push(n[o]);var s=[t].concat(i);r.invoke.apply(r,s).done(function(t){e.signal(t)})}}var i=this,r=null;this._name="",this.client=function(e){var n={};e(n);for(var i in n){var o=n[i];Bifrost.isFunction(o)&&r.on(i,t(o))}},this.server={};var o=[];e.connected.subscribe(function(){o.forEach(function(e){e()})}),this.invokeServerMethod=function(t,i){var r=Bifrost.execution.Promise.create(),s=n(r,t,i);return e.isConnected===!1?o.push(s):s(),r},this.onCreated=function(t){r=e.createProxy(t._name)}})}),Bifrost.namespace("Bifrost.hubs",{hubConnection:Bifrost.Singleton(function(){var e=this,t=$.hubConnection("/signalr",{useDefaultPath:!1});$.signalR.hub=t,this.isConnected=!1,this.connected=Bifrost.Event.create(),this.createProxy=function(e){var n=t.createHubProxy(e);return n},$.connection.hub.start().done(function(){console.log("Hub connection up and running"),e.isConnected=!0,e.connected.trigger()})})}),Bifrost.WellKnownTypesDependencyResolver.types.hubConnection=Bifrost.hubs.hubConnection,Bifrost.dependencyResolvers.hub={canResolve:function(e,t){return"undefined"!=typeof hubs&&t in hubs},resolve:function(e,t){return hubs[t].create()}},Bifrost.namespace("Bifrost.interaction",{Action:Bifrost.Type.extend(function(){this.perform=function(){}})}),Bifrost.namespace("Bifrost.interaction",{CommandOperation:Bifrost.interaction.Operation.extend(function(e){var t=this;this.commandType=ko.observable(),this.isAuthorized=ko.observable(!1),this.commandCreated=Bifrost.Event.create(),this.canPerform.when(this.isAuthorized),this.commandType.subscribe(function(n){e.getContextForType(n).continueWith(function(e){Bifrost.isNullOrUndefined(e)||t.isAuthorized(e.isAuthorized())})}),this.createCommandOfType=function(e){var n=e.create({region:t.region});return t.commandCreated.trigger(n),n}})}),Bifrost.namespace("Bifrost.interaction",{EventTrigger:Bifrost.interaction.Trigger.extend(function(){function e(e){if(!e.eventName)throw"EventName is not set for trigger"}var t=this;this.eventName=null,this.initialize=function(n){e(this);var i="on"+t.eventName;if(null==n[i]||"function"==typeof n[i]){var r=n[i];n[i]=function(e){r&&r(e),t.signal()}}}})}),Bifrost.namespace("Bifrost.interaction",{Operation:Bifrost.Type.extend(function(e,t){var n=this,i=ko.observableArray(),r=ko.observable(!0);this.context=t,this.identifier=Bifrost.Guid.empty,this.region=e,this.canPerform=ko.computed({read:function(){if(0===i().length)return!0;var e=!0;return i().forEach(function(t){if(t()===!1)return void(e=!1)}),e},write:function(e){r(e)}}),this.canPerform.when=function(e){return i.push(e),n.canPerform},this.canPerform.when(r),this.perform=function(){return{}},this.undo=function(e){}})}),Bifrost.namespace("Bifrost.interaction",{OperationContext:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.interaction",{OperationEntry:Bifrost.Type.extend(function(e,t){this.operation=e,this.state=t})}),Bifrost.namespace("Bifrost.interaction",{operationEntryFactory:Bifrost.Singleton(function(){this.create=function(e,t){var n=Bifrost.interaction.OperationEntry.create({operation:e,state:t});return n}})}),Bifrost.namespace("Bifrost.interaction",{Operations:Bifrost.Type.extend(function(e){var t=this;this.all=ko.observableArray(),this.stateful=ko.computed(function(){var e=[];return t.all().forEach(function(t){Bifrost.areEqual(t.state,{})||e.push(t)}),e}),this.getByIdentifier=function(e){var n=null;return t.all().forEach(function(t){if(t.identifier===e)return void(n=t)}),n},this.perform=function(n){if(n.canPerform()===!0){var i=n.perform(),r=e.create(n,i);t.all.push(r)}},this.undo=function(){throw"Not implemented"}})}),Bifrost.namespace("Bifrost.interaction",{operationsFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.interaction.Operations.create();return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.operationsFactory=Bifrost.interaction.operationsFactory,Bifrost.namespace("Bifrost.interaction",{Trigger:Bifrost.Type.extend(function(){var e=this;this.actions=[],this.addAction=function(t){e.actions.push(t)},this.initialize=function(e){},this.signal=function(){e.actions.forEach(function(e){e.perform()})}})}),Bifrost.namespace("Bifrost.interaction",{VisualState:Bifrost.Type.extend(function(){var e=this;this.name="",this.actions=ko.observableArray(),this.addAction=function(t){e.actions.push(t)},this.enter=function(t,n){e.actions().forEach(function(e){e.onEnter(t,n)})},this.exit=function(t,n){e.actions().forEach(function(e){e.onExit(t,n)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateAction:Bifrost.Type.extend(function(){this.initialize=function(e){},this.onEnter=function(e,t){},this.onExit=function(e,t){}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateGroup:Bifrost.Type.extend(function(e){var t=this;this.defaultDuration=Bifrost.TimeSpan.zero(),this.currentState=ko.observable({name:"null state",enter:function(){},exit:function(){}}),this.states=ko.observableArray(),this.transitions=ko.observableArray(),this.addState=function(e){if(t.hasState(e.name))throw"VisualState with name of '"+e.name+"' already exists";t.states.push(e)},this.addTransition=function(e){t.transitions.push(e)},this.hasState=function(e){var n=!1;return t.states().forEach(function(t){if(t.name===e)return void(n=!0)}),n},this.getStateByName=function(e){var n=null;return t.states().forEach(function(t){if(t.name===e)return void(n=t)}),n},this.goTo=function(n,i){var r=t.currentState();if(Bifrost.isNullOrUndefined(r)||r.name!==i){var o=t.getStateByName(i);if(!Bifrost.isNullOrUndefined(o)){var s=t.defaultDuration;Bifrost.isNullOrUndefined(r)||r.exit(n,s),o.enter(n,s),e.schedule(s.totalMilliseconds(),function(){t.currentState(o)})}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManager:Bifrost.Type.extend(function(){var e=this;this.namingRoot=null,this.groups=ko.observableArray(),this.addGroup=function(t){e.groups.push(t)},this.goTo=function(t){e.groups().forEach(function(n){n.hasState(t)===!0&&n.goTo(e.namingRoot,t)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManagerElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){function e(e,t,i){function r(t){if(t._name.toLowerCase()===o.localName){for(var n=t.create(),r=0;r<o.attributes.length;r++){var s=o.attributes[r].localName,a=o.attributes[r].value;n.hasOwnProperty(s)&&(n[s]=a)}n.initialize(e),i.addAction(n)}}if(t.hasChildNodes())for(var o=t.firstChild;o;)n.forEach(r),o=o.nextSibling}function t(t,n,i){if(n.hasChildNodes())for(var r=n.firstChild;r;){if("visualstate"===r.localName){var o=Bifrost.interaction.VisualState.create();o.name=r.getAttribute("name"),i.addState(o),e(t,r,o)}r=r.nextSibling}}var n=Bifrost.interaction.VisualStateAction.getExtenders();this.visit=function(e,n){if("visualstatemanager"===e.localName){var i=Bifrost.interaction.VisualStateManager.create(),r=e.parentElement.namingRoot;if(e.parentElement.visualStateManager=i,e.hasChildNodes())for(var o=e.firstChild;o;){if("visualstategroup"===o.localName){var s=Bifrost.interaction.VisualStateGroup.create();i.addGroup(s);var a=o.getAttribute("duration");if(!Bifrost.isNullOrUndefined(a)&&(a=parseFloat(a),!isNaN(a))){a=1e3*a;var f=Bifrost.TimeSpan.fromMilliseconds(a);s.defaultDuration=f}t(r,o,s)}o=o.nextSibling}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateTransition:Bifrost.Type.extend(function(){this.from="",this.to="",this.duration=Bifrost.TimeStamp.zero()})}),Bifrost.namespace("Bifrost.io",{
File:Bifrost.Type.extend(function(e){this.type=Bifrost.io.fileType.unknown,this.path=Bifrost.Path.create({fullPath:e})})}),Bifrost.namespace("Bifrost.io",{fileFactory:Bifrost.Singleton(function(){this.create=function(e,t){var n=Bifrost.io.File.create({path:e});return Bifrost.isNullOrUndefined(t)||(n.fileType=t),n}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileFactory=Bifrost.io.fileFactory,Bifrost.namespace("Bifrost.io",{fileManager:Bifrost.Singleton(function(){function e(e){var n=t.origin;return 0!==e.indexOf("/")&&(n+="/"),n+=e}var t=this,n=Bifrost.Uri.create(window.location.href);if("file:"===window.location.protocol)this.origin=window.location.href,this.origin=this.origin.substr(0,this.origin.lastIndexOf("/")),this.origin.lastIndexOf("/")===this.origin.length-1&&(this.origin=this.origin.substr(0,this.origin.length-1));else{var i=n.port||"";Bifrost.isUndefined(i)||""===i||80===i||(i=":"+i),this.origin=n.scheme+"://"+n.host+i}this.load=function(t){var n=[],i=Bifrost.execution.Promise.create();return t.forEach(function(t){var i=e(t.path.fullPath);t.fileType===Bifrost.io.fileType.html&&(i="text!"+i+"!strip",t.path.hasExtension()||(i="noext!"+i)),n.push(i)}),require(n,function(){i.signal(arguments)}),i}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileManager=Bifrost.io.fileManager,Bifrost.namespace("Bifrost.io",{fileType:{unknown:0,text:1,javaScript:2,html:3}});var requirejs,require,define;!function(){function J(e){return"[object Function]"===M.call(e)}function E(e){return"[object Array]"===M.call(e)}function Z(e,t,n){for(var i in t)i in K||i in e&&!n||(e[i]=t[i]);return d}function N(e,t,n){return e=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),n&&(e.originalError=n),e}function $(e,t,n){var i,r,o;for(i=0;o=t[i];i++)o="string"==typeof o?{name:o}:o,r=o.location,n&&(!r||0!==r.indexOf("/")&&r.indexOf(":")===-1)&&(r=n+"/"+(r||o.name)),e[o.name]={name:o.name,location:r||o.name,main:(o.main||"main").replace(ea,"").replace(aa,"")}}function U(e,t){e.holdReady?e.holdReady(t):t?e.readyWait+=1:e.ready(!0)}function fa(e){function t(e,t){var n,i;if(e&&"."===e.charAt(0))if(t){y.pkgs[t]?t=[t]:(t=t.split("/"),t=t.slice(0,t.length-1)),n=e=t.concat(e.split("/"));var r;for(i=0;r=n[i];i++)if("."===r)n.splice(i,1),i-=1;else if(".."===r){if(1===i&&(".."===n[2]||".."===n[0]))break;i>0&&(n.splice(i-1,2),i-=2)}i=y.pkgs[n=e[0]],e=e.join("/"),i&&e===n+"/"+i.main&&(e=n)}else 0===e.indexOf("./")&&(e=e.substring(2));return e}function n(e,n){var i,r,o=e?e.indexOf("!"):-1,s=null,a=n?n.name:null,f=e;return o!==-1&&(s=e.substring(0,o),e=e.substring(o+1,e.length)),s&&(s=t(s,a)),e&&(s?i=(o=F[s])&&o.normalize?o.normalize(e,function(e){return t(e,a)}):t(e,a):(i=t(e,a),r=x[i],r||(r=g.nameToUrl(i,null,n),x[i]=r))),{prefix:s,name:i,parentMap:n,url:r,originalName:f,fullName:s?s+"!"+(i||""):i}}function i(){var e,t,n=!0,i=y.priorityWait;if(i){for(t=0;e=i[t];t++)if(!S[e]){n=!1;break}n&&delete y.priorityWait}return n}function r(e,t,n){return function(){var i,r=ga.call(arguments,0);return n&&J(i=r[r.length-1])&&(i.__requireJsBuild=!0),r.push(t),e.apply(null,r)}}function o(e,t){var n=r(g.require,e,t);return Z(n,{nameToUrl:r(g.nameToUrl,e),toUrl:r(g.toUrl,e),defined:r(g.requireDefined,e),specified:r(g.requireSpecified,e),isBrowser:d.isBrowser}),n}function s(e){var t,i,r,o=e.callback,s=e.map,a=s.fullName,f=e.deps;if(r=e.listeners,o&&J(o)){if(y.catchError.define)try{i=d.execCb(a,e.callback,f,F[a])}catch(e){t=e}else i=d.execCb(a,e.callback,f,F[a]);a&&((o=e.cjsModule)&&void 0!==o.exports&&o.exports!==F[a]?i=F[a]=e.cjsModule.exports:void 0===i&&e.usingExports?i=F[a]:(F[a]=i,A[a]&&(_[a]=!0)))}else a&&(i=F[a]=o,A[a]&&(_[a]=!0));if(k[e.id]&&(delete k[e.id],e.isDone=!0,g.waitCount-=1,0===g.waitCount&&(M=[])),delete P[a],d.onResourceLoad&&!e.placeholder&&d.onResourceLoad(g,s,e.depArray),t)return i=(a?n(a).url:"")||t.fileName||t.sourceURL,r=t.moduleTree,t=N("defineerror",'Error evaluating module "'+a+'" at location "'+i+'":\n'+t+"\nfileName:"+i+"\nlineNumber: "+(t.lineNumber||t.line),t),t.moduleName=a,t.moduleTree=r,d.onError(t);for(t=0;o=r[t];t++)o(i)}function a(e,t){return function(n){e.depDone[t]||(e.depDone[t]=!0,e.deps[t]=n,e.depCount-=1,e.depCount||s(e))}}function f(e,t){var n,i=t.map,r=i.fullName,a=i.name,f=R[e]||(R[e]=F[e]);t.loading||(t.loading=!0,n=function(e){t.callback=function(){return e},s(t),S[t.id]=!0,B()},n.fromText=function(e,t){var n=O;S[e]=!1,g.scriptCount+=1,g.fake[e]=!0,n&&(O=!1),d.exec(t),n&&(O=!0),g.completeLoad(e)},r in F?n(F[r]):f.load(a,o(i.parentMap,!0),n,y))}function u(e){k[e.id]||(k[e.id]=e,M.push(e),g.waitCount+=1)}function c(e){this.listeners.push(e)}function l(e,t){var i,r,o=e.fullName,a=e.prefix,f=a?R[a]||(R[a]=F[a]):null;return o&&(i=P[o]),i||(r=!0,i={id:(a&&!f?C++ +"__p@:":"")+(o||"__r@"+C++),map:e,depCount:0,depDone:[],depCallbacks:[],deps:[],listeners:[],add:c},w[i.id]=!0,!o||a&&!R[a])||(P[o]=i),a&&!f?(o=l(n(a),!0),o.add(function(){var t=n(e.originalName,e.parentMap),t=l(t,!0);i.placeholder=!0,t.add(function(e){i.callback=function(){return e},s(i)})})):r&&t&&(S[i.id]=!1,g.paused.push(i),u(i)),i}function p(e,t,i,r){var f,e=n(e,r),c=e.name,d=e.fullName,p=l(e),h=p.id,m=p.deps;if(d){if(d in F||S[h]===!0||"jquery"===d&&y.jQuery&&y.jQuery!==i().fn.jquery)return;w[h]=!0,S[h]=!0,"jquery"===d&&i&&V(i())}for(p.depArray=t,p.callback=i,i=0;i<t.length;i++)(h=t[i])&&(h=n(h,c?e:r),f=h.fullName,t[i]=f,"require"===f?m[i]=o(e):"exports"===f?(m[i]=F[d]={},p.usingExports=!0):"module"===f?p.cjsModule=m[i]={id:c,uri:c?g.nameToUrl(c,null,r):void 0,exports:F[d]}:!(f in F)||f in k||d in A&&!(d in A&&_[f])?(d in A&&(A[f]=!0,delete F[f],E[h.url]=!1),p.depCount+=1,p.depCallbacks[i]=a(p,i),l(h,!0).add(p.depCallbacks[i])):m[i]=F[f]);p.depCount?u(p):s(p)}function h(e){p.apply(null,e)}function m(e,t){if(!e.isDone){var i,r,o,s,a=e.map.fullName,f=e.depArray;if(a){if(t[a])return F[a];t[a]=!0}if(f)for(i=0;i<f.length;i++)(r=f[i])&&((o=n(r).prefix)&&(s=k[o])&&m(s,t),(o=k[r])&&!o.isDone&&S[r]&&(r=m(o,t),e.depCallbacks[i](r)));return a?F[a]:void 0}}function v(){var e,t=1e3*y.waitSeconds,n=t&&g.startTime+t<(new Date).getTime(),t="",r=!1,o=!1;if(!(g.pausedCount>0)){if(y.priorityWait){if(!i())return;B()}for(e in S)if(!(e in K||(r=!0,S[e]))){if(!n){o=!0;break}t+=e+" "}if(r||g.waitCount){if(n&&t)return e=N("timeout","Load timeout for modules: "+t),e.requireType="timeout",e.requireModules=t,d.onError(e);if(o||g.scriptCount)!G&&!ca||W||(W=setTimeout(function(){W=0,v()},50));else{if(g.waitCount){for(H=0;t=M[H];H++)m(t,{});g.paused.length&&B(),X<5&&(X+=1,v())}X=0,d.checkReadyState()}}}}var g,B,y={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},catchError:{}},b=[],w={require:!0,exports:!0,module:!0},x={},F={},S={},k={},M=[],E={},C=0,P={},R={},A={},_={},D=0;return V=function(e){g.jQuery||!(e=e||("undefined"!=typeof jQuery?jQuery:null))||y.jQuery&&e.fn.jquery!==y.jQuery||!("holdReady"in e||"readyWait"in e)||(g.jQuery=e,h(["jquery",[],function(){return jQuery}]),g.scriptCount&&(U(e,!0),g.jQueryIncremented=!0))},B=function(){var e,t,n,r,o,s;for(D+=1,g.scriptCount<=0&&(g.scriptCount=0);b.length;){if(e=b.shift(),null===e[0])return d.onError(N("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));h(e)}if(!y.priorityWait||i())for(;g.paused.length;){for(o=g.paused,g.pausedCount+=o.length,g.paused=[],r=0;e=o[r];r++)t=e.map,n=t.url,s=t.fullName,t.prefix?f(t.prefix,e):!E[n]&&!S[s]&&(d.load(g,s,n),0!==n.indexOf("empty:")&&(E[n]=!0));g.startTime=(new Date).getTime(),g.pausedCount-=o.length}1===D&&v(),D-=1},g={contextName:e,config:y,defQueue:b,waiting:k,waitCount:0,specified:w,loaded:S,urlMap:x,urlFetched:E,scriptCount:0,defined:F,paused:[],pausedCount:0,plugins:R,needFullExec:A,fake:{},fullExec:_,managerCallbacks:P,makeModuleMap:n,normalize:t,configure:function(e){var t,n,i;if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),t=y.paths,i=y.pkgs,Z(y,e,!0),e.paths){for(n in e.paths)n in K||(t[n]=e.paths[n]);y.paths=t}if((t=e.packagePaths)||e.packages){if(t)for(n in t)n in K||$(i,t[n],n);e.packages&&$(i,e.packages),y.pkgs=i}e.priority&&(n=g.requireWait,g.requireWait=!1,g.takeGlobalQueue(),B(),g.require(e.priority),B(),g.requireWait=n,y.priorityWait=e.priority),(e.deps||e.callback)&&g.require(e.deps||[],e.callback)},requireDefined:function(e,t){return n(e,t).fullName in F},requireSpecified:function(e,t){return n(e,t).fullName in w},require:function(t,i,r){if("string"==typeof t)return J(i)?d.onError(N("requireargs","Invalid require call")):d.get?d.get(g,t,i):(i=n(t,i),t=i.fullName,t in F?F[t]:d.onError(N("notloaded","Module name '"+i.fullName+"' has not been loaded yet for context: "+e)));if((t&&t.length||i)&&p(null,t,i,r),!g.requireWait)for(;!g.scriptCount&&g.paused.length;)g.takeGlobalQueue(),B();return g.require},takeGlobalQueue:function(){T.length&&(ha.apply(g.defQueue,[g.defQueue.length-1,0].concat(T)),T=[])},completeLoad:function(e){var t;for(g.takeGlobalQueue();b.length;){if(t=b.shift(),null===t[0]){t[0]=e;break}if(t[0]===e)break;h(t),t=null}h(t?t:[e,[],"jquery"===e&&"undefined"!=typeof jQuery?function(){return jQuery}:null]),d.isAsync&&(g.scriptCount-=1),B(),d.isAsync||(g.scriptCount-=1)},toUrl:function(e,t){var n=e.lastIndexOf("."),i=null;return n!==-1&&(i=e.substring(n,e.length),e=e.substring(0,n)),g.nameToUrl(e,i,t)},nameToUrl:function(e,n,i){var r,o,s,a,f=g.config,e=t(e,i&&i.fullName);if(d.jsExtRegExp.test(e))n=e+(n?n:"");else{for(r=f.paths,o=f.pkgs,i=e.split("/"),a=i.length;a>0;a--){if(s=i.slice(0,a).join("/"),r[s]){i.splice(0,a,r[s]);break}if(s=o[s]){e=e===s.name?s.location+"/"+s.main:s.location,i.splice(0,a,e);break}}n=i.join("/")+(n||".js"),n=("/"===n.charAt(0)||n.match(/^\w+:/)?"":f.baseUrl)+n}return f.urlArgs?n+((n.indexOf("?")===-1?"?":"&")+f.urlArgs):n}},g.jQueryCheck=V,g.resume=B,g}function ia(){var e,t,i;if(n&&"interactive"===n.readyState)return n;for(e=document.getElementsByTagName("script"),t=e.length-1;t>-1&&(i=e[t]);t--)if("interactive"===i.readyState)return n=i;return null}var ja=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,ka=/require\(\s*["']([^'"\s]+)["']\s*\)/g,ea=/^\.\//,aa=/\.js$/,M=Object.prototype.toString,r=Array.prototype,ga=r.slice,ha=r.splice,G=!("undefined"==typeof window||!navigator||!document),ca=!G&&"undefined"!=typeof importScripts,la=G&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,da="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),K={},D={},T=[],n=null,X=0,O=!1,d,r={},I,v,t,x,u,y,z,H,A,V,W;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(J(requirejs))return;r=requirejs,requirejs=void 0}if("undefined"!=typeof require&&!J(require)&&(r=require,require=void 0),d=requirejs=function(e,t,n){var i,r="_";return!E(e)&&"string"!=typeof e&&(i=e,E(t)?(e=t,t=n):e=[]),i&&i.context&&(r=i.context),n=D[r]||(D[r]=fa(r)),i&&n.configure(i),n.require(e,t)},d.config=function(e){return d(e)},require||(require=d),d.toUrl=function(e){return D._.toUrl(e)},d.version="1.0.3",d.jsExtRegExp=/^\/|:|\?|\.js$/,v=d.s={contexts:D,skipAsync:{}},(d.isAsync=d.isBrowser=G)&&(t=v.head=document.getElementsByTagName("head")[0],(x=document.getElementsByTagName("base")[0])&&(t=v.head=x.parentNode)),d.onError=function(e){throw e},d.load=function(e,t,n){d.resourcesReady(!1),e.scriptCount+=1,d.attach(n,e,t),e.jQuery&&!e.jQueryIncremented&&(U(e.jQuery,!0),e.jQueryIncremented=!0)},define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),E(t)||(n=t,t=[]),!t.length&&J(n)&&n.length&&(n.toString().replace(ja,"").replace(ka,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t)),O&&(i=I||ia())&&(e||(e=i.getAttribute("data-requiremodule")),r=D[i.getAttribute("data-requirecontext")]),(r?r.defQueue:T).push([e,t,n])},define.amd={multiversion:!0,plugins:!0,jQuery:!0},d.exec=function(a){return eval(a)},d.execCb=function(e,t,n,i){return t.apply(i,n)},d.addScriptToDom=function(e){I=e,x?t.insertBefore(e,x):t.appendChild(e),I=null},d.onScriptLoad=function(e){var t,i=e.currentTarget||e.srcElement;("load"===e.type||i&&la.test(i.readyState))&&(n=null,e=i.getAttribute("data-requirecontext"),t=i.getAttribute("data-requiremodule"),D[e].completeLoad(t),i.detachEvent&&!da?i.detachEvent("onreadystatechange",d.onScriptLoad):i.removeEventListener("load",d.onScriptLoad,!1))},d.attach=function(e,t,n,i,r,o){var s;return G?(i=i||d.onScriptLoad,s=t&&t.config&&t.config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),s.type=r||"text/javascript",s.charset="utf-8",s.async=!v.skipAsync[e],t&&s.setAttribute("data-requirecontext",t.contextName),s.setAttribute("data-requiremodule",n),s.attachEvent&&!da?(O=!0,o?s.onreadystatechange=function(){"loaded"===s.readyState&&(s.onreadystatechange=null,s.attachEvent("onreadystatechange",i),o(s))}:s.attachEvent("onreadystatechange",i)):s.addEventListener("load",i,!1),s.src=e,o||d.addScriptToDom(s),s):(ca&&(importScripts(e),t.completeLoad(n)),null)},G)for(u=document.getElementsByTagName("script"),H=u.length-1;H>-1&&(y=u[H]);H--)if(t||(t=y.parentNode),z=y.getAttribute("data-main")){r.baseUrl||(u=z.split("/"),y=u.pop(),u=u.length?u.join("/")+"/":"./",r.baseUrl=u,z=y.replace(aa,"")),r.deps=r.deps?r.deps.concat(z):[z];break}d.checkReadyState=function(){var e,t=v.contexts;for(e in t)if(!(e in K)&&t[e].waitCount)return;d.resourcesReady(!0)},d.resourcesReady=function(e){var t,n;if(d.resourcesDone=e,d.resourcesDone)for(n in e=v.contexts)n in K||(t=e[n],!t.jQueryIncremented)||(U(t.jQuery,!1),t.jQueryIncremented=!1)},d.pageLoaded=function(){"complete"!==document.readyState&&(document.readyState="complete")},G&&document.addEventListener&&!document.readyState&&(document.readyState="loading",window.addEventListener("load",d.pageLoaded,!1)),d(r),d.isAsync&&"undefined"!=typeof setTimeout&&(A=v.contexts[r.context||"_"],A.requireWait=!0,setTimeout(function(){A.requireWait=!1,A.takeGlobalQueue(),A.scriptCount||A.resume(),d.checkReadyState()},0))}}(),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i="undefined"!=typeof location&&location.href,r=i&&location.protocol&&location.protocol.replace(/\:/,""),o=i&&location.hostname,s=i&&(location.port||void 0),a=[];define(function(){var f,u,c;return"undefined"!=typeof window&&window.navigator&&window.document?u=function(e,t){var n=f.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)},n.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(c=require.nodeRequire("fs"),u=function(e,t){t(c.readFileSync(e,"utf8"))}):"undefined"!=typeof Packages&&(u=function(e,t){var n,i,r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),s="";try{for(n=new java.lang.StringBuffer,(i=r.readLine())&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=r.readLine());)n.append(o),n.append(i);s=String(n.toString())}finally{r.close()}t(s)}),f={version:"1.0.2",strip:function(e){if(e){var e=e.replace(t,""),i=e.match(n);i&&(e=i[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(n=0;n<3;n++){i=e[n];try{t=new ActiveXObject(i)}catch(e){}if(t){e=[i];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:u,parseName:function(e){var t=!1,n=e.indexOf("."),i=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t="strip"===t,e=e.substring(0,n)),{moduleName:i,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,i){var r,o=f.xdRegExp.exec(e);return!o||(e=o[2],o=o[3],o=o.split(":"),r=o[1],o=o[0],!(e&&e!==t||o&&o!==n||(r||o)&&r!==i))},finishLoad:function(e,t,n,i,r){n=t?f.strip(n):n,r.isBuild&&(a[e]=n),i(n)},load:function(e,t,n,a){if(a.isBuild&&!a.inlineText)n();else{var u=f.parseName(e),c=u.moduleName+"."+u.ext,l=t.toUrl(c),d=a&&a.text&&a.text.useXhr||f.useXhr;!i||d(l,r,o,s)?f.get(l,function(t){f.finishLoad(e,u.strip,t,n,a)}):t([c],function(e){f.finishLoad(u.moduleName+"."+u.ext,u.strip,e,n,a)})}},write:function(e,t,n){if(t in a){var i=f.jsEscape(a[t]);n.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,n,i,r){var t=f.parseName(t),o=t.moduleName+"."+t.ext,s=n.toUrl(t.moduleName+"."+t.ext)+".js";f.load(o,n,function(){var t=function(e){return i(s,e)};t.asModule=function(e,t){return i.asModule(e,s,t)},f.write(e,o,t,r)},r)}}})}(),Bifrost.namespace("Bifrost.mapping",{Map:Bifrost.Type.extend(function(){var e=this,t={};this.sourceType=null,this.targetType=null,this.source=function(t){e.sourceType=t},this.target=function(t){e.targetType=t},this.property=function(e){var n=Bifrost.mapping.PropertyMap.create({sourceProperty:e});return t[e]=n,n},this.canMapProperty=function(e){return t.hasOwnProperty(e)},this.mapProperty=function(n,i,r){e.canMapProperty(n)&&t[n].map(i,r)}})}),Bifrost.namespace("Bifrost.mapping",{mapper:Bifrost.Type.extend(function(typeConverters,maps){"use strict";function getTypeAsString(e,t,n,i){var r=null;return Bifrost.isNullOrUndefined(n)||Bifrost.isNullOrUndefined(i)||n.constructor!==i.constructor&&(r=i.constructor.toString().match(/function\040+(\w*)/)[1]),Bifrost.isNullOrUndefined(e[t])||Bifrost.isNullOrUndefined(e[t]._typeAsString)||(r=e[t]._typeAsString),r}function copyProperties(e,t,n,i){for(var r in t)if(0!==r.indexOf("_")&&!Bifrost.isUndefined(t[r]))if(Bifrost.isObject(t[r])&&Bifrost.isObject(n[r]))copyProperties(e,t[r],n[r]);else{if(!Bifrost.isNullOrUndefined(i)&&i.canMapProperty(r)){i.mapProperty(r,t,n),e.indexOf(r)<0&&e.push(r);continue}if(!Bifrost.isUndefined(n[r])){var o=ko.unwrap(t[r]),s=ko.unwrap(n[r]),a=getTypeAsString(n,r,o,s);if(Bifrost.isNullOrUndefined(a)||Bifrost.isNullOrUndefined(o)||(o=typeConverters.convertFrom(o.toString(),a)),e.indexOf(r)<0&&e.push(r),ko.isObservable(n[r])){if(!ko.isWriteableObservable(n[r]))continue;n[r](o)}else n[r]=o}}}function mapSingleInstance(type,data,mappedProperties){data&&(Bifrost.isNullOrUndefined(data._sourceType)||(type=eval(data._sourceType)));var instance=type.create();if(data){var map=null;maps.hasMapFor(data._type,type)&&(map=maps.getMapFor(data._type,type)),copyProperties(mappedProperties,data,instance,map)}return instance}function mapMultipleInstances(e,t,n){for(var i=[],r=0;r<t.length;r++){var o=t[r];i.push(mapSingleInstance(e,o,n))}return i}var self=this;this.map=function(e,t){var n=[];return Bifrost.isArray(t)?mapMultipleInstances(e,t,n):mapSingleInstance(e,t,n)},this.mapToInstance=function(e,t,n){var i=[],r=null;return maps.hasMapFor(t._type,e)&&(r=maps.getMapFor(t._type,e)),copyProperties(i,t,n,r),i}})}),Bifrost.WellKnownTypesDependencyResolver.types.mapper=Bifrost.mapping.mapper,Bifrost.namespace("Bifrost.mapping",{maps:Bifrost.Singleton(function(){function e(e,t){return e._typeId+" - "+t._typeId}var t=this,n={},i=Bifrost.mapping.Map.getExtenders();i.forEach(function(t){var i=t.create(),r=e(i.sourceType,i.targetType);n[r]=i}),this.hasMapFor=function(t,i){if(Bifrost.isNullOrUndefined(t)||Bifrost.isNullOrUndefined(i))return!1;var r=e(t,i);return n.hasOwnProperty(r)},this.getMapFor=function(i,r){if(t.hasMapFor(i,r)){var o=e(i,r);return n[o]}}})}),Bifrost.namespace("Bifrost.mapping",{MissingPropertyStrategy:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.mapping",{PropertyMap:Bifrost.Type.extend(function(e,t){function n(){if(Bifrost.isNullOrUndefined(i.strategy))throw Bifrost.mapping.MissingPropertyStrategy.create()}var i=this;this.strategy=null,this.to=function(n){i.strategy=function(i,r){var o=ko.unwrap(i[e]),s=ko.unwrap(r[n]),a=null;Bifrost.isNullOrUndefined(o)||(Bifrost.isNullOrUndefined(s)||(o.constructor!==s.constructor&&(a=s.constructor.name.toString()),Bifrost.isNullOrUndefined(r[n]._typeAsString)||(a=r[n]._typeAsString)),Bifrost.isNullOrUndefined(a)||(o=t.convertFrom(o.toString(),a))),ko.isObservable(r[n])?r[n](o):r[n]=o}},this.map=function(e,t){n(),i.strategy(e,t)}})}),Bifrost.namespace("Bifrost.markup",{AttachedProperty:Bifrost.values.ValueConsumer.extend(function(){this.canNotifyChanges=function(){return!1},this.notifyChanges=function(e){},this.consume=function(e){}})}),Bifrost.namespace("Bifrost.markup",{attributeValues:Bifrost.Singleton(function(e){this.expandFor=function(e){}})}),Bifrost.namespace("Bifrost.markup",{BindingContext:Bifrost.Type.extend(function(){this.parent=null,this.current=null,this.changed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.markup",{bindingContextManager:Bifrost.Singleton(function(){this.ensure=function(e){},this.hasFor=function(e){},this.getFor=function(e){}})}),Bifrost.WellKnownTypesDependencyResolver.types.bindingContextManager=Bifrost.markup.bindingContextManager,Bifrost.namespace("Bifrost.markup",{Control:Bifrost.markup.UIElement.extend(function(){var e=this;this.template=null,this.prepare=function(t,n){var i=Bifrost.execution.Promise.create(),r=t._namespace._path+t._name+".html";return require(["text!"+r+"!strip"],function(t){var n=document.createElement("div");n.innerHTML=t,e.template=n,i.signal()}),i}})}),Bifrost.namespace("Bifrost.markup",{elementNaming:Bifrost.Singleton(function(){function e(e){var t,n=e.localName.toLowerCase(),i=n.split(":");if(i.length>2)throw Bifrost.markup.MultipleNamespacesInNameNotAllowed.create({tagName:n});return 2===i.length&&(n=i[1],t=i[0]),{name:n,namespace:t}}this.getNamespacePrefixFor=function(t){var n=e(t);return Bifrost.isNullOrUndefined(n.namespace)?"":n.namespace},this.getLocalNameFor=function(t){var n=e(t);return n.name}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitor:Bifrost.Type.extend(function(){this.visit=function(e,t){}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitorResultActions:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.markup",{MultipleNamespacesInNameNotAllowed:Bifrost.Type.extend(function(e){})}),Bifrost.namespace("Bifrost.markup",{MultiplePropertyReferencesNotAllowed:Bifrost.Type.extend(function(e){})}),Bifrost.namespace("Bifrost.markup",{NamespaceDefinition:Bifrost.Type.extend(function(e){var t=this;this.prefix=e,this.targets=[],this.addTarget=function(e){t.targets.push(e)}})}),Bifrost.namespace("Bifrost.markup",{namespaceDefinitions:Bifrost.Singleton(function(){this.create=function(e){var t=Bifrost.markup.NamespaceDefinition.create({prefix:e});return t}})}),Bifrost.namespace("Bifrost.markup",{namespaces:Bifrost.Singleton(function(e,t){function n(e,t){if(!Bifrost.isNullOrUndefined(t.__namespaces)){var i=null;if(t.__namespaces.forEach(function(t){if(t.prefix===e)return i=t,!1}),null!=i)return i}if(Bifrost.isNullOrUndefined(t.parentElement)||t.parentElement.constructor===HTMLHtmlElement)return null;var r=n(e,t.parentElement);return null!=r?r:null}var i=this,r="ns:";this.global=e.create("__global"),this.expandNamespaceDefinitions=function(t){for(var i=0;i<t.attributes.length;i++){var o=t.attributes[i];if(0===o.name.indexOf(r)){var s=o.name.substr(r.length),a=o.value,f=n(s,t);Bifrost.isNullOrUndefined(f)&&(Bifrost.isNullOrUndefined(t.__namespaces)&&(t.__namespaces=[]),f=e.create(s),t.__namespaces.push(f)),f.addTarget(a)}}},this.resolveFor=function(e){var r=t.getNamespacePrefixFor(e);if(Bifrost.isNullOrUndefined(r)||""===r)return i.global;var o=n(r,e);return o}})}),Bifrost.namespace("Bifrost.markup",{NamingRoot:Bifrost.Type.extend(function(){var e=this;this.target=null,this.find=function(t,n){if(Bifrost.isNullOrUndefined(n)){if(Bifrost.isNullOrUndefined(e.target))return null;n=e.target}if(n.getAttribute("name")===t)return n;if(n.hasChildNodes())for(var i=n.firstChild;i;){if(1===i.nodeType){var r=e.find(t,i);if(null!=r)return r}i=i.nextSibling}return null}})}),Bifrost.namespace("Bifrost.markup",{ObjectModelElementVisitor:Bifrost.markup.ElementVisitor.extend(function(e,t,n,i,r,o,s){this.visit=function(a,f){if(t.expandNamespaceDefinitions(a),s.ensure(a),a.isKnownType())return void o.expandFor(a);var u=e.getLocalNameFor(a),c=t.resolveFor(a);n.createFrom(a,u,c,function(e){i.expand(a,e),r.prepare(a,e)},function(){})}})}),Bifrost.namespace("Bifrost.markup",{objectModelFactory:Bifrost.Singleton(function(e,t){function n(t,i,r,o){function s(s){if(s.length){var a=Bifrost.namespace(i.shift()),f=!1;a._scripts.forEach(function(s){s.toLowerCase()===t.toLowerCase()&&(e.beginResolve(a,s).continueWith(function(e){r(e)}).onFail(function(){n(t,i,r,o)}),f=!0)}),f||n(t,i,r,o)}else o()}s(i)}this.createFrom=function(e,t,i,r,o){n(t,i.targets,r,o)}})}),Bifrost.namespace("Bifrost.markup",{ParentTagNameMismatched:Bifrost.Type.extend(function(e,t){})}),Bifrost.namespace("Bifrost.markup",{propertyExpander:Bifrost.Singleton(function(e){this.expand=function(t,n){for(var i=0;i<t.attributes.length;i++){var r=t.attributes[i].localName,o=t.attributes[i].value;r in n&&e.hasValueProvider(o)&&e.parseFor(n,r,o)}}})}),Bifrost.namespace("Bifrost.markup",{UIElement:Bifrost.markup.NamingRoot.extend(function(){this.prepare=function(e,t){}})}),Bifrost.namespace("Bifrost.markup",{UIElementPreparer:Bifrost.Singleton(function(){this.prepare=function(e,t){var n=t.prepare(t._type,e);n instanceof Bifrost.execution.Promise&&n.continueWith(function(){if(!Bifrost.isNullOrUndefined(t.template)){var n=Bifrost.views.UIManager.create();n.handle(t.template),ko.applyBindingsToNode(t.template,{with:t}),e.parentElement.replaceChild(t.template,e)}})}})}),Bifrost.namespace("Bifrost.markup",{valueProviderParser:Bifrost.Singleton(function(e,t,n){function i(e,n,i){var o=t.getFor(e,n);if(r.hasValueProvider(i)){var s=r.parseFor(e,n,i);s.forEach(function(e){e.provide(o)})}else o.consume(i)}var r=this,o=new RegExp("{{([a-z ,:{{}}}]*)}}","g");this.hasValueProvider=function(e){var t=e.match(o);return!!t},this.parseFor=function(t,n,r){var s=[],a=r.match(o),f=a[0].substr(2,a[0].length-4),u=new RegExp("([a-z]*) +","g");if(a=f.match(u),1===a.length){var c=a[0].trim();if(e.isKnown(c)){var l=e.getInstanceOf(c);if(s.push(l),f.length>a[0].length){var d=f.substr(a[0].length),p=d.split(",");p.forEach(function(e){e=e.trim();var t=e.split(":");if(0===t.length,1===t.length){var n=t[0];i(l,l.defaultProperty,n)}else 2===t.length&&i(l,t[0],t[1])})}}}return s}})}),Bifrost.namespace("Bifrost.navigation",{DataNavigationFrameAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(e){this.visit=function(e,t){var n=e.attributes.getNamedItem("data-navigation-frame");if(!Bifrost.isNullOrUndefined(n)){var i="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):i=r.value+", ",r.value=i+"navigation: '"+n.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-navigation-frame")}}})}),"undefined"!=typeof ko&&"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&(ko.bindingHandlers.navigateTo={init:function(e,t,n,i){ko.applyBindingsToNode(e,{click:function(){var n=t()();History.pushState({feature:n},$(e).attr("title"),"/"+n)}},i)}}),Bifrost.namespace("Bifrost.navigation",{navigationBindingHandler:Bifrost.Type.extend(function(){function e(e){for(var t=ko.utils.unwrapObservable(e()),n=ko.expressionRewriting.parseObjectLiteral(t),i={},r=0;r<n.length;r++){var o=n[r];i[o.key.trim()]=o.value.trim()}var s=i.uriMapper;Bifrost.isNullOrUndefined(s)&&(s="default");var a=Bifrost.uriMappers[s],f=Bifrost.navigation.NavigationFrame.create({locationAware:!1,uriMapper:a,home:i.home||""});return f}function t(e){return function(){return e.currentUri()}}this.init=function(n,i,r,o,s){var a=e(i);return a.configureFor(n),ko.bindingHandlers.view.init(n,t(a),r,o,s)},this.update=function(n,i,r,o,s){var a=e(i);return a.configureFor(n),ko.bindingHandlers.view.update(n,t(a),r,o,s)}})}),Bifrost.navigation.navigationBindingHandler.initialize=function(){ko.bindingHandlers.navigation=Bifrost.navigation.navigationBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.navigation=!1,ko.virtualElements.allowedBindings.navigation=!0},Bifrost.namespace("Bifrost.navigation",{NavigationFrame:Bifrost.Type.extend(function(e,t,n){var i=this;this.home=e,this.history=n,this.container=null,this.currentUri=ko.observable(e),this.uriMapper=t||null,this.setCurrentUri=function(e){0===e.indexOf("/")&&(e=e.substr(1)),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1)),null!=e&&0!==e.length||(e=i.home),null==i.uriMapper||i.uriMapper.hasMappingFor(e)||(e=i.home),i.currentUri(e)},this.setCurrentUriFromCurrentLocation=function(){var e=i.history.getState(),t=Bifrost.Uri.create(e.url);i.setCurrentUri(t.path)},n.Adapter.bind(window,"statechange",function(){i.setCurrentUriFromCurrentLocation()}),this.configureFor=function(e){i.setCurrentUriFromCurrentLocation(),i.container=e;var t=$(e).closest("[data-urimapper]");if(1===t.length){var n=$(t[0]).data("urimapper");n in Bifrost.uriMappers&&(i.uriMapper=Bifrost.uriMappers[n])}null==i.uriMapper&&(i.uriMapper=Bifrost.uriMappers.default)},this.navigate=function(e){i.setCurrentUri(e)}})}),Bifrost.namespace("Bifrost.navigation",{navigateTo:function(e,t){var n=e;"/"!==e.charAt(0)&&(n="/"+n),t&&(n+=t),"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&History.pushState({},"",n)},navigationManager:{getCurrentLocation:function(){var e=Bifrost.Uri.create(window.location.toString());return e},hookup:function(){"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&$("body").click(function(e){var t=e.target.href;if("undefined"==typeof t){var n=$(e.target).closest("a")[0];if(!n)return;t=n.href}t.indexOf("#!")>0&&(t=t.substr(0,t.indexOf("#!"))),0===t.length&&(t="/");var i=Bifrost.Uri.create(t);if(i.isSameAsOrigin&&i.queryString.indexOf("postback")<0){for(var r=i.path;0===r.indexOf("/");)r=r.substr(1);e.preventDefault();var o=$(e.target).closest("[data-navigation-target]");if(1===o.length){var s=$(o[0]).data("navigation-target"),a=$("#"+s);1===a.length&&"undefined"!=typeof a[0].navigationFrame&&a[0].navigationFrame.navigate(i.path)}else{var f=i.queryString.length>0?"?"+i.queryString:"";History.pushState({},"","/"+r+f)}}})}}}),Bifrost.namespace("Bifrost.navigation",{observableQueryParameterFactory:Bifrost.Singleton(function(){var e="undefined"!=typeof History&&"undefined"!=typeof History.Adapter;this.create=function(t,n,i){function r(){var e=i.getCurrentLocation();return e.parameters.hasOwnProperty(t)?e.parameters[t]:null}function o(e,n){var i=Bifrost.hashString.decode(e);i[t]=n;var r="",o=0;for(var s in i){var a=i[s];Bifrost.isNullOrUndefined(a)||(o>0&&(r+="&"),r+=s+"="+a),o++}return r}function s(e){return 0!==e.indexOf("#")&&0!==e.indexOf("?")||(e=e.substr(1)),e}var a=null;e?History.Adapter.bind(window,"statechange",function(){null!=a&&a(r())}):window.addEventListener("hashchange",function(){if(null!=a){var e=r();a()!==e&&a(e)}},!1);var f=r();return a=ko.observable(f||n),a.subscribe(function(n){var i;if(e){var r=History.getState();r[t]=n,i="?"+o(s(r.url),n),History.pushState(r,r.title,i)}else i="#"+o(s(document.location.hash),n),document.location.hash=i}),a}})}),ko.observableQueryParameter=function(e,t){var n=Bifrost.navigation.navigationManager,i=Bifrost.navigation.observableQueryParameterFactory.create().create(e,t,n);return i},Bifrost.namespace("Bifrost.messaging",{Messenger:Bifrost.Type.extend(function(){var e=[];return this.publish=function(t,n){e.hasOwnProperty(t)&&e[t].subscribers.forEach(function(e){e(n)})},this.subscribeTo=function(t,n){var i;e.hasOwnProperty(t)?i=e[t]:(i={subscribers:[]},e[t]=i),i.subscribers.push(n)},{publish:this.publish,subscribeTo:this.subscribeTo}})}),Bifrost.messaging.Messenger.global=Bifrost.messaging.Messenger.create(),Bifrost.WellKnownTypesDependencyResolver.types.globalMessenger=Bifrost.messaging.Messenger.global,Bifrost.namespace("Bifrost.messaging",{messengerFactory:Bifrost.Singleton(function(){
this.create=function(){var e=Bifrost.messaging.Messenger.create();return e},this.global=function(){return Bifrost.messaging.Messenger.global}})}),Bifrost.WellKnownTypesDependencyResolver.types.messengerFactory=Bifrost.messaging.messengerFactory,"undefined"!=typeof ko&&(ko.observableMessage=function(e,t){var n=ko.observable(t),i=!1;return n.subscribe(function(t){i!==!0&&Bifrost.messaging.Messenger.global.publish(e,t)}),Bifrost.messaging.Messenger.global.subscribeTo(e,function(e){i=!0,n(e),i=!1}),n}),"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&!function(e){"use strict";if("Element"in e){var t="classList",n="prototype",i=e.Element[n],r=Object,o=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},f=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},u=function(e){for(var t=o.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],i=0,r=n.length;i<r;i++)this.push(n[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=u[n]=[],l=function(){return new u(this)};if(a[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",f(this,e)!==-1},c.add=function(){var e,t=arguments,n=0,i=t.length,r=!1;do e=t[n]+"",f(this,e)===-1&&(this.push(e),r=!0);while(++n<i);r&&this._updateClassName()},c.remove=function(){var e,t=arguments,n=0,i=t.length,r=!1;do{e=t[n]+"";var o=f(this,e);o!==-1&&(this.splice(o,1),r=!0)}while(++n<i);r&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),i=n?t!==!0&&"remove":t!==!1&&"add";return i&&this[i](e),!n},c.toString=function(){return this.join(" ")},r.defineProperty){var d={get:l,enumerable:!0,configurable:!0};try{r.defineProperty(i,t,d)}catch(e){e.number===-2146823252&&(d.enumerable=!1,r.defineProperty(i,t,d))}}else r[n].__defineGetter__&&i.__defineGetter__(t,l)}}(self),this.Element&&function(e,t){function n(){}n.prototype.length=Array.prototype.length,e.matchesSelector=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this.parentNode.querySelectorAll(e),n=-1;t[++n]&&t[n]!=this;);return!!t[n]},e.ancestorQuerySelectorAll=e.ancestorQuerySelectorAll||e.mozAncestorQuerySelectorAll||e.msAncestorQuerySelectorAll||e.oAncestorQuerySelectorAll||e.webkitAncestorQuerySelectorAll||function(e){for(var t=this,i=new n;t=t.parentElement;)t.matchesSelector(e)&&Array.prototype.push.call(i,t);return i},e.ancestorQuerySelector=e.ancestorQuerySelector||e.mozAncestorQuerySelector||e.msAncestorQuerySelector||e.oAncestorQuerySelector||e.webkitAncestorQuerySelector||function(e){return this.ancestorQuerySelectorAll(e)[0]||null}}(Element.prototype),Bifrost.namespace("Bifrost.read",{PagingInfo:Bifrost.Type.extend(function(e,t){this.size=e,this.number=t})}),Bifrost.namespace("Bifrost.read",{Query:Bifrost.Type.extend(function(e,t){var n=this;this.target=this,this._name="",this._generatedFrom="",this._readModel=null,this.region=t,this.areAllParametersSet=null,this.hasReadModel=function(){return"undefined"!=typeof n.target._readModel&&null!=n.target._readModel},this.setParameters=function(e){try{for(var t in e)n.target.hasOwnProperty(t)&&ko.isObservable(n.target[t])===!0&&n.target[t](e[t])}catch(e){}},this.getParameters=function(){var e={};for(var t in n.target)ko.isObservable(n.target[t])&&"areAllParametersSet"!==t&&(e[t]=n.target[t]);return e},this.getParameterValues=function(){var e,t={},i=n.getParameters();for(var r in i)e=i[r](),ko.isObservable(e)&&(e=e()),t[r]=e;return t},this.all=function(){var i=e.create(n.target,t);return i},this.paged=function(i,r){var o=e.create(n.target,t);return o.setPageInfo(i,r),o},this.onCreated=function(e){n.target=e;for(var t in n.target)ko.isObservable(n.target[t])===!0&&n.target[t].extend({linked:{}});n.areAllParametersSet=ko.computed(function(){var e=!0,t=!1;for(var i in n.target)if(ko.isObservable(n.target[i])===!0){t=!0;var r=ko.unwrap(n.target[i]());if("undefined"==typeof r||null===r){e=!1;break}}return t===!1||e})}})}),Bifrost.namespace("Bifrost.read",{Queryable:Bifrost.Type.extend(function(e,t,n,i){function r(e){for(var t in e){var n=e[t];ko.isObservable(n)===!0&&e.hasOwnProperty(t)&&"areAllParametersSet"!==t&&n.subscribe(o.execute)}}var o=this;this.canExecute=!0,this.target=i,this.query=e,this.queryService=t,this.pageSize=ko.observable(0),this.pageNumber=ko.observable(0),this.totalItems=ko.observable(0),this.completedCallbacks=[],this.pageSize.subscribe(function(){o.canExecute&&o.execute()}),this.pageNumber.subscribe(function(){o.canExecute&&o.execute()}),this.completed=function(e){return o.completedCallbacks.push(e),o},this.onCompleted=function(e){o.completedCallbacks.forEach(function(t){t(e)})},this.execute=function(){if(o.query.areAllParametersSet()!==!0)return o.target;o.query._previousAreAllParametersSet=!0;var t=Bifrost.read.PagingInfo.create({size:o.pageSize(),number:o.pageNumber()});return o.queryService.execute(e,t).continueWith(function(e){Bifrost.isNullOrUndefined(e)||(o.totalItems(e.totalItems),o.target(e.items),o.onCompleted(e.items))}),o.target},this.setPageInfo=function(e,t){e===o.pageSize()&&t===o.pageNumber()||(o.canExecute=!1,o.pageSize(e),o.pageNumber(t),o.canExecute=!0,o.execute())},r(o.query),o.query.areAllParametersSet()&&o.execute()})}),Bifrost.read.Queryable.new=function(e,t){var n=ko.observableArray();e.targetObservable=n,e.region=t;var i=Bifrost.read.Queryable.create(e);return Bifrost.extend(n,i),n.isQueryable=!0,n},Bifrost.namespace("Bifrost.read",{queryableFactory:Bifrost.Singleton(function(){this.create=function(e,t){var n=Bifrost.read.Queryable.new({query:e},t);return n}})}),Bifrost.WellKnownTypesDependencyResolver.types.queryableFactory=Bifrost.interaction.queryableFactory,Bifrost.dependencyResolvers.query={canResolve:function(e,t){return"undefined"!=typeof read&&t in read},resolve:function(e,t){return read[t].create()}},Bifrost.namespace("Bifrost.read",{queryService:Bifrost.Singleton(function(e,t){this.execute=function(n,i){var r=Bifrost.execution.Promise.create(),o=n.region,s=t.createQuery(n,i);return o.tasks.execute(s).continueWith(function(t){"undefined"!=typeof t&&null!=t||(t={}),"undefined"!=typeof t.items&&null!=t.items||(t.items=[]),"undefined"!=typeof t.totalItems&&null!=t.totalItems||(t.totalItems=0),n.hasReadModel()&&(t.items=e.map(n._readModel,t.items)),r.signal(t)}),r}})}),Bifrost.namespace("Bifrost.read",{QueryTask:Bifrost.tasks.LoadTask.extend(function(e,t,n){var i="/Bifrost/Query/Execute?_q="+e._generatedFrom,r={descriptor:{nameOfQuery:e._name,generatedFrom:e._generatedFrom,parameters:e.getParameterValues()},paging:{size:t.size,number:t.number}};this.query=e._name,this.paging=r.paging;var o=n.createHttpPost(i,r);this.execute=function(){var e=o.execute();return e}})}),Bifrost.namespace("Bifrost.read",{ReadModel:Bifrost.Type.extend(function(){var e=this;this.copyTo=function(t){for(var n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("_")){var i=ko.utils.unwrapObservable(e[n]);t.hasOwnProperty(n)?ko.isObservable(t[n])?t[n](i):t[n]=i:t[n]=ko.observable(i)}},this.onCreated=function(t){e=t}})}),Bifrost.namespace("Bifrost.read",{ReadModelOf:Bifrost.Type.extend(function(e,t,n,i){function r(e){var t={};for(var n in e)t[n]=ko.utils.unwrapObservable(e[n]);return t}function o(e,r){var o=n.createReadModel(e,r);e.region.tasks.execute(o).continueWith(function(n){if(Bifrost.isNullOrUndefined(n))i.noInstance.trigger(e);else{var r=t.map(e._readModelType,n);s.instance(r)}})}var s=this;this.target=null,this._name="",this._generatedFrom="",this._readModelType=Bifrost.Type.extend(function(){}),this.instance=ko.observable(),this.commandToPopulate=null,this.region=e,this.instanceMatching=function(e){function t(){var t=r(e);o(s.target,t)}t();for(var n in e){var i=e[n];ko.isObservable(i)&&i.subscribe(t)}},this.populateCommandOnChanges=function(e){e.populatedExternally(),"undefined"!=typeof s.instance()&&null!=s.instance()&&e.populateFromExternalSource(s.instance()),s.instance.subscribe(function(t){e.populateFromExternalSource(t)})},this.onCreated=function(e){s.target=e;var t=e._readModelType.create();s.instance(t)}})}),Bifrost.dependencyResolvers.readModelOf={canResolve:function(e,t){return"undefined"!=typeof read&&t in read},resolve:function(e,t){return read[t].create()}},Bifrost.namespace("Bifrost.read",{readModelService:Bifrost.Singleton(function(){})}),Bifrost.namespace("Bifrost.read",{readModelSystemEvents:Bifrost.Singleton(function(){this.noInstance=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.read",{ReadModelTask:Bifrost.tasks.LoadTask.extend(function(e,t,n){var i="/Bifrost/ReadModel/InstanceMatching?_rm="+e._generatedFrom,r={descriptor:{readModel:e._name,generatedFrom:e._generatedFrom,propertyFilters:t}};this.readModel=e._generatedFrom;var o=n.createHttpPost(i,r);this.execute=function(){var e=o.execute();return e}})}),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.Saga=function(){function e(){var e=this;this.executeCommands=function(t,n){var i=!0;t.forEach(function(e){if(e.onBeforeExecute()===!1)return i=!1,!1}),i!==!1&&Bifrost.commands.commandCoordinator.handleForSaga(e,t,n)}}return{create:function(t){var n=new e;return Bifrost.extend(n,t),n}}}(),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.sagaNarrator=function(){function e(e,t,n){$.ajax({url:e,type:"POST",dataType:"json",data:t,contentType:"application/json; charset=utf-8",complete:n})}function t(e,t){return 200===e.status&&t.success===!0}var n="/Bifrost/SagaNarrator";return{conclude:function(i,r,o){var s={sagaId:i.Id};e(n+"/Conclude",JSON.stringify(s),function(e){var n=Bifrost.commands.CommandResult.createFrom(e.responseText),s=t(e,n);s===!0&&"function"==typeof r&&r(i),s===!1&&"function"==typeof o&&o(i)})}}}(),Bifrost.namespace("Bifrost.services",{Service:Bifrost.Type.extend(function(){function e(e){var t={};for(var n in e)t[n]=JSON.stringify(e[n]);var i=JSON.stringify(t);return i}function t(t,i,r){$.ajax({url:n.url+"/"+t,type:"POST",dataType:"json",data:e(i),contentType:"application/json; charset=utf-8",complete:function(e){var t=$.parseJSON(e.responseText);r(t)}})}var n=this;this.url="",this.name="",this.callWithoutReturnValue=function(e,n){var i=Bifrost.execution.Promise.create();return t(e,n,function(e){i.signal()}),i},this.callWithObjectAsReturn=function(e,n){var i=ko.observable();return t(e,n,function(e){i(e)}),i},this.callWithArrayAsReturn=function(e,n){var i=ko.observableArray();return t(e,n,function(e){i(e)}),i},this.onCreated=function(e){n.url=e.url,0!==n.url.indexOf("/")&&(n.url="/"+n.url),n.name=e.name}})}),Bifrost.dependencyResolvers.service={canResolve:function(e,t){return"undefined"!=typeof services&&t in services},resolve:function(e,t){return services[t].create()}},Bifrost.namespace("Bifrost.specifications",{And:Bifrost.specifications.Specification.extend(function(e,t){this.isSatisfied=ko.computed(function(){return e.isSatisfied()&&t.isSatisfied()}),this.evaluate=function(n){e.evaluate(n),t.evaluate(n)}})}),Bifrost.namespace("Bifrost.specifications",{Or:Bifrost.specifications.Specification.extend(function(e,t){this.isSatisfied=ko.computed(function(){return e.isSatisfied()||t.isSatisfied()}),this.evaluate=function(n){e.evaluate(n),t.evaluate(n)}})}),Bifrost.namespace("Bifrost.specifications",{Specification:Bifrost.Type.extend(function(){var e=this,t=ko.observable();this.evaluator=null,this.isSatisfied=ko.computed(function(){if(ko.isObservable(e.evaluator))return e.evaluator();var n=t();return!Bifrost.isNullOrUndefined(n)&&e.evaluator(n)}),this.evaluate=function(n){return t(n),e.isSatisfied()},this.and=function(e){if(Bifrost.isFunction(e)){var t=e;e=Bifrost.specifications.Specification.create(),e.evaluator=t}var n=Bifrost.specifications.And.create(this,e);return n},this.or=function(e){if(Bifrost.isFunction(e)){var t=e;e=Bifrost.specifications.Specification.create(),e.evaluator=t}var n=Bifrost.specifications.Or.create(this,e);return n}})}),Bifrost.specifications.Specification.when=function(e){var t=Bifrost.specifications.Specification.create();return t.evaluator=e,t},Bifrost.namespace("Bifrost.tasks",{ExecutionTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost.tasks",{FileLoadTask:Bifrost.tasks.LoadTask.extend(function(e,t){this.files=e;var n=this;this.files=[],e.forEach(function(e){n.files.push(e.path.fullPath)}),this.execute=function(){var n=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){n.signal(e)}),n}})}),Bifrost.namespace("Bifrost.tasks",{HttpGetTask:Bifrost.tasks.Task.extend(function(e,t,n){this.execute=function(){var i=Bifrost.execution.Promise.create();return e.get(t,n).continueWith(function(e){i.signal(e)}).onFail(function(e){i.fail(e)}),i}})}),Bifrost.namespace("Bifrost.tasks",{HttpPostTask:Bifrost.tasks.Task.extend(function(e,t,n){this.execute=function(){var i=Bifrost.execution.Promise.create();return e.post(t,n).continueWith(function(e){i.signal(e)}).onFail(function(e){i.fail(e)}),i}})}),Bifrost.namespace("Bifrost.tasks",{LoadTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){var e=Bifrost.execution.Promise.create();return e.signal(),e}})}),Bifrost.namespace("Bifrost.tasks",{Task:Bifrost.Type.extend(function(){var e=this;this.errors=ko.observableArray(),this.isExecuting=ko.observable(!1),this.execute=function(){var e=Bifrost.execution.Promise.create();return e.signal(),e},this.reportError=function(t){e.errors.push(t)}})}),Bifrost.namespace("Bifrost.tasks",{taskHistory:Bifrost.Singleton(function(e){var t=this,n={};this.entries=ko.observableArray(),this.begin=function(i){var r=Bifrost.Guid.create();try{var o=Bifrost.tasks.TaskHistoryEntry.create();o.type=i._type._name;var s={};for(var a in i)0!==a.indexOf("_")&&i.hasOwnProperty(a)&&"function"!=typeof i[a]&&(s[a]=i[a]);o.content=JSON.stringify(s),o.begin(e.nowInMilliseconds()),n[r]=o,t.entries.push(o)}catch(e){}return r},this.end=function(t,i){if(n.hasOwnProperty(t)){var r=n[t];r.end(e.nowInMilliseconds()),r.result(i)}},this.failed=function(t,i){if(n.hasOwnProperty(t)){var r=n[t];r.end(e.nowInMilliseconds()),r.error(i)}}})}),Bifrost.WellKnownTypesDependencyResolver.types.taskHistory=Bifrost.tasks.taskHistory,Bifrost.namespace("Bifrost.tasks",{TaskHistoryEntry:Bifrost.Type.extend(function(){var e=this;this.type="",this.content="",this.begin=ko.observable(),this.end=ko.observable(),this.total=ko.computed(function(){return Bifrost.isNullOrUndefined(e.end())||Bifrost.isNullOrUndefined(e.begin())?0:e.end()-e.begin()}),this.result=ko.observable(),this.error=ko.observable(),this.isFinished=ko.computed(function(){return!Bifrost.isNullOrUndefined(e.end())}),this.hasFailed=ko.computed(function(){return!Bifrost.isNullOrUndefined(e.error())}),this.isSuccess=ko.computed(function(){return e.isFinished()&&!e.hasFailed()})})}),Bifrost.namespace("Bifrost.tasks",{Tasks:Bifrost.Type.extend(function(e){function t(t){if(t.isExecuting()!==!0){t.isExecuting(!0);var i=e.begin(t);t.execute().continueWith(function(r){n.unfiltered.remove(t),e.end(i,r),t.promise.signal(r)}).onFail(function(r){n.unfiltered.remove(t),n.errors.push(t),e.failed(i,r),t.promise.fail(r)})}}var n=this;this.unfiltered=ko.observableArray(),this.canExecuteWhen=ko.observable(),this.all=ko.computed(function(){var e=n.unfiltered(),t=n.canExecuteWhen();if(!Bifrost.isNullOrUndefined(t)){var i=[];return e.forEach(function(e){t.evaluate(e),t.isSatisfied()===!0&&i.push(e)}),i}return e}),this.errors=ko.observableArray(),this.isBusy=ko.computed(function(){return n.all().length>0}),this.all.subscribe(function(e){e.forEach(function(e){t(e)})}),this.execute=function(e){e.promise=Bifrost.execution.Promise.create(),n.unfiltered.push(e);var i=n.canExecuteWhen(),r=!0;return Bifrost.isNullOrUndefined(i)||(r=i.evaluate(e)),r===!0&&t(e),e.promise}})}),Bifrost.namespace("Bifrost.tasks",{tasksFactory:Bifrost.Singleton(function(){this.create=function(){var e=Bifrost.tasks.Tasks.create();return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.tasksFactory=Bifrost.tasks.tasksFactory,Bifrost.namespace("Bifrost.types",{PropertyInfo:Bifrost.Type.extend(function(e,t){this.name=e,this.type=t})}),Bifrost.namespace("Bifrost.types",{TypeInfo:Bifrost.Type.extend(function(){this.properties=[]})}),Bifrost.types.TypeInfo.createFrom=function(e){var t,n=Bifrost.types.TypeInfo.create();for(var i in e){var r=e[i];if(!Bifrost.isNullOrUndefined(r)){var o=r.constructor;Bifrost.isNullOrUndefined(e[i]._type)||(o=e[i]._type),t=Bifrost.types.PropertyInfo.create({name:i,type:o})}n.properties.push(t)}return n},Bifrost.namespace("Bifrost",{areEqual:function(e,t){function n(e){return e.indexOf("_")>=0||"model"===e||"commons"===e||"targetViewModel"===e||"region"===e}if(ko.isObservable(e)&&(e=e()),ko.isObservable(t)&&(t=t()),Bifrost.isNullOrUndefined(e)&&Bifrost.isNullOrUndefined(t))return!0;if(Bifrost.isNullOrUndefined(e))return!1;if(Bifrost.isNullOrUndefined(t))return!1;if(Bifrost.isArray(e)&&Bifrost.isArray(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(Bifrost.areEqual(e[i],t[i])===!1)return!1}else for(var r in e)if(!n(r)){if(!t.hasOwnProperty(r))return!1;var o=e[r],s=t[r];if(Bifrost.isObject(o)||Bifrost.isArray(o)||ko.isObservable(o)){if(!Bifrost.areEqual(o,s))return!1}else if(o!==s)return!1}return!0}}),Bifrost.namespace("Bifrost",{assetsManager:{scripts:[],isInitialized:function(){return Bifrost.assetsManager.scripts.length>0},initialize:function(){var e=Bifrost.execution.Promise.create();return Bifrost.assetsManager.isInitialized()?e.signal():$.get("/Bifrost/AssetsManager",{extension:"js"},function(t){Bifrost.assetsManager.initializeFromAssets(t),e.signal()},"json"),e},initializeFromAssets:function(e){Bifrost.assetsManager.isInitialized()||(Bifrost.assetsManager.scripts=e,Bifrost.namespaces.create().initialize())},getScripts:function(){return Bifrost.assetsManager.scripts},hasScript:function(e){return Bifrost.assetsManager.scripts.some(function(t){return t===e})},getScriptPaths:function(){var e=[];return Bifrost.assetsManager.scripts.forEach(function(t){var n=Bifrost.Path.getPathWithoutFilename(t);e.indexOf(n)===-1&&e.push(n)}),e}}}),Bifrost.namespace("Bifrost",{configurator:Bifrost.Type.extend(function(){this.configure=function(e){}})}),Bifrost.namespace("Bifrost",{configureType:Bifrost.Singleton(function(e){function t(){Bifrost.views.Region.current=document.body.region,r.isReady=!0;for(var e=0;e<r.readyCallbacks.length;e++)r.readyCallbacks[e]()}function n(){Bifrost.navigation.navigationManager.hookup(),r.applyMasterViewModel===!0&&Bifrost.views.viewModelManager.create().masterViewModel.apply()}function i(){var i=Bifrost.configurator.getExtenders();i.forEach(function(e){var t=e.create();t.config(r)}),Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady(),Bifrost.views.viewModelBindingHandler.initialize(),Bifrost.views.viewBindingHandler.initialize(),Bifrost.navigation.navigationBindingHandler.initialize(),"undefined"!=typeof History&&"undefined"!=typeof History.Adapter&&(Bifrost.WellKnownTypesDependencyResolver.types.history=History),e.initialize().continueWith(function(){r.initializeLandingPage===!0?Bifrost.views.viewManager.create().initializeLandingPage().continueWith(n):n(),t()})}var r=this,o=Bifrost.StringMapper.create();o.addMapping("{boundedContext}/{module}/{feature}/{view}","{boundedContext}/{module}/{feature}/{view}.html"),o.addMapping("{boundedContext}/{feature}/{view}","{boundedContext}/{feature}/{view}.html"),o.addMapping("{feature}/{view}","{feature}/{view}.html"),o.addMapping("{view}","{view}.html"),Bifrost.uriMappers.default=o,this.isReady=!1,this.readyCallbacks=[],this.initializeLandingPage=!0,this.applyMasterViewModel=!0,this.ready=function(e){r.isReady===!0?e():r.readyCallbacks.push(e)},$(function(){i()})})}),Bifrost.configure=Bifrost.configureType.create(),Bifrost.namespace("Bifrost",{deepClone:function(e,t){function n(e){return e.indexOf("_")>=0||"model"===e||"commons"===e||"targetViewModel"===e||"region"===e}ko.isObservable(e)&&(e=e()),null==t&&(t=Bifrost.isArray(e)?[]:{});var i;if(Bifrost.isArray(e))for(var r=0;r<e.length;r++){i=e[r];var o=Bifrost.deepClone(i);t.push(o)}else for(var s in e)if(!n(s)&&(i=e[s],ko.isObservable(i)&&(i=i()),!Bifrost.isFunction(i))){var a=null;Bifrost.isObject(i)?a={}:Bifrost.isArray(i)?a=[]:t[s]=i,null!=a&&(t[s]=a,Bifrost.deepClone(i,a))}return t}}),Bifrost.namespace("Bifrost",{DefaultDependencyResolver:function(){var e=this;this.doesNamespaceHave=function(e,t){return e.hasOwnProperty(t)},this.doesNamespaceHaveScriptReference=function(e,t){if(e.hasOwnProperty("_scripts")&&Bifrost.isArray(e._scripts))for(var n=0;n<e._scripts.length;n++){var i=e._scripts[n];if(i===t)return!0}return!1},this.getFileName=function(e,t){var n="";return"undefined"!=typeof e._path&&(n+=e._path,n.endsWith("/")||(n+="/")),n+=t,n.endsWith(".js")||(n+=".js"),n=n.replaceAll("//","/")},this.loadScriptReference=function(t,n,i){var r=e.getFileName(t,n),o=Bifrost.io.fileFactory.create().create(r,Bifrost.io.fileType.javaScript);Bifrost.io.fileManager.create().load([o]).continueWith(function(r){var o=r[0];e.doesNamespaceHave(t,n)&&(o=t[n]),i.signal(o)})},this.canResolve=function(t,n){for(var i=t;null!=i&&i!==window;){if(e.doesNamespaceHave(i,n))return!0;if(e.doesNamespaceHaveScriptReference(i,n))return!0;if(i===i.parent)break;i=i.parent}return!1},this.resolve=function(t,n){for(var i=t;null!=i&&i!==window;){if(e.doesNamespaceHave(i,n))return i[n];if(e.doesNamespaceHaveScriptReference(i,n)){var r=Bifrost.execution.Promise.create();return e.loadScriptReference(i,n,r),r}if(i===i.parent)break;i=i.parent}return null}}}),Bifrost.namespace("Bifrost",{dependencyResolver:function(){function e(e,t){var n=Bifrost.dependencyResolvers.getAll(),i=null;return n.forEach(function(n){if(null==i){var r=n.canResolve(e,t);return r?void(i=n.resolve(e,t)):void 0}}),i}function t(e){if(null!=e&&null!==e._super){if("undefined"!=typeof e._super&&e._super===Bifrost.Type)return!0;if(t(e._super)===!0)return!0}return!1}function n(e){return t(e)?e.create():e}function i(e){var t=Bifrost.execution.Promise.create();return null!=e&&null!==e._super&&"undefined"!=typeof e._super&&e._super===Bifrost.Type?e.beginCreate().continueWith(function(e,n){t.signal(e)}):t.signal(e),t}return{getDependenciesFor:function(e){for(var t=[],n=Bifrost.functionParser.parse(e),i=0;i<n.length;i++)t.push(n[i].name);return t},canResolve:function(e,t){var n=Bifrost.dependencyResolvers.getAll(),i=!1;return n.forEach(function(n){i!==!0&&(i=n.canResolve(e,t))}),i},resolve:function(t,i){var r=e(t,i);if("undefined"==typeof r||null===r)throw console.log("Unable to resolve '"+i+"' in '"+t+"'"),new Bifrost.UnresolvedDependencies;if(r instanceof Bifrost.execution.Promise)throw console.log("'"+i+"' was resolved as an asynchronous dependency, consider using beginCreate() or make the dependency available prior to calling create"),new Bifrost.AsynchronousDependenciesDetected;return n(r)},beginResolve:function(t,r){var o=Bifrost.execution.Promise.create();return Bifrost.configure.ready(function(){var s=e(t,r);"undefined"!=typeof s&&null!==s||(console.log("Unable to resolve '"+r+"' in '"+t+"'"),o.fail(new Bifrost.UnresolvedDependencies)),s instanceof Bifrost.execution.Promise?s.continueWith(function(e,t){i(e).continueWith(function(e,t){o.signal(n(e))}).onFail(function(e){o.fail(e)})}):o.signal(n(s))}),o}}}()}),Bifrost.WellKnownTypesDependencyResolver.types.dependencyResolver=Bifrost.dependencyResolver,Bifrost.namespace("Bifrost",{dependencyResolvers:function(){return{getAll:function(){var e=[new Bifrost.WellKnownTypesDependencyResolver,new Bifrost.DefaultDependencyResolver,new Bifrost.KnownArtifactTypesDependencyResolver,new Bifrost.KnownArtifactInstancesDependencyResolver];for(var t in this)0!==t.indexOf("_")&&this.hasOwnProperty(t)&&"function"!=typeof this[t]&&e.push(this[t]);return e}}}()}),Bifrost.dependencyResolvers.DOMRootDependencyResolver={canResolve:function(e,t){return"DOMRoot"===t},resolve:function(e,t){if(null!=document.body&&"undefined"!=typeof document.body)return document.body;var n=Bifrost.execution.Promise.create();return Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.push(n),n}},Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises=[],Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady=function(){Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.forEach(function(e){e.signal(document.body)})},Bifrost.namespace("Bifrost"),Bifrost.DefinitionMustBeFunction=function(e){this.prototype=Error.prototype,this.name="DefinitionMustBeFunction",this.message=e||"Definition must be function"},Bifrost.MissingName=function(e){this.prototype=Error.prototype,this.name="MissingName",this.message=e||"Missing name"},Bifrost.Exception=function(e,t){function n(e){if(!e||"undefined"==typeof e)throw new Bifrost.MissingName}function i(e){if("function"!=typeof e)throw new Bifrost.DefinitionMustBeFunction}function r(e){var t=e.lastIndexOf(".");return t===-1&&t!==e.length?e:e.substr(t+1)}function o(t){var n=t.lastIndexOf(".");if(n===-1)return e;var i=t.substr(0,n);Bifrost.namespace(i);var r=e,o=i.split(".");return o.forEach(function(e){r=r[e]}),r}return{define:function(e,t,s){n(e);var a=o(e),f=r(e),u=function(e){this.name=f,this.message=e||t};u.prototype=Error.prototype,s&&"undefined"!=typeof s&&(i(s),s.prototype=Error.prototype,u.prototype=new s),a[f]=u}}}(window),Bifrost.namespace("Bifrost"),Bifrost.Exception.define("Bifrost.LocationNotSpecified","Location was not specified"),Bifrost.Exception.define("Bifrost.InvalidUriFormat","Uri format specified is not valid"),Bifrost.Exception.define("Bifrost.ObjectLiteralNotAllowed","Object literal is not allowed"),Bifrost.Exception.define("Bifrost.MissingTypeDefinition","Type definition was not specified"),Bifrost.Exception.define("Bifrost.AsynchronousDependenciesDetected","You should consider using Type.beginCreate() or dependencyResolver.beginResolve() for systems that has asynchronous dependencies"),Bifrost.Exception.define("Bifrost.UnresolvedDependencies","Some dependencies was not possible to resolve");var Bifrost=Bifrost||{};!function(e,t){Bifrost.extend=function(e,t){return $.extend(e,t)}}(window),Bifrost.namespace("Bifrost",{functionParser:{parse:function(e){var t=[],n=e.toString().match(/function\w*\s*\((.*?)\)/);if(null!==n){var i=n[1].split(/\s*,\s*/);i.forEach(function(e){e.trim().length>0&&t.push({name:e})})}return t}}}),Bifrost.namespace("Bifrost",{Guid:{create:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},empty:"00000000-0000-0000-0000-000000000000"}}),Bifrost.namespace("Bifrost"),Bifrost.hashString=function(){return{decode:function(e){if(""===e)return{};e=e.replace("/?","").split("&");for(var t={},n=0;n<e.length;++n){var i=e[n].split("=",2);if(2===i.length){var r=decodeURIComponent(i[1].replace(/\+/g," "));""===r||isNaN(r)||(r=parseFloat(r)),t[i[0]]=r}}return t}}}(),Bifrost.namespace("Bifrost",{isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)}}),Bifrost.namespace("Bifrost",{isFunction:function(e){return"function"==typeof e}}),Bifrost.namespace("Bifrost",{isNull:function(e){return null===e}}),Bifrost.namespace("Bifrost",{isNullOrUndefined:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}}),Bifrost.namespace("Bifrost",{isNumber:function(e){return!(Bifrost.isString(e)&&e.length>1&&"0"===e[0])&&(!isNaN(parseFloat(e))&&isFinite(e))}}),Bifrost.namespace("Bifrost",{isObject:function(e){return null!==e&&"undefined"!=typeof e&&"[object Object]"===Object.prototype.toString.call(e)}}),Bifrost.namespace("Bifrost",{isString:function(e){return"string"==typeof e}}),Bifrost.namespace("Bifrost",{isType:function(e){return!Bifrost.isNullOrUndefined(e)&&"undefined"!=typeof e._typeId}}),Bifrost.namespace("Bifrost",{isUndefined:function(e){return"undefined"==typeof e}}),Bifrost.namespace("Bifrost",{KnownArtifactInstancesDependencyResolver:function(){function e(e,t){var n=e.name.split("."),i=t.name.split(".");if(n.length>i.length)return!1;for(var r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}var t={readModels:Bifrost.read.ReadModelOf,commands:Bifrost.commands.Command,queries:Bifrost.read.Query};this.canResolve=function(e,n){return n in t},this.resolve=function(n,i){var r=t[i],o=r.getExtendersIn(n),s={};o.forEach(function(t){var n=t._name;s[n]&&!e(s[n]._namespace,t._namespace)||(s[n]=t)});var a={};for(var f in s)a[f]=s[f].create();return a}}}),Bifrost.namespace("Bifrost",{KnownArtifactTypesDependencyResolver:function(){function e(e,t){var n=e.name.split("."),i=t.name.split(".");if(n.length>i.length)return!1;for(var r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}var t={readModelTypes:Bifrost.read.ReadModelOf,commandTypes:Bifrost.commands.Command,queryTypes:Bifrost.read.Query};this.canResolve=function(e,n){return n in t},this.resolve=function(n,i){var r=t[i],o=r.getExtendersIn(n),s={};return o.forEach(function(t){var n=t._name;s[n]&&!e(s[n]._namespace,t._namespace)||(s[n]=t)}),s}}});var Bifrost=Bifrost||{};Bifrost.namespace=function(e,t){e=e.replaceAll("..","."),e.endsWith(".")&&(e=e.substr(0,e.length-1)),e.startsWith(".")&&(e=e.substr(1));var n=window,i="",r=e.split(".");if(r.forEach(function(e){i.length>0&&(i+="."),i+=e,Object.prototype.hasOwnProperty.call(n,e)||(n[e]={},n[e].parent=n,n[e].name=i),n=n[e]}),"object"==typeof t){Bifrost.namespace.current=n;var o;for(o in t)n[o]=t[o];for(o in n)n.hasOwnProperty(o)&&(n[o]._namespace=n,n[o]._name=o);Bifrost.namespace.current=null}return n},Bifrost.namespace("Bifrost",{namespaceMappers:{mapPathToNamespace:function(e){for(var t in Bifrost.namespaceMappers){var n=Bifrost.namespaceMappers[t];if("function"==typeof n.hasMappingFor&&n.hasMappingFor(e)){var i=n.resolve(e);return i}}return null}}}),Bifrost.namespace("Bifrost",{namespaces:Bifrost.Singleton(function(){var e=this;this.stripPath=function(e){return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e},this.initialize=function(){var t=Bifrost.assetsManager.getScripts();"undefined"!=typeof t&&t.forEach(function(t){var n=Bifrost.Path.getPathWithoutFilename(t);n=e.stripPath(n);for(var i in Bifrost.namespaceMappers){var r=Bifrost.namespaceMappers[i];if("function"==typeof r.hasMappingFor&&r.hasMappingFor(n)){var o=r.resolve(n),s=Bifrost.namespace(o),a="/"+n+"/";s._path=a,"undefined"==typeof s._scripts&&(s._scripts=[]);var f=t.lastIndexOf("/"),u=t.substr(f+1),c=u.lastIndexOf("."),l=u.substr(0,c);s._scripts.push(l)}}})}})}),Bifrost.namespace("Bifrost",{Path:Bifrost.Type.extend(function(e){function t(e){var t=e.indexOf("?");return t>0&&(e=e.substr(0,t)),e}function n(e){var t=r.exec(e),n=(t[1]||"")+(t[2]||""),i=t[3]||"",s=o.exec(i),a=s[1]||"",f=s[2]||"",u=s[3]||"";return[n,a,f,u]}var i=this,r=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?([\\\/])?([\s\S]*?)$/,o=/^([\s\S]+[\\\/](?!$)|[\\\/])?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/\\]*)?)$/;e=t(e);var s=n(e);this.device=s[0]||"",this.directory=s[1]||"",this.filename=s[2]||"",this.extension=s[3]||"",this.filenameWithoutExtension=this.filename.replaceAll(this.extension,""),this.fullPath=e,this.hasExtension=function(){return!Bifrost.isNullOrUndefined(i.extension)&&""!==i.extension}})}),Bifrost.Path.makeRelative=function(e){return 0===e.indexOf("/")?e.substr(1):e},Bifrost.Path.getPathWithoutFilename=function(e){var t=e.lastIndexOf("/");return e.substr(0,t)},Bifrost.Path.getFilename=function(e){var t=e.lastIndexOf("/");return e.substr(t+1)},Bifrost.Path.getFilenameWithoutExtension=function(e){var t=this.getFilename(e),n=t.lastIndexOf(".");return t.substr(0,n);
},Bifrost.Path.hasExtension=function(e){e.indexOf("?")>0&&(e=e.substr(0,e.indexOf("?")));var t=e.lastIndexOf(".");return t>0},Bifrost.Path.changeExtension=function(e,t){var n=Bifrost.Path.create({fullPath:e}),i=n.directory+n.filenameWithoutExtension+"."+t;return i},Bifrost.namespace("Bifrost",{server:Bifrost.Singleton(function(){function e(t){if(Bifrost.isArray(t)){var n=[];return t.forEach(function(t){n.push(e(t))}),n}for(var i in t)if(Bifrost.isArray(t[i]))t[i]=e(t[i]);else{var r=t[i];Bifrost.isNumber(r)?t[i]=parseFloat(r):t[i]=t[i]}return t}var t=this;this.target="",this.defaultParameters={},this.post=function(n,i){var r=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(n)||(n=t.target+n);var o={};Bifrost.extend(o,t.defaultParameters);for(var s in i)o[s]=JSON.stringify(i[s]);return $.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",complete:function(t){var n=$.parseJSON(t.responseText);e(n),r.signal(n)},error:function(e,t,n){r.fail(e)}}),r},this.get=function(n,i){var r=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(n)||(n=t.target+n);var o={};if(Bifrost.extend(o,t.defaultParameters),Bifrost.isObject(i))for(var s in i)Bifrost.isArray(i[s])?o[s]=JSON.stringify(i[s]):o[s]=i[s];return $.ajax({url:n,type:"GET",dataType:"json",data:o,contentType:"application/json; charset=utf-8",complete:function(t,n){var i=$.parseJSON(t.responseText);e(i),r.signal(i)},error:function(e,t,n){r.fail(e)}}),r}})}),Bifrost.WellKnownTypesDependencyResolver.types.server=Bifrost.server,Bifrost.namespace("Bifrost",{Singleton:function(e){return Bifrost.Type.extend(e).scopeTo(window)}}),Bifrost.namespace("Bifrost",{StringMapper:Bifrost.Type.extend(function(e){function t(e,t){var n=!1;return e.some(function(e){return e.matches(t)&&(n=!0),n}),n}function n(e,t){var n;if(e.some(function(e){if(e.matches(t))return n=e,!0}),"undefined"!=typeof n)return n;throw{name:"ArgumentError",message:"String mapping for ("+t+") could not be found"}}function i(e,t){try{if(null===t||"undefined"==typeof t)return"";var n=r.getMappingFor(t);return Bifrost.isNullOrUndefined(n)?"":n.resolve(t)}catch(e){return""}}var r=this;this.stringMappingFactory=e,this.mappings=[],this.reverseMappings=[],this.hasMappingFor=function(e){return t(r.mappings,e)},this.getMappingFor=function(e){return n(r.mappings,e)},this.resolve=function(e){return i(r.mappings,e)},this.reverse={hasMappingFor:function(e){return r.hasMappingFor(r.reverseMappings,e)},getMappingFor:function(e){return r.getMappingFor(r.reverseMappings,e)},resolve:function(e){return r.resolve(r.reverseMappings,e)}},this.addMapping=function(e,t){var n=r.stringMappingFactory.create(e,t);r.mappings.push(n);var i=r.stringMappingFactory.create(t,e);r.reverseMappings.push(i)}})}),Bifrost.namespace("Bifrost",{StringMapping:Bifrost.Type.extend(function(e,t){this.format=e,this.mappedFormat=t;var n="{[a-zA-Z]+}",i=(new RegExp(n,"g"),"\\*{2}[//||.]"),r=new RegExp(i,"g"),o="("+n+")*("+i+")*",s=new RegExp(o,"g"),a=[],f=e.replace(s,function(e){return"undefined"==typeof e||""===e?"":(a.push(e),0===e.indexOf("**")?"([\\w.//]*)":"([\\w.]*)")}),u=t.match(r),c=new RegExp(f);this.matches=function(e){var t=e.match(c);return!!t},this.getValues=function(e){var t={},n=e.match(c);return a.forEach(function(e,i){var r=e.substr(1,e.length-2),o=n[i+2];0!==e.indexOf("**")&&(t[r]=o)}),t},this.resolve=function(e){var n=e.match(c),i=t,r=0;return a.forEach(function(e,t){var o=n[t+1];if(0===e.indexOf("**")){var s=u[r];o=o.replaceAll(e[2],s[2]),i=i.replace(s,o),r++}else i=i.replace(e,o)}),i}})}),Bifrost.namespace("Bifrost",{stringMappingFactory:Bifrost.Singleton(function(){this.create=function(e,t){var n=Bifrost.StringMapping.create({format:e,mappedFormat:t});return n}})}),Bifrost.namespace("Bifrost",{systemClock:Bifrost.Singleton(function(){this.nowInMilliseconds=function(){return window.performance.now()}})}),Bifrost.namespace("Bifrost",{Type:function(){}}),function(){function throwIfMissingTypeDefinition(e){if(null==e||"undefined"==typeof e)throw new Bifrost.MissingTypeDefinition}function throwIfTypeDefinitionIsObjectLiteral(e){if("object"==typeof e)throw new Bifrost.ObjectLiteralNotAllowed}function addStaticProperties(e){for(var t in Bifrost.Type)Bifrost.Type.hasOwnProperty(t)&&"_extenders"!==t&&(e[t]=Bifrost.Type[t])}function setupDependencies(typeDefinition){typeDefinition._dependencies=Bifrost.dependencyResolver.getDependenciesFor(typeDefinition);var firstParameter=!0,createFunctionString="Function('definition', 'dependencies','return new definition(";"undefined"!=typeof typeDefinition._dependencies&&typeDefinition._dependencies.forEach(function(e,t){firstParameter||(createFunctionString+=","),firstParameter=!1,createFunctionString+="dependencies["+t+"]"}),createFunctionString+=");')",typeDefinition.createFunction=eval(createFunctionString)}function getDependencyInstances(e,t){var n=[];return"undefined"!=typeof t._dependencies&&t._dependencies.forEach(function(t){var i=Bifrost.dependencyResolver.resolve(e,t);n.push(i)}),n}function resolve(e,t,n,i,r,o){var s=Bifrost.dependencyResolver.beginResolve(e,t).continueWith(function(e,t){i[n]=e,o(e,t)});return s}function beginGetDependencyInstances(e,t,n){function i(e,t){s++,s===a&&r.signal(o)}var r=Bifrost.execution.Promise.create(),o=[],s=0;if("undefined"!=typeof t._dependencies)for(var a=t._dependencies.length,f="",u=0;u<a;u++)f=t._dependencies[u],n&&n.hasOwnProperty(f)?(o[u]=n[f],s++,s===a&&r.signal(o)):resolve(e,f,u,o,t,i).onFail(r.fail);return r}function expandInstancesHashToDependencies(e,t,n){if("undefined"!=typeof e._dependencies&&null!=e._dependencies)for(var i in t)for(var r=0;r<e._dependencies.length;r++)e._dependencies[r]===i&&(n[r]=t[i])}function expandDependenciesToInstanceHash(e,t,n){for(var i=0;i<t.length;i++)n[e._dependencies[i]]=t[i]}function resolveDependencyInstancesThatHasNotBeenResolved(e,t){e.forEach(function(n,i){if(null==n||"undefined"==typeof n){var r=t._dependencies[i];e[i]=Bifrost.dependencyResolver.resolve(t._namespace,r)}})}function resolveDependencyInstances(e,t){var n=[];return"object"==typeof e&&expandInstancesHashToDependencies(t,e,n),"undefined"!=typeof t._dependencies&&t._dependencies.length>0&&(n.length>0?resolveDependencyInstancesThatHasNotBeenResolved(n,t):n=getDependencyInstances(t._namespace,t)),n}function addMissingDependenciesAsNullFromTypeDefinition(e,t){if("undefined"!=typeof t._dependencies&&"undefined"!=typeof e&&null!=e)for(var n=0;n<t._dependencies.length;n++){var i=t._dependencies[n];i in e||(e[i]=null)}}function handleOnCreate(e,t,n){null!=n&&"undefined"!=typeof n&&("undefined"!=typeof e&&"undefined"!=typeof e.prototype&&handleOnCreate(e._super,t,e.prototype),n.hasOwnProperty("onCreated")&&"function"==typeof n.onCreated&&n.onCreated(t))}Bifrost.Type._extenders=[],Bifrost.Type.scope={getFor:function(e,t){return null}},Bifrost.Type.typeOf=function(e){if("undefined"==typeof this._super||"undefined"==typeof this._super._typeId)return!1;if(this._super._typeId===e._typeId)return!0;if("undefined"!=typeof e._super){var t=this._super.typeOf(e);if(t===!0)return!0}return!1},Bifrost.Type.getExtenders=function(){return this._extenders},Bifrost.Type.getExtendersIn=function(e){var t=[];return this._extenders.forEach(function(n){for(var i=e;i!==window;){if(n._namespace===i){t.push(n);break}if(Bifrost.isUndefined(i.parent))break;i=i.parent}}),t},Bifrost.Type.extend=function(e){return throwIfMissingTypeDefinition(e),throwIfTypeDefinitionIsObjectLiteral(e),addStaticProperties(e),setupDependencies(e),e._super=this,e._typeId=Bifrost.Guid.create(),e._extenders=[],Bifrost.Type.registerExtender(this,e),e},Bifrost.Type.registerExtender=function(e,t){for(var n=e;null!=n;)n._extenders.indexOf(t)===-1&&n._extenders.push(t),n=n._super},Bifrost.Type.scopeTo=function(e){return"function"==typeof e?this.scope={getFor:e}:"function"==typeof e.getFor?this.scope=e:this.scope={getFor:function(){return e}},this},Bifrost.Type.defaultScope=function(){return this.scope={getFor:function(){return null}},this},Bifrost.Type.requires=function(){for(var e=0;e<arguments.length;e++)this._dependencies.push(arguments[e]);return this},Bifrost.Type.create=function(e,t){var n=this;null!=this._super&&(n.prototype=this._super.create(e,!0)),addMissingDependenciesAsNullFromTypeDefinition(e,this);var i=null;if(this!==Bifrost.Type&&(this.instancesPerScope=this.instancesPerScope||{},i=this.scope.getFor(this._namespace,this._name,this._typeId),null!=i&&this.instancesPerScope.hasOwnProperty(i)))return this.instancesPerScope[i];var r=null;if("undefined"!=typeof this.createFunction){var o=resolveDependencyInstances(e,this);r=this.createFunction(this,o)}else r=new n;return r._type=n,t!==!0&&handleOnCreate(n,r,r),null!=i&&(this.instancesPerScope[i]=r),r},Bifrost.Type.createWithoutScope=function(e,t){var n=this.scope;this.defaultScope();var i=this.create(e,t);return this.scope=n,i},Bifrost.Type.ensure=function(){var e=Bifrost.execution.Promise.create(),t=0,n=this._dependencies.length,i=this._namespace,r=Bifrost.dependencyResolver;return n>0?this._dependencies.forEach(function(o){r.canResolve(i,o)?r.beginResolve(i,o).continueWith(function(i){t++,t===n&&e.signal()}):(n--,t===n&&e.signal())}):e.signal(),e},Bifrost.Type.beginCreate=function(e){var t=this,n=Bifrost.execution.Promise.create(),i=Bifrost.execution.Promise.create();return i.onFail(function(e){n.fail(e)}),null!=this._super?this._super.beginCreate(e).continueWith(function(e,t){i.signal(e)}).onFail(function(e){n.fail(e)}):i.signal(null),i.continueWith(function(i,r){if(t.prototype=i,null==t._dependencies||"undefined"==typeof t._dependencies||0===t._dependencies.length){var o=t.create(e);n.signal(o)}else beginGetDependencyInstances(t._namespace,t,e).continueWith(function(i,r){var o={};if(expandDependenciesToInstanceHash(t,i,o),"object"==typeof e)for(var s in e)o[s]=e[s];try{var a=t.create(o);n.signal(a)}catch(e){n.fail(e)}})}),n}}(),Bifrost.namespace("Bifrost"),Bifrost.Uri=function(e,t){function n(e){for(var t=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],n=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),i={},r=0;r<10;r++)i[t[r]]=n[r]?n[r]:"";return i.directoryPath.length>0&&(i.directoryPath=i.directoryPath.replace(/\/?$/,"/")),i}function i(t){var i=this;this.setLocation=function(t){i.fullPath=t,t=t.replace("#!","/");var r=n(t);if(!r.protocol||"undefined"==typeof r.protocol)throw new Bifrost.InvalidUriFormat("Uri ('"+t+"') was in the wrong format");i.scheme=r.protocol,i.host=r.domain,i.path=r.path,i.anchor=r.anchor,i.queryString=r.query,i.port=parseInt(r.port),i.parameters=Bifrost.hashString.decode(r.query),i.parameters=Bifrost.extend(Bifrost.hashString.decode(r.anchor),i.parameters),i.isSameAsOrigin=e.location.protocol===r.protocol+":"&&e.location.hostname===i.host},this.setLocation(t)}function r(e){if(!e||"undefined"==typeof e)throw new Bifrost.LocationNotSpecified}return{create:function(e){r(e);var t=new i(e);return t},isAbsolute:function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return t.test(e)}}}(window),Bifrost.namespace("Bifrost",{uriMappers:{}}),Bifrost.namespace("Bifrost",{WellKnownTypesDependencyResolver:function(){var e=this;this.types=Bifrost.WellKnownTypesDependencyResolver.types,this.canResolve=function(t,n){return e.types.hasOwnProperty(n)},this.resolve=function(t,n){return e.types[n]}}}),Bifrost.WellKnownTypesDependencyResolver.types={options:{}},Bifrost.namespace("Bifrost.validation",{email:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isNull(e)||Bifrost.isUndefined(e)}var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/;this.validate=function(n){if(e(n))return!1;if(!Bifrost.isString(n))throw new Bifrost.validation.NotAString("Value "+n+" is not a string");return null!=n.match(t)}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.Exception.define("Bifrost.validation.OptionsNotDefined","Option was undefined"),Bifrost.Exception.define("Bifrost.validation.OptionsValueNotSpecified","Required value in Options is not specified. "),Bifrost.Exception.define("Bifrost.validation.NotANumber","Value is not a number"),Bifrost.Exception.define("Bifrost.validation.NotAString","Value is not a string"),Bifrost.Exception.define("Bifrost.validation.ValueNotSpecified","Value is not specified"),Bifrost.Exception.define("Bifrost.validation.MinNotSpecified","Min is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxNotSpecified","Max is not specified"),Bifrost.Exception.define("Bifrost.validation.MinLengthNotSpecified","Min length is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxLengthNotSpecified","Max length is not specified"),Bifrost.Exception.define("Bifrost.validation.MissingExpression","Expression is not specified"),Bifrost.namespace("Bifrost.validation",{greaterThan:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.value)){var i=new Bifrost.validation.OptionsValueNotSpecified;throw i.message=i.message+" 'value' is not set.",i}n(t.value)}function n(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}var i=this;this.validate=function(r){return t(i.options),!e(r)&&(n(r),parseFloat(r)>parseFloat(i.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.greaterThanOrEqual={throwIfOptionsInvalid:function(e){if(this.notSet(e))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(e.value)){var t=new Bifrost.validation.OptionsValueNotSpecified;throw t.message=t.message+" 'value' is not set.",t}this.throwIfValueToCheckIsNotANumber(e.value)},throwIfValueToCheckIsNotANumber:function(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")},notSet:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)},validate:function(e,t){return this.throwIfOptionsInvalid(t),!this.notSet(e)&&(this.throwIfValueToCheckIsNotANumber(e),parseFloat(e)>=parseFloat(t.value))}},Bifrost.namespace("Bifrost.validation",{length:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function n(n){if(e(n))throw new Bifrost.validation.OptionsNotDefined;if(e(n.max))throw new Bifrost.validation.MaxLengthNotSpecified;if(e(n.min))throw new Bifrost.validation.MinLengthNotSpecified;t(n.min),t(n.max)}var i=this;this.validate=function(t){return n(i.options),e(t)&&(t=""),Bifrost.isString(t)||(t=t.toString()),i.options.min<=t.length&&t.length<=i.options.max}})}),Bifrost.namespace("Bifrost.validation",{lessThan:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.value)){var n=new Bifrost.validation.OptionsValueNotSpecified;throw n.message=n.message+" 'value' is not set.",n}}function n(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}var i=this;this.validate=function(r){return t(i.options),!e(r)&&(n(r),parseFloat(r)<parseFloat(i.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.lessThanOrEqual={throwIfOptionsInvalid:function(e){if(this.notSet(e))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(e.value)){var t=new Bifrost.validation.OptionsValueNotSpecified;throw t.message=t.message+" 'value' is not set.",t}},throwIsValueToCheckIsNotANumber:function(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")},notSet:function(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)},validate:function(e,t){return this.throwIfOptionsInvalid(t),!this.notSet(e)&&(this.throwIsValueToCheckIsNotANumber(e),parseFloat(e)<=parseFloat(t.value))}},Bifrost.namespace("Bifrost.validation",{maxLength:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function n(n){if(e(n))throw new Bifrost.validation.OptionsNotDefined;if(e(n.length))throw new Bifrost.validation.MaxNotSpecified;t(n.length)}function i(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string")}var r=this;this.validate=function(t){return n(r.options),e(t)&&(t=""),i(t),t.length<=r.options.length}})}),Bifrost.namespace("Bifrost.validation",{minLength:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber("Value "+e+" is not a number")}function n(n){if(e(n))throw new Bifrost.validation.OptionsNotDefined;if(e(n.length))throw new Bifrost.validation.MaxNotSpecified;t(n.length)}function i(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string")}var r=this;this.validate=function(t){return n(r.options),e(t)&&(t=""),i(t),t.length>=r.options.length}})}),Bifrost.namespace("Bifrost.validation",{notNull:Bifrost.validation.Rule.extend(function(){this.validate=function(e){return!(Bifrost.isUndefined(e)||Bifrost.isNull(e))}})}),Bifrost.namespace("Bifrost.validation",{range:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(e,t){if(!Bifrost.isNumber(e))throw new Bifrost.validation.NotANumber(t+" value "+e+" is not a number")}function n(n){if(e(n))throw new Bifrost.validation.OptionsNotDefined;if(e(n.max))throw new Bifrost.validation.MaxNotSpecified;if(e(n.min))throw new Bifrost.validation.MinNotSpecified;t(n.min,"min"),t(n.max,"max")}var i=this;this.validate=function(r){return n(i.options),!e(r)&&(t(r,"value"),i.options.min<=r&&r<=i.options.max)}})}),Bifrost.namespace("Bifrost.validation",{regex:Bifrost.validation.Rule.extend(function(){function e(e){return Bifrost.isUndefined(e)||Bifrost.isNull(e)}function t(t){if(e(t))throw new Bifrost.validation.OptionsNotDefined;if(e(t.expression))throw new Bifrost.validation.MissingExpression;if(!Bifrost.isString(t.expression))throw new Bifrost.validation.NotAString("Expression "+t.expression+" is not a string.")}function n(e){if(!Bifrost.isString(e))throw new Bifrost.validation.NotAString("Value "+e+" is not a string.")}var i=this;this.validate=function(r){return t(i.options),!e(r)&&(n(r),null!=r.match(i.options.expression))}})}),Bifrost.namespace("Bifrost.validation",{required:Bifrost.validation.Rule.extend(function(){this.validate=function(e){return!(Bifrost.isUndefined(e)||Bifrost.isNull(e)||""===e||0===e)}})}),Bifrost.namespace("Bifrost.validation",{Rule:Bifrost.Type.extend(function(e){e=e||{},this.message=e.message||"",this.options={},Bifrost.extend(this.options,e),this.validate=function(e){return!0}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.ruleHandlers=function(){return Bifrost.validation.ruleHandlers||{}}(),"undefined"!=typeof ko&&(ko.extenders.validation=function(e,t){return Bifrost.validation.Validator.applyTo(e,t),e.subscribe(function(t){e.validator.validate(t)}),e}),"undefined"!=typeof ko&&(ko.bindingHandlers.validationMessageFor={init:function(e,t,n,i){var r=t(),o=r.validator;Bifrost.isNullOrUndefined(o)||(o.isValid.subscribe(function(t){t===!0?$(e).hide():$(e).show()}),ko.applyBindingsToNode(e,{text:o.message},o))}}),"undefined"!=typeof ko&&(Bifrost.namespace("Bifrost.validation",{ValidationSummary:function(e,t){function n(){var e=[];i.commands().forEach(function(t){var n=ko.utils.unwrapObservable(t);n.validators().forEach(function(t){!t.isValid()&&t.message().length&&e.push(t.message())})}),i.messages(e)}var i=this;this.commands=ko.observable(e),this.messages=ko.observableArray([]),this.hasMessages=ko.computed(function(){return this.messages().length>0},i),e.forEach(function(e){var t=ko.utils.unwrapObservable(e);t.validators().forEach(function(e){e.message.subscribe(n)})})}}),ko.bindingHandlers.validationSummaryFor={init:function(e,t,n,i){var r=ko.bindingHandlers.validationSummaryFor.getValueAsArray(t),o=new Bifrost.validation.ValidationSummary(r),s=document.createElement("ul");e.appendChild(s),s.innerHTML="<li><span data-bind='text: $data'></span></li>",ko.utils.domData.set(e,"validationsummary",o),ko.applyBindingsToNode(e,{visible:o.hasMessages},o),ko.applyBindingsToNode(s,{foreach:o.messages},o)},update:function(e,t){var n=ko.utils.domData.get(e,"validationsummary");n.commands(ko.bindingHandlers.validationSummaryFor.getValueAsArray(t))},getValueAsArray:function(e){var t=ko.utils.unwrapObservable(e());return Bifrost.isArray(t)||(t=[t]),t}}),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.Validator=function(){function e(e){var t=this;this.isValid=ko.observable(!0),this.message=ko.observable(""),this.rules=[],this.isRequired=!1,e=e||{},this.setOptions=function(e){function n(n){if(n._name===i){var r=n.create({options:e[i]||{}});t.rules.push(r)}"required"===n._name&&(t.isRequired=!0)}for(var i in e){var r=Bifrost.validation.Rule.getExtenders();r.some(n)}},this.validate=function(e){t.isValid(!0),t.message(""),e=ko.utils.unwrapObservable(e),t.rules.some(function(n){return n.validate(e)?(t.isValid(!0),void t.message("")):(t.isValid(!1),t.message(n.message),!0)})},this.validateSilently=function(e){t.rules.some(function(n){return n.validate(e)?void t.isValid(!0):(t.isValid(!1),!0)})},this.setOptions(e)}return{create:function(t){var n=new e(t);return n},applyTo:function(e,t){function n(e){var n=i.create(t);e.validator=n}var i=this;e instanceof Array?e.forEach(function(e){n(e)}):n(e)},applyToProperties:function(e,t){var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push(e[i]);this.applyTo(n,t)}}}(),Bifrost.namespace("Bifrost.values",{Binding:Bifrost.values.ValueProvider.extend(function(e){this.defaultProperty="path",this.path="",this.mode=null,this.converter=null,this.format=null,this.provide=function(e){}})}),Bifrost.namespace("Bifrost.values",{DateFormatter:Bifrost.values.Formatter.extend(function(){this.supportedType=Date,this.format=function(e,t){return e.format(t)}})}),Bifrost.namespace("Bifrost.values",{DateTypeConverter:Bifrost.values.TypeConverter.extend(function(){function e(e){return Bifrost.isNullOrUndefined(e)||"0001-01-01T00:00:00"===e||"0001-01-01T00:00:00Z"===e||e instanceof Date&&e.getTime()===-621355968e5||e instanceof Date&&isNaN(e.getTime())}this.supportedType=Date,this.convertFrom=function(t){if(e(t))return null;var n=new Date(t);return n},this.convertTo=function(e){return e.format("yyyy-MM-dd")}})}),Bifrost.namespace("Bifrost.values",{DefaultValueConsumer:Bifrost.values.ValueConsumer.extend(function(e,t){this.consume=function(n){e[t]=n}})}),Bifrost.namespace("Bifrost.values",{Formatter:Bifrost.Type.extend(function(){this.supportedType=null,this.format=function(e,t){return e}})}),Bifrost.namespace("Bifrost.values",{NumberTypeConverter:Bifrost.values.TypeConverter.extend(function(){function e(e){e=e.toString();for(var n="",i=0;i<e.length;i++)for(var r=!1,o=0;o<t.length;o++)if(e[i]===t[o]){r=!0,n+=e[i];break}return n}var t="0123456789.,-";this.supportedType=Number,this.convertFrom=function(t){if(t.constructor===Number)return t;if(""===t)return 0;t=e(t);var n=0;return n=t.indexOf(".")>=0?parseFloat(t):parseInt(t)}})}),Bifrost.namespace("Bifrost.values",{stringFormatter:Bifrost.Singleton(function(){function e(e){if(1!==e.nodeType||Bifrost.isNullOrUndefined(e.attributes))return null;var t=e.attributes.getNamedItem("data-stringformat");return Bifrost.isNullOrUndefined(t)?null:t.value}var t=Bifrost.values.Formatter.getExtenders(),n={};t.forEach(function(e){var t=e.create();n[t.supportedType]=t}),this.hasFormat=function(t){var n=e(t);return null!==n},this.format=function(t,i){var r=e(t);if(n.hasOwnProperty(i.constructor)){var o=n[i.constructor],s=new RegExp("{(.[^{}])*}","g"),a=r.replace(s,function(e){var t=e.substr(1,e.length-2);return o.format(i,t)});return a}return r}})}),Bifrost.namespace("Bifrost.values",{StringTypeConverter:Bifrost.values.TypeConverter.extend(function(){this.supportedType=String,this.convertFrom=function(e){return e.toString()}})}),Bifrost.namespace("Bifrost.values",{TypeConverter:Bifrost.Type.extend(function(){this.supportedType=null,this.convertFrom=function(e){return e},this.convertTo=function(e){return e}})}),Bifrost.namespace("Bifrost.values",{typeConverters:Bifrost.Singleton(function(){var convertersByType={},typeConverterTypes=Bifrost.values.TypeConverter.getExtenders();typeConverterTypes.forEach(function(e){var t=e.create();convertersByType[t.supportedType]=t}),this.convertFrom=function(value,type){var actualType=null;return actualType=Bifrost.isString(type)?eval(type):type,convertersByType.hasOwnProperty(actualType)?convertersByType[actualType].convertFrom(value):value},this.convertTo=function(e){if(Bifrost.isNullOrUndefined(e))return e;for(var t in convertersByType)if(e.constructor==t)return convertersByType[t].convertTo(e);return e}})}),Bifrost.WellKnownTypesDependencyResolver.types.typeConverters=Bifrost.values.typeConverters,Bifrost.namespace("Bifrost.values",{typeExtender:Bifrost.Singleton(function(){this.extend=function(e,t){e._typeAsString=t}})}),ko.extenders.type=Bifrost.values.typeExtender.create().extend,Bifrost.namespace("Bifrost.values",{ValueConsumer:Bifrost.Type.extend(function(){this.canNotifyChanges=function(){return!1},this.notifyChanges=function(e){},this.consume=function(e){}})}),Bifrost.namespace("Bifrost.values",{valueConsumers:Bifrost.Singleton(function(){this.getFor=function(e,t){var n=Bifrost.values.DefaultValueConsumer.create({target:e,property:t});return n}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueConsumers=Bifrost.values.valueConsumers,Bifrost.namespace("Bifrost.values",{valuePipeline:Bifrost.Singleton(function(e,t){this.getValueForView=function(n,i){if(Bifrost.isNullOrUndefined(i))return i;var r=ko.utils.unwrapObservable(i);if(Bifrost.isNullOrUndefined(r))return i;var o=r;return t.hasFormat(n)?o=t.format(n,r):Bifrost.isNullOrUndefined(i._typeAsString)||(o=e.convertTo(r)),o},this.getValueForProperty=function(t,n){return Bifrost.isNullOrUndefined(t)?n:Bifrost.isNullOrUndefined(n)?n:(Bifrost.isNullOrUndefined(t._typeAsString)||(n=e.convertFrom(n,t._typeAsString)),n)}})}),function(){var e=Bifrost.values.valuePipeline.create(),t=ko.selectExtensions.readValue;ko.selectExtensions.readValue=function(n){var i=t(n),r=ko.bindingProvider.instance.getBindings(n,ko.contextFor(n));if(Bifrost.isNullOrUndefined(r))return i;var o=e.getValueForProperty(r.value,i);return o};var n=ko.selectExtensions.writeValue;ko.selectExtensions.writeValue=function(t,i,r){var o=i,s=ko.bindingProvider.instance.getBindings(t,ko.contextFor(t));Bifrost.isNullOrUndefined(s)||(o=ko.utils.unwrapObservable(e.getValueForView(t,s.value))),n(t,o,r)};var i=ko.utils.setTextContent;ko.utils.setTextContent=function(t,n){var r=e.getValueForView(t,n);i(t,r)};var r=ko.utils.setHtml;ko.utils.setHtml=function(t,n){var i=e.getValueForView(t,n);r(t,i)}}(),Bifrost.namespace("Bifrost.values",{ValueProvider:Bifrost.Type.extend(function(){this.defaultProperty=null,this.provide=function(e){}})}),Bifrost.namespace("Bifrost.values",{valueProviders:Bifrost.Singleton(function(){this.isKnown=function(e){var t=!1,n=Bifrost.values.ValueProvider.getExtenders();return n.forEach(function(n){if(n._name.toLowerCase()===e)return void(t=!0)}),t},this.getInstanceOf=function(e){var t=null,n=Bifrost.values.ValueProvider.getExtenders();return n.forEach(function(n){if(n._name.toLowerCase()===e)return void(t=n.create())}),t}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueProviders=Bifrost.values.valueProviders,Bifrost.namespace("Bifrost.views",{ComposeTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost.views",{Content:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{DataViewAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(e,t){var n=e.attributes.getNamedItem("data-view");if(!Bifrost.isNullOrUndefined(n)){var i="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):i=r.value+", ",r.value=i+"view: '"+n.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-view")}}})}),Bifrost.namespace("Bifrost.views",{DataViewModelFileAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(e,t){var n=e.attributes.getNamedItem("data-viewmodel-file");if(!Bifrost.isNullOrUndefined(n)){var i="",r=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(r)?r=document.createAttribute("data-bind"):i=r.value+", ",r.value=i+"viewModel: '"+n.value+"'",e.attributes.setNamedItem(r),e.attributes.removeNamedItem("data-viewmodel-file")}}})}),Bifrost.namespace("Bifrost.views",{Items:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{MasterViewModel:Bifrost.Type.extend(function(e){function t(e){Bifrost.isNullOrUndefined(e)||Bifrost.isFunction(e.deactivated)&&e.deactivated()}function n(e){!Bifrost.isNullOrUndefined(e)&&Bifrost.isFunction(e.activated)&&e.activated()}var i=this;this.setFor=function(r,o){var s=i.getFor(r);s!==o&&t(s);var a=e.getViewModelNameFor(r);i[a]=o,n(o)},this.getFor=function(t){var n=e.getViewModelNameFor(t);return i.hasOwnProperty(n)?i[n]:null},this.clearFor=function(n){var r=e.getViewModelNameFor(n);i.hasOwnProperty(r)||(t(i[r]),delete i[r],i[r]=null)},this.apply=function(){ko.applyBindings(i)},this.applyTo=function(e){ko.applyBindings(i,e)}})}),Bifrost.namespace("Bifrost.views",{PathResolver:Bifrost.Type.extend(function(){this.canResolve=function(e,t){return!1},this.resolve=function(e,t){}})}),Bifrost.namespace("Bifrost.views",{pathResolvers:Bifrost.Singleton(function(){function e(){var e=[];for(var t in Bifrost.views.pathResolvers)if(Bifrost.views.pathResolvers.hasOwnProperty(t)){var n=Bifrost.views.pathResolvers[t];if("function"==typeof n&&"function"==typeof n.create){var i=n.create();"function"==typeof i.canResolve&&e.push(i)}}return e}this.canResolve=function(t,n){for(var i=e(),r=0;r<i.length;r++){var o=i[r],s=o.canResolve(t,n);if(s===!0)return!0}return!1},this.resolve=function(t,n){for(var i=e(),r=0;r<i.length;r++){var o=i[r];if(o.canResolve(t,n))return o.resolve(t,n)}return null}})}),Bifrost.namespace("Bifrost.views",{PostBindingVisitor:Bifrost.Type.extend(function(){this.visit=function(e){}})}),Bifrost.namespace("Bifrost.views",{Region:function(e,t,n){function i(e,t){return ko.computed(function(){var n=!1;return s.children().forEach(function(e){if(e[t]()===!0)return void(n=!0)}),s.tasks.all().forEach(function(t){t._type.typeOf(e)===!0&&(n=!0)}),n})}function r(e,t){return ko.computed(function(){var n=!0,i=s.aggregatedCommands();return(t!==!0||0!==i.length)&&(i.forEach(function(t){
if(t[e]()===!1)return void(n=!1)}),n)})}function o(e){return ko.computed(function(){var t=!1,n=s.aggregatedCommands();return n.forEach(function(n){if(n[e]()===!0)return void(t=!0)}),t})}var s=this;this.view=ko.observable(),this.viewModel=null,this.messenger=e.create(),this.globalMessenger=e.global(),this.operations=t.create(),this.tasks=n.create(),this.parent=null,this.children=ko.observableArray(),this.commands=ko.observableArray(),this.isCommandRoot=ko.observable(!1),this.aggregatedCommands=ko.computed(function(){var e=[];return s.commands().forEach(function(t){e.push(t)}),s.children().forEach(function(t){t.isCommandRoot()||t.aggregatedCommands().forEach(function(t){e.push(t)})}),e}),this.isValid=r("isValid"),this.canCommandsExecute=r("canExecute",!0),this.areCommandsAuthorized=r("isAuthorized"),this.commandsHaveChanges=o("hasChanges"),this.areCommandsReadyToExecute=r("isReadyToExecute",!0),this.hasChanges=ko.computed(function(){var e=s.commandsHaveChanges(),t=!1;return s.children().forEach(function(e){if(!e.isCommandRoot()&&e.hasChanges()===!0)return void(t=!0)}),e||s.operations.stateful().length>0||t}),this.validationMessages=ko.computed(function(){var e=[],t=s.aggregatedCommands();return t.forEach(function(t){t.isValid()===!1&&t.validators().forEach(function(t){t.isValid()===!1&&e.push(t.message())})}),e}),this.isExecuting=i(Bifrost.tasks.ExecutionTask,"isExecuting"),this.isComposing=i(Bifrost.views.ComposeTask,"isComposing"),this.isLoading=i(Bifrost.tasks.LoadTask,"isLoading"),this.isBusy=ko.computed(function(){var e=!1;return s.children().forEach(function(t){if(t.isBusy()===!0)return void(e=!0)}),s.tasks.all().length>0&&(e=!0),e})}}),Bifrost.views.Region.current=null,Bifrost.dependencyResolvers.Region={canResolve:function(e,t){return"region"===t},resolve:function(e,t){return Bifrost.views.Region.current}},Bifrost.namespace("Bifrost.views",{RegionDescriptor:Bifrost.Type.extend(function(){this.describe=function(e){}})}),Bifrost.dependencyResolvers.RegionDescriptor={canResolve:function(e,t){return"RegionDescriptor"===t},resolve:function(e,t){return{describe:function(){}}}},Bifrost.namespace("Bifrost.views",{regionDescriptorManager:Bifrost.Singleton(function(){this.describe=function(e,t){var n=Bifrost.execution.Promise.create(),i=Bifrost.Path.getPathWithoutFilename(e.path),r=Bifrost.namespaceMappers.mapPathToNamespace(i);if(null!=r){var o=Bifrost.namespace(r);Bifrost.views.Region.current=t,Bifrost.dependencyResolver.beginResolve(o,"RegionDescriptor").continueWith(function(e){e.describe(t),n.signal()}).onFail(function(){n.signal()})}else n.signal();return n},this.describeTopLevel=function(e){}})}),Bifrost.namespace("Bifrost.views",{regionManager:Bifrost.Singleton(function(e,t,n,i,r){function o(){var e=new Bifrost.views.Region(n,i,r);return e}function s(n){var i=e.getParentRegionFor(n);if(i)Bifrost.views.Region.prototype=i;else{var r=o();t.describeTopLevel(r),Bifrost.views.Region.prototype=r}return i}function a(e){var t=o();return t.parent=e,e&&e.children.push(t),t}this.getFor=function(t){var n,i=t.element;if(e.hasOwnRegion(i))return n=e.getRegionFor(i),n.view(t),n;var r=s(i);return n=a(r),n.view(t),e.setRegionOn(i,n),n},this.describe=function(e,n){var i=Bifrost.execution.Promise.create();e.element;return t.describe(e,n).continueWith(function(){i.signal()}),i},this.getCurrent=function(){return Bifrost.views.Region.current},this.evict=function(e){e.parentRegion&&e.parentRegion.children.remove(e),e.parentRegion=null}})}),Bifrost.WellKnownTypesDependencyResolver.types.regionManager=Bifrost.views.regionManage,Bifrost.namespace("Bifrost.views",{RelativePathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(e,t){var n=$(e).closest("[data-view]");if(1===n.length){$(n[0]).view}return!1},this.resolve=function(e,t){var n=$(e).closest("[data-urimapper]");if(1===n.length){var i=$(n[0]).data("urimapper");if(Bifrost.uriMappers[i].hasMappingFor(t)===!0)return Bifrost.uriMappers[i].resolve(t)}return Bifrost.uriMappers.default.resolve(t)}})}),"undefined"!=typeof Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.RelativePathResolver=Bifrost.views.RelativePathResolver),Bifrost.namespace("Bifrost.views",{UIManager:Bifrost.Singleton(function(e){var t=Bifrost.markup.ElementVisitor.getExtenders(),n=[],i=Bifrost.views.PostBindingVisitor.getExtenders(),r=[];t.forEach(function(e){n.push(e.create())}),i.forEach(function(e){r.push(e.create())}),this.handle=function(t){e.traverseObjects(function(e){n.forEach(function(t){var n=Bifrost.markup.ElementVisitorResultActions.create();t.visit(e,n)})},t)},this.handlePostBinding=function(t){e.traverseObjects(function(e){r.forEach(function(t){t.visit(e)})},t)}})}),Bifrost.WellKnownTypesDependencyResolver.types.UIManager=Bifrost.views.UIManager,Bifrost.namespace("Bifrost.views",{UriMapperPathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(e,t){var n=$(e).closest("[data-urimapper]");if(1===n.length){var i=$(n[0]).data("urimapper");if(Bifrost.uriMappers[i].hasMappingFor(t)===!0)return!0}return Bifrost.uriMappers.default.hasMappingFor(t)},this.resolve=function(e,t){var n=$(e).closest("[data-urimapper]");if(1===n.length){var i=$(n[0]).data("urimapper");if(Bifrost.uriMappers[i].hasMappingFor(t)===!0)return Bifrost.uriMappers[i].resolve(t)}return Bifrost.uriMappers.default.resolve(t)}})}),"undefined"!=typeof Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.UriMapperPathResolver=Bifrost.views.UriMapperPathResolver),Bifrost.namespace("Bifrost.views",{View:Bifrost.Type.extend(function(e,t,n,i){var r=this;this.path=i,this.content="[CONTENT NOT LOADED]",this.element=null,this.viewModelType=null,this.viewModelPath=null,this.region=null,this.load=function(o){r.region=o;var s=Bifrost.execution.Promise.create();return r.viewModelPath=n.getViewModelPathForView(i),e.load(r.path,o).continueWith(function(e){r.content=e,r.viewModelType=t.getViewModelTypeForPath(r.viewModelPath),s.signal(r)}),s}})}),Bifrost.namespace("Bifrost.views",{viewBindingHandler:Bifrost.Type.extend(function(e,t,n,i,r,o,s,a){function f(t,i,r,o){return function(){var o=ko.utils.unwrapObservable(i());t.viewUri!==o&&(t.children.forEach(ko.removeNode),t.viewModel=null,t.view=null,t.templateSource=null,t.innerHTML=""),t.viewUri=o;var f=ko.observable(t.viewModel),u=r().viewModelParameters||{},c=null,l=null,d=null;if(Bifrost.isNullOrUndefined(o)||""===o)c=new ko.nativeTemplateEngine;else{c=e;var p=a.resolve(t,o);l=n.createFrom(p),l.element=t,d=s.getFor(l)}return{if:!0,data:f,element:t,templateEngine:c,viewUri:o,viewModelParameters:u,view:l,region:d}}}this.init=function(e,t,n,i,r){return ko.bindingHandlers.template.init(e,f(e,t,n,r),n,i,r)},this.update=function(e,t,n,i,r){return ko.bindingHandlers.template.update(e,f(e,t,n,r),n,i,r)}})}),Bifrost.views.viewBindingHandler.initialize=function(){ko.bindingHandlers.view=Bifrost.views.viewBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.view=!1,ko.virtualElements.allowedBindings.view=!0},Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateEngine:Bifrost.Type.extend(function(e,t,n){var i=this;this.renderTemplate=function(e,r,o){var s;Bifrost.isNullOrUndefined(o.element.templateSource)?(s=Bifrost.views.ViewBindingHandlerTemplateSource.create({viewUri:o.viewUri,region:o.region}),o.element.templateSource=s):s=o.element.templateSource,Bifrost.isNullOrUndefined(o.element.view)&&s.loadFor(o.element,o.view,o.region).continueWith(function(e){o.element.view=e,t.describe(o.view,o.region).continueWith(function(){try{ko.dependencyDetection.begin();var t;if(Bifrost.isNullOrUndefined(e.viewModelType))t={},o.data(t),r.$data=t;else{var n=o.viewModelParameters;n.region=o.region,t=e.viewModelType.create(n),o.element.viewModel=t,o.data(t),r.$data=t}}finally{ko.dependencyDetection.end()}})}),r.$root=r.$data;var a=i.renderTemplateSource(s,r,o);return a.forEach(function(e){e.constructor!==Text&&e.constructor!==Comment&&n.handle(e)}),a}})}),function(){var e=new ko.nativeTemplateEngine,t=Bifrost.views.ViewBindingHandlerTemplateEngine.create;Bifrost.views.ViewBindingHandlerTemplateEngine.create=function(){var n=t.call(Bifrost.views.ViewBindingHandlerTemplateEngine,arguments);for(var i in e)n.hasOwnProperty(i)||(n[i]=e[i]);return n}}(),Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateSource:Bifrost.Type.extend(function(e){var t="";this.loadFor=function(e,n,i){var r=Bifrost.execution.Promise.create();return n.load(i).continueWith(function(e){var o=document.createElement("div");o.innerHTML=e.content,t=o.innerHTML,Bifrost.isNullOrUndefined(e.viewModelType)?r.signal(e):(Bifrost.views.Region.current=i,n.viewModelType.ensure().continueWith(function(){r.signal(e)}))}),r},this.data=function(e,t){},this.text=function(e){return t}})}),Bifrost.namespace("Bifrost.views",{viewFactory:Bifrost.Singleton(function(){this.createFrom=function(e){var t=Bifrost.views.View.create({path:e});return t}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewFactory=Bifrost.views.viewFactory,Bifrost.namespace("Bifrost.views",{viewLoader:Bifrost.Singleton(function(e,t,n,i){this.load=function(i,r){var o=Bifrost.execution.Promise.create(),s=[],a=n.create(i,Bifrost.io.fileType.html);i.indexOf("?")>0&&(a.path.fullPath=a.path.fullPath+i.substr(i.indexOf("?"))),s.push(a);var f=null;if(e.hasForView(i)&&(f=e.getViewModelPathForView(i),!e.isLoaded(f))){var u=n.create(f,Bifrost.io.fileType.javaScript);s.push(u)}var c=t.createViewLoad(s);return r.tasks.execute(c).continueWith(function(e){o.signal(e)}),o}})}),Bifrost.namespace("Bifrost.views",{ViewLoadTask:Bifrost.views.ComposeTask.extend(function(e,t){var n=this;this.files=[],e.forEach(function(e){n.files.push(e.path.fullPath)}),this.execute=function(){var n=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){var t=e[0];n.signal(t)}),n}})}),Bifrost.namespace("Bifrost.views",{viewManager:Bifrost.Singleton(function(e,t,n,i,r,o,s,a){function f(e,t){r.masterViewModel.setFor(e,t);var n=a.getViewModelNameFor(e),i="",o=e.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(o)?o=document.createAttribute("data-bind"):i=o.value+", ",o.value=i+"viewModel: $root['"+n+"']",e.attributes.setNamedItem(o)}this.initializeLandingPage=function(){var a=Bifrost.execution.Promise.create(),u=document.body;if(null!==u){var c=Bifrost.Path.getFilenameWithoutExtension(document.location.toString());if(""===c&&(c="index"),t.canResolve(u,c)){var l=t.resolve(u,c),d=e.createFrom(l);d.element=u,d.content=u.innerHTML,u.view=d;var p=n.getFor(d);n.describe(d,p).continueWith(function(){if(r.hasForView(l)){var e=r.getViewModelPathForView(l);r.isLoaded(e)?s.beginCreateInstanceOfViewModel(e,p).continueWith(function(e){Bifrost.isNullOrUndefined(e)||f(u,e)}):o.load(e,p).continueWith(function(e){Bifrost.isNullOrUndefined(e)||f(u,e)})}i.handle(u),a.signal()})}}return a},this.attach=function(e){i.handle(e),r.masterViewModel.applyTo(e)}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewManager=Bifrost.views.viewManager,Bifrost.namespace("Bifrost.views",{ViewModel:Bifrost.Type.extend(function(e){var t=this;this.targetViewModel=this,this.region=e,this.activated=function(){"function"==typeof t.targetViewModel.onActivated&&t.targetViewModel.onActivated()},this.deactivated=function(){"function"==typeof t.targetViewModel.onDeactivated&&t.targetViewModel.onDeactivated()},this.onCreated=function(e){t.targetViewModel=e}})}),Bifrost.namespace("Bifrost.views",{viewModelBindingHandler:Bifrost.Type.extend(function(e,t,n,i,r,o){this.init=function(i,s,a,f,u){var c=ko.utils.unwrapObservable(s());if(i._isLoading!==!0&&(i._viewModelPath!==c||Bifrost.isNullOrUndefined(i._viewModel))){i._isLoading=!0,i._viewModelPath=c;var l="/";e.hasViewFile(i)&&(l=e.getViewFileFrom(i));var d=t.createFrom(l);d.content=i.innerHTML,d.element=i;var p=ko.observable(),h=o.getFor(d);return o.describe(d,h).continueWith(function(){var e=a().viewModelParameters||{};if(e.region=h,r.isLoaded(c)){var t=r.getViewModelTypeForPath(c),o=Bifrost.views.Region.current;Bifrost.views.Region.current=h,t.beginCreate(e).continueWith(function(e){var t=u.createChildContext(e);t.$root=e,i._viewModel=e,p(e),Bifrost.views.Region.current=o,i._isLoading=!1}).onFail(function(e){console.log("Could not create an instance of '"+t._namespace.name+"."+t._name+" - Reason : "+e)})}else n.load(c,h,e).continueWith(function(e){var t=u.createChildContext(e);t.$root=e,i._viewModel=e,p(e),i._isLoading=!1})}),ko.bindingHandlers.with.init(i,p,a,f,u)}}})}),Bifrost.views.viewModelBindingHandler.initialize=function(){ko.bindingHandlers.viewModel=Bifrost.views.viewModelBindingHandler.create()},Bifrost.namespace("Bifrost.views",{viewModelLoader:Bifrost.Singleton(function(e,t,n){this.load=function(i,r,o){var s=Bifrost.execution.Promise.create(),a=t.create(i,Bifrost.io.fileType.javaScript),f=e.createViewModelLoad([a]);return r.tasks.execute(f).continueWith(function(){n.beginCreateInstanceOfViewModel(i,r,o).continueWith(function(e){s.signal(e)})}),s}})}),Bifrost.namespace("Bifrost.views",{ViewModelLoadTask:Bifrost.views.ComposeTask.extend(function(e,t){var n=this;this.files=[],e.forEach(function(e){n.files.push(e.path.fullPath)}),this.execute=function(){var n=Bifrost.execution.Promise.create();return t.load(e).continueWith(function(e){n.signal(e)}),n}})}),Bifrost.namespace("Bifrost.views",{viewModelManager:Bifrost.Singleton(function(e,t,n,i,r,o,s){var a=this;this.assetsManager=e,this.viewModelLoader=n,this.documentService=t,this.masterViewModel=s,this.hasForView=function(e){var t=Bifrost.Path.changeExtension(e,"js");t=Bifrost.Path.makeRelative(t);var n=a.assetsManager.hasScript(t);return n},this.getViewModelPathForView=function(e){var t=Bifrost.Path.changeExtension(e,"js");return t},this.isLoaded=function(e){var t=Bifrost.Path.getPathWithoutFilename(e),n=Bifrost.Path.getFilenameWithoutExtension(e),i=Bifrost.namespaceMappers.mapPathToNamespace(t);if(null!=i){var r=Bifrost.namespace(i);if(n in r)return!0}return!1}})}),Bifrost.namespace("Bifrost.views",{viewModelTypes:Bifrost.Singleton(function(){function e(e){var t=Bifrost.Path.getPathWithoutFilename(e),n=Bifrost.namespaceMappers.mapPathToNamespace(t);if(null!=n){var i=Bifrost.namespace(n);return i}return null}function t(e){var t=(Bifrost.Path.getPathWithoutFilename(e),Bifrost.Path.getFilenameWithoutExtension(e));return t}function n(n){var i=e(n);if(null!=i){var r=t(n);if(Bifrost.isType(i[r]))return i[r]}return null}var i=this;this.isLoaded=function(n){var i=e(n);if(null!=i){var r=t(n);return r in i}return!1},this.getViewModelTypeForPath=function(e){var t=n(e);if(Bifrost.isNullOrUndefined(t)){var i=e.replace(".js","/index.js");t=n(i),Bifrost.isNullOrUndefined(t)&&(i=e.replace(".js","/Index.js"),n(i))}return t},this.beginCreateInstanceOfViewModel=function(e,t,n){var r=Bifrost.execution.Promise.create(),o=i.getViewModelTypeForPath(e);if(null!=o){Bifrost.views.Region.current;Bifrost.views.Region.current=t,n=n||{},n.region=t,o.beginCreate(n).continueWith(function(e){r.signal(e)}).onFail(function(t){throw console.log("ViewModel '"+e+"' failed instantiation"),t})}else console.log("ViewModel '"+e+"' does not exist"),r.signal(null);return r}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewModelTypes=Bifrost.views.viewModelTypes;var globalId=0;Bifrost.namespace("Bifrost.interaction.visualStateActions",{Opacity:Bifrost.interaction.VisualStateAction.extend(function(e){var t=this,n=null,i=e.getUniqueStyleName("opacity");this.target="",this.value="",this.initialize=function(e){n=e.find(t.target)},this.onEnter=function(r,o){var s=parseFloat(t.value);isNaN(s)&&(s=0);var a=o.totalMilliseconds()/1e3;e.addStyle("."+i,{"-webkit-transition":"opacity "+a+"s ease-in-out","-moz-transition":"opacity "+a+"s ease-in-out","-ms-transition":"opacity "+a+"s ease-in-out","-o-transition":"opacity "+a+"s ease-in-out",transition:"opacity "+a+"s ease-in-out",opacity:s}),n.classList.add(i)},this.onExit=function(e,t){n.classList.remove(i)}})});