function polyfillForEach(){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(callback,thisArg){void 0===thisArg&&(thisArg=window);for(var i=0;i<this.length;i++)callback.call(thisArg,this[i],i,this)})}function polyFillClone(){"function"!=typeof Array.prototype.clone&&(Array.prototype.clone=function(){return this.slice(0)})}function shallowEquals(){"function"!=typeof Array.prototype.shallowEquals&&(Array.prototype.shallowEquals=function(other){if(this===other)return!0;if(null===this||null===other)return!1;if(this.length!==other.length)return!1;for(var i=0;i<this.length;i++)if(this[i]!==other[i])return!1;return!0})}Array.prototype.insert=function(index,item){this.splice(index,0,item)},polyfillForEach(),polyFillClone(),shallowEquals(),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return str.length>0&&this.substring(0,str.length)===str}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(str){return str.length>0&&this.substring(this.length-str.length,this.length)===str}),String.prototype.replaceAll=function(toReplace,replacement){return this.split(toReplace).join(replacement)},String.prototype.toCamelCase=function(){var result=this.charAt(0).toLowerCase()+this.substring(1);return result=result.replaceAll("-","")},String.prototype.toPascalCase=function(){var result=this.charAt(0).toUpperCase()+this.substring(1);return result=result.replaceAll("-","")},String.prototype.hashCode=function(){var hash=0;if(0===this.length)return hash;for(var i=0;i<this.length;i++)hash=(hash<<5)-hash+this.charCodeAt(i),hash&=hash;return hash},NodeList.prototype.forEach=Array.prototype.forEach,NodeList.prototype.length=Array.prototype.length,HTMLElement.prototype.knownElementTypes=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","col","colgroup","content","code","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marque","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],HTMLElement.prototype.isKnownType=function(){if(!Bifrost.isNullOrUndefined("HTMLUnknownElement"))return this.constructor.toString().indexOf("HTMLUnknownElement")<0;var isKnown=this.constructor!==HTMLElement;if(!1===isKnown){var tagName=this.tagName.toLowerCase();isKnown=this.knownElementTypes.some(function(type){if(tagName===type)return!0})}return isKnown},HTMLElement.prototype.getChildElements=function(){var children=[];return this.childNodes.forEach(function(node){1===node.nodeType&&children.push(node)}),children},HTMLCollection.prototype.forEach=Array.prototype.forEach,HTMLCollection.prototype.length=Array.prototype.length,Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1===RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format},"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&function(view){"use strict";if("Element"in view){var elemCtrProto=view.Element.prototype,objCtr=Object,strTrim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array.prototype.indexOf||function(item){for(var i=0,len=this.length;i<len;i++)if(i in this&&this[i]===item)return i;return-1},DOMEx=function(type,message){this.name=type,this.code=DOMException[type],this.message=message},checkTokenAndGetIndex=function(classList,token){if(""===token)throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(token))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(classList,token)},ClassList=function(elem){for(var trimmedClasses=strTrim.call(elem.getAttribute("class")||""),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;i<len;i++)this.push(classes[i]);this._updateClassName=function(){elem.setAttribute("class",this.toString())}},classListProto=ClassList.prototype=[],classListGetter=function(){return new ClassList(this)};if(DOMEx.prototype=Error.prototype,classListProto.item=function(i){return this[i]||null},classListProto.contains=function(token){return token+="",-1!==checkTokenAndGetIndex(this,token)},classListProto.add=function(){var token,tokens=arguments,i=0,l=tokens.length,updated=!1;do{token=tokens[i]+"",-1===checkTokenAndGetIndex(this,token)&&(this.push(token),updated=!0)}while(++i<l);updated&&this._updateClassName()},classListProto.remove=function(){var token,tokens=arguments,i=0,l=tokens.length,updated=!1;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);-1!==index&&(this.splice(index,1),updated=!0)}while(++i<l);updated&&this._updateClassName()},classListProto.toggle=function(token,forse){token+="";var result=this.contains(token),method=result?!0!==forse&&"remove":!1!==forse&&"add";return method&&this[method](token),!result},classListProto.toString=function(){return this.join(" ")},objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:!0,configurable:!0};try{objCtr.defineProperty(elemCtrProto,"classList",classListPropDesc)}catch(ex){-2146823252===ex.number&&(classListPropDesc.enumerable=!1,objCtr.defineProperty(elemCtrProto,"classList",classListPropDesc))}}else objCtr.prototype.__defineGetter__&&elemCtrProto.__defineGetter__("classList",classListGetter)}}(self),this.Element&&function(ElementPrototype,polyfill){function NodeList(){}NodeList.prototype.length=Array.prototype.length,ElementPrototype.matchesSelector=ElementPrototype.matchesSelector||ElementPrototype.mozMatchesSelector||ElementPrototype.msMatchesSelector||ElementPrototype.oMatchesSelector||ElementPrototype.webkitMatchesSelector||function(selector){for(var results=this.parentNode.querySelectorAll(selector),resultsIndex=-1;results[++resultsIndex]&&results[resultsIndex]!=this;);return!!results[resultsIndex]},ElementPrototype.ancestorQuerySelectorAll=ElementPrototype.ancestorQuerySelectorAll||ElementPrototype.mozAncestorQuerySelectorAll||ElementPrototype.msAncestorQuerySelectorAll||ElementPrototype.oAncestorQuerySelectorAll||ElementPrototype.webkitAncestorQuerySelectorAll||function(selector){for(var cite=this,newNodeList=new NodeList;cite=cite.parentElement;)cite.matchesSelector(selector)&&Array.prototype.push.call(newNodeList,cite);return newNodeList},ElementPrototype.ancestorQuerySelector=ElementPrototype.ancestorQuerySelector||ElementPrototype.mozAncestorQuerySelector||ElementPrototype.msAncestorQuerySelector||ElementPrototype.oAncestorQuerySelector||ElementPrototype.webkitAncestorQuerySelector||function(selector){return this.ancestorQuerySelectorAll(selector)[0]||null}}(Element.prototype);var Bifrost=Bifrost||{};window,Bifrost.extend=function(destination,source){return $.extend(destination,source)};var Bifrost=Bifrost||{};Bifrost.namespace=function(ns,content){(ns=ns.replaceAll("..",".")).endsWith(".")&&(ns=ns.substr(0,ns.length-1)),ns.startsWith(".")&&(ns=ns.substr(1));var parent=window,name="";if(ns.split(".").forEach(function(part){name.length>0&&(name+="."),name+=part,Object.prototype.hasOwnProperty.call(parent,part)||(parent[part]={},parent[part].parent=parent,parent[part].name=name),parent=parent[part]}),"object"==typeof content){Bifrost.namespace.current=parent;var property;for(property in content)parent[property]=content[property];for(property in parent)parent.hasOwnProperty(property)&&(parent[property]._namespace=parent,parent[property]._name=property);Bifrost.namespace.current=null}return parent},Bifrost.namespace("Bifrost.execution",{Promise:function(){function onSignal(){null!=self.callback&&void 0!==self.callback&&(void 0!==self.signalParameter?self.callback(self.signalParameter,Bifrost.execution.Promise.create()):self.callback(Bifrost.execution.Promise.create()))}var self=this;this.id=Bifrost.Guid.create(),this.signalled=!1,this.callback=null,this.error=null,this.hasFailed=!1,this.failedCallback=null,this.fail=function(error){null!=self.failedCallback&&self.failedCallback(error),self.hasFailed=!0,self.error=error},this.onFail=function(callback){return self.hasFailed?callback(self.error):self.failedCallback=callback,self},this.signal=function(parameter){self.signalled=!0,self.signalParameter=parameter,onSignal()},this.continueWith=function(callback){return this.callback=callback,!0===self.signalled&&onSignal(),self}}}),Bifrost.execution.Promise.create=function(){return new Bifrost.execution.Promise},Bifrost.namespace("Bifrost",{isObject:function(o){return null!==o&&void 0!==o&&"[object Object]"===Object.prototype.toString.call(o)}}),Bifrost.namespace("Bifrost",{isNumber:function(number){return!(Bifrost.isString(number)&&number.length>1&&"0"===number[0])&&(!isNaN(parseFloat(number))&&isFinite(number))}}),Bifrost.namespace("Bifrost",{isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)}}),Bifrost.namespace("Bifrost",{isString:function(value){return"string"==typeof value}}),Bifrost.namespace("Bifrost",{isNull:function(value){return null===value}}),Bifrost.namespace("Bifrost",{isUndefined:function(value){return void 0===value}}),Bifrost.namespace("Bifrost",{isNullOrUndefined:function(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}}),Bifrost.namespace("Bifrost",{isFunction:function(value){return"function"==typeof value}}),Bifrost.namespace("Bifrost",{isType:function(o){return!Bifrost.isNullOrUndefined(o)&&void 0!==o._typeId}}),Bifrost.namespace("Bifrost",{functionParser:{parse:function(func){var result=[],match=func.toString().match(/function\w*\s*\((.*?)\)/);return null!==match&&match[1].split(/\s*,\s*/).forEach(function(item){item.trim().length>0&&result.push({name:item})}),result}}}),Bifrost.namespace("Bifrost",{assetsManager:{scripts:[],isInitialized:function(){return Bifrost.assetsManager.scripts.length>0},initialize:function(){var promise=Bifrost.execution.Promise.create();return Bifrost.assetsManager.isInitialized()?promise.signal():$.get("/Bifrost/AssetsManager",{extension:"js"},function(result){Bifrost.assetsManager.initializeFromAssets(result),promise.signal()},"json"),promise},initializeFromAssets:function(assets){Bifrost.assetsManager.isInitialized()||(Bifrost.assetsManager.scripts=assets,Bifrost.namespaces.create().initialize())},getScripts:function(){return Bifrost.assetsManager.scripts},hasScript:function(script){return Bifrost.assetsManager.scripts.some(function(scriptInSystem){return scriptInSystem===script})},getScriptPaths:function(){var paths=[];return Bifrost.assetsManager.scripts.forEach(function(fullPath){var path=Bifrost.Path.getPathWithoutFilename(fullPath);-1===paths.indexOf(path)&&paths.push(path)}),paths}}}),Bifrost.namespace("Bifrost",{WellKnownTypesDependencyResolver:function(){var self=this;this.types=Bifrost.WellKnownTypesDependencyResolver.types,this.canResolve=function(namespace,name){return self.types.hasOwnProperty(name)},this.resolve=function(namespace,name){return self.types[name]}}}),Bifrost.WellKnownTypesDependencyResolver.types={options:{}},Bifrost.namespace("Bifrost",{dependencyResolver:function(){function resolveImplementation(namespace,name){var resolvedSystem=null;return Bifrost.dependencyResolvers.getAll().forEach(function(resolver){null==resolvedSystem&&resolver.canResolve(namespace,name)&&(resolvedSystem=resolver.resolve(namespace,name))}),resolvedSystem}function isType(system){if(null!=system&&null!==system._super){if(void 0!==system._super&&system._super===Bifrost.Type)return!0;if(!0===isType(system._super))return!0}return!1}function handleSystemInstance(system){return isType(system)?system.create():system}function beginHandleSystemInstance(system){var promise=Bifrost.execution.Promise.create();return null!=system&&null!==system._super&&void 0!==system._super&&system._super===Bifrost.Type?system.beginCreate().continueWith(function(result,next){promise.signal(result)}):promise.signal(system),promise}return{getDependenciesFor:function(func){for(var dependencies=[],parameters=Bifrost.functionParser.parse(func),i=0;i<parameters.length;i++)dependencies.push(parameters[i].name);return dependencies},canResolve:function(namespace,name){var canResolve=!1;return Bifrost.dependencyResolvers.getAll().forEach(function(resolver){!0!==canResolve&&(canResolve=resolver.canResolve(namespace,name))}),canResolve},resolve:function(namespace,name){var resolvedSystem=resolveImplementation(namespace,name);if(void 0===resolvedSystem||null===resolvedSystem)throw console.log("Unable to resolve '"+name+"' in '"+namespace+"'"),new Bifrost.UnresolvedDependencies;if(resolvedSystem instanceof Bifrost.execution.Promise)throw console.log("'"+name+"' was resolved as an asynchronous dependency, consider using beginCreate() or make the dependency available prior to calling create"),new Bifrost.AsynchronousDependenciesDetected;return handleSystemInstance(resolvedSystem)},beginResolve:function(namespace,name){var promise=Bifrost.execution.Promise.create();return Bifrost.configure.ready(function(){var resolvedSystem=resolveImplementation(namespace,name);void 0!==resolvedSystem&&null!==resolvedSystem||(console.log("Unable to resolve '"+name+"' in '"+namespace+"'"),promise.fail(new Bifrost.UnresolvedDependencies)),resolvedSystem instanceof Bifrost.execution.Promise?resolvedSystem.continueWith(function(system,innerPromise){beginHandleSystemInstance(system).continueWith(function(actualSystem,next){promise.signal(handleSystemInstance(actualSystem))}).onFail(function(e){promise.fail(e)})}):promise.signal(handleSystemInstance(resolvedSystem))}),promise}}}()}),Bifrost.WellKnownTypesDependencyResolver.types.dependencyResolver=Bifrost.dependencyResolver,Bifrost.namespace("Bifrost",{dependencyResolvers:{getAll:function(){var resolvers=[new Bifrost.WellKnownTypesDependencyResolver,new Bifrost.DefaultDependencyResolver,new Bifrost.KnownArtifactTypesDependencyResolver,new Bifrost.KnownArtifactInstancesDependencyResolver];for(var property in this)0!==property.indexOf("_")&&this.hasOwnProperty(property)&&"function"!=typeof this[property]&&resolvers.push(this[property]);return resolvers}}}),Bifrost.namespace("Bifrost",{DefaultDependencyResolver:function(){var self=this;this.doesNamespaceHave=function(namespace,name){return namespace.hasOwnProperty(name)},this.doesNamespaceHaveScriptReference=function(namespace,name){if(namespace.hasOwnProperty("_scripts")&&Bifrost.isArray(namespace._scripts))for(var i=0;i<namespace._scripts.length;i++)if(namespace._scripts[i]===name)return!0;return!1},this.getFileName=function(namespace,name){var fileName="";return void 0!==namespace._path&&((fileName+=namespace._path).endsWith("/")||(fileName+="/")),(fileName+=name).endsWith(".js")||(fileName+=".js"),fileName=fileName.replaceAll("//","/")},this.loadScriptReference=function(namespace,name,promise){var fileName=self.getFileName(namespace,name),file=Bifrost.io.fileFactory.create().create(fileName,Bifrost.io.fileType.javaScript);Bifrost.io.fileManager.create().load([file]).continueWith(function(types){var system=types[0];self.doesNamespaceHave(namespace,name)&&(system=namespace[name]),promise.signal(system)})},this.canResolve=function(namespace,name){for(var current=namespace;null!=current&&current!==window;){if(self.doesNamespaceHave(current,name))return!0;if(self.doesNamespaceHaveScriptReference(current,name))return!0;if(current===current.parent)break;current=current.parent}return!1},this.resolve=function(namespace,name){for(var current=namespace;null!=current&&current!==window;){if(self.doesNamespaceHave(current,name))return current[name];if(self.doesNamespaceHaveScriptReference(current,name)){var promise=Bifrost.execution.Promise.create();return self.loadScriptReference(current,name,promise),promise}if(current===current.parent)break;current=current.parent}return null}}}),Bifrost.dependencyResolvers.DOMRootDependencyResolver={canResolve:function(namespace,name){return"DOMRoot"===name},resolve:function(namespace,name){if(null!=document.body&&void 0!==document.body)return document.body;var promise=Bifrost.execution.Promise.create();return Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.push(promise),promise}},Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises=[],Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady=function(){Bifrost.dependencyResolvers.DOMRootDependencyResolver.promises.forEach(function(promise){promise.signal(document.body)})},Bifrost.namespace("Bifrost",{KnownArtifactTypesDependencyResolver:function(){function isMoreSpecificNamespace(base,compareTo){var baseParts=base.name.split("."),compareToParts=compareTo.name.split(".");if(baseParts.length>compareToParts.length)return!1;for(var i=0;i<baseParts.length;i++)if(baseParts[i]!==compareToParts[i])return!1;return!0}var supportedArtifacts={readModelTypes:Bifrost.read.ReadModelOf,commandTypes:Bifrost.commands.Command,queryTypes:Bifrost.read.Query};this.canResolve=function(namespace,name){return name in supportedArtifacts},this.resolve=function(namespace,name){var resolvedTypes={};return supportedArtifacts[name].getExtendersIn(namespace).forEach(function(extender){var name=extender._name;resolvedTypes[name]&&!isMoreSpecificNamespace(resolvedTypes[name]._namespace,extender._namespace)||(resolvedTypes[name]=extender)}),resolvedTypes}}}),Bifrost.namespace("Bifrost",{KnownArtifactInstancesDependencyResolver:function(){function isMoreSpecificNamespace(base,compareTo){var baseParts=base.name.split("."),compareToParts=compareTo.name.split(".");if(baseParts.length>compareToParts.length)return!1;for(var i=0;i<baseParts.length;i++)if(baseParts[i]!==compareToParts[i])return!1;return!0}var supportedArtifacts={readModels:Bifrost.read.ReadModelOf,commands:Bifrost.commands.Command,queries:Bifrost.read.Query};this.canResolve=function(namespace,name){return name in supportedArtifacts},this.resolve=function(namespace,name){var resolvedTypes={};supportedArtifacts[name].getExtendersIn(namespace).forEach(function(extender){var name=extender._name;resolvedTypes[name]&&!isMoreSpecificNamespace(resolvedTypes[name]._namespace,extender._namespace)||(resolvedTypes[name]=extender)});var resolvedInstances={};for(var prop in resolvedTypes)resolvedInstances[prop]=resolvedTypes[prop].create();return resolvedInstances}}}),Bifrost.namespace("Bifrost",{Guid:{create:function(){function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},empty:"00000000-0000-0000-0000-000000000000"}}),Bifrost.namespace("Bifrost",{Type:function(){}}),function(){function throwIfMissingTypeDefinition(typeDefinition){if(null==typeDefinition||void 0===typeDefinition)throw new Bifrost.MissingTypeDefinition}function throwIfTypeDefinitionIsObjectLiteral(typeDefinition){if("object"==typeof typeDefinition)throw new Bifrost.ObjectLiteralNotAllowed}function addStaticProperties(typeDefinition){for(var property in Bifrost.Type)Bifrost.Type.hasOwnProperty(property)&&"_extenders"!==property&&(typeDefinition[property]=Bifrost.Type[property])}function setupDependencies(typeDefinition){typeDefinition._dependencies=Bifrost.dependencyResolver.getDependenciesFor(typeDefinition);var firstParameter=!0,createFunctionString="Function('definition', 'dependencies','return new definition(";void 0!==typeDefinition._dependencies&&typeDefinition._dependencies.forEach(function(dependency,index){firstParameter||(createFunctionString+=","),firstParameter=!1,createFunctionString+="dependencies["+index+"]"}),createFunctionString+=");')",typeDefinition.createFunction=eval(createFunctionString)}function getDependencyInstances(namespace,typeDefinition){var dependencyInstances=[];return void 0!==typeDefinition._dependencies&&typeDefinition._dependencies.forEach(function(dependency){var dependencyInstance=Bifrost.dependencyResolver.resolve(namespace,dependency);dependencyInstances.push(dependencyInstance)}),dependencyInstances}function resolve(namespace,dependency,index,instances,typeDefinition,resolvedCallback){return Bifrost.dependencyResolver.beginResolve(namespace,dependency).continueWith(function(result,nextPromise){instances[index]=result,resolvedCallback(result,nextPromise)})}function beginGetDependencyInstances(namespace,typeDefinition,instanceHash){var promise=Bifrost.execution.Promise.create(),dependencyInstances=[],solvedDependencies=0;if(void 0!==typeDefinition._dependencies)for(var dependenciesToResolve=typeDefinition._dependencies.length,dependency="",dependencyIndex=0;dependencyIndex<dependenciesToResolve;dependencyIndex++)dependency=typeDefinition._dependencies[dependencyIndex],instanceHash&&instanceHash.hasOwnProperty(dependency)?(dependencyInstances[dependencyIndex]=instanceHash[dependency],++solvedDependencies===dependenciesToResolve&&promise.signal(dependencyInstances)):resolve(namespace,dependency,dependencyIndex,dependencyInstances,typeDefinition,function(result,nextPromise){++solvedDependencies===dependenciesToResolve&&promise.signal(dependencyInstances)}).onFail(promise.fail);return promise}function expandInstancesHashToDependencies(typeDefinition,instanceHash,dependencyInstances){if(void 0!==typeDefinition._dependencies&&null!=typeDefinition._dependencies)for(var dependency in instanceHash)for(var dependencyIndex=0;dependencyIndex<typeDefinition._dependencies.length;dependencyIndex++)typeDefinition._dependencies[dependencyIndex]===dependency&&(dependencyInstances[dependencyIndex]=instanceHash[dependency])}function expandDependenciesToInstanceHash(typeDefinition,dependencies,instanceHash){for(var dependencyIndex=0;dependencyIndex<dependencies.length;dependencyIndex++)instanceHash[typeDefinition._dependencies[dependencyIndex]]=dependencies[dependencyIndex]}function resolveDependencyInstancesThatHasNotBeenResolved(dependencyInstances,typeDefinition){dependencyInstances.forEach(function(dependencyInstance,index){if(null==dependencyInstance||void 0===dependencyInstance){var dependency=typeDefinition._dependencies[index];dependencyInstances[index]=Bifrost.dependencyResolver.resolve(typeDefinition._namespace,dependency)}})}function resolveDependencyInstances(instanceHash,typeDefinition){var dependencyInstances=[];return"object"==typeof instanceHash&&expandInstancesHashToDependencies(typeDefinition,instanceHash,dependencyInstances),void 0!==typeDefinition._dependencies&&typeDefinition._dependencies.length>0&&(dependencyInstances.length>0?resolveDependencyInstancesThatHasNotBeenResolved(dependencyInstances,typeDefinition):dependencyInstances=getDependencyInstances(typeDefinition._namespace,typeDefinition)),dependencyInstances}function addMissingDependenciesAsNullFromTypeDefinition(instanceHash,typeDefinition){if(void 0!==typeDefinition._dependencies&&void 0!==instanceHash&&null!=instanceHash)for(var index=0;index<typeDefinition._dependencies.length;index++){var dependency=typeDefinition._dependencies[index];dependency in instanceHash||(instanceHash[dependency]=null)}}function handleOnCreate(type,lastDescendant,currentInstance){null!=currentInstance&&void 0!==currentInstance&&(void 0!==type&&void 0!==type.prototype&&handleOnCreate(type._super,lastDescendant,type.prototype),currentInstance.hasOwnProperty("onCreated")&&"function"==typeof currentInstance.onCreated&&currentInstance.onCreated(lastDescendant))}Bifrost.Type._extenders=[],Bifrost.Type.scope={getFor:function(namespace,name){return null}},Bifrost.Type.typeOf=function(type){return void 0!==this._super&&void 0!==this._super._typeId&&(this._super._typeId===type._typeId||void 0!==type._super&&!0===this._super.typeOf(type))},Bifrost.Type.getExtenders=function(){return this._extenders},Bifrost.Type.getExtendersIn=function(namespace){var inNamespace=[];return this._extenders.forEach(function(extender){for(var current=namespace;current!==window;){if(extender._namespace===current){inNamespace.push(extender);break}if(Bifrost.isUndefined(current.parent))break;current=current.parent}}),inNamespace},Bifrost.Type.extend=function(typeDefinition){return throwIfMissingTypeDefinition(typeDefinition),throwIfTypeDefinitionIsObjectLiteral(typeDefinition),addStaticProperties(typeDefinition),setupDependencies(typeDefinition),typeDefinition._super=this,typeDefinition._typeId=Bifrost.Guid.create(),typeDefinition._extenders=[],Bifrost.Type.registerExtender(this,typeDefinition),typeDefinition},Bifrost.Type.registerExtender=function(typeExtended,typeDefined){for(var superType=typeExtended;null!=superType;)-1===superType._extenders.indexOf(typeDefined)&&superType._extenders.push(typeDefined),superType=superType._super},Bifrost.Type.scopeTo=function(scope){return"function"==typeof scope?this.scope={getFor:scope}:"function"==typeof scope.getFor?this.scope=scope:this.scope={getFor:function(){return scope}},this},Bifrost.Type.defaultScope=function(){return this.scope={getFor:function(){return null}},this},Bifrost.Type.requires=function(){for(var argumentIndex=0;argumentIndex<arguments.length;argumentIndex++)this._dependencies.push(arguments[argumentIndex]);return this},Bifrost.Type.create=function(instanceHash,isSuper){var actualType=this;null!=this._super&&(actualType.prototype=this._super.create(instanceHash,!0)),addMissingDependenciesAsNullFromTypeDefinition(instanceHash,this);var scope=null;if(this!==Bifrost.Type&&(this.instancesPerScope=this.instancesPerScope||{},null!=(scope=this.scope.getFor(this._namespace,this._name,this._typeId))&&this.instancesPerScope.hasOwnProperty(scope)))return this.instancesPerScope[scope];var instance=null;if(void 0!==this.createFunction){var dependencyInstances=resolveDependencyInstances(instanceHash,this);instance=this.createFunction(this,dependencyInstances)}else instance=new actualType;return instance._type=actualType,!0!==isSuper&&handleOnCreate(actualType,instance,instance),null!=scope&&(this.instancesPerScope[scope]=instance),instance},Bifrost.Type.createWithoutScope=function(instanceHash,isSuper){var scope=this.scope;this.defaultScope();var instance=this.create(instanceHash,isSuper);return this.scope=scope,instance},Bifrost.Type.ensure=function(){var promise=Bifrost.execution.Promise.create(),loadedDependencies=0,dependenciesToResolve=this._dependencies.length,namespace=this._namespace,resolver=Bifrost.dependencyResolver;return dependenciesToResolve>0?this._dependencies.forEach(function(dependency){resolver.canResolve(namespace,dependency)?resolver.beginResolve(namespace,dependency).continueWith(function(resolvedSystem){++loadedDependencies===dependenciesToResolve&&promise.signal()}):loadedDependencies===--dependenciesToResolve&&promise.signal()}):promise.signal(),promise},Bifrost.Type.beginCreate=function(instanceHash){var self=this,promise=Bifrost.execution.Promise.create(),superPromise=Bifrost.execution.Promise.create();return superPromise.onFail(function(e){promise.fail(e)}),null!=this._super?this._super.beginCreate(instanceHash).continueWith(function(_super,nextPromise){superPromise.signal(_super)}).onFail(function(e){promise.fail(e)}):superPromise.signal(null),superPromise.continueWith(function(_super,nextPromise){if(self.prototype=_super,null==self._dependencies||void 0===self._dependencies||0===self._dependencies.length){var instance=self.create(instanceHash);promise.signal(instance)}else beginGetDependencyInstances(self._namespace,self,instanceHash).continueWith(function(dependencies,nextPromise){var dependencyInstances={};if(expandDependenciesToInstanceHash(self,dependencies,dependencyInstances),"object"==typeof instanceHash)for(var property in instanceHash)dependencyInstances[property]=instanceHash[property];try{var instance=self.create(dependencyInstances);promise.signal(instance)}catch(e){promise.fail(e)}})}),promise}}(),Bifrost.namespace("Bifrost",{Singleton:function(typeDefinition){return Bifrost.Type.extend(typeDefinition).scopeTo(window)}}),Bifrost.namespace("Bifrost.types",{TypeInfo:Bifrost.Type.extend(function(){this.properties=[]})}),Bifrost.types.TypeInfo.createFrom=function(instance){var propertyInfo,typeInfo=Bifrost.types.TypeInfo.create();for(var property in instance){var value=instance[property];if(!Bifrost.isNullOrUndefined(value)){var type=value.constructor;Bifrost.isNullOrUndefined(instance[property]._type)||(type=instance[property]._type),propertyInfo=Bifrost.types.PropertyInfo.create({name:property,type:type})}typeInfo.properties.push(propertyInfo)}return typeInfo},Bifrost.namespace("Bifrost.types",{PropertyInfo:Bifrost.Type.extend(function(name,type){this.name=name,this.type=type})}),Bifrost.namespace("Bifrost",{Path:Bifrost.Type.extend(function(fullPath){var self=this,splitDeviceRe=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?([\\\/])?([\s\S]*?)$/,splitTailRe=/^([\s\S]+[\\\/](?!$)|[\\\/])?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/\\]*)?)$/,result=function(filename){var result=splitDeviceRe.exec(filename),device=(result[1]||"")+(result[2]||""),tail=result[3]||"",result2=splitTailRe.exec(tail);return[device,result2[1]||"",result2[2]||"",result2[3]||""]}(fullPath=function(filename){var queryStringStart=filename.indexOf("?");return queryStringStart>0&&(filename=filename.substr(0,queryStringStart)),filename}(fullPath));this.device=result[0]||"",this.directory=result[1]||"",this.filename=result[2]||"",this.extension=result[3]||"",this.filenameWithoutExtension=this.filename.replaceAll(this.extension,""),this.fullPath=fullPath,this.hasExtension=function(){return!Bifrost.isNullOrUndefined(self.extension)&&""!==self.extension}})}),Bifrost.Path.makeRelative=function(fullPath){return 0===fullPath.indexOf("/")?fullPath.substr(1):fullPath},Bifrost.Path.getPathWithoutFilename=function(fullPath){var lastIndex=fullPath.lastIndexOf("/");return fullPath.substr(0,lastIndex)},Bifrost.Path.getFilename=function(fullPath){var lastIndex=fullPath.lastIndexOf("/");return fullPath.substr(lastIndex+1)},Bifrost.Path.getFilenameWithoutExtension=function(fullPath){var filename=this.getFilename(fullPath),lastIndex=filename.lastIndexOf(".");return filename.substr(0,lastIndex)},Bifrost.Path.hasExtension=function(path){return path.indexOf("?")>0&&(path=path.substr(0,path.indexOf("?"))),path.lastIndexOf(".")>0},Bifrost.Path.changeExtension=function(fullPath,newExtension){var path=Bifrost.Path.create({fullPath:fullPath});return path.directory+path.filenameWithoutExtension+"."+newExtension},Bifrost.namespace("Bifrost"),Bifrost.DefinitionMustBeFunction=function(message){this.prototype=Error.prototype,this.name="DefinitionMustBeFunction",this.message=message||"Definition must be function"},Bifrost.MissingName=function(message){this.prototype=Error.prototype,this.name="MissingName",this.message=message||"Missing name"},Bifrost.Exception=function(global,undefined){function throwIfNameMissing(name){if(!name||void 0===name)throw new Bifrost.MissingName}function throwIfDefinitionNotAFunction(definition){if("function"!=typeof definition)throw new Bifrost.DefinitionMustBeFunction}function getExceptionName(name){var lastDot=name.lastIndexOf(".");return-1===lastDot&&lastDot!==name.length?name:name.substr(lastDot+1)}function defineAndGetTargetScope(name){var lastDot=name.lastIndexOf(".");if(-1===lastDot)return global;var ns=name.substr(0,lastDot);Bifrost.namespace(ns);var scope=global;return ns.split(".").forEach(function(part){scope=scope[part]}),scope}return{define:function(name,defaultMessage,definition){throwIfNameMissing(name);var scope=defineAndGetTargetScope(name),exceptionName=getExceptionName(name),exception=function(message){this.name=exceptionName,this.message=message||defaultMessage};exception.prototype=Error.prototype,definition&&void 0!==definition&&(throwIfDefinitionNotAFunction(definition),definition.prototype=Error.prototype,exception.prototype=new definition),scope[exceptionName]=exception}}}(window),Bifrost.namespace("Bifrost"),Bifrost.Exception.define("Bifrost.LocationNotSpecified","Location was not specified"),Bifrost.Exception.define("Bifrost.InvalidUriFormat","Uri format specified is not valid"),Bifrost.Exception.define("Bifrost.ObjectLiteralNotAllowed","Object literal is not allowed"),Bifrost.Exception.define("Bifrost.MissingTypeDefinition","Type definition was not specified"),Bifrost.Exception.define("Bifrost.AsynchronousDependenciesDetected","You should consider using Type.beginCreate() or dependencyResolver.beginResolve() for systems that has asynchronous dependencies"),Bifrost.Exception.define("Bifrost.UnresolvedDependencies","Some dependencies was not possible to resolve"),Bifrost.namespace("Bifrost"),Bifrost.hashString={decode:function(a){if(""===a)return{};a=a.replace("/?","").split("&");for(var b={},i=0;i<a.length;++i){var p=a[i].split("=",2);if(2===p.length){var value=decodeURIComponent(p[1].replace(/\+/g," "));""===value||isNaN(value)||(value=parseFloat(value)),b[p[0]]=value}}return b}},Bifrost.namespace("Bifrost"),Bifrost.Uri=function(window,undefined){function parseUri(sourceUri){for(var uriPartNames=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],uriParts=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(sourceUri),uri={},i=0;i<10;i++)uri[uriPartNames[i]]=uriParts[i]?uriParts[i]:"";return uri.directoryPath.length>0&&(uri.directoryPath=uri.directoryPath.replace(/\/?$/,"/")),uri}function Uri(location){var self=this;this.setLocation=function(location){self.fullPath=location;var result=parseUri(location=location.replace("#!","/"));if(!result.protocol||void 0===result.protocol)throw new Bifrost.InvalidUriFormat("Uri ('"+location+"') was in the wrong format");self.scheme=result.protocol,self.host=result.domain,self.path=result.path,self.anchor=result.anchor,self.queryString=result.query,self.port=parseInt(result.port),self.parameters=Bifrost.hashString.decode(result.query),self.parameters=Bifrost.extend(Bifrost.hashString.decode(result.anchor),self.parameters),self.isSameAsOrigin=window.location.protocol===result.protocol+":"&&window.location.hostname===self.host},this.setLocation(location)}function throwIfLocationNotSpecified(location){if(!location||void 0===location)throw new Bifrost.LocationNotSpecified}return{create:function(location){return throwIfLocationNotSpecified(location),new Uri(location)},isAbsolute:function(url){return new RegExp("^(?:[a-z]+:)?//","i").test(url)}}}(window),Bifrost.namespace("Bifrost",{namespaces:Bifrost.Singleton(function(){var self=this;this.stripPath=function(path){return path.startsWith("/")&&(path=path.substr(1)),path.endsWith("/")&&(path=path.substr(0,path.length-1)),path},this.initialize=function(){var scripts=Bifrost.assetsManager.getScripts();void 0!==scripts&&scripts.forEach(function(fullPath){var path=Bifrost.Path.getPathWithoutFilename(fullPath);path=self.stripPath(path);for(var mapperKey in Bifrost.namespaceMappers){var mapper=Bifrost.namespaceMappers[mapperKey];if("function"==typeof mapper.hasMappingFor&&mapper.hasMappingFor(path)){var namespacePath=mapper.resolve(path),namespace=Bifrost.namespace(namespacePath),root="/"+path+"/";namespace._path=root,void 0===namespace._scripts&&(namespace._scripts=[]);var fileIndex=fullPath.lastIndexOf("/"),file=fullPath.substr(fileIndex+1),extensionIndex=file.lastIndexOf("."),system=file.substr(0,extensionIndex);namespace._scripts.push(system)}}})}})}),Bifrost.namespace("Bifrost",{namespaceMappers:{mapPathToNamespace:function(path){for(var mapperKey in Bifrost.namespaceMappers){var mapper=Bifrost.namespaceMappers[mapperKey];if("function"==typeof mapper.hasMappingFor&&mapper.hasMappingFor(path))return mapper.resolve(path)}return null}}}),Bifrost.namespace("Bifrost",{StringMapping:Bifrost.Type.extend(function(format,mappedFormat){this.format=format,this.mappedFormat=mappedFormat;new RegExp("{[a-zA-Z]+}","g");var wildcardRegex=new RegExp("\\*{2}[//||.]","g"),combinedRegex=new RegExp("({[a-zA-Z]+})*(\\*{2}[//||.])*","g"),components=[],resolveExpression=format.replace(combinedRegex,function(match){return void 0===match||""===match?"":(components.push(match),0===match.indexOf("**")?"([\\w.//]*)":"([\\w.]*)")}),mappedFormatWildcardMatch=mappedFormat.match(wildcardRegex),formatRegex=new RegExp(resolveExpression);this.matches=function(input){return!!input.match(formatRegex)},this.getValues=function(input){var output={},match=input.match(formatRegex);return components.forEach(function(c,i){var component=c.substr(1,c.length-2),value=match[i+2];0!==c.indexOf("**")&&(output[component]=value)}),output},this.resolve=function(input){var match=input.match(formatRegex),result=mappedFormat,wildcardOffset=0;return components.forEach(function(c,i){var value=match[i+1];if(0===c.indexOf("**")){var wildcard=mappedFormatWildcardMatch[wildcardOffset];value=value.replaceAll(c[2],wildcard[2]),result=result.replace(wildcard,value),wildcardOffset++}else result=result.replace(c,value)}),result}})}),Bifrost.namespace("Bifrost",{stringMappingFactory:Bifrost.Singleton(function(){this.create=function(format,mappedFormat){return Bifrost.StringMapping.create({format:format,mappedFormat:mappedFormat})}})}),Bifrost.namespace("Bifrost",{StringMapper:Bifrost.Type.extend(function(stringMappingFactory){function hasMappingFor(mappings,input){var found=!1;return mappings.some(function(m){return m.matches(input)&&(found=!0),found}),found}function getMappingFor(mappings,input){var found;if(mappings.some(function(m){if(m.matches(input))return found=m,!0}),void 0!==found)return found;throw{name:"ArgumentError",message:"String mapping for ("+input+") could not be found"}}function resolve(mappings,input){try{if(null===input||void 0===input)return"";var mapping=self.getMappingFor(input);return Bifrost.isNullOrUndefined(mapping)?"":mapping.resolve(input)}catch(e){return""}}var self=this;this.stringMappingFactory=stringMappingFactory,this.mappings=[],this.reverseMappings=[],this.hasMappingFor=function(input){return hasMappingFor(self.mappings,input)},this.getMappingFor=function(input){return getMappingFor(self.mappings,input)},this.resolve=function(input){return resolve(self.mappings,input)},this.reverse={hasMappingFor:function(input){return self.hasMappingFor(self.reverseMappings,input)},getMappingFor:function(input){return self.getMappingFor(self.reverseMappings,input)},resolve:function(input){return self.resolve(self.reverseMappings,input)}},this.addMapping=function(format,mappedFormat){var mapping=self.stringMappingFactory.create(format,mappedFormat);self.mappings.push(mapping);var reverseMapping=self.stringMappingFactory.create(mappedFormat,format);self.reverseMappings.push(reverseMapping)}})}),Bifrost.namespace("Bifrost",{uriMappers:{}}),Bifrost.namespace("Bifrost",{server:Bifrost.Singleton(function(){function deserialize(data){if(Bifrost.isArray(data)){var items=[];return data.forEach(function(item){items.push(deserialize(item))}),items}for(var property in data)if(Bifrost.isArray(data[property]))data[property]=deserialize(data[property]);else{var value=data[property];Bifrost.isNumber(value)?data[property]=parseFloat(value):data[property]=data[property]}return data}var self=this;this.target="",this.defaultParameters={},this.post=function(url,parameters){var promise=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(url)||(url=self.target+url);var actualParameters={};Bifrost.extend(actualParameters,self.defaultParameters);for(var property in parameters)actualParameters[property]=JSON.stringify(parameters[property]);return $.ajax({url:url,type:"POST",dataType:"json",data:JSON.stringify(actualParameters),contentType:"application/json; charset=utf-8",complete:function(result){var data=$.parseJSON(result.responseText);deserialize(data),promise.signal(data)},error:function(jqXHR,textStatus,errorThrown){promise.fail(jqXHR)}}),promise},this.get=function(url,parameters){var promise=Bifrost.execution.Promise.create();Bifrost.Uri.isAbsolute(url)||(url=self.target+url);var actualParameters={};if(Bifrost.extend(actualParameters,self.defaultParameters),Bifrost.isObject(parameters))for(var parameterName in parameters)Bifrost.isArray(parameters[parameterName])?actualParameters[parameterName]=JSON.stringify(parameters[parameterName]):actualParameters[parameterName]=parameters[parameterName];return $.ajax({url:url,type:"GET",dataType:"json",data:actualParameters,contentType:"application/json; charset=utf-8",complete:function(result,textStatus){var data=$.parseJSON(result.responseText);deserialize(data),promise.signal(data)},error:function(jqXHR,textStatus,errorThrown){promise.fail(jqXHR)}}),promise}})}),Bifrost.WellKnownTypesDependencyResolver.types.server=Bifrost.server,Bifrost.namespace("Bifrost",{areEqual:function(source,target){if(ko.isObservable(source)&&(source=source()),ko.isObservable(target)&&(target=target()),Bifrost.isNullOrUndefined(source)&&Bifrost.isNullOrUndefined(target))return!0;if(Bifrost.isNullOrUndefined(source))return!1;if(Bifrost.isNullOrUndefined(target))return!1;if(Bifrost.isArray(source)&&Bifrost.isArray(target)){if(source.length!==target.length)return!1;for(var index=0;index<source.length;index++)if(!1===Bifrost.areEqual(source[index],target[index]))return!1}else for(var member in source)if(!function(member){return member.indexOf("_")>=0||"model"===member||"commons"===member||"targetViewModel"===member||"region"===member}(member)){if(!target.hasOwnProperty(member))return!1;var sourceValue=source[member],targetValue=target[member];if(Bifrost.isObject(sourceValue)||Bifrost.isArray(sourceValue)||ko.isObservable(sourceValue)){if(!Bifrost.areEqual(sourceValue,targetValue))return!1}else if(sourceValue!==targetValue)return!1}return!0}}),Bifrost.namespace("Bifrost",{deepClone:function(source,target){ko.isObservable(source)&&(source=source()),null==target&&(target=Bifrost.isArray(source)?[]:{});var sourceValue;if(Bifrost.isArray(source))for(var index=0;index<source.length;index++){sourceValue=source[index];var clonedValue=Bifrost.deepClone(sourceValue);target.push(clonedValue)}else for(var member in source)if(!function(member){return member.indexOf("_")>=0||"model"===member||"commons"===member||"targetViewModel"===member||"region"===member}(member)&&(sourceValue=source[member],ko.isObservable(sourceValue)&&(sourceValue=sourceValue()),!Bifrost.isFunction(sourceValue))){var targetValue=null;Bifrost.isObject(sourceValue)?targetValue={}:Bifrost.isArray(sourceValue)?targetValue=[]:target[member]=sourceValue,null!=targetValue&&(target[member]=targetValue,Bifrost.deepClone(sourceValue,targetValue))}return target}}),Bifrost.namespace("Bifrost",{systemClock:Bifrost.Singleton(function(){this.nowInMilliseconds=function(){return window.performance.now()}})}),Bifrost.namespace("Bifrost",{TimeSpan:function(milliseconds,seconds,minutes,hours,days){var msecs=0,isNumeric=function(input){return!isNaN(parseFloat(input))&&isFinite(input)};isNumeric(days)&&(msecs+=864e5*days),isNumeric(hours)&&(msecs+=36e5*hours),isNumeric(minutes)&&(msecs+=6e4*minutes),isNumeric(seconds)&&(msecs+=1e3*seconds),isNumeric(milliseconds)&&(msecs+=milliseconds),this.addMilliseconds=function(milliseconds){isNumeric(milliseconds)&&(msecs+=milliseconds)},this.addSeconds=function(seconds){isNumeric(seconds)&&(msecs+=1e3*seconds)},this.addMinutes=function(minutes){isNumeric(minutes)&&(msecs+=6e4*minutes)},this.addHours=function(hours){isNumeric(hours)&&(msecs+=36e5*hours)},this.addDays=function(days){isNumeric(days)&&(msecs+=864e5*days)},this.subtractMilliseconds=function(milliseconds){isNumeric(milliseconds)&&(msecs-=milliseconds)},this.subtractSeconds=function(seconds){isNumeric(seconds)&&(msecs-=1e3*seconds)},this.subtractMinutes=function(minutes){isNumeric(minutes)&&(msecs-=6e4*minutes)},this.subtractHours=function(hours){isNumeric(hours)&&(msecs-=36e5*hours)},this.subtractDays=function(days){isNumeric(days)&&(msecs-=864e5*days)},this.isTimeSpan=!0,this.add=function(otherTimeSpan){otherTimeSpan.isTimeSpan&&(msecs+=otherTimeSpan.totalMilliseconds())},this.subtract=function(otherTimeSpan){otherTimeSpan.isTimeSpan&&(msecs-=otherTimeSpan.totalMilliseconds())},this.equals=function(otherTimeSpan){if(otherTimeSpan.isTimeSpan)return msecs===otherTimeSpan.totalMilliseconds()},this.totalMilliseconds=function(roundDown){var result=msecs;return!0===roundDown&&(result=Math.floor(result)),result},this.totalSeconds=function(roundDown){var result=msecs/1e3;return!0===roundDown&&(result=Math.floor(result)),result},this.totalMinutes=function(roundDown){var result=msecs/6e4;return!0===roundDown&&(result=Math.floor(result)),result},this.totalHours=function(roundDown){var result=msecs/36e5;return!0===roundDown&&(result=Math.floor(result)),result},this.totalDays=function(roundDown){var result=msecs/864e5;return!0===roundDown&&(result=Math.floor(result)),result},this.milliseconds=function(){return msecs%1e3},this.seconds=function(){return Math.floor(msecs/1e3)%60},this.minutes=function(){return Math.floor(msecs/6e4)%60},this.hours=function(){return Math.floor(msecs/36e5)%24},this.days=function(){return Math.floor(msecs/864e5)},this.getVersion=function(){return"1.2"}}}),Bifrost.TimeSpan.zero=function(){return new Bifrost.TimeSpan(0,0,0,0,0)},Bifrost.TimeSpan.fromMilliseconds=function(milliseconds){return new Bifrost.TimeSpan(milliseconds,0,0,0,0)},Bifrost.TimeSpan.fromSeconds=function(seconds){return new Bifrost.TimeSpan(0,seconds,0,0,0)},Bifrost.TimeSpan.fromMinutes=function(minutes){return new Bifrost.TimeSpan(0,0,minutes,0,0)},Bifrost.TimeSpan.fromHours=function(hours){return new Bifrost.TimeSpan(0,0,0,hours,0)},Bifrost.TimeSpan.fromDays=function(days){return new Bifrost.TimeSpan(0,0,0,0,days)},Bifrost.TimeSpan.fromDates=function(firstDate,secondDate,forcePositive){var differenceMsecs=secondDate.valueOf()-firstDate.valueOf();return!0===forcePositive&&(differenceMsecs=Math.abs(differenceMsecs)),new Bifrost.TimeSpan(differenceMsecs,0,0,0,0)},Bifrost.namespace("Bifrost",{Event:Bifrost.Type.extend(function(){var subscribers=[];this.subscribe=function(subscriber){subscribers.push(subscriber)},this.trigger=function(data){subscribers.forEach(function(subscriber){subscriber(data)})}})}),Bifrost.namespace("Bifrost",{systemEvents:Bifrost.Singleton(function(){this.readModels=Bifrost.read.readModelSystemEvents.create(),this.commands=Bifrost.commands.commandEvents.create()})}),Bifrost.WellKnownTypesDependencyResolver.types.systemEvents=Bifrost.systemEvents,Bifrost.namespace("Bifrost",{dispatcher:Bifrost.Singleton(function(){this.schedule=function(milliseconds,callback){setTimeout(callback,milliseconds)}})}),ko.extenders.linked=function(target,options){function setupValueSubscription(value){if(ko.isObservable(value)){var subscription=value.subscribe(function(){target.valueHasMutated()});target._previousLinkedSubscription=subscription}}target.subscribe(function(newValue){target._previousLinkedSubscription&&target._previousLinkedSubscription.dispose(),setupValueSubscription(newValue)}),setupValueSubscription(target())},Bifrost.namespace("Bifrost.hubs",{hubConnection:Bifrost.Singleton(function(){var self=this,hub=$.hubConnection("/signalr",{useDefaultPath:!1});$.signalR.hub=hub,this.isConnected=!1,this.connected=Bifrost.Event.create(),this.createProxy=function(hubName){return hub.createHubProxy(hubName)},$.connection.hub.start().done(function(){console.log("Hub connection up and running"),self.isConnected=!0,self.connected.trigger()})})}),Bifrost.WellKnownTypesDependencyResolver.types.hubConnection=Bifrost.hubs.hubConnection,Bifrost.namespace("Bifrost.hubs",{Hub:Bifrost.Type.extend(function(hubConnection){function makeClientProxyFunction(callback){return function(){callback.apply(self,arguments)}}function makeInvocationFunction(promise,method,args){return function(){for(var argumentsAsArray=[],arg=0;arg<args.length;arg++)argumentsAsArray.push(args[arg]);var allArguments=[method].concat(argumentsAsArray);proxy.invoke.apply(proxy,allArguments).done(function(result){promise.signal(result)})}}var self=this,proxy=null;this._name="",this.client=function(callback){var client={};callback(client);for(var property in client){var value=client[property];Bifrost.isFunction(value)&&proxy.on(property,makeClientProxyFunction(value))}},this.server={};var delayedServerInvocations=[];hubConnection.connected.subscribe(function(){delayedServerInvocations.forEach(function(invocationFunction){invocationFunction()})}),this.invokeServerMethod=function(method,args){var promise=Bifrost.execution.Promise.create(),invocationFunction=makeInvocationFunction(promise,method,args);return!1===hubConnection.isConnected?delayedServerInvocations.push(invocationFunction):invocationFunction(),promise},this.onCreated=function(lastDescendant){proxy=hubConnection.createProxy(lastDescendant._name)}})}),Bifrost.dependencyResolvers.hub={canResolve:function(namespace,name){return"undefined"!=typeof hubs&&name in hubs},resolve:function(namespace,name){return hubs[name].create()}},Bifrost.namespace("Bifrost.io",{fileType:{unknown:0,text:1,javaScript:2,html:3}}),Bifrost.namespace("Bifrost.io",{File:Bifrost.Type.extend(function(path){this.type=Bifrost.io.fileType.unknown,this.path=Bifrost.Path.create({fullPath:path})})}),Bifrost.namespace("Bifrost.io",{fileFactory:Bifrost.Singleton(function(){this.create=function(path,fileType){var file=Bifrost.io.File.create({path:path});return Bifrost.isNullOrUndefined(fileType)||(file.fileType=fileType),file}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileFactory=Bifrost.io.fileFactory,Bifrost.namespace("Bifrost.io",{fileManager:Bifrost.Singleton(function(){function getActualFilename(filename){var actualFilename=self.origin;return 0!==filename.indexOf("/")&&(actualFilename+="/"),actualFilename+=filename}var self=this,uri=Bifrost.Uri.create(window.location.href);if("file:"===window.location.protocol)this.origin=window.location.href,this.origin=this.origin.substr(0,this.origin.lastIndexOf("/")),this.origin.lastIndexOf("/")===this.origin.length-1&&(this.origin=this.origin.substr(0,this.origin.length-1));else{var port=uri.port||"";Bifrost.isUndefined(port)||""===port||80===port||(port=":"+port),this.origin=uri.scheme+"://"+uri.host+port}this.load=function(files){var filesToLoad=[],promise=Bifrost.execution.Promise.create();return files.forEach(function(file){var path=getActualFilename(file.path.fullPath);file.fileType===Bifrost.io.fileType.html&&(path="text!"+path+"!strip"),filesToLoad.push(path)}),require(filesToLoad,function(){promise.signal(arguments)}),promise}})}),Bifrost.WellKnownTypesDependencyResolver.types.fileManager=Bifrost.io.fileManager,Bifrost.namespace("Bifrost.specifications",{Specification:Bifrost.Type.extend(function(){var self=this,currentInstance=ko.observable();this.evaluator=null,this.isSatisfied=ko.computed(function(){if(ko.isObservable(self.evaluator))return self.evaluator();var instance=currentInstance();return!Bifrost.isNullOrUndefined(instance)&&self.evaluator(instance)}),this.evaluate=function(instance){return currentInstance(instance),self.isSatisfied()},this.and=function(rule){if(Bifrost.isFunction(rule)){var oldRule=rule;(rule=Bifrost.specifications.Specification.create()).evaluator=oldRule}return Bifrost.specifications.And.create(this,rule)},this.or=function(rule){if(Bifrost.isFunction(rule)){var oldRule=rule;(rule=Bifrost.specifications.Specification.create()).evaluator=oldRule}return Bifrost.specifications.Or.create(this,rule)}})}),Bifrost.specifications.Specification.when=function(evaluator){var rule=Bifrost.specifications.Specification.create();return rule.evaluator=evaluator,rule},Bifrost.namespace("Bifrost.specifications",{And:Bifrost.specifications.Specification.extend(function(leftHandSide,rightHandSide){this.isSatisfied=ko.computed(function(){return leftHandSide.isSatisfied()&&rightHandSide.isSatisfied()}),this.evaluate=function(instance){leftHandSide.evaluate(instance),rightHandSide.evaluate(instance)}})}),Bifrost.namespace("Bifrost.specifications",{Or:Bifrost.specifications.Specification.extend(function(leftHandSide,rightHandSide){this.isSatisfied=ko.computed(function(){return leftHandSide.isSatisfied()||rightHandSide.isSatisfied()}),this.evaluate=function(instance){leftHandSide.evaluate(instance),rightHandSide.evaluate(instance)}})}),Bifrost.namespace("Bifrost.tasks",{Task:Bifrost.Type.extend(function(){var self=this;this.errors=ko.observableArray(),this.isExecuting=ko.observable(!1),this.execute=function(){var promise=Bifrost.execution.Promise.create();return promise.signal(),promise},this.reportError=function(error){self.errors.push(error)}})}),Bifrost.namespace("Bifrost.tasks",{TaskHistoryEntry:Bifrost.Type.extend(function(){var self=this;this.type="",this.content="",this.begin=ko.observable(),this.end=ko.observable(),this.total=ko.computed(function(){return Bifrost.isNullOrUndefined(self.end())||Bifrost.isNullOrUndefined(self.begin())?0:self.end()-self.begin()}),this.result=ko.observable(),this.error=ko.observable(),this.isFinished=ko.computed(function(){return!Bifrost.isNullOrUndefined(self.end())}),this.hasFailed=ko.computed(function(){return!Bifrost.isNullOrUndefined(self.error())}),this.isSuccess=ko.computed(function(){return self.isFinished()&&!self.hasFailed()})})}),Bifrost.namespace("Bifrost.tasks",{taskHistory:Bifrost.Singleton(function(systemClock){var self=this,entriesById={};this.entries=ko.observableArray(),this.begin=function(task){var id=Bifrost.Guid.create();try{var entry=Bifrost.tasks.TaskHistoryEntry.create();entry.type=task._type._name;var content={};for(var property in task)0!==property.indexOf("_")&&task.hasOwnProperty(property)&&"function"!=typeof task[property]&&(content[property]=task[property]);entry.content=JSON.stringify(content),entry.begin(systemClock.nowInMilliseconds()),entriesById[id]=entry,self.entries.push(entry)}catch(ex){}return id},this.end=function(id,result){if(entriesById.hasOwnProperty(id)){var entry=entriesById[id];entry.end(systemClock.nowInMilliseconds()),entry.result(result)}},this.failed=function(id,error){if(entriesById.hasOwnProperty(id)){var entry=entriesById[id];entry.end(systemClock.nowInMilliseconds()),entry.error(error)}}})}),Bifrost.WellKnownTypesDependencyResolver.types.taskHistory=Bifrost.tasks.taskHistory,Bifrost.namespace("Bifrost.tasks",{Tasks:Bifrost.Type.extend(function(taskHistory){function executeTaskIfNotExecuting(task){if(!0!==task.isExecuting()){task.isExecuting(!0);var taskHistoryId=taskHistory.begin(task);task.execute().continueWith(function(result){self.unfiltered.remove(task),taskHistory.end(taskHistoryId,result),task.promise.signal(result)}).onFail(function(error){self.unfiltered.remove(task),self.errors.push(task),taskHistory.failed(taskHistoryId,error),task.promise.fail(error)})}}var self=this;this.unfiltered=ko.observableArray(),this.canExecuteWhen=ko.observable(),this.all=ko.computed(function(){var all=self.unfiltered(),rule=self.canExecuteWhen();if(!Bifrost.isNullOrUndefined(rule)){var filtered=[];return all.forEach(function(task){rule.evaluate(task),!0===rule.isSatisfied()&&filtered.push(task)}),filtered}return all}),this.errors=ko.observableArray(),this.isBusy=ko.computed(function(){return self.all().length>0}),this.all.subscribe(function(changedTasks){changedTasks.forEach(function(task){executeTaskIfNotExecuting(task)})}),this.execute=function(task){task.promise=Bifrost.execution.Promise.create(),self.unfiltered.push(task);var rule=self.canExecuteWhen(),canExecute=!0;return Bifrost.isNullOrUndefined(rule)||(canExecute=rule.evaluate(task)),!0===canExecute&&executeTaskIfNotExecuting(task),task.promise}})}),Bifrost.namespace("Bifrost.tasks",{tasksFactory:Bifrost.Singleton(function(){this.create=function(){return Bifrost.tasks.Tasks.create()}})}),Bifrost.WellKnownTypesDependencyResolver.types.tasksFactory=Bifrost.tasks.tasksFactory,Bifrost.namespace("Bifrost.tasks",{HttpGetTask:Bifrost.tasks.Task.extend(function(server,url,payload){this.execute=function(){var promise=Bifrost.execution.Promise.create();return server.get(url,payload).continueWith(function(result){promise.signal(result)}).onFail(function(error){promise.fail(error)}),promise}})}),Bifrost.namespace("Bifrost.tasks",{HttpPostTask:Bifrost.tasks.Task.extend(function(server,url,payload){this.execute=function(){var promise=Bifrost.execution.Promise.create();return server.post(url,payload).continueWith(function(result){promise.signal(result)}).onFail(function(error){promise.fail(error)}),promise}})}),Bifrost.namespace("Bifrost.tasks",{LoadTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){var promise=Bifrost.execution.Promise.create();return promise.signal(),promise}})}),Bifrost.namespace("Bifrost.tasks",{FileLoadTask:Bifrost.tasks.LoadTask.extend(function(files,fileManager){this.files=files;var self=this;this.files=[],files.forEach(function(file){self.files.push(file.path.fullPath)}),this.execute=function(){var promise=Bifrost.execution.Promise.create();return fileManager.load(files).continueWith(function(instances){promise.signal(instances)}),promise}})}),Bifrost.namespace("Bifrost.tasks",{ExecutionTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost",{taskFactory:Bifrost.Singleton(function(){this.createHttpPost=function(url,payload){return Bifrost.tasks.HttpPostTask.create({url:url,payload:payload})},this.createHttpGet=function(url,payload){return Bifrost.tasks.HttpGetTask.create({url:url,payload:payload})},this.createQuery=function(query,paging){return Bifrost.read.QueryTask.create({query:query,paging:paging})},this.createReadModel=function(readModelOf,propertyFilters){return Bifrost.read.ReadModelTask.create({readModelOf:readModelOf,propertyFilters:propertyFilters})},this.createHandleCommand=function(command){return Bifrost.commands.HandleCommandTask.create({command:command})},this.createHandleCommands=function(commands){return Bifrost.commands.HandleCommandsTask.create({commands:commands})},this.createViewLoad=function(files){return Bifrost.views.ViewLoadTask.create({files:files})},this.createViewModelLoad=function(files){return Bifrost.views.ViewModelLoadTask.create({files:files})},this.createFileLoad=function(files){return Bifrost.tasks.FileLoadTask.create({files:files})}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.Exception.define("Bifrost.validation.OptionsNotDefined","Option was undefined"),Bifrost.Exception.define("Bifrost.validation.OptionsValueNotSpecified","Required value in Options is not specified. "),Bifrost.Exception.define("Bifrost.validation.NotANumber","Value is not a number"),Bifrost.Exception.define("Bifrost.validation.NotAString","Value is not a string"),Bifrost.Exception.define("Bifrost.validation.ValueNotSpecified","Value is not specified"),Bifrost.Exception.define("Bifrost.validation.MinNotSpecified","Min is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxNotSpecified","Max is not specified"),Bifrost.Exception.define("Bifrost.validation.MinLengthNotSpecified","Min length is not specified"),Bifrost.Exception.define("Bifrost.validation.MaxLengthNotSpecified","Max length is not specified"),Bifrost.Exception.define("Bifrost.validation.MissingExpression","Expression is not specified"),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.ruleHandlers=Bifrost.validation.ruleHandlers||{},Bifrost.namespace("Bifrost.validation",{Rule:Bifrost.Type.extend(function(options){options=options||{},this.message=options.message||"",this.options={},Bifrost.extend(this.options,options),this.validate=function(value){return!0}})}),Bifrost.namespace("Bifrost.validation"),Bifrost.validation.Validator=function(){function Validator(options){var self=this;this.isValid=ko.observable(!0),this.message=ko.observable(""),this.rules=[],this.isRequired=!1,options=options||{},this.setOptions=function(options){for(var property in options)Bifrost.validation.Rule.getExtenders().some(function(ruleType){if(ruleType._name===property){var rule=ruleType.create({options:options[property]||{}});self.rules.push(rule)}"required"===ruleType._name&&(self.isRequired=!0)})},this.validate=function(value){self.isValid(!0),self.message(""),value=ko.utils.unwrapObservable(value),self.rules.some(function(rule){if(!rule.validate(value))return self.isValid(!1),self.message(rule.message),!0;self.isValid(!0),self.message("")})},this.validateSilently=function(value){self.rules.some(function(rule){if(!rule.validate(value))return self.isValid(!1),!0;self.isValid(!0)})},this.setOptions(options)}return{create:function(options){return new Validator(options)},applyTo:function(itemOrItems,options){function applyToItem(item){var validator=self.create(options);item.validator=validator}var self=this;itemOrItems instanceof Array?itemOrItems.forEach(function(item){applyToItem(item)}):applyToItem(itemOrItems)},applyToProperties:function(item,options){var items=[];for(var property in item)item.hasOwnProperty(property)&&items.push(item[property]);this.applyTo(items,options)}}}(),"undefined"!=typeof ko&&(Bifrost.namespace("Bifrost.validation",{ValidationSummary:function(commands,containerElement){function aggregateMessages(){var actualMessages=[];self.commands().forEach(function(command){ko.utils.unwrapObservable(command).validators().forEach(function(validator){!validator.isValid()&&validator.message().length&&actualMessages.push(validator.message())})}),self.messages(actualMessages)}var self=this;this.commands=ko.observable(commands),this.messages=ko.observableArray([]),this.hasMessages=ko.computed(function(){return this.messages().length>0},self),commands.forEach(function(command){ko.utils.unwrapObservable(command).validators().forEach(function(validator){validator.message.subscribe(aggregateMessages)})})}}),ko.bindingHandlers.validationSummaryFor={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var target=ko.bindingHandlers.validationSummaryFor.getValueAsArray(valueAccessor),validationSummary=new Bifrost.validation.ValidationSummary(target),ul=document.createElement("ul");element.appendChild(ul),ul.innerHTML="<li><span data-bind='text: $data'></span></li>",ko.utils.domData.set(element,"validationsummary",validationSummary),ko.applyBindingsToNode(element,{visible:validationSummary.hasMessages},validationSummary),ko.applyBindingsToNode(ul,{foreach:validationSummary.messages},validationSummary)},update:function(element,valueAccessor){ko.utils.domData.get(element,"validationsummary").commands(ko.bindingHandlers.validationSummaryFor.getValueAsArray(valueAccessor))},getValueAsArray:function(valueAccessor){var target=ko.utils.unwrapObservable(valueAccessor());return Bifrost.isArray(target)||(target=[target]),target}}),"undefined"!=typeof ko&&(ko.bindingHandlers.validationMessageFor={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var validator=valueAccessor().validator;Bifrost.isNullOrUndefined(validator)||(validator.isValid.subscribe(function(newValue){!0===newValue?$(element).hide():$(element).show()}),ko.applyBindingsToNode(element,{text:validator.message},validator))}}),"undefined"!=typeof ko&&(ko.extenders.validation=function(target,options){return Bifrost.validation.Validator.applyTo(target,options),target.subscribe(function(newValue){target.validator.validate(newValue)}),target}),Bifrost.namespace("Bifrost.validation",{required:Bifrost.validation.Rule.extend(function(){this.validate=function(value){return!(Bifrost.isUndefined(value)||Bifrost.isNull(value)||""===value||0===value)}})}),Bifrost.namespace("Bifrost.validation",{length:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfValueIsNotANumber(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.max))throw new Bifrost.validation.MaxLengthNotSpecified;if(notSet(options.min))throw new Bifrost.validation.MinLengthNotSpecified;throwIfValueIsNotANumber(options.min),throwIfValueIsNotANumber(options.max)}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),notSet(value)&&(value=""),Bifrost.isString(value)||(value=value.toString()),self.options.min<=value.length&&value.length<=self.options.max}})}),Bifrost.namespace("Bifrost.validation",{minLength:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfValueIsNotANumber(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.length))throw new Bifrost.validation.MaxNotSpecified;throwIfValueIsNotANumber(options.length)}function throwIfValueIsNotAString(string){if(!Bifrost.isString(string))throw new Bifrost.validation.NotAString("Value "+string+" is not a string")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),notSet(value)&&(value=""),throwIfValueIsNotAString(value),value.length>=self.options.length}})}),Bifrost.namespace("Bifrost.validation",{maxLength:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfValueIsNotANumber(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.length))throw new Bifrost.validation.MaxNotSpecified;throwIfValueIsNotANumber(options.length)}function throwIfValueIsNotAString(string){if(!Bifrost.isString(string))throw new Bifrost.validation.NotAString("Value "+string+" is not a string")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),notSet(value)&&(value=""),throwIfValueIsNotAString(value),value.length<=self.options.length}})}),Bifrost.namespace("Bifrost.validation",{range:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfValueIsNotANumber(value,param){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber(param+" value "+value+" is not a number")}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.max))throw new Bifrost.validation.MaxNotSpecified;if(notSet(options.min))throw new Bifrost.validation.MinNotSpecified;throwIfValueIsNotANumber(options.min,"min"),throwIfValueIsNotANumber(options.max,"max")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),!notSet(value)&&(throwIfValueIsNotANumber(value,"value"),self.options.min<=value&&value<=self.options.max)}})}),Bifrost.namespace("Bifrost.validation",{lessThan:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.value)){var exception=new Bifrost.validation.OptionsValueNotSpecified;throw exception.message=exception.message+" 'value' is not set.",exception}}function throwIsValueToCheckIsNotANumber(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),!notSet(value)&&(throwIsValueToCheckIsNotANumber(value),parseFloat(value)<parseFloat(self.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.lessThanOrEqual={throwIfOptionsInvalid:function(options){if(this.notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(options.value)){var exception=new Bifrost.validation.OptionsValueNotSpecified;throw exception.message=exception.message+" 'value' is not set.",exception}},throwIsValueToCheckIsNotANumber:function(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")},notSet:function(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)},validate:function(value,options){return this.throwIfOptionsInvalid(options),!this.notSet(value)&&(this.throwIsValueToCheckIsNotANumber(value),parseFloat(value)<=parseFloat(options.value))}},Bifrost.namespace("Bifrost.validation",{greaterThan:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.value)){var exception=new Bifrost.validation.OptionsValueNotSpecified;throw exception.message=exception.message+" 'value' is not set.",exception}throwIfValueToCheckIsNotANumber(options.value)}function throwIfValueToCheckIsNotANumber(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),!notSet(value)&&(throwIfValueToCheckIsNotANumber(value),parseFloat(value)>parseFloat(self.options.value))}})}),Bifrost.namespace("Bifrost.validation.ruleHandlers"),Bifrost.validation.ruleHandlers.greaterThanOrEqual={throwIfOptionsInvalid:function(options){if(this.notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(this.notSet(options.value)){var exception=new Bifrost.validation.OptionsValueNotSpecified;throw exception.message=exception.message+" 'value' is not set.",exception}this.throwIfValueToCheckIsNotANumber(options.value)},throwIfValueToCheckIsNotANumber:function(value){if(!Bifrost.isNumber(value))throw new Bifrost.validation.NotANumber("Value "+value+" is not a number")},notSet:function(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)},validate:function(value,options){return this.throwIfOptionsInvalid(options),!this.notSet(value)&&(this.throwIfValueToCheckIsNotANumber(value),parseFloat(value)>=parseFloat(options.value))}},Bifrost.namespace("Bifrost.validation",{email:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isNull(value)||Bifrost.isUndefined(value)}var regex=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/;this.validate=function(value){if(notSet(value))return!1;if(!Bifrost.isString(value))throw new Bifrost.validation.NotAString("Value "+value+" is not a string");return null!=value.match(regex)}})}),Bifrost.namespace("Bifrost.validation",{regex:Bifrost.validation.Rule.extend(function(){function notSet(value){return Bifrost.isUndefined(value)||Bifrost.isNull(value)}function throwIfOptionsInvalid(options){if(notSet(options))throw new Bifrost.validation.OptionsNotDefined;if(notSet(options.expression))throw new Bifrost.validation.MissingExpression;if(!Bifrost.isString(options.expression))throw new Bifrost.validation.NotAString("Expression "+options.expression+" is not a string.")}function throwIfValueIsNotString(value){if(!Bifrost.isString(value))throw new Bifrost.validation.NotAString("Value "+value+" is not a string.")}var self=this;this.validate=function(value){return throwIfOptionsInvalid(self.options),!notSet(value)&&(throwIfValueIsNotString(value),null!=value.match(self.options.expression))}})}),"undefined"!=typeof ko&&(ko.bindingHandlers.command={init:function(element,valueAccessor,allBindingAccessor,viewModel){var command,value=valueAccessor();if(void 0===value.canExecute){(command=value.target).parameters=command.parameters||{};var parameters=value.parameters||{};for(var parameter in parameters){var parameterValue=parameters[parameter];command.parameters.hasOwnProperty(parameter)&&ko.isObservable(command.parameters[parameter])?command.parameters[parameter](parameterValue):command.parameters[parameter]=ko.observable(parameterValue)}!0}else command=value;ko.applyBindingsToNode(element,{click:function(){command.execute()}},viewModel)}}),Bifrost.namespace("Bifrost.commands",{HandleCommandTask:Bifrost.tasks.ExecutionTask.extend(function(command,server,systemEvents){this.name=command.name,this.execute=function(){var promise=Bifrost.execution.Promise.create(),parameters={commandDescriptor:Bifrost.commands.CommandDescriptor.createFrom(command)},url="/Bifrost/CommandCoordinator/Handle?_cmd="+command._generatedFrom;return server.post(url,parameters).continueWith(function(result){var commandResult=Bifrost.commands.CommandResult.createFrom(result);!0===commandResult.success?systemEvents.commands.succeeded.trigger(result):systemEvents.commands.failed.trigger(result),promise.signal(commandResult)}).onFail(function(response){var commandResult=Bifrost.commands.CommandResult.create();commandResult.exception="HTTP 500",commandResult.exceptionMessage=response.statusText,commandResult.details=response.responseText,systemEvents.commands.failed.trigger(commandResult),promise.signal(commandResult)}),promise}})}),Bifrost.namespace("Bifrost.commands",{HandleCommandsTask:Bifrost.tasks.ExecutionTask.extend(function(commands,server){var self=this;this.names=[],commands.forEach(function(command){self.names.push(command.name)}),this.execute=function(){var promise=Bifrost.execution.Promise.create(),commandDescriptors=[];commands.forEach(function(command){command.isBusy(!0);var commandDescriptor=Bifrost.commands.CommandDescriptor.createFrom(command);commandDescriptors.push(commandDescriptor)});var parameters={commandDescriptors:commandDescriptors};return server.post("/Bifrost/CommandCoordinator/HandleMany",parameters).continueWith(function(results){var commandResults=[];results.forEach(function(result){var commandResult=Bifrost.commands.CommandResult.createFrom(result);commandResults.push(commandResult)}),promise.signal(commandResults)}),promise}})}),Bifrost.namespace("Bifrost.commands",{commandCoordinator:Bifrost.Singleton(function(taskFactory){this.handle=function(command){var promise=Bifrost.execution.Promise.create(),task=taskFactory.createHandleCommand(command);return command.region.tasks.execute(task).continueWith(function(commandResult){promise.signal(commandResult)}),promise},this.handleMany=function(commands,region){var promise=Bifrost.execution.Promise.create();try{var task=taskFactory.createHandleCommands(commands);region.tasks.execute(task).continueWith(function(commandResults){commands.forEach(function(command,index){var commandResult=commandResults[index];null==commandResult||Bifrost.isUndefined(commandResult)||command.handleCommandResult(commandResult),command.isBusy(!1)}),promise.signal(commandResults)})}catch(e){commands.forEach(function(command){command.isBusy(!1)})}return promise}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandCoordinator=Bifrost.commands.commandCoordinator,Bifrost.namespace("Bifrost.commands",{commandValidationService:Bifrost.Singleton(function(){function shouldSkipProperty(target,property){return"region"===property||(target instanceof HTMLElement||(!target.hasOwnProperty(property)||!ko.isObservable(target[property])&&("function"==typeof target[property]||("_type"===property||("_dependencies"===property||("_namespace"===property||(null==target[property]||void 0!==target[property].prototype&&null!==target[property].prototype&&target[property]instanceof Bifrost.Type)))))))}function extendProperties(target,validators){for(var property in target)shouldSkipProperty(target,property)||void 0===target[property].validator&&(ko.isObservable(target[property])?(target[property].extend({validation:{}}),target[property].validator.propertyName=property):"object"==typeof target[property]&&extendProperties(target[property],validators))}function validatePropertiesFor(target,result,silent){for(var property in target)if(!shouldSkipProperty(target,property))if(void 0!==target[property].validator){var valueToValidate=ko.utils.unwrapObservable(target[property]());!0===silent?target[property].validator.validateSilently(valueToValidate):target[property].validator.validate(valueToValidate),!1===target[property].validator.isValid()&&(result.valid=!1)}else"object"==typeof target[property]&&validatePropertiesFor(target[property],result,silent)}function applyValidationMessageToMembers(command,members,message){for(var memberIndex=0;memberIndex<members.length;memberIndex++){var property=null,target=command;if(members[memberIndex].split(".").forEach(function(member){(property=member.toCamelCase())in target&&"object"==typeof target[property]&&(target=target[property])}),null!=property&&property.length){var member=target[property];void 0!==member.validator&&(member.validator.isValid(!1),member.validator.message(message))}}}function collectValidators(source,validators){for(var property in source){var value=source[property];shouldSkipProperty(source,property)||(ko.isObservable(value)&&void 0!==value.validator?validators.push(value.validator):Bifrost.isObject(value)&&collectValidators(value,validators))}}this.applyValidationResultToProperties=function(command,validationResults){for(var i=0;i<validationResults.length;i++){var validationResult=validationResults[i],message=validationResult.errorMessage,memberNames=validationResult.memberNames;memberNames.length>0&&applyValidationMessageToMembers(command,memberNames,message)}},this.validate=function(command){var result={valid:!0};return validatePropertiesFor(command,result),result},this.validateSilently=function(command){var result={valid:!0};return validatePropertiesFor(command,result,!0),result},this.clearValidationMessagesFor=function(target){for(var property in target)shouldSkipProperty(target,property)||Bifrost.isNullOrUndefined(target[property].validator)||target[property].validator.message("")},this.extendPropertiesWithoutValidation=function(command){extendProperties(command)},this.getValidatorsFor=function(command){var validators=[];return collectValidators(command,validators),validators}})}),Bifrost.namespace("Bifrost.commands",{Command:Bifrost.Type.extend(function(commandCoordinator,commandValidationService,commandSecurityService,mapper,options,region){var self=this,hasChangesObservables=ko.observableArray();this.region=region,this._name="",this._generatedFrom="",this.targetCommand=this,this.validators=ko.observableArray(),this.validationMessages=ko.observableArray(),this.securityContext=ko.observable(null),this.populatedFromExternalSource=ko.observable(!1),this.isBusy=ko.observable(!1),this.isValid=ko.computed(function(){var valid=!0;return self.validators().some(function(validator){if(ko.isObservable(validator.isValid)&&!1===validator.isValid())return valid=!1,!0}),!(self.validationMessages().length>0)&&valid}),this.isAuthorized=ko.observable(!1),this.canExecute=ko.computed(function(){return self.isValid()&&self.isAuthorized()}),this.isPopulatedExternally=ko.observable(!1),this.isReady=ko.computed(function(){return!1===self.isPopulatedExternally()||self.populatedFromExternalSource()}),this.isReadyToExecute=ko.computed(function(){return!1===self.isPopulatedExternally()||self.hasChanges()}),this.hasChanges=ko.computed(function(){var hasChange=!1;return hasChangesObservables().some(function(item){if(!0===item())return hasChange=!0,!0}),hasChange}),this.failedCallbacks=[],this.succeededCallbacks=[],this.completedCallbacks=[],this.commandCoordinator=commandCoordinator,this.commandValidationService=commandValidationService,this.commandSecurityService=commandSecurityService,this.options={beforeExecute:function(){},failed:function(){},succeeded:function(){},completed:function(){},properties:{}},this.failed=function(callback){return self.failedCallbacks.push(callback),self},this.succeeded=function(callback){return self.succeededCallbacks.push(callback),self},this.completed=function(callback){return self.completedCallbacks.push(callback),self},this.setOptions=function(options){Bifrost.extend(self.options,options),void 0!==options.name&&"string"==typeof options.name&&(self._name=options.name)},this.copyPropertiesFromOptions=function(){for(var property in self.targetCommand.options.properties){var value=self.targetCommand.options.properties[property];ko.isObservable(value)||(value=ko.observable(value)),self.targetCommand[property]=value}},this.getProperties=function(){var properties=[];for(var property in self.targetCommand)self.targetCommand.hasOwnProperty(property)&&!self.hasOwnProperty(property)&&properties.push(property);return properties},this.makePropertiesObservable=function(){self.getProperties().forEach(function(property){var value=null,propertyValue=self.targetCommand[property];ko.isObservable(propertyValue)||"object"==typeof propertyValue&&!Bifrost.isArray(propertyValue)||"function"!=typeof propertyValue&&(value=Bifrost.isArray(propertyValue)?ko.observableArray(propertyValue):ko.observable(propertyValue),self.targetCommand[property]=value)})},this.extendPropertiesWithHasChanges=function(){self.getProperties().forEach(function(property){var propertyValue=self.targetCommand[property];ko.isObservable(propertyValue)&&(propertyValue.extend({hasChanges:{}}),Bifrost.isNullOrUndefined(propertyValue.hasChanges)||hasChangesObservables.push(propertyValue.hasChanges))})},this.onBeforeExecute=function(){self.options.beforeExecute()},this.onFailed=function(commandResult){self.options.failed(commandResult),self.failedCallbacks.forEach(function(callback){callback(commandResult)})},this.setInitialValuesForProperties=function(properties){properties.forEach(function(propertyName){var property=self.targetCommand[propertyName];if(ko.isObservable(property)&&ko.isWriteableObservable(property)&&Bifrost.isFunction(property.setInitialValue)){var value=property();property.setInitialValue(value)}})},this.setInitialValuesFromCurrentValues=function(){var properties=self.getProperties();self.setInitialValuesForProperties(properties)},this.onSucceeded=function(commandResult){self.options.succeeded(commandResult),self.setInitialValuesFromCurrentValues(),self.succeededCallbacks.forEach(function(callback){callback(commandResult)})},this.onCompleted=function(commandResult){self.options.completed(commandResult),self.completedCallbacks.forEach(function(callback){callback(commandResult)})},this.handleCommandResult=function(commandResult){self.isBusy(!1),void 0!==commandResult.commandValidationMessages&&self.validationMessages(commandResult.commandValidationMessages),!1===commandResult.success||!0===commandResult.invalid?(commandResult.invalid&&void 0!==commandResult.validationResults&&self.commandValidationService.applyValidationResultToProperties(self.targetCommand,commandResult.validationResults),self.onFailed(commandResult)):self.onSucceeded(commandResult),self.onCompleted(commandResult)},this.getCommandResultFromValidationResult=function(validationResult){var result=Bifrost.commands.CommandResult.create();return result.invalid=!0,result},this.execute=function(){self.isBusy(!0);try{self.onBeforeExecute();var validationResult=self.commandValidationService.validate(this);if(!0===validationResult.valid)self.commandCoordinator.handle(self.targetCommand).continueWith(function(commandResult){self.handleCommandResult(commandResult)});else{var commandResult=self.getCommandResultFromValidationResult(validationResult);self.handleCommandResult(commandResult)}}catch(ex){self.isBusy(!1)}},this.populatedExternally=function(){self.isPopulatedExternally(!0)},this.populateFromExternalSource=function(values){self.isPopulatedExternally(!0),self.setPropertyValuesFrom(values),self.populatedFromExternalSource(!0),commandValidationService.clearValidationMessagesFor(self.targetCommand)},this.setPropertyValuesFrom=function(values){var mappedProperties=mapper.mapToInstance(self.targetCommand._type,values,self.targetCommand);self.setInitialValuesForProperties(mappedProperties)},this.onCreated=function(lastDescendant){if(self.targetCommand=lastDescendant,void 0!==options&&(this.setOptions(options),this.copyPropertiesFromOptions()),this.makePropertiesObservable(),this.extendPropertiesWithHasChanges(),void 0!==lastDescendant._name&&""!==lastDescendant._name){commandValidationService.extendPropertiesWithoutValidation(lastDescendant);var validators=commandValidationService.getValidatorsFor(lastDescendant);Bifrost.isArray(validators)&&validators.length>0&&self.validators(validators),commandValidationService.validateSilently(this)}commandSecurityService.getContextFor(lastDescendant).continueWith(function(securityContext){lastDescendant.securityContext(securityContext),ko.isObservable(securityContext.isAuthorized)&&(lastDescendant.isAuthorized(securityContext.isAuthorized()),securityContext.isAuthorized.subscribe(function(newValue){lastDescendant.isAuthorized(newValue)}))})}})}),Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandDescriptor=function(command){function shouldSkipProperty(target,property){return!target.hasOwnProperty(property)||(!!builtInCommand.hasOwnProperty(property)||!ko.isObservable(target[property])&&("function"==typeof target[property]||("_type"===property||"_namespace"===property)))}var builtInCommand={};void 0!==Bifrost.commands.Command&&(builtInCommand=Bifrost.commands.Command.create({region:{commands:[]},commandCoordinator:{},commandValidationService:{},commandSecurityService:{getContextFor:function(){return{continueWith:function(){}}}},mapper:{},options:{}})),this.name=command._name,this.generatedFrom=command._generatedFrom,this.id=Bifrost.Guid.create();var properties=function(command){var properties={};for(var property in command)shouldSkipProperty(command,property)||(properties[property]=command[property]);return properties}(command),commandContent=ko.toJS(properties);commandContent.Id=Bifrost.Guid.create(),this.command=ko.toJSON(commandContent)},Bifrost.commands.CommandDescriptor.createFrom=function(command){return new Bifrost.commands.CommandDescriptor(command)},Bifrost.namespace("Bifrost.commands"),Bifrost.commands.CommandResult=function(){function CommandResult(existing){var self=this;this.isEmpty=function(){return self.commandId===Bifrost.Guid.empty},this.commandName="",this.commandId=Bifrost.Guid.empty,this.validationResults=[],this.success=!0,this.invalid=!1,this.passedSecurity=!0,this.exception=void 0,this.exceptionMessage="",this.commandValidationMessages=[],this.securityMessages=[],this.allValidationMessages=[],this.details="",void 0!==existing&&Bifrost.extend(this,existing)}return{create:function(){return new CommandResult},createFrom:function(result){return new CommandResult("string"==typeof result?JSON.parse(result):result)}}}(),Bifrost.dependencyResolvers.command={canResolve:function(namespace,name){return"undefined"!=typeof commands&&name in commands},resolve:function(namespace,name){return commands[name].create()}},Bifrost.namespace("Bifrost.commands",{CommandSecurityContext:Bifrost.Type.extend(function(){this.isAuthorized=ko.observable(!1)})}),Bifrost.namespace("Bifrost.commands",{commandSecurityContextFactory:Bifrost.Singleton(function(){this.create=function(){return Bifrost.commands.CommandSecurityContext.create()}})}),Bifrost.namespace("Bifrost.commands",{commandSecurityService:Bifrost.Singleton(function(commandSecurityContextFactory){function getTypeNameFor(command){return command._type._name}function getSecurityContextNameFor(type){return type+"SecurityContext"}function hasSecurityContextInNamespaceFor(type,namespace){var securityContextName=getSecurityContextNameFor(type);return!Bifrost.isNullOrUndefined(securityContextName)&&!Bifrost.isNullOrUndefined(namespace)&&namespace.hasOwnProperty(securityContextName)}function getSecurityContextInNamespaceFor(type,namespace){return namespace[getSecurityContextNameFor(type,namespace)]}var self=this;this.commandSecurityContextFactory=commandSecurityContextFactory,this.getContextFor=function(command){var context,promise=Bifrost.execution.Promise.create(),type=getTypeNameFor(command);if(hasSecurityContextInNamespaceFor(type,command._type._namespace)){var contextType=getSecurityContextInNamespaceFor(type,command._type._namespace);context=contextType.create(),promise.signal(context)}else if(context=self.commandSecurityContextFactory.create(),Bifrost.isNullOrUndefined(command._generatedFrom)||""===command._generatedFrom)promise.signal(context);else{var url="/Bifrost/CommandSecurity/GetForCommand?commandName="+command._generatedFrom;$.getJSON(url,function(e){context.isAuthorized(e.isAuthorized),promise.signal(context)})}return promise},this.getContextForType=function(commandType){var context,promise=Bifrost.execution.Promise.create();return hasSecurityContextInNamespaceFor(commandType._name,commandType._namespace)?(context=getSecurityContextInNamespaceFor(commandType._name,commandType._namespace).create(),promise.signal(context)):((context=Bifrost.commands.CommandSecurityContext.create()).isAuthorized(!0),promise.signal(context)),promise}})}),Bifrost.WellKnownTypesDependencyResolver.types.commandSecurityService=Bifrost.commands.commandSecurityService,ko.extenders.hasChanges=function(target){function updateHasChanges(){if(!1===target._initialValueSet)target.hasChanges(!1);else{if(Bifrost.isArray(target._initialValue))return void target.hasChanges(!target._initialValue.shallowEquals(target()));target.hasChanges(target._initialValue!==target())}}target._initialValueSet=!1,target.hasChanges=ko.observable(!1),target.subscribe(function(){updateHasChanges()}),target.setInitialValue=function(value){var initialValue;initialValue=Bifrost.isArray(value)?value.clone():value,target._initialValue=initialValue,target._initialValueSet=!0,updateHasChanges()}},Bifrost.namespace("Bifrost.commands",{commandEvents:Bifrost.Singleton(function(){this.succeeded=Bifrost.Event.create(),this.failed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.interaction",{Operation:Bifrost.Type.extend(function(region,context){var self=this,canPerformObservables=ko.observableArray(),internalCanPerform=ko.observable(!0);this.context=context,this.identifier=Bifrost.Guid.empty,this.region=region,this.canPerform=ko.computed({read:function(){if(0===canPerformObservables().length)return!0;var canPerform=!0;return canPerformObservables().forEach(function(observable){!1!==observable()||(canPerform=!1)}),canPerform},write:function(value){internalCanPerform(value)}}),this.canPerform.when=function(observable){return canPerformObservables.push(observable),self.canPerform},this.canPerform.when(internalCanPerform),this.perform=function(){return{}},this.undo=function(state){}})}),Bifrost.namespace("Bifrost.interaction",{OperationContext:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.interaction",{OperationEntry:Bifrost.Type.extend(function(operation,state){this.operation=operation,this.state=state})}),Bifrost.namespace("Bifrost.interaction",{operationEntryFactory:Bifrost.Singleton(function(){this.create=function(operation,state){return Bifrost.interaction.OperationEntry.create({operation:operation,state:state})}})}),Bifrost.namespace("Bifrost.interaction",{Operations:Bifrost.Type.extend(function(operationEntryFactory){var self=this;this.all=ko.observableArray(),this.stateful=ko.computed(function(){var entries=[];return self.all().forEach(function(entry){Bifrost.areEqual(entry.state,{})||entries.push(entry)}),entries}),this.getByIdentifier=function(identifier){var found=null;return self.all().forEach(function(operation){operation.identifier!==identifier||(found=operation)}),found},this.perform=function(operation){if(!0===operation.canPerform()){var state=operation.perform(),entry=operationEntryFactory.create(operation,state);self.all.push(entry)}},this.undo=function(){throw"Not implemented"}})}),Bifrost.namespace("Bifrost.interaction",{operationsFactory:Bifrost.Singleton(function(){this.create=function(){return Bifrost.interaction.Operations.create()}})}),Bifrost.WellKnownTypesDependencyResolver.types.operationsFactory=Bifrost.interaction.operationsFactory,Bifrost.namespace("Bifrost.interaction",{CommandOperation:Bifrost.interaction.Operation.extend(function(commandSecurityService){var self=this;this.commandType=ko.observable(),this.isAuthorized=ko.observable(!1),this.commandCreated=Bifrost.Event.create(),this.canPerform.when(this.isAuthorized),this.commandType.subscribe(function(type){commandSecurityService.getContextForType(type).continueWith(function(context){Bifrost.isNullOrUndefined(context)||self.isAuthorized(context.isAuthorized())})}),this.createCommandOfType=function(commandType){var instance=commandType.create({region:self.region});return self.commandCreated.trigger(instance),instance}})}),Bifrost.namespace("Bifrost.interaction",{Action:Bifrost.Type.extend(function(){this.perform=function(){}})}),Bifrost.namespace("Bifrost.interaction",{Trigger:Bifrost.Type.extend(function(){var self=this;this.actions=[],this.addAction=function(action){self.actions.push(action)},this.initialize=function(element){},this.signal=function(){self.actions.forEach(function(action){action.perform()})}})}),Bifrost.namespace("Bifrost.interaction",{EventTrigger:Bifrost.interaction.Trigger.extend(function(){function throwIfEventNameIsNotSet(trigger){if(!trigger.eventName)throw"EventName is not set for trigger"}var self=this;this.eventName=null,this.initialize=function(element){throwIfEventNameIsNotSet(this);var actualEventName="on"+self.eventName;if(null==element[actualEventName]||"function"==typeof element[actualEventName]){var originalEventHandler=element[actualEventName];element[actualEventName]=function(e){originalEventHandler&&originalEventHandler(e),self.signal()}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualState:Bifrost.Type.extend(function(){var self=this;this.name="",this.actions=ko.observableArray(),this.addAction=function(action){self.actions.push(action)},this.enter=function(namingRoot,duration){self.actions().forEach(function(action){action.onEnter(namingRoot,duration)})},this.exit=function(namingRoot,duration){self.actions().forEach(function(action){action.onExit(namingRoot,duration)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateAction:Bifrost.Type.extend(function(){this.initialize=function(namingRoot){},this.onEnter=function(namingRoot,duration){},this.onExit=function(namingRoot,duration){}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateGroup:Bifrost.Type.extend(function(dispatcher){var self=this;this.defaultDuration=Bifrost.TimeSpan.zero(),this.currentState=ko.observable({name:"null state",enter:function(){},exit:function(){}}),this.states=ko.observableArray(),this.transitions=ko.observableArray(),this.addState=function(state){if(self.hasState(state.name))throw"VisualState with name of '"+state.name+"' already exists";self.states.push(state)},this.addTransition=function(transition){self.transitions.push(transition)},this.hasState=function(stateName){var hasState=!1;return self.states().forEach(function(state){state.name!==stateName||(hasState=!0)}),hasState},this.getStateByName=function(stateName){var stateFound=null;return self.states().forEach(function(state){state.name!==stateName||(stateFound=state)}),stateFound},this.goTo=function(namingRoot,stateName){var currentState=self.currentState();if(Bifrost.isNullOrUndefined(currentState)||currentState.name!==stateName){var state=self.getStateByName(stateName);if(!Bifrost.isNullOrUndefined(state)){var duration=self.defaultDuration;Bifrost.isNullOrUndefined(currentState)||currentState.exit(namingRoot,duration),state.enter(namingRoot,duration),dispatcher.schedule(duration.totalMilliseconds(),function(){self.currentState(state)})}}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManager:Bifrost.Type.extend(function(){var self=this;this.namingRoot=null,this.groups=ko.observableArray(),this.addGroup=function(group){self.groups.push(group)},this.goTo=function(stateName){self.groups().forEach(function(group){!0===group.hasState(stateName)&&group.goTo(self.namingRoot,stateName)})}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateTransition:Bifrost.Type.extend(function(){this.from="",this.to="",this.duration=Bifrost.TimeStamp.zero()})});var globalId=0;Bifrost.namespace("Bifrost.interaction.visualStateActions",{Opacity:Bifrost.interaction.VisualStateAction.extend(function(documentService){var self=this,element=null,id=documentService.getUniqueStyleName("opacity");this.target="",this.value="",this.initialize=function(namingRoot){element=namingRoot.find(self.target)},this.onEnter=function(namingRoot,duration){var value=parseFloat(self.value);isNaN(value)&&(value=0);var actualDuration=duration.totalMilliseconds()/1e3;documentService.addStyle("."+id,{"-webkit-transition":"opacity "+actualDuration+"s ease-in-out","-moz-transition":"opacity "+actualDuration+"s ease-in-out","-ms-transition":"opacity "+actualDuration+"s ease-in-out","-o-transition":"opacity "+actualDuration+"s ease-in-out",transition:"opacity "+actualDuration+"s ease-in-out",opacity:value}),element.classList.add(id)},this.onExit=function(namingRoot,duration){element.classList.remove(id)}})}),Bifrost.namespace("Bifrost.mapping",{MissingPropertyStrategy:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.mapping",{PropertyMap:Bifrost.Type.extend(function(sourceProperty,typeConverters){function throwIfMissingPropertyStrategy(){if(Bifrost.isNullOrUndefined(self.strategy))throw Bifrost.mapping.MissingPropertyStrategy.create()}var self=this;this.strategy=null,this.to=function(targetProperty){self.strategy=function(source,target){var value=ko.unwrap(source[sourceProperty]),targetValue=ko.unwrap(target[targetProperty]),typeAsString=null;Bifrost.isNullOrUndefined(value)||(Bifrost.isNullOrUndefined(targetValue)||(value.constructor!==targetValue.constructor&&(typeAsString=targetValue.constructor.name.toString()),Bifrost.isNullOrUndefined(target[targetProperty]._typeAsString)||(typeAsString=target[targetProperty]._typeAsString)),Bifrost.isNullOrUndefined(typeAsString)||(value=typeConverters.convertFrom(value.toString(),typeAsString))),ko.isObservable(target[targetProperty])?target[targetProperty](value):target[targetProperty]=value}},this.map=function(source,target){throwIfMissingPropertyStrategy(),self.strategy(source,target)}})}),Bifrost.namespace("Bifrost.mapping",{Map:Bifrost.Type.extend(function(){var self=this,properties={};this.sourceType=null,this.targetType=null,this.source=function(type){self.sourceType=type},this.target=function(type){self.targetType=type},this.property=function(property){var propertyMap=Bifrost.mapping.PropertyMap.create({sourceProperty:property});return properties[property]=propertyMap,propertyMap},this.canMapProperty=function(property){return properties.hasOwnProperty(property)},this.mapProperty=function(property,source,target){self.canMapProperty(property)&&properties[property].map(source,target)}})}),Bifrost.namespace("Bifrost.mapping",{maps:Bifrost.Singleton(function(){function getKeyFrom(sourceType,targetType){return sourceType._typeId+" - "+targetType._typeId}var self=this,maps={};Bifrost.mapping.Map.getExtenders().forEach(function(extender){var map=extender.create(),key=getKeyFrom(map.sourceType,map.targetType);maps[key]=map}),this.hasMapFor=function(sourceType,targetType){if(Bifrost.isNullOrUndefined(sourceType)||Bifrost.isNullOrUndefined(targetType))return!1;var key=getKeyFrom(sourceType,targetType);return maps.hasOwnProperty(key)},this.getMapFor=function(sourceType,targetType){if(self.hasMapFor(sourceType,targetType)){var key=getKeyFrom(sourceType,targetType);return maps[key]}}})}),Bifrost.namespace("Bifrost.mapping",{mapper:Bifrost.Type.extend(function(typeConverters,maps){"use strict";function getTypeAsString(to,property,value,toValue){var typeAsString=null;return Bifrost.isNullOrUndefined(value)||Bifrost.isNullOrUndefined(toValue)||value.constructor!==toValue.constructor&&(typeAsString=toValue.constructor.toString().match(/function\040+(\w*)/)[1]),Bifrost.isNullOrUndefined(to[property])||Bifrost.isNullOrUndefined(to[property]._typeAsString)||(typeAsString=to[property]._typeAsString),typeAsString}function copyProperties(mappedProperties,from,to,map){for(var property in from)if(0!==property.indexOf("_")&&!Bifrost.isUndefined(from[property]))if(Bifrost.isObject(from[property])&&Bifrost.isObject(to[property]))copyProperties(mappedProperties,from[property],to[property]);else{if(!Bifrost.isNullOrUndefined(map)&&map.canMapProperty(property)){map.mapProperty(property,from,to),mappedProperties.indexOf(property)<0&&mappedProperties.push(property);continue}if(!Bifrost.isUndefined(to[property])){var value=ko.unwrap(from[property]),typeAsString=getTypeAsString(to,property,value,ko.unwrap(to[property]));if(Bifrost.isNullOrUndefined(typeAsString)||Bifrost.isNullOrUndefined(value)||(value=typeConverters.convertFrom(value.toString(),typeAsString)),mappedProperties.indexOf(property)<0&&mappedProperties.push(property),ko.isObservable(to[property])){if(!ko.isWriteableObservable(to[property]))continue;to[property](value)}else to[property]=value}}}function mapSingleInstance(type,data,mappedProperties){data&&(Bifrost.isNullOrUndefined(data._sourceType)||(type=eval(data._sourceType)));var instance=type.create();if(data){var map=null;maps.hasMapFor(data._type,type)&&(map=maps.getMapFor(data._type,type)),copyProperties(mappedProperties,data,instance,map)}return instance}function mapMultipleInstances(type,data,mappedProperties){for(var mappedInstances=[],i=0;i<data.length;i++){var singleData=data[i];mappedInstances.push(mapSingleInstance(type,singleData,mappedProperties))}return mappedInstances}var self=this;this.map=function(type,data){var mappedProperties=[];return Bifrost.isArray(data)?mapMultipleInstances(type,data,mappedProperties):mapSingleInstance(type,data,mappedProperties)},this.mapToInstance=function(targetType,data,target){var mappedProperties=[],map=null;return maps.hasMapFor(data._type,targetType)&&(map=maps.getMapFor(data._type,targetType)),copyProperties(mappedProperties,data,target,map),mappedProperties}})}),Bifrost.WellKnownTypesDependencyResolver.types.mapper=Bifrost.mapping.mapper,Bifrost.namespace("Bifrost.read",{readModelSystemEvents:Bifrost.Singleton(function(){this.noInstance=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.read",{PagingInfo:Bifrost.Type.extend(function(size,number){this.size=size,this.number=number})}),Bifrost.namespace("Bifrost.read",{Queryable:Bifrost.Type.extend(function(query,queryService,region,targetObservable){var self=this;this.canExecute=!0,this.target=targetObservable,this.query=query,this.queryService=queryService,this.pageSize=ko.observable(0),this.pageNumber=ko.observable(0),this.totalItems=ko.observable(0),this.completedCallbacks=[],this.pageSize.subscribe(function(){self.canExecute&&self.execute()}),this.pageNumber.subscribe(function(){self.canExecute&&self.execute()}),this.completed=function(callback){return self.completedCallbacks.push(callback),self},this.onCompleted=function(data){self.completedCallbacks.forEach(function(callback){callback(data)})},this.execute=function(){if(!0!==self.query.areAllParametersSet())return self.target;self.query._previousAreAllParametersSet=!0;var paging=Bifrost.read.PagingInfo.create({size:self.pageSize(),number:self.pageNumber()});return self.queryService.execute(query,paging).continueWith(function(result){Bifrost.isNullOrUndefined(result)||(self.totalItems(result.totalItems),self.target(result.items),self.onCompleted(result.items))}),self.target},this.setPageInfo=function(pageSize,pageNumber){pageSize===self.pageSize()&&pageNumber===self.pageNumber()||(self.canExecute=!1,self.pageSize(pageSize),self.pageNumber(pageNumber),self.canExecute=!0,self.execute())},function(query){for(var propertyName in query){var property=query[propertyName];!0===ko.isObservable(property)&&query.hasOwnProperty(propertyName)&&"areAllParametersSet"!==propertyName&&property.subscribe(self.execute)}}(self.query),self.query.areAllParametersSet()&&self.execute()})}),Bifrost.read.Queryable.new=function(options,region){var observable=ko.observableArray();options.targetObservable=observable,options.region=region;var queryable=Bifrost.read.Queryable.create(options);return Bifrost.extend(observable,queryable),observable.isQueryable=!0,observable},Bifrost.namespace("Bifrost.read",{queryableFactory:Bifrost.Singleton(function(){this.create=function(query,region){return Bifrost.read.Queryable.new({query:query},region)}})}),Bifrost.WellKnownTypesDependencyResolver.types.queryableFactory=Bifrost.interaction.queryableFactory,Bifrost.namespace("Bifrost.read",{Query:Bifrost.Type.extend(function(queryableFactory,region){var self=this;this.target=this,this._name="",this._generatedFrom="",this._readModel=null,this.region=region,this.areAllParametersSet=null,this.hasReadModel=function(){return void 0!==self.target._readModel&&null!=self.target._readModel},this.setParameters=function(parameters){try{for(var property in parameters)self.target.hasOwnProperty(property)&&!0===ko.isObservable(self.target[property])&&self.target[property](parameters[property])}catch(ex){}},this.getParameters=function(){var parameters={};for(var property in self.target)ko.isObservable(self.target[property])&&"areAllParametersSet"!==property&&(parameters[property]=self.target[property]);return parameters},this.getParameterValues=function(){var value,parameterValues={},parameters=self.getParameters();for(var property in parameters)value=parameters[property](),ko.isObservable(value)&&(value=value()),parameterValues[property]=value;return parameterValues},this.all=function(){return queryableFactory.create(self.target,region)},this.paged=function(pageSize,pageNumber){var queryable=queryableFactory.create(self.target,region);return queryable.setPageInfo(pageSize,pageNumber),queryable},this.onCreated=function(query){self.target=query;for(var property in self.target)!0===ko.isObservable(self.target[property])&&self.target[property].extend({linked:{}});self.areAllParametersSet=ko.computed(function(){var isSet=!0,hasParameters=!1;for(var property in self.target)if(!0===ko.isObservable(self.target[property])){hasParameters=!0;var value=ko.unwrap(self.target[property]());if(void 0===value||null===value){isSet=!1;break}}return!1===hasParameters||isSet})}})}),Bifrost.namespace("Bifrost.read",{ReadModel:Bifrost.Type.extend(function(){var actualReadModel=this;this.copyTo=function(target){for(var property in actualReadModel)if(actualReadModel.hasOwnProperty(property)&&0!==property.indexOf("_")){var value=ko.utils.unwrapObservable(actualReadModel[property]);target.hasOwnProperty(property)?ko.isObservable(target[property])?target[property](value):target[property]=value:target[property]=ko.observable(value)}},this.onCreated=function(lastDescendant){actualReadModel=lastDescendant}})}),Bifrost.namespace("Bifrost.read",{ReadModelOf:Bifrost.Type.extend(function(region,mapper,taskFactory,readModelSystemEvents){function unwrapPropertyFilters(propertyFilters){var unwrappedPropertyFilters={};for(var property in propertyFilters)unwrappedPropertyFilters[property]=ko.utils.unwrapObservable(propertyFilters[property]);return unwrappedPropertyFilters}function performLoad(target,propertyFilters){var task=taskFactory.createReadModel(target,propertyFilters);target.region.tasks.execute(task).continueWith(function(data){if(Bifrost.isNullOrUndefined(data))readModelSystemEvents.noInstance.trigger(target);else{var mappedReadModel=mapper.map(target._readModelType,data);self.instance(mappedReadModel)}})}var self=this;this.target=null,this._name="",this._generatedFrom="",this._readModelType=Bifrost.Type.extend(function(){}),this.instance=ko.observable(),this.commandToPopulate=null,this.region=region,this.instanceMatching=function(propertyFilters){function load(){var unwrappedPropertyFilters=unwrapPropertyFilters(propertyFilters);performLoad(self.target,unwrappedPropertyFilters)}load();for(var property in propertyFilters){var value=propertyFilters[property];ko.isObservable(value)&&value.subscribe(load)}},this.populateCommandOnChanges=function(command){command.populatedExternally(),void 0!==self.instance()&&null!=self.instance()&&command.populateFromExternalSource(self.instance()),self.instance.subscribe(function(newValue){command.populateFromExternalSource(newValue)})},this.onCreated=function(lastDescendant){self.target=lastDescendant;var readModelInstance=lastDescendant._readModelType.create();self.instance(readModelInstance)}})}),Bifrost.namespace("Bifrost.read",{ReadModelTask:Bifrost.tasks.LoadTask.extend(function(readModelOf,propertyFilters,taskFactory){var url="/Bifrost/ReadModel/InstanceMatching?_rm="+readModelOf._generatedFrom,payload={descriptor:{readModel:readModelOf._name,generatedFrom:readModelOf._generatedFrom,propertyFilters:propertyFilters}};this.readModel=readModelOf._generatedFrom;var innerTask=taskFactory.createHttpPost(url,payload);this.execute=function(){return innerTask.execute()}})}),Bifrost.dependencyResolvers.readModelOf={canResolve:function(namespace,name){return"undefined"!=typeof read&&name in read},resolve:function(namespace,name){return read[name].create()}},Bifrost.dependencyResolvers.query={canResolve:function(namespace,name){return"undefined"!=typeof read&&name in read},resolve:function(namespace,name){return read[name].create()}},Bifrost.namespace("Bifrost.read",{QueryTask:Bifrost.tasks.LoadTask.extend(function(query,paging,taskFactory){var url="/Bifrost/Query/Execute?_q="+query._generatedFrom,payload={descriptor:{nameOfQuery:query._name,generatedFrom:query._generatedFrom,parameters:query.getParameterValues()},paging:{size:paging.size,number:paging.number}};this.query=query._name,this.paging=payload.paging;var innerTask=taskFactory.createHttpPost(url,payload);this.execute=function(){return innerTask.execute()}})}),Bifrost.namespace("Bifrost.read",{queryService:Bifrost.Singleton(function(mapper,taskFactory){this.execute=function(query,paging){var promise=Bifrost.execution.Promise.create(),region=query.region,task=taskFactory.createQuery(query,paging);return region.tasks.execute(task).continueWith(function(result){void 0!==result&&null!=result||(result={}),void 0!==result.items&&null!=result.items||(result.items=[]),void 0!==result.totalItems&&null!=result.totalItems||(result.totalItems=0),query.hasReadModel()&&(result.items=mapper.map(query._readModel,result.items)),promise.signal(result)}),promise}})}),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.Saga=function(){function Saga(){var self=this;this.executeCommands=function(commands,options){var canExecuteSaga=!0;commands.forEach(function(command){if(!1===command.onBeforeExecute())return canExecuteSaga=!1,!1}),!1!==canExecuteSaga&&Bifrost.commands.commandCoordinator.handleForSaga(self,commands,options)}}return{create:function(configuration){var saga=new Saga;return Bifrost.extend(saga,configuration),saga}}}(),Bifrost.namespace("Bifrost.sagas"),Bifrost.sagas.sagaNarrator=function(){function post(url,data,completeHandler){$.ajax({url:url,type:"POST",dataType:"json",data:data,contentType:"application/json; charset=utf-8",complete:completeHandler})}function isRequestSuccess(jqXHR,commandResult){return 200===jqXHR.status&&!0===commandResult.success}return{conclude:function(saga,success,error){var methodParameters={sagaId:saga.Id};post("/Bifrost/SagaNarrator/Conclude",JSON.stringify(methodParameters),function(jqXHR){var isSuccess=isRequestSuccess(jqXHR,Bifrost.commands.CommandResult.createFrom(jqXHR.responseText));!0===isSuccess&&"function"==typeof success&&success(saga),!1===isSuccess&&"function"==typeof error&&error(saga)})}}}(),Bifrost.namespace("Bifrost.messaging",{Messenger:Bifrost.Type.extend(function(){var subscribers=[];return this.publish=function(topic,message){subscribers.hasOwnProperty(topic)&&subscribers[topic].subscribers.forEach(function(item){item(message)})},this.subscribeTo=function(topic,subscriber){var subscribersByTopic;subscribers.hasOwnProperty(topic)?subscribersByTopic=subscribers[topic]:(subscribersByTopic={subscribers:[]},subscribers[topic]=subscribersByTopic),subscribersByTopic.subscribers.push(subscriber)},{publish:this.publish,subscribeTo:this.subscribeTo}})}),Bifrost.messaging.Messenger.global=Bifrost.messaging.Messenger.create(),Bifrost.WellKnownTypesDependencyResolver.types.globalMessenger=Bifrost.messaging.Messenger.global,Bifrost.namespace("Bifrost.messaging",{messengerFactory:Bifrost.Singleton(function(){this.create=function(){return Bifrost.messaging.Messenger.create()},this.global=function(){return Bifrost.messaging.Messenger.global}})}),Bifrost.WellKnownTypesDependencyResolver.types.messengerFactory=Bifrost.messaging.messengerFactory,"undefined"!=typeof ko&&(ko.observableMessage=function(message,defaultValue){var observable=ko.observable(defaultValue),internal=!1;return observable.subscribe(function(newValue){!0!==internal&&Bifrost.messaging.Messenger.global.publish(message,newValue)}),Bifrost.messaging.Messenger.global.subscribeTo(message,function(value){internal=!0,observable(value),internal=!1}),observable}),Bifrost.namespace("Bifrost.services",{Service:Bifrost.Type.extend(function(){function prepareArguments(args){var prepared={};for(var property in args)prepared[property]=JSON.stringify(args[property]);return JSON.stringify(prepared)}function call(method,args,callback){$.ajax({url:self.url+"/"+method,type:"POST",dataType:"json",data:prepareArguments(args),contentType:"application/json; charset=utf-8",complete:function(result){var v=$.parseJSON(result.responseText);callback(v)}})}var self=this;this.url="",this.name="",this.callWithoutReturnValue=function(method,args){var promise=Bifrost.execution.Promise.create();return call(method,args,function(v){promise.signal()}),promise},this.callWithObjectAsReturn=function(method,args){var value=ko.observable();return call(method,args,function(v){value(v)}),value},this.callWithArrayAsReturn=function(method,args){var value=ko.observableArray();return call(method,args,function(v){value(v)}),value},this.onCreated=function(lastDescendant){self.url=lastDescendant.url,0!==self.url.indexOf("/")&&(self.url="/"+self.url),self.name=lastDescendant.name}})}),Bifrost.dependencyResolvers.service={canResolve:function(namespace,name){return"undefined"!=typeof services&&name in services},resolve:function(namespace,name){return services[name].create()}},Bifrost.namespace("Bifrost",{documentService:Bifrost.Singleton(function(DOMRoot){var self=this;this.DOMRoot=DOMRoot,this.pageHasViewModel=function(viewModel){var context=ko.contextFor($("body")[0]);return!Bifrost.isUndefined(context)&&context.$data===viewModel},this.getViewModelNameFor=function(element){var dataViewModelName=element.attributes.getNamedItem("data-viewmodel-name");return Bifrost.isNullOrUndefined(dataViewModelName)&&((dataViewModelName=document.createAttribute("data-viewmodel-name")).value=Bifrost.Guid.create()),element.attributes.setNamedItem(dataViewModelName),dataViewModelName.value},this.setViewModelParametersOn=function(element,parameters){element.viewModelParameters=parameters},this.getViewModelParametersFrom=function(element){return element.viewModelParameters},this.hasViewModelParameters=function(element){return!Bifrost.isNullOrUndefined(element.viewModelParameters)},this.cleanChildrenOf=function(element){self.traverseObjects(function(child){child!==element&&($(child).unbind(),ko.cleanNode(child))},element)},this.hasViewFile=function(element){var attribute=element.attributes["data-view-file"];return!Bifrost.isNullOrUndefined(attribute)},this.getViewFileFrom=function(element){return self.hasViewFile(element)?element.attributes["data-view-file"].value:null},this.hasOwnRegion=function(element){return!!element.region},this.getParentRegionFor=function(element){for(;element.parentNode;)if((element=element.parentNode).region)return element.region;return null},this.getRegionFor=function(element){return element.region?element.region:self.getParentRegionFor(element)},this.setRegionOn=function(element,region){element.region=region},this.clearRegionOn=function(element){element.region=null},this.traverseObjects=function(callback,element){if(element=element||self.DOMRoot,!Bifrost.isNullOrUndefined(element)&&(callback(element),element.hasChildNodes()))for(var child=element.firstChild;child;){var nextSibling=child.nextSibling;1===child.nodeType&&self.traverseObjects(callback,child),child=nextSibling}},this.getUniqueStyleName=function(prefix){return prefix+"_"+Bifrost.Guid.create()},this.addStyle=function(selector,style){if(document.styleSheets){var i,styleString="";for(var property in style)styleString=styleString+property+":"+style[property]+";";if(style=styleString,0!==document.getElementsByTagName("head").length){var styleSheet,media,mediaType;if(document.styleSheets.length>0)for(i=0;i<document.styleSheets.length&&(document.styleSheets[i].disabled||(media=document.styleSheets[i].media,"string"===(mediaType=typeof media)?""!==media&&-1===media.indexOf("screen")||(styleSheet=document.styleSheets[i]):"object"===mediaType&&(""!==media.mediaText&&-1===media.mediaText.indexOf("screen")||(styleSheet=document.styleSheets[i])),void 0===styleSheet));i++);if(void 0===styleSheet){var styleSheetElement=document.createElement("style");for(styleSheetElement.type="text/css",document.getElementsByTagName("head")[0].appendChild(styleSheetElement),i=0;i<document.styleSheets.length;i++)document.styleSheets[i].disabled||(styleSheet=document.styleSheets[i]);mediaType=typeof(media=styleSheet.media)}if("string"===mediaType){for(i=0;i<styleSheet.rules.length;i++)if(styleSheet.rules[i].selectorText&&styleSheet.rules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.rules[i].style.cssText=style);styleSheet.addRule(selector,style)}else if("object"===mediaType){for(i=0;i<styleSheet.cssRules.length;i++)if(styleSheet.cssRules[i].selectorText&&styleSheet.cssRules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.cssRules[i].style.cssText=style);styleSheet.insertRule(selector+"{"+style+"}",0)}}}}})}),Bifrost.namespace("Bifrost.markup",{BindingContext:Bifrost.Type.extend(function(){this.parent=null,this.current=null,this.changed=Bifrost.Event.create()})}),Bifrost.namespace("Bifrost.markup",{bindingContextManager:Bifrost.Singleton(function(){this.ensure=function(element){},this.hasFor=function(element){},this.getFor=function(element){}})}),Bifrost.WellKnownTypesDependencyResolver.types.bindingContextManager=Bifrost.markup.bindingContextManager,Bifrost.namespace("Bifrost.markup",{attributeValues:Bifrost.Singleton(function(valueProviderParser){this.expandFor=function(element){}})}),Bifrost.namespace("Bifrost.markup",{valueProviderParser:Bifrost.Singleton(function(valueProviders,valueConsumers,typeConverters){function handleValue(instance,property,value){var consumer=valueConsumers.getFor(instance,property);self.hasValueProvider(value)?self.parseFor(instance,property,value).forEach(function(provider){provider.provide(consumer)}):consumer.consume(value)}var self=this,regex=new RegExp("{{([a-z ,:{{}}}]*)}}","g");this.hasValueProvider=function(value){return!!value.match(regex)},this.parseFor=function(instance,name,value){var providers=[],result=value.match(regex),expression=result[0].substr(2,result[0].length-4),rx=new RegExp("([a-z]*) +","g");if(1===(result=expression.match(rx)).length){var valueProviderName=result[0].trim();if(valueProviders.isKnown(valueProviderName)){var provider=valueProviders.getInstanceOf(valueProviderName);providers.push(provider),expression.length>result[0].length&&expression.substr(result[0].length).split(",").forEach(function(element){var keyValuePair=(element=element.trim()).split(":");if(keyValuePair.length,1===keyValuePair.length){var value=keyValuePair[0];handleValue(provider,provider.defaultProperty,value)}else 2===keyValuePair.length&&handleValue(provider,keyValuePair[0],keyValuePair[1])})}}return providers}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitor:Bifrost.Type.extend(function(){this.visit=function(element,resultActions){}})}),Bifrost.namespace("Bifrost.markup",{ElementVisitorResultActions:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.markup",{objectModelFactory:Bifrost.Singleton(function(dependencyResolver,documentService){function tryResolveTargetNamespaces(localName,targets,success,error){!function(queue){if(queue.length){var namespace=Bifrost.namespace(targets.shift()),found=!1;namespace._scripts.forEach(function(script){script.toLowerCase()===localName.toLowerCase()&&(dependencyResolver.beginResolve(namespace,script).continueWith(function(instance){success(instance)}).onFail(function(){tryResolveTargetNamespaces(localName,targets,success,error)}),found=!0)}),found||tryResolveTargetNamespaces(localName,targets,success,error)}else error()}(targets)}this.createFrom=function(element,localName,namespaceDefinition,success,error){tryResolveTargetNamespaces(localName,namespaceDefinition.targets,success,error)}})}),Bifrost.namespace("Bifrost.markup",{MultipleNamespacesInNameNotAllowed:Bifrost.Type.extend(function(tagName){})}),Bifrost.namespace("Bifrost.markup",{MultiplePropertyReferencesNotAllowed:Bifrost.Type.extend(function(tagName){})}),Bifrost.namespace("Bifrost.markup",{ParentTagNameMismatched:Bifrost.Type.extend(function(tagName,parentTagName){})}),Bifrost.namespace("Bifrost.markup",{NamespaceDefinition:Bifrost.Type.extend(function(prefix){var self=this;this.prefix=prefix,this.targets=[],this.addTarget=function(target){self.targets.push(target)}})}),Bifrost.namespace("Bifrost.markup",{namespaceDefinitions:Bifrost.Singleton(function(){this.create=function(prefix){return Bifrost.markup.NamespaceDefinition.create({prefix:prefix})}})}),Bifrost.namespace("Bifrost.markup",{namespaces:Bifrost.Singleton(function(namespaceDefinitions,elementNaming){function findNamespaceDefinitionInElementOrParent(prefix,element){if(!Bifrost.isNullOrUndefined(element.__namespaces)){var found=null;if(element.__namespaces.forEach(function(definition){if(definition.prefix===prefix)return found=definition,!1}),null!=found)return found}if(Bifrost.isNullOrUndefined(element.parentElement)||element.parentElement.constructor===HTMLHtmlElement)return null;var parentResult=findNamespaceDefinitionInElementOrParent(prefix,element.parentElement);return null!=parentResult?parentResult:null}var self=this;this.global=namespaceDefinitions.create("__global"),this.expandNamespaceDefinitions=function(element){for(var attributeIndex=0;attributeIndex<element.attributes.length;attributeIndex++){var attribute=element.attributes[attributeIndex];if(0===attribute.name.indexOf("ns:")){var prefix=attribute.name.substr("ns:".length),target=attribute.value,namespaceDefinition=findNamespaceDefinitionInElementOrParent(prefix,element);Bifrost.isNullOrUndefined(namespaceDefinition)&&(Bifrost.isNullOrUndefined(element.__namespaces)&&(element.__namespaces=[]),namespaceDefinition=namespaceDefinitions.create(prefix),element.__namespaces.push(namespaceDefinition)),namespaceDefinition.addTarget(target)}}},this.resolveFor=function(element){var prefix=elementNaming.getNamespacePrefixFor(element);return Bifrost.isNullOrUndefined(prefix)||""===prefix?self.global:findNamespaceDefinitionInElementOrParent(prefix,element)}})}),Bifrost.namespace("Bifrost.markup",{elementNaming:Bifrost.Singleton(function(){function getNameAndNamespace(element){var namespace,name=element.localName.toLowerCase(),namespaceSplit=name.split(":");if(namespaceSplit.length>2)throw Bifrost.markup.MultipleNamespacesInNameNotAllowed.create({tagName:name});return 2===namespaceSplit.length&&(name=namespaceSplit[1],namespace=namespaceSplit[0]),{name:name,namespace:namespace}}this.getNamespacePrefixFor=function(element){var nameAndNamespace=getNameAndNamespace(element);return Bifrost.isNullOrUndefined(nameAndNamespace.namespace)?"":nameAndNamespace.namespace},this.getLocalNameFor=function(element){return getNameAndNamespace(element).name}})}),Bifrost.namespace("Bifrost.markup",{propertyExpander:Bifrost.Singleton(function(valueProviderParser){this.expand=function(element,target){for(var attributeIndex=0;attributeIndex<element.attributes.length;attributeIndex++){var name=element.attributes[attributeIndex].localName,value=element.attributes[attributeIndex].value;name in target&&valueProviderParser.hasValueProvider(value)&&valueProviderParser.parseFor(target,name,value)}}})}),Bifrost.namespace("Bifrost.markup",{ObjectModelElementVisitor:Bifrost.markup.ElementVisitor.extend(function(elementNaming,namespaces,objectModelFactory,propertyExpander,UIElementPreparer,attributeValues,bindingContextManager){this.visit=function(element,actions){if(namespaces.expandNamespaceDefinitions(element),bindingContextManager.ensure(element),element.isKnownType())attributeValues.expandFor(element);else{var localName=elementNaming.getLocalNameFor(element),namespaceDefinition=namespaces.resolveFor(element);objectModelFactory.createFrom(element,localName,namespaceDefinition,function(instance){propertyExpander.expand(element,instance),UIElementPreparer.prepare(element,instance)},function(){})}}})}),Bifrost.namespace("Bifrost.markup",{NamingRoot:Bifrost.Type.extend(function(){var self=this;this.target=null,this.find=function(name,element){if(Bifrost.isNullOrUndefined(element)){if(Bifrost.isNullOrUndefined(self.target))return null;element=self.target}if(element.getAttribute("name")===name)return element;if(element.hasChildNodes())for(var child=element.firstChild;child;){if(1===child.nodeType){var foundElement=self.find(name,child);if(null!=foundElement)return foundElement}child=child.nextSibling}return null}})}),Bifrost.namespace("Bifrost.markup",{UIElement:Bifrost.markup.NamingRoot.extend(function(){this.prepare=function(type,element){}})}),Bifrost.namespace("Bifrost.markup",{UIElementPreparer:Bifrost.Singleton(function(){this.prepare=function(element,instance){var result=instance.prepare(instance._type,element);result instanceof Bifrost.execution.Promise&&result.continueWith(function(){Bifrost.isNullOrUndefined(instance.template)||(Bifrost.views.UIManager.create().handle(instance.template),ko.applyBindingsToNode(instance.template,{with:instance}),element.parentElement.replaceChild(instance.template,element))})}})}),Bifrost.namespace("Bifrost.markup",{Control:Bifrost.markup.UIElement.extend(function(){var self=this;this.template=null,this.prepare=function(type,element){var promise=Bifrost.execution.Promise.create(),file=type._namespace._path+type._name+".html";return require(["text!"+file+"!strip"],function(v){var container=document.createElement("div");container.innerHTML=v,self.template=container,promise.signal()}),promise}})}),Bifrost.namespace("Bifrost.views",{PostBindingVisitor:Bifrost.Type.extend(function(){this.visit=function(element){}})}),Bifrost.namespace("Bifrost.views",{UIManager:Bifrost.Singleton(function(documentService){var elementVisitorTypes=Bifrost.markup.ElementVisitor.getExtenders(),elementVisitors=[],postBindingVisitorTypes=Bifrost.views.PostBindingVisitor.getExtenders(),postBindingVisitors=[];elementVisitorTypes.forEach(function(type){elementVisitors.push(type.create())}),postBindingVisitorTypes.forEach(function(type){postBindingVisitors.push(type.create())}),this.handle=function(root){documentService.traverseObjects(function(element){elementVisitors.forEach(function(visitor){var actions=Bifrost.markup.ElementVisitorResultActions.create();visitor.visit(element,actions)})},root)},this.handlePostBinding=function(root){documentService.traverseObjects(function(element){postBindingVisitors.forEach(function(visitor){visitor.visit(element)})},root)}})}),Bifrost.WellKnownTypesDependencyResolver.types.UIManager=Bifrost.views.UIManager,Bifrost.namespace("Bifrost.views",{Content:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{Items:Bifrost.Type.extend(function(){})}),Bifrost.namespace("Bifrost.views",{ComposeTask:Bifrost.tasks.Task.extend(function(){this.execute=function(){}})}),Bifrost.namespace("Bifrost.views",{viewManager:Bifrost.Singleton(function(viewFactory,pathResolvers,regionManager,UIManager,viewModelManager,viewModelLoader,viewModelTypes,documentService){function setViewModelForElement(element,viewModel){viewModelManager.masterViewModel.setFor(element,viewModel);var viewModelName=documentService.getViewModelNameFor(element),dataBindString="",dataBind=element.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(dataBind)?dataBind=document.createAttribute("data-bind"):dataBindString=dataBind.value+", ",dataBind.value=dataBindString+"viewModel: $root['"+viewModelName+"']",element.attributes.setNamedItem(dataBind)}this.initializeLandingPage=function(){var promise=Bifrost.execution.Promise.create(),body=document.body;if(null!==body){var file=Bifrost.Path.getFilenameWithoutExtension(document.location.toString());if(""===file&&(file="index"),pathResolvers.canResolve(body,file)){var actualPath=pathResolvers.resolve(body,file),view=viewFactory.createFrom(actualPath);view.element=body,view.content=body.innerHTML,body.view=view;var region=regionManager.getFor(view);regionManager.describe(view,region).continueWith(function(){if(viewModelManager.hasForView(actualPath)){var viewModelPath=viewModelManager.getViewModelPathForView(actualPath);viewModelManager.isLoaded(viewModelPath)?viewModelTypes.beginCreateInstanceOfViewModel(viewModelPath,region).continueWith(function(viewModel){Bifrost.isNullOrUndefined(viewModel)||setViewModelForElement(body,viewModel)}):viewModelLoader.load(viewModelPath,region).continueWith(function(viewModel){Bifrost.isNullOrUndefined(viewModel)||setViewModelForElement(body,viewModel)})}UIManager.handle(body),promise.signal()})}}return promise},this.attach=function(element){UIManager.handle(element),viewModelManager.masterViewModel.applyTo(element)}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewManager=Bifrost.views.viewManager,Bifrost.namespace("Bifrost.views",{PathResolver:Bifrost.Type.extend(function(){this.canResolve=function(element,path){return!1},this.resolve=function(element,path){}})}),Bifrost.namespace("Bifrost.views",{pathResolvers:Bifrost.Singleton(function(){function getResolvers(){var resolvers=[];for(var property in Bifrost.views.pathResolvers)if(Bifrost.views.pathResolvers.hasOwnProperty(property)){var value=Bifrost.views.pathResolvers[property];if("function"==typeof value&&"function"==typeof value.create){var resolver=value.create();"function"==typeof resolver.canResolve&&resolvers.push(resolver)}}return resolvers}this.canResolve=function(element,path){for(var resolvers=getResolvers(),resolverIndex=0;resolverIndex<resolvers.length;resolverIndex++)if(!0===resolvers[resolverIndex].canResolve(element,path))return!0;return!1},this.resolve=function(element,path){for(var resolvers=getResolvers(),resolverIndex=0;resolverIndex<resolvers.length;resolverIndex++){var resolver=resolvers[resolverIndex];if(resolver.canResolve(element,path))return resolver.resolve(element,path)}return null}})}),Bifrost.namespace("Bifrost.views",{UriMapperPathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(element,path){var closest=$(element).closest("[data-urimapper]");if(1===closest.length){var mapperName=$(closest[0]).data("urimapper");if(!0===Bifrost.uriMappers[mapperName].hasMappingFor(path))return!0}return Bifrost.uriMappers.default.hasMappingFor(path)},this.resolve=function(element,path){var closest=$(element).closest("[data-urimapper]");if(1===closest.length){var mapperName=$(closest[0]).data("urimapper");if(!0===Bifrost.uriMappers[mapperName].hasMappingFor(path))return Bifrost.uriMappers[mapperName].resolve(path)}return Bifrost.uriMappers.default.resolve(path)}})}),void 0!==Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.UriMapperPathResolver=Bifrost.views.UriMapperPathResolver),Bifrost.namespace("Bifrost.views",{RelativePathResolver:Bifrost.views.PathResolver.extend(function(){this.canResolve=function(element,path){var closest=$(element).closest("[data-view]");if(1===closest.length)$(closest[0]).view;return!1},this.resolve=function(element,path){var closest=$(element).closest("[data-urimapper]");if(1===closest.length){var mapperName=$(closest[0]).data("urimapper");if(!0===Bifrost.uriMappers[mapperName].hasMappingFor(path))return Bifrost.uriMappers[mapperName].resolve(path)}return Bifrost.uriMappers.default.resolve(path)}})}),void 0!==Bifrost.views.pathResolvers&&(Bifrost.views.pathResolvers.RelativePathResolver=Bifrost.views.RelativePathResolver),Bifrost.namespace("Bifrost.views",{View:Bifrost.Type.extend(function(viewLoader,viewModelTypes,viewModelManager,path){var self=this;this.path=path,this.content="[CONTENT NOT LOADED]",this.element=null,this.viewModelType=null,this.viewModelPath=null,this.region=null,this.load=function(region){self.region=region;var promise=Bifrost.execution.Promise.create();return self.viewModelPath=viewModelManager.getViewModelPathForView(path),viewLoader.load(self.path,region).continueWith(function(html){self.content=html,self.viewModelType=viewModelTypes.getViewModelTypeForPath(self.viewModelPath),promise.signal(self)}),promise}})}),Bifrost.namespace("Bifrost.views",{viewFactory:Bifrost.Singleton(function(){this.createFrom=function(path){return Bifrost.views.View.create({path:path})}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewFactory=Bifrost.views.viewFactory,Bifrost.namespace("Bifrost.views",{ViewLoadTask:Bifrost.views.ComposeTask.extend(function(files,fileManager){var self=this;this.files=[],files.forEach(function(file){self.files.push(file.path.fullPath)}),this.execute=function(){var promise=Bifrost.execution.Promise.create();return fileManager.load(files).continueWith(function(instances){var view=instances[0];promise.signal(view)}),promise}})}),Bifrost.namespace("Bifrost.views",{viewLoader:Bifrost.Singleton(function(viewModelManager,taskFactory,fileFactory,regionManager){this.load=function(path,region){var promise=Bifrost.execution.Promise.create(),files=[],viewFile=fileFactory.create(path,Bifrost.io.fileType.html);path.indexOf("?")>0&&(viewFile.path.fullPath=viewFile.path.fullPath+path.substr(path.indexOf("?"))),files.push(viewFile);var viewModelPath=null;if(viewModelManager.hasForView(path)&&(viewModelPath=viewModelManager.getViewModelPathForView(path),!viewModelManager.isLoaded(viewModelPath))){var viewModelFile=fileFactory.create(viewModelPath,Bifrost.io.fileType.javaScript);files.push(viewModelFile)}var task=taskFactory.createViewLoad(files);return region.tasks.execute(task).continueWith(function(view){promise.signal(view)}),promise}})}),Bifrost.namespace("Bifrost.views",{viewBindingHandler:Bifrost.Type.extend(function(ViewBindingHandlerTemplateEngine,UIManager,viewFactory,viewManager,viewModelManager,documentService,regionManager,pathResolvers){function makeTemplateValueAccessor(element,valueAccessor,allBindingsAccessor,bindingContext){return function(){var viewUri=ko.utils.unwrapObservable(valueAccessor());element.viewUri!==viewUri&&(element.children.forEach(ko.removeNode),element.viewModel=null,element.view=null,element.templateSource=null,element.innerHTML=""),element.viewUri=viewUri;var viewModel=ko.observable(element.viewModel),viewModelParameters=allBindingsAccessor().viewModelParameters||{},templateEngine=null,view=null,region=null;if(Bifrost.isNullOrUndefined(viewUri)||""===viewUri)templateEngine=new ko.nativeTemplateEngine;else{templateEngine=ViewBindingHandlerTemplateEngine;var actualPath=pathResolvers.resolve(element,viewUri);(view=viewFactory.createFrom(actualPath)).element=element,region=regionManager.getFor(view)}return{if:!0,data:viewModel,element:element,templateEngine:templateEngine,viewUri:viewUri,viewModelParameters:viewModelParameters,view:view,region:region}}}this.init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return ko.bindingHandlers.template.init(element,makeTemplateValueAccessor(element,valueAccessor,allBindingsAccessor),allBindingsAccessor,viewModel,bindingContext)},this.update=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return ko.bindingHandlers.template.update(element,makeTemplateValueAccessor(element,valueAccessor,allBindingsAccessor),allBindingsAccessor,viewModel,bindingContext)}})}),Bifrost.views.viewBindingHandler.initialize=function(){ko.bindingHandlers.view=Bifrost.views.viewBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.view=!1,ko.virtualElements.allowedBindings.view=!0},Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateSource:Bifrost.Type.extend(function(viewFactory){var content="";this.loadFor=function(element,view,region){var promise=Bifrost.execution.Promise.create();return view.load(region).continueWith(function(loadedView){var wrapper=document.createElement("div");wrapper.innerHTML=loadedView.content,content=wrapper.innerHTML,Bifrost.isNullOrUndefined(loadedView.viewModelType)?promise.signal(loadedView):(Bifrost.views.Region.current=region,view.viewModelType.ensure().continueWith(function(){promise.signal(loadedView)}))}),promise},this.data=function(key,value){},this.text=function(value){return content}})}),Bifrost.namespace("Bifrost.views",{ViewBindingHandlerTemplateEngine:Bifrost.Type.extend(function(viewModelManager,regionManager,UIManager){var self=this;this.renderTemplate=function(template,bindingContext,options){var templateSource;Bifrost.isNullOrUndefined(options.element.templateSource)?(templateSource=Bifrost.views.ViewBindingHandlerTemplateSource.create({viewUri:options.viewUri,region:options.region}),options.element.templateSource=templateSource):templateSource=options.element.templateSource,Bifrost.isNullOrUndefined(options.element.view)&&templateSource.loadFor(options.element,options.view,options.region).continueWith(function(view){options.element.view=view,regionManager.describe(options.view,options.region).continueWith(function(){try{ko.dependencyDetection.begin();var instance;if(Bifrost.isNullOrUndefined(view.viewModelType))instance={},options.data(instance),bindingContext.$data=instance;else{var viewModelParameters=options.viewModelParameters;viewModelParameters.region=options.region,instance=view.viewModelType.create(viewModelParameters),options.element.viewModel=instance,options.data(instance),bindingContext.$data=instance}}finally{ko.dependencyDetection.end()}})}),bindingContext.$root=bindingContext.$data;var renderedTemplateSource=self.renderTemplateSource(templateSource,bindingContext,options);return renderedTemplateSource.forEach(function(element){element.constructor!==Text&&element.constructor!==Comment&&UIManager.handle(element)}),renderedTemplateSource}})}),function(){var nativeTemplateEngine=new ko.nativeTemplateEngine,baseCreate=Bifrost.views.ViewBindingHandlerTemplateEngine.create;Bifrost.views.ViewBindingHandlerTemplateEngine.create=function(){var instance=baseCreate.call(Bifrost.views.ViewBindingHandlerTemplateEngine,arguments);for(var property in nativeTemplateEngine)instance.hasOwnProperty(property)||(instance[property]=nativeTemplateEngine[property]);return instance}}(),Bifrost.namespace("Bifrost.views",{MasterViewModel:Bifrost.Type.extend(function(documentService){function deactivateViewModel(viewModel){Bifrost.isNullOrUndefined(viewModel)||Bifrost.isFunction(viewModel.deactivated)&&viewModel.deactivated()}function activateViewModel(viewModel){!Bifrost.isNullOrUndefined(viewModel)&&Bifrost.isFunction(viewModel.activated)&&viewModel.activated()}var self=this;this.setFor=function(element,viewModel){var existingViewModel=self.getFor(element);existingViewModel!==viewModel&&deactivateViewModel(existingViewModel);var name=documentService.getViewModelNameFor(element);self[name]=viewModel,activateViewModel(viewModel)},this.getFor=function(element){var name=documentService.getViewModelNameFor(element);return self.hasOwnProperty(name)?self[name]:null},this.clearFor=function(element){var name=documentService.getViewModelNameFor(element);self.hasOwnProperty(name)||(deactivateViewModel(self[name]),delete self[name],self[name]=null)},this.apply=function(){ko.applyBindings(self)},this.applyTo=function(element){ko.applyBindings(self,element)}})}),Bifrost.namespace("Bifrost.views",{ViewModel:Bifrost.Type.extend(function(region){var self=this;this.targetViewModel=this,this.region=region,this.activated=function(){"function"==typeof self.targetViewModel.onActivated&&self.targetViewModel.onActivated()},this.deactivated=function(){"function"==typeof self.targetViewModel.onDeactivated&&self.targetViewModel.onDeactivated()},this.onCreated=function(lastDescendant){self.targetViewModel=lastDescendant}})}),Bifrost.namespace("Bifrost.views",{viewModelTypes:Bifrost.Singleton(function(){function getNamespaceFrom(path){var localPath=Bifrost.Path.getPathWithoutFilename(path),namespacePath=Bifrost.namespaceMappers.mapPathToNamespace(localPath);return null!=namespacePath?Bifrost.namespace(namespacePath):null}function getTypeNameFrom(path){Bifrost.Path.getPathWithoutFilename(path);return Bifrost.Path.getFilenameWithoutExtension(path)}function getViewModelTypeForPathImplementation(path){var namespace=getNamespaceFrom(path);if(null!=namespace){var typename=getTypeNameFrom(path);if(Bifrost.isType(namespace[typename]))return namespace[typename]}return null}var self=this;this.isLoaded=function(path){var namespace=getNamespaceFrom(path);return null!=namespace&&getTypeNameFrom(path)in namespace},this.getViewModelTypeForPath=function(path){var type=getViewModelTypeForPathImplementation(path);if(Bifrost.isNullOrUndefined(type)){var deepPath=path.replace(".js","/index.js");type=getViewModelTypeForPathImplementation(deepPath),Bifrost.isNullOrUndefined(type)&&getViewModelTypeForPathImplementation(deepPath=path.replace(".js","/Index.js"))}return type},this.beginCreateInstanceOfViewModel=function(path,region,viewModelParameters){var promise=Bifrost.execution.Promise.create(),type=self.getViewModelTypeForPath(path);if(null!=type){Bifrost.views.Region.current;Bifrost.views.Region.current=region,(viewModelParameters=viewModelParameters||{}).region=region,type.beginCreate(viewModelParameters).continueWith(function(instance){promise.signal(instance)}).onFail(function(error){throw console.log("ViewModel '"+path+"' failed instantiation"),error})}else console.log("ViewModel '"+path+"' does not exist"),promise.signal(null);return promise}})}),Bifrost.WellKnownTypesDependencyResolver.types.viewModelTypes=Bifrost.views.viewModelTypes,Bifrost.namespace("Bifrost.views",{viewModelLoader:Bifrost.Singleton(function(taskFactory,fileFactory,viewModelTypes){this.load=function(path,region,viewModelParameters){var promise=Bifrost.execution.Promise.create(),file=fileFactory.create(path,Bifrost.io.fileType.javaScript),task=taskFactory.createViewModelLoad([file]);return region.tasks.execute(task).continueWith(function(){viewModelTypes.beginCreateInstanceOfViewModel(path,region,viewModelParameters).continueWith(function(instance){promise.signal(instance)})}),promise}})}),Bifrost.namespace("Bifrost.views",{ViewModelLoadTask:Bifrost.views.ComposeTask.extend(function(files,fileManager){var self=this;this.files=[],files.forEach(function(file){self.files.push(file.path.fullPath)}),this.execute=function(){var promise=Bifrost.execution.Promise.create();return fileManager.load(files).continueWith(function(instances){promise.signal(instances)}),promise}})}),Bifrost.namespace("Bifrost.views",{viewModelManager:Bifrost.Singleton(function(assetsManager,documentService,viewModelLoader,regionManager,taskFactory,viewFactory,MasterViewModel){var self=this;this.assetsManager=assetsManager,this.viewModelLoader=viewModelLoader,this.documentService=documentService,this.masterViewModel=MasterViewModel,this.hasForView=function(viewPath){var scriptFile=Bifrost.Path.changeExtension(viewPath,"js");return scriptFile=Bifrost.Path.makeRelative(scriptFile),self.assetsManager.hasScript(scriptFile)},this.getViewModelPathForView=function(viewPath){return Bifrost.Path.changeExtension(viewPath,"js")},this.isLoaded=function(path){var localPath=Bifrost.Path.getPathWithoutFilename(path),filename=Bifrost.Path.getFilenameWithoutExtension(path),namespacePath=Bifrost.namespaceMappers.mapPathToNamespace(localPath);return null!=namespacePath&&filename in Bifrost.namespace(namespacePath)}})}),Bifrost.namespace("Bifrost.views",{viewModelBindingHandler:Bifrost.Type.extend(function(documentService,viewFactory,viewModelLoader,viewModelManager,viewModelTypes,regionManager){this.init=function(element,valueAccessor,allBindingsAccessor,parentViewModel,bindingContext){var path=ko.utils.unwrapObservable(valueAccessor());if(!0!==element._isLoading&&(element._viewModelPath!==path||Bifrost.isNullOrUndefined(element._viewModel))){element._isLoading=!0,element._viewModelPath=path;var viewPath="/";documentService.hasViewFile(element)&&(viewPath=documentService.getViewFileFrom(element));var view=viewFactory.createFrom(viewPath);view.content=element.innerHTML,view.element=element;var viewModelInstance=ko.observable(),region=regionManager.getFor(view);return regionManager.describe(view,region).continueWith(function(){var viewModelParameters=allBindingsAccessor().viewModelParameters||{};if(viewModelParameters.region=region,viewModelTypes.isLoaded(path)){var viewModelType=viewModelTypes.getViewModelTypeForPath(path),lastRegion=Bifrost.views.Region.current;Bifrost.views.Region.current=region,viewModelType.beginCreate(viewModelParameters).continueWith(function(viewModel){bindingContext.createChildContext(viewModel).$root=viewModel,element._viewModel=viewModel,viewModelInstance(viewModel),Bifrost.views.Region.current=lastRegion,element._isLoading=!1}).onFail(function(e){console.log("Could not create an instance of '"+viewModelType._namespace.name+"."+viewModelType._name+" - Reason : "+e)})}else viewModelLoader.load(path,region,viewModelParameters).continueWith(function(viewModel){bindingContext.createChildContext(viewModel).$root=viewModel,element._viewModel=viewModel,viewModelInstance(viewModel),element._isLoading=!1})}),ko.bindingHandlers.with.init(element,viewModelInstance,allBindingsAccessor,parentViewModel,bindingContext)}}})}),Bifrost.views.viewModelBindingHandler.initialize=function(){ko.bindingHandlers.viewModel=Bifrost.views.viewModelBindingHandler.create()},Bifrost.namespace("Bifrost.views",{Region:function(messengerFactory,operationsFactory,tasksFactory){function thisOrChildHasTaskType(taskType,propertyName){return ko.computed(function(){var hasTask=!1;return self.children().forEach(function(childRegion){!0!==childRegion[propertyName]()||(hasTask=!0)}),self.tasks.all().forEach(function(task){!0===task._type.typeOf(taskType)&&(hasTask=!0)}),hasTask})}function thisOrChildCommandHasPropertySetToTrue(commandPropertyName,breakIfThisHasNoCommands){return ko.computed(function(){var isSet=!0,commands=self.aggregatedCommands();return(!0!==breakIfThisHasNoCommands||0!==commands.length)&&(commands.forEach(function(command){!1!==command[commandPropertyName]()||(isSet=!1)}),isSet)})}var self=this;this.view=ko.observable(),this.viewModel=null,this.messenger=messengerFactory.create(),this.globalMessenger=messengerFactory.global(),this.operations=operationsFactory.create(),this.tasks=tasksFactory.create(),this.parent=null,this.children=ko.observableArray(),this.commands=ko.observableArray(),this.isCommandRoot=ko.observable(!1),this.aggregatedCommands=ko.computed(function(){var commands=[];return self.commands().forEach(function(command){commands.push(command)}),self.children().forEach(function(childRegion){childRegion.isCommandRoot()||childRegion.aggregatedCommands().forEach(function(command){commands.push(command)})}),commands}),this.isValid=thisOrChildCommandHasPropertySetToTrue("isValid"),this.canCommandsExecute=thisOrChildCommandHasPropertySetToTrue("canExecute",!0),this.areCommandsAuthorized=thisOrChildCommandHasPropertySetToTrue("isAuthorized"),this.commandsHaveChanges=function(commandPropertyName){return ko.computed(function(){var isSet=!1;return self.aggregatedCommands().forEach(function(command){!0!==command[commandPropertyName]()||(isSet=!0)}),isSet})}("hasChanges"),this.areCommandsReadyToExecute=thisOrChildCommandHasPropertySetToTrue("isReadyToExecute",!0),this.hasChanges=ko.computed(function(){var commandsHaveChanges=self.commandsHaveChanges(),childrenHasChanges=!1;return self.children().forEach(function(childRegion){childRegion.isCommandRoot()||!0!==childRegion.hasChanges()||(childrenHasChanges=!0)}),commandsHaveChanges||self.operations.stateful().length>0||childrenHasChanges}),this.validationMessages=ko.computed(function(){var messages=[];return self.aggregatedCommands().forEach(function(command){!1===command.isValid()&&command.validators().forEach(function(validator){!1===validator.isValid()&&messages.push(validator.message())})}),messages}),this.isExecuting=thisOrChildHasTaskType(Bifrost.tasks.ExecutionTask,"isExecuting"),this.isComposing=thisOrChildHasTaskType(Bifrost.views.ComposeTask,"isComposing"),this.isLoading=thisOrChildHasTaskType(Bifrost.tasks.LoadTask,"isLoading"),this.isBusy=ko.computed(function(){var isBusy=!1;return self.children().forEach(function(childRegion){!0!==childRegion.isBusy()||(isBusy=!0)}),self.tasks.all().length>0&&(isBusy=!0),isBusy})}}),Bifrost.views.Region.current=null,Bifrost.dependencyResolvers.Region={canResolve:function(namespace,name){return"region"===name},resolve:function(namespace,name){return Bifrost.views.Region.current}},Bifrost.namespace("Bifrost.views",{regionManager:Bifrost.Singleton(function(documentService,regionDescriptorManager,messengerFactory,operationsFactory,tasksFactory){function createRegionInstance(){return new Bifrost.views.Region(messengerFactory,operationsFactory,tasksFactory)}function manageInheritance(element){var parentRegion=documentService.getParentRegionFor(element);if(parentRegion)Bifrost.views.Region.prototype=parentRegion;else{var topLevel=createRegionInstance();regionDescriptorManager.describeTopLevel(topLevel),Bifrost.views.Region.prototype=topLevel}return parentRegion}function manageHierarchy(parentRegion){var region=createRegionInstance();return region.parent=parentRegion,parentRegion&&parentRegion.children.push(region),region}this.getFor=function(view){var region,element=view.element;return documentService.hasOwnRegion(element)?((region=documentService.getRegionFor(element)).view(view),region):((region=manageHierarchy(manageInheritance(element))).view(view),documentService.setRegionOn(element,region),region)},this.describe=function(view,region){var promise=Bifrost.execution.Promise.create();view.element;return regionDescriptorManager.describe(view,region).continueWith(function(){promise.signal()}),promise},this.getCurrent=function(){return Bifrost.views.Region.current},this.evict=function(region){region.parentRegion&&region.parentRegion.children.remove(region),region.parentRegion=null}})}),Bifrost.WellKnownTypesDependencyResolver.types.regionManager=Bifrost.views.regionManage,Bifrost.namespace("Bifrost.views",{RegionDescriptor:Bifrost.Type.extend(function(){this.describe=function(region){}})}),Bifrost.namespace("Bifrost.views",{regionDescriptorManager:Bifrost.Singleton(function(){this.describe=function(view,region){var promise=Bifrost.execution.Promise.create(),localPath=Bifrost.Path.getPathWithoutFilename(view.path),namespacePath=Bifrost.namespaceMappers.mapPathToNamespace(localPath);if(null!=namespacePath){var namespace=Bifrost.namespace(namespacePath);Bifrost.views.Region.current=region,Bifrost.dependencyResolver.beginResolve(namespace,"RegionDescriptor").continueWith(function(descriptor){descriptor.describe(region),promise.signal()}).onFail(function(){promise.signal()})}else promise.signal();return promise},this.describeTopLevel=function(region){}})}),Bifrost.dependencyResolvers.RegionDescriptor={canResolve:function(namespace,name){return"RegionDescriptor"===name},resolve:function(namespace,name){return{describe:function(){}}}},Bifrost.namespace("Bifrost.views",{DataViewAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(element,actions){var dataView=element.attributes.getNamedItem("data-view");if(!Bifrost.isNullOrUndefined(dataView)){var dataBindString="",dataBind=element.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(dataBind)?dataBind=document.createAttribute("data-bind"):dataBindString=dataBind.value+", ",dataBind.value=dataBindString+"view: '"+dataView.value+"'",element.attributes.setNamedItem(dataBind),element.attributes.removeNamedItem("data-view")}}})}),Bifrost.namespace("Bifrost.views",{DataViewModelFileAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){this.visit=function(element,actions){var dataView=element.attributes.getNamedItem("data-viewmodel-file");if(!Bifrost.isNullOrUndefined(dataView)){var dataBindString="",dataBind=element.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(dataBind)?dataBind=document.createAttribute("data-bind"):dataBindString=dataBind.value+", ",dataBind.value=dataBindString+"viewModel: '"+dataView.value+"'",element.attributes.setNamedItem(dataBind),element.attributes.removeNamedItem("data-viewmodel-file")}}})}),Bifrost.namespace("Bifrost.interaction",{VisualStateManagerElementVisitor:Bifrost.markup.ElementVisitor.extend(function(){function parseActions(namingRoot,stateElement,state){if(stateElement.hasChildNodes())for(var child=stateElement.firstChild;child;)visualStateActionTypes.forEach(function(type){if(type._name.toLowerCase()===child.localName){for(var action=type.create(),attributeIndex=0;attributeIndex<child.attributes.length;attributeIndex++){var name=child.attributes[attributeIndex].localName,value=child.attributes[attributeIndex].value;action.hasOwnProperty(name)&&(action[name]=value)}action.initialize(namingRoot),state.addAction(action)}}),child=child.nextSibling}function parseStates(namingRoot,groupElement,group){if(groupElement.hasChildNodes())for(var child=groupElement.firstChild;child;){if("visualstate"===child.localName){var state=Bifrost.interaction.VisualState.create();state.name=child.getAttribute("name"),group.addState(state),parseActions(namingRoot,child,state)}child=child.nextSibling}}var visualStateActionTypes=Bifrost.interaction.VisualStateAction.getExtenders();this.visit=function(element,actions){if("visualstatemanager"===element.localName){var visualStateManager=Bifrost.interaction.VisualStateManager.create(),namingRoot=element.parentElement.namingRoot;if(element.parentElement.visualStateManager=visualStateManager,element.hasChildNodes())for(var child=element.firstChild;child;){if("visualstategroup"===child.localName){var group=Bifrost.interaction.VisualStateGroup.create();visualStateManager.addGroup(group);var duration=child.getAttribute("duration");if(!Bifrost.isNullOrUndefined(duration)&&(duration=parseFloat(duration),!isNaN(duration))){duration*=1e3;var timespan=Bifrost.TimeSpan.fromMilliseconds(duration);group.defaultDuration=timespan}parseStates(namingRoot,child,group)}child=child.nextSibling}}}})}),Bifrost.namespace("Bifrost.navigation",{NavigationFrame:Bifrost.Type.extend(function(home,uriMapper,history){var self=this;this.home=home,this.history=history,this.container=null,this.currentUri=ko.observable(home),this.uriMapper=uriMapper||null,this.setCurrentUri=function(path){0===path.indexOf("/")&&(path=path.substr(1)),path.lastIndexOf("/")===path.length-1&&(path=path.substr(0,path.length-1)),null!=path&&0!==path.length||(path=self.home),null==self.uriMapper||self.uriMapper.hasMappingFor(path)||(path=self.home),self.currentUri(path)},this.setCurrentUriFromCurrentLocation=function(){var state=self.history.getState(),uri=Bifrost.Uri.create(state.url);self.setCurrentUri(uri.path)},history.Adapter.bind(window,"statechange",function(){self.setCurrentUriFromCurrentLocation()}),this.configureFor=function(container){self.setCurrentUriFromCurrentLocation(),self.container=container;var uriMapper=$(container).closest("[data-urimapper]");if(1===uriMapper.length){var uriMapperName=$(uriMapper[0]).data("urimapper");uriMapperName in Bifrost.uriMappers&&(self.uriMapper=Bifrost.uriMappers[uriMapperName])}null==self.uriMapper&&(self.uriMapper=Bifrost.uriMappers.default)},this.navigate=function(uri){self.setCurrentUri(uri)}})}),"undefined"!=typeof ko&&"undefined"!=typeof History&&void 0!==History.Adapter&&(ko.bindingHandlers.navigateTo={init:function(element,valueAccessor,allBindingAccessor,viewModel){ko.applyBindingsToNode(element,{click:function(){var featureName=valueAccessor()();History.pushState({feature:featureName},$(element).attr("title"),"/"+featureName)}},viewModel)}}),Bifrost.namespace("Bifrost.navigation",{navigateTo:function(featureName,queryString){var url=featureName;"/"!==featureName.charAt(0)&&(url="/"+url),queryString&&(url+=queryString),"undefined"!=typeof History&&void 0!==History.Adapter&&History.pushState({},"",url)},navigationManager:{getCurrentLocation:function(){return Bifrost.Uri.create(window.location.toString())},hookup:function(){"undefined"!=typeof History&&void 0!==History.Adapter&&$("body").click(function(e){var href=e.target.href;if(void 0===href){var closestAnchor=$(e.target).closest("a")[0];if(!closestAnchor)return;href=closestAnchor.href}href.indexOf("#!")>0&&(href=href.substr(0,href.indexOf("#!"))),0===href.length&&(href="/");var targetUri=Bifrost.Uri.create(href);if(targetUri.isSameAsOrigin&&targetUri.queryString.indexOf("postback")<0){for(var target=targetUri.path;0===target.indexOf("/");)target=target.substr(1);e.preventDefault();var result=$(e.target).closest("[data-navigation-target]");if(1===result.length){var id=$(result[0]).data("navigation-target"),element=$("#"+id);1===element.length&&void 0!==element[0].navigationFrame&&element[0].navigationFrame.navigate(targetUri.path)}else{var queryString=targetUri.queryString.length>0?"?"+targetUri.queryString:"";History.pushState({},"","/"+target+queryString)}}})}}}),Bifrost.namespace("Bifrost.navigation",{observableQueryParameterFactory:Bifrost.Singleton(function(){var historyEnabled="undefined"!=typeof History&&void 0!==History.Adapter;this.create=function(parameterName,defaultValue,navigationManager){function getState(){var uri=navigationManager.getCurrentLocation();return uri.parameters.hasOwnProperty(parameterName)?uri.parameters[parameterName]:null}function getQueryStringParametersWithValueForParameter(url,parameterValue){var parameters=Bifrost.hashString.decode(url);parameters[parameterName]=parameterValue;var queryString="",parameterIndex=0;for(var parameter in parameters){var value=parameters[parameter];Bifrost.isNullOrUndefined(value)||(parameterIndex>0&&(queryString+="&"),queryString+=parameter+"="+value),parameterIndex++}return queryString}function cleanQueryString(queryString){return 0!==queryString.indexOf("#")&&0!==queryString.indexOf("?")||(queryString=queryString.substr(1)),queryString}var observable=null;historyEnabled?History.Adapter.bind(window,"statechange",function(){null!=observable&&observable(getState())}):window.addEventListener("hashchange",function(){if(null!=observable){var state=getState();observable()!==state&&observable(state)}},!1);var state=getState();return(observable=ko.observable(state||defaultValue)).subscribe(function(newValue){var queryString;if(historyEnabled){var state=History.getState();state[parameterName]=newValue,queryString="?"+getQueryStringParametersWithValueForParameter(cleanQueryString(state.url),newValue),History.pushState(state,state.title,queryString)}else queryString="#"+getQueryStringParametersWithValueForParameter(cleanQueryString(document.location.hash),newValue),document.location.hash=queryString}),observable}})}),ko.observableQueryParameter=function(parameterName,defaultValue){var navigationManager=Bifrost.navigation.navigationManager;return Bifrost.navigation.observableQueryParameterFactory.create().create(parameterName,defaultValue,navigationManager)},Bifrost.namespace("Bifrost.navigation",{DataNavigationFrameAttributeElementVisitor:Bifrost.markup.ElementVisitor.extend(function(documentService){this.visit=function(element,actions){var dataNavigationFrame=element.attributes.getNamedItem("data-navigation-frame");if(!Bifrost.isNullOrUndefined(dataNavigationFrame)){var dataBindString="",dataBind=element.attributes.getNamedItem("data-bind");Bifrost.isNullOrUndefined(dataBind)?dataBind=document.createAttribute("data-bind"):dataBindString=dataBind.value+", ",dataBind.value=dataBindString+"navigation: '"+dataNavigationFrame.value+"'",element.attributes.setNamedItem(dataBind),element.attributes.removeNamedItem("data-navigation-frame")}}})}),Bifrost.namespace("Bifrost.navigation",{navigationBindingHandler:Bifrost.Type.extend(function(){function getNavigationFrameFor(valueAccessor){for(var configurationString=ko.utils.unwrapObservable(valueAccessor()),configurationItems=ko.expressionRewriting.parseObjectLiteral(configurationString),configuration={},index=0;index<configurationItems.length;index++){var item=configurationItems[index];configuration[item.key.trim()]=item.value.trim()}var uriMapperName=configuration.uriMapper;Bifrost.isNullOrUndefined(uriMapperName)&&(uriMapperName="default");var mapper=Bifrost.uriMappers[uriMapperName];return Bifrost.navigation.NavigationFrame.create({locationAware:!1,uriMapper:mapper,home:configuration.home||""})}function makeValueAccessor(navigationFrame){return function(){return navigationFrame.currentUri()}}this.init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var navigationFrame=getNavigationFrameFor(valueAccessor);return navigationFrame.configureFor(element),ko.bindingHandlers.view.init(element,makeValueAccessor(navigationFrame),allBindingsAccessor,viewModel,bindingContext)},this.update=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var navigationFrame=getNavigationFrameFor(valueAccessor);return navigationFrame.configureFor(element),ko.bindingHandlers.view.update(element,makeValueAccessor(navigationFrame),allBindingsAccessor,viewModel,bindingContext)}})}),Bifrost.navigation.navigationBindingHandler.initialize=function(){ko.bindingHandlers.navigation=Bifrost.navigation.navigationBindingHandler.create(),ko.jsonExpressionRewriting.bindingRewriteValidators.navigation=!1,ko.virtualElements.allowedBindings.navigation=!0},Bifrost.namespace("Bifrost.values",{TypeConverter:Bifrost.Type.extend(function(){this.supportedType=null,this.convertFrom=function(value){return value},this.convertTo=function(value){return value}})}),Bifrost.namespace("Bifrost.values",{NumberTypeConverter:Bifrost.values.TypeConverter.extend(function(){function stripLetters(value){value=value.toString();for(var returnValue="",charIndex=0;charIndex<value.length;charIndex++)for(var allowedCharIndex=0;allowedCharIndex<allowedCharacters.length;allowedCharIndex++)if(value[charIndex]===allowedCharacters[allowedCharIndex]){!0,returnValue+=value[charIndex];break}return returnValue}var allowedCharacters="0123456789.,-";this.supportedType=Number,this.convertFrom=function(value){if(value.constructor===Number)return value;if(""===value)return 0;return(value=stripLetters(value)).indexOf(".")>=0?parseFloat(value):parseInt(value)}})}),Bifrost.namespace("Bifrost.values",{DateTypeConverter:Bifrost.values.TypeConverter.extend(function(){function isNull(time){return Bifrost.isNullOrUndefined(time)||"0001-01-01T00:00:00"===time||"0001-01-01T00:00:00Z"===time||time instanceof Date&&-621355968e5===time.getTime()||time instanceof Date&&isNaN(time.getTime())}this.supportedType=Date,this.convertFrom=function(value){return isNull(value)?null:new Date(value)},this.convertTo=function(value){return value.format("yyyy-MM-dd")}})}),Bifrost.namespace("Bifrost.values",{StringTypeConverter:Bifrost.values.TypeConverter.extend(function(){this.supportedType=String,this.convertFrom=function(value){return value.toString()}})}),Bifrost.namespace("Bifrost.values",{typeConverters:Bifrost.Singleton(function(){var convertersByType={},typeConverterTypes=Bifrost.values.TypeConverter.getExtenders();typeConverterTypes.forEach(function(type){var converter=type.create();convertersByType[converter.supportedType]=converter}),this.convertFrom=function(value,type){var actualType=null;return actualType=Bifrost.isString(type)?eval(type):type,convertersByType.hasOwnProperty(actualType)?convertersByType[actualType].convertFrom(value):value},this.convertTo=function(value){if(Bifrost.isNullOrUndefined(value))return value;for(var converter in convertersByType)if(value.constructor==converter)return convertersByType[converter].convertTo(value);return value}})}),Bifrost.WellKnownTypesDependencyResolver.types.typeConverters=Bifrost.values.typeConverters,Bifrost.namespace("Bifrost.values",{typeExtender:Bifrost.Singleton(function(){this.extend=function(target,typeAsString){target._typeAsString=typeAsString}})}),ko.extenders.type=Bifrost.values.typeExtender.create().extend,Bifrost.namespace("Bifrost.values",{Formatter:Bifrost.Type.extend(function(){this.supportedType=null,this.format=function(value,format){return value}})}),Bifrost.namespace("Bifrost.values",{DateFormatter:Bifrost.values.Formatter.extend(function(){this.supportedType=Date,this.format=function(value,format){return value.format(format)}})}),Bifrost.namespace("Bifrost.values",{stringFormatter:Bifrost.Singleton(function(){function getFormat(element){if(1!==element.nodeType||Bifrost.isNullOrUndefined(element.attributes))return null;var stringFormatAttribute=element.attributes.getNamedItem("data-stringformat");return Bifrost.isNullOrUndefined(stringFormatAttribute)?null:stringFormatAttribute.value}var formattersByType={};Bifrost.values.Formatter.getExtenders().forEach(function(type){var formatter=type.create();formattersByType[formatter.supportedType]=formatter}),this.hasFormat=function(element){return null!==getFormat(element)},this.format=function(element,value){var format=getFormat(element);if(formattersByType.hasOwnProperty(value.constructor)){var formatter=formattersByType[value.constructor],regex=new RegExp("{(.[^{}])*}","g");return format.replace(regex,function(formatExpression){var expression=formatExpression.substr(1,formatExpression.length-2);return formatter.format(value,expression)})}return format}})}),Bifrost.namespace("Bifrost.values",{valuePipeline:Bifrost.Singleton(function(typeConverters,stringFormatter){this.getValueForView=function(element,value){if(Bifrost.isNullOrUndefined(value))return value;var actualValue=ko.utils.unwrapObservable(value);if(Bifrost.isNullOrUndefined(actualValue))return value;var returnValue=actualValue;return stringFormatter.hasFormat(element)?returnValue=stringFormatter.format(element,actualValue):Bifrost.isNullOrUndefined(value._typeAsString)||(returnValue=typeConverters.convertTo(actualValue)),returnValue},this.getValueForProperty=function(property,value){return Bifrost.isNullOrUndefined(property)?value:Bifrost.isNullOrUndefined(value)?value:(Bifrost.isNullOrUndefined(property._typeAsString)||(value=typeConverters.convertFrom(value,property._typeAsString)),value)}})}),function(){var valuePipeline=Bifrost.values.valuePipeline.create(),oldReadValue=ko.selectExtensions.readValue;ko.selectExtensions.readValue=function(element){var value=oldReadValue(element),bindings=ko.bindingProvider.instance.getBindings(element,ko.contextFor(element));return Bifrost.isNullOrUndefined(bindings)?value:valuePipeline.getValueForProperty(bindings.value,value)};var oldWriteValue=ko.selectExtensions.writeValue;ko.selectExtensions.writeValue=function(element,value,allowUnset){var result=value,bindings=ko.bindingProvider.instance.getBindings(element,ko.contextFor(element));Bifrost.isNullOrUndefined(bindings)||(result=ko.utils.unwrapObservable(valuePipeline.getValueForView(element,bindings.value))),oldWriteValue(element,result,allowUnset)};var oldSetTextContent=ko.utils.setTextContent;ko.utils.setTextContent=function(element,value){var result=valuePipeline.getValueForView(element,value);oldSetTextContent(element,result)};var oldSetHtml=ko.utils.setHtml;ko.utils.setHtml=function(element,value){var result=valuePipeline.getValueForView(element,value);oldSetHtml(element,result)}}(),Bifrost.namespace("Bifrost.values",{ValueProvider:Bifrost.Type.extend(function(){this.defaultProperty=null,this.provide=function(consumer){}})}),Bifrost.namespace("Bifrost.values",{valueProviders:Bifrost.Singleton(function(){this.isKnown=function(name){var found=!1;return Bifrost.values.ValueProvider.getExtenders().forEach(function(valueProviderType){valueProviderType._name.toLowerCase()!==name||(found=!0)}),found},this.getInstanceOf=function(name){var instance=null;return Bifrost.values.ValueProvider.getExtenders().forEach(function(valueProviderType){valueProviderType._name.toLowerCase()!==name||(instance=valueProviderType.create())}),instance}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueProviders=Bifrost.values.valueProviders,Bifrost.namespace("Bifrost.values",{ValueConsumer:Bifrost.Type.extend(function(){this.canNotifyChanges=function(){return!1},this.notifyChanges=function(callback){},this.consume=function(value){}})}),Bifrost.namespace("Bifrost.values",{valueConsumers:Bifrost.Singleton(function(){this.getFor=function(instance,propertyName){return Bifrost.values.DefaultValueConsumer.create({target:instance,property:propertyName})}})}),Bifrost.WellKnownTypesDependencyResolver.types.valueConsumers=Bifrost.values.valueConsumers,Bifrost.namespace("Bifrost.values",{Binding:Bifrost.values.ValueProvider.extend(function(bindingContextManager){this.defaultProperty="path",this.path="",this.mode=null,this.converter=null,this.format=null,this.provide=function(consumer){}})}),Bifrost.namespace("Bifrost.values",{DefaultValueConsumer:Bifrost.values.ValueConsumer.extend(function(target,property){this.consume=function(value){target[property]=value}})}),Bifrost.namespace("Bifrost",{configurator:Bifrost.Type.extend(function(){this.configure=function(configure){}})}),Bifrost.namespace("Bifrost",{configureType:Bifrost.Singleton(function(assetsManager){function onReady(){Bifrost.views.Region.current=document.body.region,self.isReady=!0;for(var callbackIndex=0;callbackIndex<self.readyCallbacks.length;callbackIndex++)self.readyCallbacks[callbackIndex]()}function hookUpNavigaionAndApplyViewModel(){Bifrost.navigation.navigationManager.hookup(),!0===self.applyMasterViewModel&&Bifrost.views.viewModelManager.create().masterViewModel.apply()}function onStartup(){Bifrost.configurator.getExtenders().forEach(function(configuratorType){configuratorType.create().config(self)}),Bifrost.dependencyResolvers.DOMRootDependencyResolver.documentIsReady(),Bifrost.views.viewModelBindingHandler.initialize(),Bifrost.views.viewBindingHandler.initialize(),Bifrost.navigation.navigationBindingHandler.initialize(),"undefined"!=typeof History&&void 0!==History.Adapter&&(Bifrost.WellKnownTypesDependencyResolver.types.history=History),assetsManager.initialize().continueWith(function(){!0===self.initializeLandingPage?Bifrost.views.viewManager.create().initializeLandingPage().continueWith(hookUpNavigaionAndApplyViewModel):hookUpNavigaionAndApplyViewModel(),onReady()})}var self=this,defaultUriMapper=Bifrost.StringMapper.create();defaultUriMapper.addMapping("{boundedContext}/{module}/{feature}/{view}","{boundedContext}/{module}/{feature}/{view}.html"),defaultUriMapper.addMapping("{boundedContext}/{feature}/{view}","{boundedContext}/{feature}/{view}.html"),defaultUriMapper.addMapping("{feature}/{view}","{feature}/{view}.html"),defaultUriMapper.addMapping("{view}","{view}.html"),Bifrost.uriMappers.default=defaultUriMapper,this.isReady=!1,this.readyCallbacks=[],this.initializeLandingPage=!0,this.applyMasterViewModel=!0,this.ready=function(callback){!0===self.isReady?callback():self.readyCallbacks.push(callback)},$(function(){onStartup()})})}),Bifrost.configure=Bifrost.configureType.create();